<!DOCTYPE html>
<html lang="en">
<head>
<!--  2024-06-25 Tue 14:17  -->
<meta charset="utf-8" />
<meta content="width=device-width, initial-scale=1" name="viewport" />
<title>‎</title>
<meta content="Vindaar" name="author" />
<meta content="Org Mode" name="generator" />

<link type="text/css" rel="stylesheet" href="org_html_export.css" />
<script type="text/javascript">

document.addEventListener('DOMContentLoaded', function() {
    // Set the initial width for subfigures and their images
    document.querySelectorAll('figure.subfigure[data-width]').forEach(function(subfigure) {
        subfigure.style.width = subfigure.getAttribute('data-width');
    });

    document.querySelectorAll('figure.subfigure img[data-width]').forEach(function(img) {
        img.style.width = img.getAttribute('data-width');
    });

    // Event listener for images within subfigures
    document.querySelectorAll('figure.subfigure img[data-width]').forEach(function(img) {
        img.addEventListener('click', function() {
            // Determine the .figure-wrapper that contains the clicked image
            let wrapper = this.closest('.figure-wrapper');

            // If found, adjust the sizes of its subfigures
            if (wrapper) {
                let subfigures = wrapper.querySelectorAll('figure.subfigure');
                subfigures.forEach(subfigure => {
                    let width = parseFloat(subfigure.getAttribute('data-width'));
                    if (width < 50) { // Double size if less than 50%
                        subfigure.setAttribute('data-width', (width * 2) + '%');
                        subfigure.style.width = (width * 2) + '%';
                    } else { // Halve size otherwise
                        subfigure.setAttribute('data-width', (width / 2) + '%');
                        subfigure.style.width = (width / 2) + '%';
                    }
                });
            }
        });
    });
});

document.addEventListener('DOMContentLoaded', function () {
    var headers = document.querySelectorAll('h1 .extended, h2 .extended, h3 .extended, h4 .extended, h5 .extended, h6 .extended');

    headers.forEach(function (header) {
        var foldableHeader = header.closest('h1, h2, h3, h4, h5, h6');
        if (foldableHeader) {
            foldableHeader.classList.add('foldable-header');
            var nextElement = foldableHeader.nextElementSibling;
            var contentToFold = [];
            while (nextElement && !nextElement.matches('h1, h2, h3, h4, h5, h6')) {
                contentToFold.push(nextElement);
                nextElement = nextElement.nextElementSibling;
            }
            contentToFold.forEach(function (element) {
                element.classList.add('folded-content');
            });

            foldableHeader.addEventListener('click', function () {
                contentToFold.forEach(function (element) {
                    if (element.style.display === 'none' || element.style.display == '') {
                        element.style.display = 'block';
                    } else {
                        element.style.display = 'none';
                    }
                });
            });
        }
    });
});

</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript"></script>
<script type="text/x-mathjax-config">
<!-- /* --><![CDATA[/*><!--*/
    MathJax.Hub.Config({
        jax: ["input/TeX", "output/HTML-CSS"],
        extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js",
                     "TeX/noUndefined.js", "[Contrib]/siunitx/siunitx.js", "[Contrib]/mhchem/mhchem.js"],
        tex2jax: {
            inlineMath: [ ["\\(","\\)"], ['$', '$'], ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"], ["\\begin{displaymath}","\\end{displaymath}"] ],
            skipTags: ["script","noscript","style","textarea","pre","code"],
            ignoreClass: "tex2jax_ignore",
            processEscapes: false,
            processEnvironments: true,
            preview: "TeX"
        },
        showProcessingMessages: true,
        displayAlign: "center",
        displayIndent: "2em",

        "HTML-CSS": {
             scale: 1.0,
             availableFonts: ["STIX","TeX"],
             preferredFont: "TeX",
             webFont: "TeX",
             imageFont: "TeX",
             showMathMenu: true,
        },
        MMLorHTML: {
             prefer: {
                 MSIE:    "MML",
                 Firefox: "MML",
                 Opera:   "HTML",
                 other:   "HTML"
             }
        },
        TeX: {
              equationNumbers: { autoNumber: 'AMS' },
              Macros: {
                  ccsini: '{\\mathrm{Si}₃\\mathrm{N}₄}',
                  cefe: '{\\ce{^{55}Fe}}',
                  vektor: ['{\\begin{pmatrix}#1\\end{pmatrix}}', 1],
                  mtrix: ['{\\begin{pmatrix}#1\\end{pmatrix}}', 1],
                  cp: '{\\mathrm{CP}}',
                  cpt: '{\\mathrm{CPT}}',
                  dd: '{\\mathop{}\\!{\\mathrm{d}}}',
                  sinc: '{\\mathrm{sinc}}'
              }
        }
    });
/*]]>*///--&gt;
</script>
</head>
<body>
<div id="content" class="content">
<nav role="doc-toc" id="table-of-contents">
<h2>Table of Contents</h2>
<div role="doc-toc" id="text-table-of-contents">
<ul>
<li>  <a href="./errata.html#sec:errata">1. Errata   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./introduction.html#sec:introduction">2. Introduction   <span class="tag">    <span class="Intro">Intro</span>  </span></a></li>
<li><a href="./about_thesis.html#sec:about_thesis">3. About this thesis   <span class="tag">  <span class="Intro">Intro</span></span></a>
<ul>
<li>  <a href="./about_thesis.html#orgfbe9803">3.1. Extended notes for the extended thesis <code>[/]</code>   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./about_thesis.html#org440d307">3.2. Why Org mode   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./about_thesis.html#org1090aaf">3.3. Notes for future PhD students and IAXO analyses   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li><a href="./theory.html#sec:theory">4. Theory of axions   <span class="tag">  <span class="Theory">Theory</span></span></a>
<ul>
<li>  <a href="./theory.html#sec:theory:useful_reading_material">4.1. Useful reading material   <span class="tag">    <span class="optional">optional</span>  </span></a></li>
<li>  <a href="./theory.html#sec:theory:illustration_cpt">4.2. Illustration of the \cpt symmetry <code>[/]</code>   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./theory.html#sec:theory:invisible_axion_models">4.3. Invisible axion models and axion couplings</a></li>
<li>  <a href="./theory.html#sec:theory:axion_interactions">4.4. Implications for axion interactions - conversion probability</a></li>
<li>  <a href="./theory.html#sec:theory:solar_axion_flux">4.5. Solar axion flux</a></li>
<li>  <a href="./theory.html#sec:theory:chameleon">4.6. Chameleons</a></li>
<li>  <a href="./theory.html#sec:theory:current_bounds">4.7. Current bounds on coupling constants</a></li>
</ul>
</li>
<li><a href="./helioscopes.html#sec:helioscopes">5. Axion helioscopes   <span class="tag">  <span class="Theory">Theory</span></span></a>
<ul>
<li>  <a href="./helioscopes.html#sec:helioscopes:cast">5.1. CERN Axion Solar Telescope (CAST)</a></li>
<li>  <a href="./helioscopes.html#sec:helioscopes:iaxo">5.2. International AXion Observatory (IAXO)</a></li>
</ul>
</li>
<li><a href="./theory_detector.html#sec:theory_detector">6. X-rays, cosmic muons and gaseous detectors   <span class="tag">  <span class="Theory">Theory</span></span></a>
<ul>
<li>  <a href="./theory_detector.html#sec:theory:particle_int">6.1. Particle interactions with matter</a></li>
<li>  <a href="./theory_detector.html#sec:theory:cosmic_radiation">6.2. Cosmic rays</a></li>
<li>  <a href="./theory_detector.html#sec:theory:gas_fundamentals">6.3. Gaseous detector fundamentals</a></li>
</ul>
</li>
<li><a href="./septemboard.html#sec:septemboard">7. Septemboard detector   <span class="tag">  <span class="Detector">Detector</span></span></a>
<ul>
<li>  <a href="./septemboard.html#sec:detector:micromegas">7.1. Micromegas working principle</a></li>
<li>  <a href="./septemboard.html#sec:detector:timepix">7.2. Timepix ASIC</a></li>
<li>  <a href="./septemboard.html#sec:detector:gridpix">7.3. GridPix</a></li>
<li>  <a href="./septemboard.html#sec:detector:detector_2014_15">7.4. 2014 / 2015 GridPix detector for CAST</a></li>
<li>  <a href="./septemboard.html#sec:detector:detector_overview">7.5. Septemboard detector overview</a></li>
<li>  <a href="./septemboard.html#orgaff9f43">7.6. Detector readout system</a></li>
<li>  <a href="./septemboard.html#sec:detector:scintillators">7.7. Scintillator vetoes</a></li>
<li>  <a href="./septemboard.html#sec:detector:fadc">7.8. FADC</a></li>
<li>  <a href="./septemboard.html#sec:detector:sin_window">7.9. SiN window</a></li>
<li>  <a href="./septemboard.html#sec:detector:septemboard">7.10. Septemboard - 6 GridPixes around a center one</a></li>
<li>  <a href="./septemboard.html#sec:detector:water_cooling">7.11. Water cooling and temperature readout for the septemboard</a></li>
<li>  <a href="./septemboard.html#sec:septem:efficiency">7.12. Detector efficiency</a></li>
<li>  <a href="./septemboard.html#sec:detector:daq">7.13. Data acquisition and detector monitoring</a></li>
</ul>
</li>
<li><a href="./operation_calibration.html#sec:operation_calibration">8. Detector calibration for operation   <span class="tag">  <span class="Detector">Detector</span></span></a>
<ul>
<li>  <a href="./operation_calibration.html#sec:operation_calibration:timepix">8.1. Timepix calibrations</a></li>
<li>  <a href="./operation_calibration.html#sec:operation_calibration:fadc">8.2. FADC calibration</a></li>
<li>  <a href="./operation_calibration.html#sec:operation_calibration:scintillators">8.3. Scintillator calibration</a></li>
</ul>
</li>
<li><a href="./reconstruction.html#sec:reconstruction">9. Data reconstruction   <span class="tag">  <span class="Reconstruction">Reconstruction</span></span></a>
<ul>
<li>  <a href="./reconstruction.html#sec:reco:tpa">9.1. <code>TimepixAnalysis</code> and Nim</a></li>
<li>  <a href="./reconstruction.html#sec:reco:tos_data_parsing">9.2. TOS data parsing</a></li>
<li>  <a href="./reconstruction.html#sec:reco:event_shape">9.3. Expectation of event shapes</a></li>
<li>  <a href="./reconstruction.html#sec:reco:data_reconstruction">9.4. Data reconstruction</a></li>
<li>  <a href="./reconstruction.html#sec:reco:fadc_data">9.5. FADC reconstruction</a></li>
<li>  <a href="./reconstruction.html#sec:reco:scintillator_data">9.6. Scintillator data</a></li>
</ul>
</li>
<li><a href="./cast.html#sec:cast">10. Detector installation &amp; data taking at CAST   <span class="tag">  <span class="CAST">CAST</span></span></a>
<ul>
<li>  <a href="./cast.html#sec:cast:timeline">10.1. Timeline</a></li>
<li>  <a href="./cast.html#sec:cast:alignment">10.2. Alignment</a></li>
<li>  <a href="./cast.html#sec:cast:detector_setup">10.3. Detector setup at CAST</a></li>
<li>  <a href="./cast.html#sec:cast:window_accident">10.4. Window accident</a></li>
<li>  <a href="./cast.html#sec:cast:data_taking_woes">10.5. Data taking woes</a></li>
<li>  <a href="./cast.html#sec:cast:data_taking_campaigns">10.6. Summary of CAST data taking</a></li>
</ul>
</li>
<li><a href="./calibration.html#sec:calibration">11. Data calibration   <span class="tag">  <span class="Calibration">Calibration</span></span></a>
<ul>
<li>  <a href="./calibration.html#sec:calibration:energy">11.1. Energy calibration - in principle</a></li>
<li>  <a href="./calibration.html#sec:calib:detector_behavior_over_time">11.2. Detector behavior over time</a></li>
<li>  <a href="./calibration.html#sec:calib:final_energy_calibration">11.3. Energy calibration dependence on the gas gain</a></li>
<li>  <a href="./calibration.html#sec:calib:fadc">11.4. FADC</a></li>
</ul>
</li>
<li><a href="./background.html#sec:background">12. Finding signal and defining background | Background rate computation   <span class="tag">  <span class="Analysis">Analysis</span></span></a>
<ul>
<li>  <a href="./background.html#sec:background:likelihood_method">12.1. Likelihood method</a></li>
<li>  <a href="./background.html#sec:cdl">12.2. CAST Detector Lab</a></li>
<li>  <a href="./background.html#sec:background:likelihood_cut">12.3. Application of likelihood cut for background rate</a></li>
<li>  <a href="./background.html#sec:background:mlp">12.4. Artificial neural networks as cluster classifiers</a></li>
<li>  <a href="./background.html#sec:background:additional_vetoes">12.5. Additional detector features as vetoes</a></li>
<li>  <a href="./background.html#sec:background:all_vetoes_combined">12.6. Background rates of combined vetoes and efficiencies</a></li>
</ul>
</li>
<li><a href="./limit.html#sec:limit">13. Limit calculation   <span class="tag">  <span class="Limit">Limit</span></span></a>
<ul>
<li>  <a href="./limit.html#sec:limit:method_introduction">13.1. Limit method - introduction</a></li>
<li>  <a href="./limit.html#sec:limit:method_likelihood">13.2. Limit method - likelihood function \(\mathcal{L}\)</a></li>
<li>  <a href="./limit.html#sec:limit:method_computing_L">13.3. Limit method - computing \(\mathcal{L}\)</a></li>
<li>  <a href="./limit.html#sec:limit:method_computing_a_limit">13.4. Limit method - computing a limit</a></li>
<li>  <a href="./limit.html#sec:limit:method_expected_limit">13.5. Limit method - toy candidate sets and expected limits</a></li>
<li>  <a href="./limit.html#sec:limit:method_systematics">13.6. Limit method - extending \(\mathcal{L}\) for systematics</a></li>
<li>  <a href="./limit.html#sec:limit:method_mcmc">13.7. Limit method - evaluating \(\mathcal{L}\) with nuisance parameters</a></li>
<li>  <a href="./limit.html#orgc19f576">13.8. Note about likelihood integral   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./limit.html#org2a59043">13.9. Derivation of short form of \(\mathcal{L}\) <code>[/]</code>   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./limit.html#sec:limit:ingredients">13.10. Likelihood ingredients in detail</a></li>
<li>  <a href="./limit.html#sec:limit:systematics">13.11. Systematics</a></li>
<li>  <a href="./limit.html#sec:limit:mcmc_calc_limit">13.12. MCMC to sample the distribution and compute a limit</a></li>
<li>  <a href="./limit.html#sec:limit:expected_limits">13.13. Expected limits of different setups</a></li>
<li>  <a href="./limit.html#sec:limit:candidates">13.14. Solar tracking candidates</a></li>
<li>  <a href="./limit.html#sec:limit:observed_limit">13.15. Observed limit - \(g_{ae}\)</a></li>
<li>  <a href="./limit.html#sec:limit:other_couplings">13.16. Other coupling constants</a></li>
<li>  <a href="./limit.html#org0e96f12">13.17. Comparison to 2013 limit (using their method)   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./limit.html#orgfc85c61">13.18. Observed limit for different axion masses   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li>  <a href="./outlook.html#sec:outlook">14. Outlook</a></li>
<li>  <a href="./summary.html#sec:summary">15. Summary &amp; conclusion</a></li>
<li>  <a href="./bibliography.html#sec:bibliography">16. Bibliography   <span class="tag">    <span class="html">html</span>  </span></a></li>
<li><a href="./daq.html#sec:daq">17. Data acquisition and detector monitoring   <span class="tag"><span class="Appendix">Appendix</span> <span class="Detector">Detector</span></span></a>
<ul>
<li>  <a href="./daq.html#sec:daq:tof">17.1. Timepix Operating Firmware - TOF</a></li>
<li>  <a href="./daq.html#sec:daq:tos">17.2. Timepix Operating Software - TOS</a></li>
<li>  <a href="./daq.html#sec:daq:septemboard_event_display">17.3. Septemboard event display</a></li>
</ul>
</li>
<li><a href="./configuration.html#sec:appendix:configuration">18. Configuration and TOS / TOF versions   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./configuration.html#sec:appendix:configuration:tos_config">18.1. TOS configuration file</a></li>
<li>  <a href="./configuration.html#sec:appendix:configuration:tos_tof_versions">18.2. TOS and TOF versions used at CAST</a></li>
</ul>
</li>
<li><a href="./calibration.html#sec:appendix:calibration">19. Calibrations   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./calibration.html#sec:appendix:calibration:timepix">19.1. Timepix calibrations</a></li>
<li>  <a href="./calibration.html#sec:appendix:septemboard_calibrations">19.2. Septemboard calibration</a></li>
<li>  <a href="./calibration.html#sec:appendix:scintillator_calibration_notes">19.3. Calibration measurements of the veto scintillator paddle   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li><a href="./cast_operations.html#sec:appendix:cast_operations">20. CAST operation procedures   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./cast_operations.html#sec:appendix:cast_operations:terminology">20.1. CAST terminology</a></li>
<li>  <a href="./cast_operations.html#sec:cast:high_voltage">20.2. High voltage supply</a></li>
<li>  <a href="./cast_operations.html#sec:cast:vacuum_system">20.3. Vacuum system</a></li>
<li>  <a href="./cast_operations.html#sec:cast:watercooling_gas">20.4. Watercooling system &amp; gas supply</a></li>
<li>  <a href="./cast_operations.html#sec:cast:interlock_systems">20.5. Interlock systems</a></li>
<li>  <a href="./cast_operations.html#sec:appendix:cast_log_files">20.6. CAST log files</a></li>
</ul>
</li>
<li><a href="./cast_run_list.html#sec:appendix:cast_run_list">21. CAST data taking run list   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./cast_run_list.html#orgb33251e">21.1. Full version   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li><a href="./cast_data_taking_notes.html#sec:appendix:cast_data_taking_notes">22. CAST data taking notes <code>[0/1]</code>   <span class="tag"><span class="Appendix">Appendix</span> <span class="extended">extended</span></span></a>
<ul>
<li>  <a href="./cast_data_taking_notes.html#org05f7e0f">22.1. Run table</a></li>
<li>  <a href="./cast_data_taking_notes.html#org7394dc2">22.2. Data runs</a></li>
<li>  <a href="./cast_data_taking_notes.html#orgdb2c57f">22.3. Calibration runs</a></li>
<li>  <a href="./cast_data_taking_notes.html#orgb70c00a">22.4. Automatically generated run list</a></li>
<li>  <a href="./cast_data_taking_notes.html#org6e5236a">22.5. Automatically calculated total run times</a></li>
<li>  <a href="./cast_data_taking_notes.html#orgcc95a0e">22.6. InGrid temperature from shift forms</a></li>
</ul>
</li>
<li><a href="./cabling_and_softwar_setup.html#sec:appendix:cabling_and_softwar_setup">23. Cabling &amp; software setup <code>[/]</code>   <span class="tag"><span class="Appendix">Appendix</span> <span class="extended">extended</span></span></a>
<ul>
<li>  <a href="./cabling_and_softwar_setup.html#org1b11899">23.1. Virtex V6 cabling</a></li>
<li>  <a href="./cabling_and_softwar_setup.html#orgd7f1578">23.2. Detector cabling</a></li>
<li>  <a href="./cabling_and_softwar_setup.html#orga067de2">23.3. Vivado / ISE on void linux &amp; flashing Virtex V6</a></li>
<li>  <a href="./cabling_and_softwar_setup.html#org161062c">23.4. Setting up the chips in TOS</a></li>
</ul>
</li>
<li><a href="./vacuum_contamination.html#sec:appendix:vacuum_contamination">24. Window rupture and vacuum contamination   <span class="tag"><span class="Appendix">Appendix</span> <span class="extended">extended</span></span></a>
<ul>
<li>  <a href="./vacuum_contamination.html#orgc569a37">24.1. Calculation of vacuum volume</a></li>
<li>  <a href="./vacuum_contamination.html#org15cc216">24.2. Calculation of potential influx of gas</a></li>
<li>  <a href="./vacuum_contamination.html#org8ea925c">24.3. Consider pumping of pumps</a></li>
<li>  <a href="./vacuum_contamination.html#org819d69c">24.4. Calculation of possible contamination</a></li>
</ul>
</li>
<li><a href="./detector_time_behavior.html#sec:appendix:detector_time_behavior">25. Detector behavior over time   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./detector_time_behavior.html#sec:appendix:choice_gas_gain_binning">25.1. Choice of gas gain binning time interval</a></li>
<li>  <a href="./detector_time_behavior.html#sec:appendix:correlation_gas_gain_ambient_temp">25.2. Correlation of gas gain and ambient CAST temperature</a></li>
</ul>
</li>
<li><a href="./cast_detector_lab.html#sec:appendix:cast_detector_lab">26. CAST Detector Lab data   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./cast_detector_lab.html#orga19ac1b">26.1. Generate all spectrum plots split by run   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./cast_detector_lab.html#sec:appendix:cdl_spectra_by_run">26.2. All spectra split by run</a></li>
<li>  <a href="./cast_detector_lab.html#sec:appendix:cdl:all_spectra_fits">26.3. All CDL spectra with line fits   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./cast_detector_lab.html#sec:appendix:cdl:all_spectra_fits_by_run">26.4. All CDL spectra with line fits by run</a></li>
</ul>
</li>
<li><a href="./fit_by_run_justification.html#sec:appendix:fit_by_run_justification">27. CAST Detector Lab variations and fitting by run   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./fit_by_run_justification.html#sec:appendix:fit_by_run:gas_gain_var_cluster_prop">27.1. Influence of gas gain variations on cluster properties</a></li>
</ul>
</li>
<li><a href="./morphing_cdl_spectra.html#sec:appendix:morphing_cdl_spectra">28. Morphing of CDL reference spectra   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./morphing_cdl_spectra.html#org0265ab6">28.1. Generate all morphing / tile related plots   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./morphing_cdl_spectra.html#org8bc5717">28.2. Generate plot comparing likelihood behavior   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./morphing_cdl_spectra.html#sec:appendix:morphing_cdl_spectra:tilemaps">28.3. Tilemap of each likelihood dataset</a></li>
<li>  <a href="./morphing_cdl_spectra.html#sec:appendix:morphing_cdl_spectra:interpolation_raster">28.4. Interpolation of each likelihood dataset</a></li>
<li>  <a href="./morphing_cdl_spectra.html#sec:appendix:morphing_cdl_spectra:binwise_linear">28.5. Binwise linear interpolations for each likelihood dataset</a></li>
<li>  <a href="./morphing_cdl_spectra.html#sec:appendix:morphing_cdl_spectra:notes">28.6. Notes on CDL morphing development   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li><a href="./occupancy.html#sec:appendix:occupancy">29. Occupancy maps   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./occupancy.html#org479bdea">29.1. Run-2</a></li>
<li>  <a href="./occupancy.html#org01c4816">29.2. Run-3</a></li>
<li>  <a href="./occupancy.html#org4b0d778">29.3. Generate occupancy map plots   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li><a href="./fadc.html#sec:appendix:fadc">30. FADC   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./fadc.html#sec:appendix:fadc:rise_fall">30.1. FADC rise and fall time</a></li>
<li>  <a href="./fadc.html#sec:appendix:background:fadc">30.2. FADC veto</a></li>
<li>  <a href="./fadc.html#orgbca5f22">30.3. Generate plot of rise time vs skewness   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./fadc.html#sec:appendix:fadc_veto_empirical_cluster_length">30.4. Expected cluster size</a></li>
</ul>
</li>
<li><a href="./background_rates.html#sec:appendix:background_rates">31. Raw data and background rates   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./background_rates.html#sec:appendix:background_rates:full_chip">31.1. Background rates over full chip</a></li>
<li>  <a href="./background_rates.html#orgef7b3d8">31.2. Generate rate without any vetoes over full chip   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./background_rates.html#org6d2bec5">31.3. Generate background rates over full chip   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./background_rates.html#orga3f0df1">31.4. Generate table of background rates for all setups   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li>  <a href="./background_interpolation_chip_area.html#sec:appendix:background_interpolation_chip_area">32. Background interpolation chip cutout correction   <span class="tag">    <span class="Appendix">Appendix</span>  </span></a></li>
<li><a href="./limit_additional.html#sec:appendix:limit_additional">33. Additional limit information   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./limit_additional.html#sec:appendix:conversion_probability">33.1. Conversion probability as a function of mass   <span class="tag">    <span class="Appendix">Appendix</span>  </span></a></li>
<li>  <a href="./limit_additional.html#sec:appendix:exp_limit_percentiles">33.2. Expected limit table with percentiles</a></li>
<li>  <a href="./limit_additional.html#sec:appendix:limit_additional:axion_photon">33.3. Observed limit - axion photon \(g_{aγ}\)</a></li>
<li>  <a href="./limit_additional.html#sec:appendix:limit_additional:chameleon">33.4. Observed limit - chameleon \(β_γ\)</a></li>
</ul>
</li>
<li><a href="./software.html#sec:appendix:software">34. Software   <span class="tag"><span class="Software">Software</span> <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./software.html#org7bca65c">34.1. Why did I start writing my own analysis framework?   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./software.html#org9f0a545">34.2. Nim   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./software.html#sec:appendix:timepix_analysis">34.3. TimepixAnalysis</a></li>
<li>  <a href="./software.html#org400c48e">34.4. Other libraries relevant for TimepixAnalysis</a></li>
</ul>
</li>
<li><a href="./full_data_reconstruction.html#sec:appendix:full_data_reconstruction">35. Full data reconstruction   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./full_data_reconstruction.html#orge240f30">35.1. Raw data parsing and reconstruction</a></li>
<li>  <a href="./full_data_reconstruction.html#orgb93cc52">35.2. Parse and reconstruct the CDL data</a></li>
<li>  <a href="./full_data_reconstruction.html#orga74a5b7">35.3. Add tracking information to background files</a></li>
<li>  <a href="./full_data_reconstruction.html#org9829d57">35.4. Using <code>runAnalysisChain</code></a></li>
<li>  <a href="./full_data_reconstruction.html#orgdb12e28">35.5. Applying a classifier</a></li>
<li>  <a href="./full_data_reconstruction.html#org1e93ed8">35.6. Computing limits</a></li>
</ul>
</li>
<li><a href="./average_depth_xrays_argon.html#sec:appendix:average_depth_xrays_argon">36. Average distance X-rays travel in argon at CAST conditions   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./average_depth_xrays_argon.html#orgd6eb4a8">36.1. Reference to original document   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./average_depth_xrays_argon.html#orgebfb8f7">36.2. Calculate conversion point numerically</a></li>
<li>  <a href="./average_depth_xrays_argon.html#org3327d77">36.3. Compiling and running the code   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li><a href="./raytracing.html#sec:appendix:raytracing">37. Raytracing   <span class="tag"><span class="Software">Software</span> <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./raytracing.html#sec:appendix:raytracing:traxer">37.1. TrAXer - An interactive axion raytracer</a></li>
<li>  <a href="./raytracing.html#sec:appendix:raytracing:llnl_telescope">37.2. A few more details about the LLNL telescope</a></li>
<li>  <a href="./raytracing.html#sec:appendix:raytracing:panter">37.3. Comparison of TrAXer results with PANTER measurements</a></li>
<li>  <a href="./raytracing.html#sec:appendix:raytracing:axion_image">37.4. Computing an axion image with TrAXer</a></li>
<li>  <a href="./raytracing.html#org1352117">37.5. Reproducing an X-ray finger run with TrAXer   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./raytracing.html#org06f5b15">37.6. Figure error development notes   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li>  <a href="./acknowledgments.html#sec:appendix:acknowledgments">38. Acknowledgments   <span class="tag">    <span class="Ack">Ack</span>  </span></a></li>
</ul>
</div>
</nav>
<div class="outline-2" id="outline-container-sec:appendix:average_depth_xrays_argon">
<h2 id="sec:appendix:average_depth_xrays_argon"><span class="section-number-2">36.</span> Average distance X-rays travel in argon at CAST conditions   <span class="tag">  <span class="Appendix">Appendix</span></span></h2>
<div class="outline-text-2" id="text-sec:appendix:average_depth_xrays_argon">
<blockquote>
<p>
Note: This section and its subsections are also available as a
standalone document titled <code>SolarAxionConversionPoint</code>. It is linked
in the extended thesis and this appendix is only a minor modification.
</p>
</blockquote>

<p>
In order to be able to compute the correct distance to use in the
raytracer for the position of the axion image, we need a good
understanding of where the X-ray will generally convert in the gas.
</p>

<p>
By combining the expected axion flux (folded with the telescope
efficiency and window transmission to get the correct energy
distribution) with the absorption length <sup>  <a role="doc-backlink" class="footref" id="fnr.1" href="#fn.1">1</a></sup> of X-rays at
different energies we can compute a weighted mean of all X-rays and
come up with a single number. The difficulty lies in combining the
statistical process of absorption with the incoming flux
distribution. We implement a numerical Monte Carlo approach in
literate programming style below.
</p>
</div>

<div class="outline-3" id="outline-container-orgd6eb4a8">
<h3 id="orgd6eb4a8"><span class="section-number-3">36.1.</span> Reference to original document   <span class="tag">  <span class="extended">extended</span></span></h3>
<div class="outline-text-3" id="text-36-1">
<p>
As mentioned in the note above, the original document is titled
<code>SolarAxionConversionPoint.org</code>. From the Org file a PDF and HTML
version is produced.
</p>

<p>
These can be found on
</p>

<p>
<a href="http://phd.vindaar.de/docs/SolarAxionConversionPoint/">http://phd.vindaar.de/docs/SolarAxionConversionPoint/</a>
</p>

<p>
That document contains an attempt to compute the same thing
analytically, which as I later realized produces wrong results of
course (at least if done the way I did it there). See the document.
</p>
</div>
</div>


<div class="outline-3" id="outline-container-orgebfb8f7">
<h3 id="orgebfb8f7"><span class="section-number-3">36.2.</span> Calculate conversion point numerically</h3>
<div class="outline-text-3" id="text-36-2">
<p>
In order to calculate the conversion point, we need:
</p>
<ul class="org-ul">
<li>random sampling logic</li>
<li>sampling from exponential distribution depending on energy</li>
<li>the axion flux, telescope effective area and window absorption</li>
</ul>

<p>
Let&apos;s start by importing the modules we need:  
</p>
<div class="org-src-container">
<pre class="src src-nim"><span style="color: #F92672;">import</span> helpers / sampling_helper <span style="color: #75715E;"># </span><span style="color: #75715E;">sampling distributions</span>
<span style="color: #F92672;">import</span> unchained                 <span style="color: #75715E;"># </span><span style="color: #75715E;">sane units</span>
<span style="color: #F92672;">import</span> ggplotnim                 <span style="color: #75715E;"># </span><span style="color: #75715E;">see something!</span>
<span style="color: #F92672;">import</span> xrayAttenuation           <span style="color: #75715E;"># </span><span style="color: #75715E;">window efficiencies</span>
<span style="color: #F92672;">import</span> math, sequtils
</pre>
</div>
<p>
where the <code>sampling_helpers</code> is a small module to sample from a
procedure or a sequence.
</p>

<p>
In addition let&apos;s define some helpers:
</p>
<div class="org-src-container">
<pre class="src src-nim"><span style="color: #F92672;">from</span> os <span style="color: #F92672;">import</span> `/`, expandTilde
<span style="color: #F92672;">const</span> <span style="color: #66D9EF;">ResourcePath</span> = <span style="color: #E6DB74;">&quot;~/org/resources&quot;</span>.expandTilde
<span style="color: #F92672;">const</span> <span style="color: #66D9EF;">OutputPath</span> = <span style="color: #E6DB74;">&quot;~/phd/Figs/axion_conversion_point_sampling/&quot;</span>.expandTilde

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">thm</span><span style="color: #AE81FF;">()</span>: <span style="color: #66D9EF;">Theme</span> =
  <span style="color: #E6DB74;">## A shorthand to define a `</span><span style="color: #AE81FF;">ggplotnim</span><span style="color: #E6DB74;">` theme that looks nice </span>
  <span style="color: #E6DB74;">## in the thesis</span>
  <span style="color: #FD971F;">result</span> = themeLatex<span style="color: #AE81FF;">(</span>fWidth = <span style="font-style: italic;">0</span>.<span style="font-style: italic;">9</span>, width = <span style="font-style: italic;">600</span>, baseTheme = singlePlot<span style="color: #AE81FF;">)</span>
</pre>
</div>

<p>
Now let&apos;s read the LLNL telescope efficiency as well as the axion flux
model. Note that we may wish to calculate the absorption points not
only for a specific axion flux model, but potentially any other kind
of signal. We&apos;ll build in functionality to disable different
contributions.
</p>

<div class="org-src-container">
<pre class="src src-nim"><span style="color: #F92672;">let</span> <span style="color: #FD971F;">flux </span>= <span style="color: #E6DB74;">&quot;solar_axion_flux_differential_g_ae_1e-13_g_ag_1e-12_g_aN_1e-15.csv&quot;</span>
<span style="color: #F92672;">let</span> <span style="color: #FD971F;">dfAx </span>= readCsv<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">ResourcePath</span> / flux<span style="color: #AE81FF;">)</span>
  .filter<span style="color: #AE81FF;">(</span>f<span style="color: #66D9EF;">{</span>`<span style="color: #F92672;">type</span>` == <span style="color: #E6DB74;">&quot;Total flux&quot;</span><span style="color: #66D9EF;">}</span><span style="color: #AE81FF;">)</span>
<span style="color: #F92672;">let</span> <span style="color: #FD971F;">llnl </span>= <span style="color: #E6DB74;">&quot;llnl_xray_telescope_cast_effective_area_parallel_light_DTU_thesis.csv&quot;</span>
<span style="color: #F92672;">let</span> <span style="color: #FD971F;">dfLLNL </span>= readCsv<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">ResourcePath</span> / llnl<span style="color: #AE81FF;">)</span>
  .mutate<span style="color: #AE81FF;">(</span>f<span style="color: #66D9EF;">{</span><span style="color: #E6DB74;">&quot;Efficiency&quot;</span> ~ idx<span style="color: #A6E22E;">(</span><span style="color: #E6DB74;">&quot;EffectiveArea[cm²]&quot;</span><span style="color: #A6E22E;">)</span> / <span style="color: #A6E22E;">(</span><span style="color: #66D9EF;">PI</span> * <span style="font-style: italic;">2</span>.<span style="font-style: italic;">15</span> * <span style="font-style: italic;">2</span>.<span style="font-style: italic;">15</span><span style="color: #A6E22E;">)</span><span style="color: #66D9EF;">}</span><span style="color: #AE81FF;">)</span>
</pre>
</div>
<p>
Note: to get the differential axion flux use <code>readOpacityFile</code> from
<a href="https://github.com/jovoy/AxionElectronLimit">https://github.com/jovoy/AxionElectronLimit</a>. It generates the CSV
file.
</p>

<p>
Next up we need to define the material properties of the detector
window in order to compute its transmission.
</p>
<div class="org-src-container">
<pre class="src src-nim"><span style="color: #F92672;">let</span> <span style="color: #FD971F;">Si</span>₃N₄ = compound<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">(</span><span style="color: #66D9EF;">Si</span>, <span style="font-style: italic;">3</span><span style="color: #66D9EF;">)</span>, <span style="color: #66D9EF;">(</span><span style="color: #66D9EF;">N</span>, <span style="font-style: italic;">4</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span> <span style="color: #75715E;"># </span><span style="color: #75715E;">actual window</span>
<span style="color: #F92672;">const</span> <span style="color: #FD971F;">ρSiN </span>= <span style="font-style: italic;">3</span>.<span style="font-style: italic;">44</span>.g•cm⁻³
<span style="color: #F92672;">const</span> <span style="color: #FD971F;">lSiN </span>= <span style="font-style: italic;">300</span>.nm                  <span style="color: #75715E;"># </span><span style="color: #75715E;">window thickness</span>
<span style="color: #F92672;">let</span> <span style="color: #66D9EF;">Al</span> = <span style="color: #66D9EF;">Aluminium</span>.init<span style="color: #AE81FF;">()</span>            <span style="color: #75715E;"># </span><span style="color: #75715E;">aluminium coating</span>
<span style="color: #F92672;">const</span> <span style="color: #FD971F;">ρAl </span>= <span style="font-style: italic;">2</span>.<span style="font-style: italic;">7</span>.g•cm⁻³
<span style="color: #F92672;">const</span> <span style="color: #FD971F;">lAl </span>= <span style="font-style: italic;">20</span>.nm                    <span style="color: #75715E;"># </span><span style="color: #75715E;">coating thickness</span>
</pre>
</div>
<p>
With these numbers we can compute the transmission at an arbitrary
energy. In order to compute the correct inputs for the calculation we
now have everything. We wish to compute the following, the intensity
\(I(E)\) is the flux that enters the detector 
</p>

<p>
\[
I(E) = f(E) · ε_{\text{LLNL}} · ε_{\ce{Si3.N4}} · ε_{\ce{Al}}
\]
</p>

<p>
where \(f(E)\) is the solar axion flux and the \(ε_i\) are the
efficiencies associated with the telescope and transmission of the
window. The idea is to sample from this intensity distribution to get
a realistic set of X-rays as they would be experienced in the
experiment. One technical aspect still to be done is an interpolation
of the axion flux and LLNL telescope efficiency to evaluate the data
at an arbitrary energy as to define a function that yields \(I(E)\).
</p>

<blockquote>
<p>
<span class="underline">Important note</span>: We fully neglect here the conversion probability and
area of the magnet bore. These (as well as a potential time component)
are purely constants and do not affect the <b>shape</b> of the distribution
\(I(E)\). We want to sample from it to get the correct weighting of the
different energies, but do not care about absolute numbers. So
differential fluxes are fine.
</p>
</blockquote>

<p>
The idea is to define the interpolators and then create a procedure
that captures the previously defined properties and interpolators.
</p>

<div class="org-src-container">
<pre class="src src-nim"><span style="color: #F92672;">from</span> numericalnim <span style="color: #F92672;">import</span> newLinear1D, <span style="color: #F92672;">eval</span>
<span style="color: #F92672;">let</span> <span style="color: #FD971F;">axInterp </span>= newLinear1D<span style="color: #AE81FF;">(</span>dfAx<span style="color: #66D9EF;">[</span><span style="color: #E6DB74;">&quot;Energy&quot;</span>, <span style="color: #66D9EF;">float</span><span style="color: #66D9EF;">]</span>.toSeq1D,
                           dfAx<span style="color: #66D9EF;">[</span><span style="color: #E6DB74;">&quot;diffFlux&quot;</span>, <span style="color: #66D9EF;">float</span><span style="color: #66D9EF;">]</span>.toSeq1D<span style="color: #AE81FF;">)</span>
<span style="color: #F92672;">let</span> <span style="color: #FD971F;">llnlInterp </span>= newLinear1D<span style="color: #AE81FF;">(</span>dfLLNL<span style="color: #66D9EF;">[</span><span style="color: #E6DB74;">&quot;Energy[keV]&quot;</span>, <span style="color: #66D9EF;">float</span><span style="color: #66D9EF;">]</span>.toSeq1D,
                             dfLLNL<span style="color: #66D9EF;">[</span><span style="color: #E6DB74;">&quot;Efficiency&quot;</span>, <span style="color: #66D9EF;">float</span><span style="color: #66D9EF;">]</span>.toSeq1D<span style="color: #AE81FF;">)</span>
</pre>
</div>

<p>
With the interpolators defined let&apos;s write the implementation for
\(I(E)\):
</p>

<div class="org-src-container">
<pre class="src src-nim"><span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">I</span><span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">E</span>: keV<span style="color: #AE81FF;">)</span>: <span style="color: #66D9EF;">float</span> =
  <span style="color: #E6DB74;">## Compute the intensity of the axion flux after telescope &amp; window eff.</span>
  <span style="color: #E6DB74;">##</span>
  <span style="color: #E6DB74;">## Axion flux and LLNL efficiency can be disabled by compiling with</span>
  <span style="color: #E6DB74;">## `</span><span style="color: #AE81FF;">-d:noAxionFlux</span><span style="color: #E6DB74;">` and `</span><span style="color: #AE81FF;">-d:noLLNL</span><span style="color: #E6DB74;">`, respectively.</span>
  <span style="color: #FD971F;">result</span> = transmission<span style="color: #AE81FF;">(</span>Si₃N₄, ρSiN, lSiN, <span style="color: #66D9EF;">E</span><span style="color: #AE81FF;">)</span> * transmission<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">Al</span>, ρAl, lAl, <span style="color: #66D9EF;">E</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">when</span> <span style="color: #F92672;">not</span> <span style="color: #F92672; font-style: italic;">defined</span><span style="color: #AE81FF;">(</span>noAxionFlux<span style="color: #AE81FF;">)</span>:
    <span style="color: #FD971F;">result</span> *= axInterp.<span style="color: #F92672;">eval</span><span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">E</span>.<span style="color: #66D9EF;">float</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">when</span> <span style="color: #F92672;">not</span> <span style="color: #F92672; font-style: italic;">defined</span><span style="color: #AE81FF;">(</span>noLLNL<span style="color: #AE81FF;">)</span>:
    <span style="color: #FD971F;">result</span> *= llnlInterp.<span style="color: #F92672;">eval</span><span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">E</span>.<span style="color: #66D9EF;">float</span><span style="color: #AE81FF;">)</span>
  
</pre>
</div>

<p>
Let&apos;s test it and see what we get for e.g. \(\SI{1}{keV}\):
</p>
<div class="org-src-container">
<pre class="src src-nim"><span style="color: #F92672;">echo</span> <span style="color: #66D9EF;">I</span><span style="color: #AE81FF;">(</span><span style="font-style: italic;">1</span>.keV<span style="color: #AE81FF;">)</span>
</pre>
</div>
<p>
yields \(1.249e20\). Not the most insightful, but it seems to
work. Let&apos;s plot it:
</p>
<div class="org-src-container">
<pre class="src src-nim"><span style="color: #F92672;">let</span> <span style="color: #FD971F;">energies </span>= linspace<span style="color: #AE81FF;">(</span><span style="font-style: italic;">0</span>.<span style="font-style: italic;">01</span>, <span style="font-style: italic;">10</span>.<span style="font-style: italic;">0</span>, <span style="font-style: italic;">1000</span><span style="color: #AE81FF;">)</span>.mapIt<span style="color: #AE81FF;">(</span>it.keV<span style="color: #AE81FF;">)</span>
<span style="color: #F92672;">let</span> <span style="color: #66D9EF;">Is</span> = energies.mapIt<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">I</span><span style="color: #66D9EF;">(</span>it<span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
<span style="color: #F92672;">block</span> <span style="color: #66D9EF;">PlotI</span>:
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">df </span>= toDf<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">{</span> <span style="color: #E6DB74;">&quot;E [keV]&quot;</span> : energies.mapIt<span style="color: #A6E22E;">(</span>it.<span style="color: #66D9EF;">float</span><span style="color: #A6E22E;">)</span>,
                  <span style="color: #E6DB74;">&quot;I&quot;</span> : <span style="color: #66D9EF;">Is</span> <span style="color: #66D9EF;">}</span><span style="color: #AE81FF;">)</span>
  ggplot<span style="color: #AE81FF;">(</span>df, aes<span style="color: #66D9EF;">(</span><span style="color: #E6DB74;">&quot;E [keV]&quot;</span>, <span style="color: #E6DB74;">&quot;I&quot;</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span> +
    geom_line<span style="color: #AE81FF;">()</span> +
    ggtitle<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;Intensity entering the detector gas&quot;</span><span style="color: #AE81FF;">)</span> +
    margin<span style="color: #AE81FF;">(</span>left = <span style="font-style: italic;">3</span>.<span style="font-style: italic;">0</span><span style="color: #AE81FF;">)</span> + thm<span style="color: #AE81FF;">()</span> + 
    ggsave<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">OutputPath</span> / <span style="color: #E6DB74;">&quot;intensity_axion_conversion_point_simulation.pdf&quot;</span><span style="color: #AE81FF;">)</span>
</pre>
</div>
<p>
shown in fig. <a href="#fig:axion_converison_point:intensity">1</a>. It looks exactly
as we would expect.
</p>


<figure id="fig:axion_converison_point:intensity">
<img src="./figs/home/basti/phd/Figs/axion_conversion_point_sampling/intensity_axion_conversion_point_simulation.svg" class="org-svg" alt="intensity_axion_conversion_point_simulation.svg" />

<figcaption>Figure 1: <span class="figure-number">Figure 197: </span>Intensity that enters the detector taking into account LLNL telescope and window efficiencies as well as the solar axion flux</figcaption>
</figure>

<p>
Now we define the sampler for the intensity distribution \(I(E)\), which
returns an energy weighted by \(I(E)\):
</p>
<div class="org-src-container">
<pre class="src src-nim"><span style="color: #F92672;">let</span> <span style="color: #66D9EF;">Isampler</span> = sampler<span style="color: #AE81FF;">(</span>
  <span style="color: #66D9EF;">(</span><span style="color: #F92672;">proc</span><span style="color: #A6E22E;">(</span>x: <span style="color: #66D9EF;">float</span><span style="color: #A6E22E;">)</span>: <span style="color: #66D9EF;">float</span> = <span style="color: #66D9EF;">I</span><span style="color: #A6E22E;">(</span>x.keV<span style="color: #A6E22E;">)</span><span style="color: #66D9EF;">)</span>, <span style="color: #75715E;"># </span><span style="color: #75715E;">wrap `</span><span style="color: #AE81FF;">I(E)</span><span style="color: #75715E;">` to take `</span><span style="color: #AE81FF;">float</span><span style="color: #75715E;">`</span>
  <span style="font-style: italic;">0</span>.<span style="font-style: italic;">01</span>, <span style="font-style: italic;">10</span>.<span style="font-style: italic;">0</span>, num = <span style="font-style: italic;">1000</span> <span style="color: #75715E;"># </span><span style="color: #75715E;">use 1000 points for EDF &amp; sample in 0.01 to 10 keV</span>
<span style="color: #AE81FF;">)</span>
</pre>
</div>
<p>
and define a random number generator:
</p>
<div class="org-src-container">
<pre class="src src-nim"><span style="color: #F92672;">import</span> random
<span style="color: #F92672;">var</span> <span style="color: #FD971F;">rnd </span>= initRand<span style="color: #AE81FF;">(</span><span style="font-style: italic;">0x42</span><span style="color: #AE81FF;">)</span>
</pre>
</div>

<p>
First we will sample 100,000 energies from the distribution to
see if we recover the intensity plot from before. 
</p>

<div class="org-src-container">
<pre class="src src-nim"><span style="color: #F92672;">block</span> <span style="color: #66D9EF;">ISampled</span>:
  <span style="color: #F92672;">const</span> <span style="color: #FD971F;">nmc </span>= <span style="font-style: italic;">100_000</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">df </span>= toDf<span style="color: #AE81FF;">(</span> <span style="color: #66D9EF;">{</span><span style="color: #E6DB74;">&quot;E [keV]&quot;</span> : toSeq<span style="color: #A6E22E;">(</span><span style="font-style: italic;">0</span> ..&lt; nmc<span style="color: #A6E22E;">)</span>.mapIt<span style="color: #A6E22E;">(</span>rnd.sample<span style="color: #E6DB74;">(</span><span style="color: #66D9EF;">Isampler</span><span style="color: #E6DB74;">)</span><span style="color: #A6E22E;">)</span> <span style="color: #66D9EF;">}</span><span style="color: #AE81FF;">)</span>
  ggplot<span style="color: #AE81FF;">(</span>df, aes<span style="color: #66D9EF;">(</span><span style="color: #E6DB74;">&quot;E [keV]&quot;</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span> +
    geom_histogram<span style="color: #AE81FF;">(</span>bins = <span style="font-style: italic;">200</span>, hdKind = hdOutline<span style="color: #AE81FF;">)</span> +
    ggtitle<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;Energies sampled from I(E)&quot;</span><span style="color: #AE81FF;">)</span> +
    thm<span style="color: #AE81FF;">()</span> + 
    ggsave<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">OutputPath</span> / <span style="color: #E6DB74;">&quot;energies_intensity_sampled.pdf&quot;</span><span style="color: #AE81FF;">)</span>
</pre>
</div>

<p>
This yields
fig. <a href="#fig:axion_conversion_point:energies_sampled_intensity">2</a>, which
clearly shows the sampling works as intended.
</p>


<figure id="fig:axion_conversion_point:energies_sampled_intensity">
<img src="./figs/home/basti/phd/Figs/axion_conversion_point_sampling/energies_intensity_sampled.svg" class="org-svg" alt="energies_intensity_sampled.svg" />

<figcaption>Figure 2: <span class="figure-number">Figure 198: </span>Energies sampled from the distribution \(I(E)\) using 100k samples. The shape is nicely reproduced, here plotted using a histogram of 200 bins.</figcaption>
</figure>

<p>
The final piece now is to use the same sampling logic to generate
energies according to \(I(E)\), which correspond to X-rays of said
energy entering the detector. For each of these energies then sample
from the Beer-Lambert law (see sec. <a href="./theory_detector.html#sec:theory:xray_matter_gas">6.1.1</a>)
</p>

<p>
\[
I(z) = I_0 \exp\left[ - \frac{z}{l_{\text{abs}} } \right],
\]
where \(I_0\) is some initial intensity and \(l_\text{abs}\) the
absorption length. The absorption length is computed from the gas
mixture properties of the gas used at CAST, namely argon/isobutane
97.7/2.3 at \(\SI{1050}{mbar}\). It is the inverse of the attenuation
coefficient \(μ_M\)
</p>

<p>
\[
l_{\text{abs}} = \frac{1}{μ_M}
\]
</p>

<p>
where the attenuation coefficient is computed via
</p>

<p>
\[
μ_m = \frac{N_A}{M * σ_A}
\]
</p>

<p>
with \(N_A\) Avogadro&apos;s constant, \(M\) the molar mass of the compound and
\(σ_A\) the atomic absorption cross section. The latter again is defined
by
</p>

<p>
\[
σ_A = 2 r_e λ f₂
\]
</p>

<p>
with \(r_e\) the classical electron radius, \(λ\) the wavelength of the
X-ray and \(f₂\) the second scattering factor. Scattering factors are
tabulated for different elements, for example by <a href="https://www.nist.gov/pml/x-ray-form-factor-attenuation-and-scattering-tables">NIST</a> and
<a href="https://henke.lbl.gov/optical_constants">Henke</a>. For a further discussion of this see the README and
implementation of <a href="https://github.com/SciNim/xrayAttenuation">  <code>xrayAttenuation</code></a> (<a href="./bibliography.html#citeproc_bib_item_203">Schmidt and SciNim contributors 2022</a>).
</p>

<p>
We will now go ahead and define the CAST gas mixture:
</p>
<div class="org-src-container">
<pre class="src src-nim"><span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">initCASTGasMixture</span><span style="color: #AE81FF;">()</span>: <span style="color: #66D9EF;">GasMixture</span> =
  <span style="color: #E6DB74;">## Returns the absorption length for the given energy in keV for CAST</span>
  <span style="color: #E6DB74;">## gas conditions:</span>
  <span style="color: #E6DB74;">## - Argon / Isobutane 97.7 / 2.3 %</span>
  <span style="color: #E6DB74;">## - 20°C ( for this difference in temperature barely matters)</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">arC </span>= compound<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">(</span><span style="color: #66D9EF;">Ar</span>, <span style="font-style: italic;">1</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span> <span style="color: #75715E;"># </span><span style="color: #75715E;">need Argon gas as a Compound</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">isobutane </span>= compound<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">(</span><span style="color: #66D9EF;">C</span>, <span style="font-style: italic;">4</span><span style="color: #66D9EF;">)</span>, <span style="color: #66D9EF;">(</span><span style="color: #66D9EF;">H</span>, <span style="font-style: italic;">10</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">define the gas mixture</span>
  <span style="color: #FD971F;">result</span> = initGasMixture<span style="color: #AE81FF;">(</span><span style="font-style: italic;">293</span>.<span style="color: #66D9EF;">K</span>, <span style="font-style: italic;">1050</span>.mbar, <span style="color: #66D9EF;">[</span><span style="color: #A6E22E;">(</span>arC, <span style="font-style: italic;">0</span>.<span style="font-style: italic;">977</span><span style="color: #A6E22E;">)</span>, <span style="color: #A6E22E;">(</span>isobutane, <span style="font-style: italic;">0</span>.<span style="font-style: italic;">023</span><span style="color: #A6E22E;">)</span><span style="color: #66D9EF;">]</span><span style="color: #AE81FF;">)</span>
<span style="color: #F92672;">let</span> <span style="color: #FD971F;">gm </span>= initCASTGasMixture<span style="color: #AE81FF;">()</span>  
</pre>
</div>

<p>
To sample from the Beer-Lambert law with a given absorption length we
also define a helper that returns a sampler for the target energy
using the definition of a normalized exponential distribution
</p>

<p>
\[
f_e(x, λ) = \frac{1}{λ} \exp \left[ -\frac{x}{λ} \right].
\]
</p>

<blockquote>
<p>
Note: The sampling of the conversion point is the crucial aspect of
this. Naively we might want to sample between the detector volume from
0 to \(\SI{3}{cm}\). However, this skews our result. Our calculation
depends on the energy distribution of the incoming X-rays. If the
absorption length is long enough the probability of reaching the
readout plane and thus not being detected is significant. Restricting
the sampler to \(\SI{3}{cm}\) would pretend that independent of
absorption length we would <span class="underline">always</span> convert within the volume, giving
too large a weight to the energies that should sometimes not be detected!
</p>
</blockquote>

<p>
Let&apos;s define the sampler now. It takes the gas mixture and the target
energy. A constant <code>SampleTo</code> is defined to adjust the position to
which we sample at compile time (to play around with different numbers).
</p>
<div class="org-src-container">
<pre class="src src-nim"><span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">generateSampler</span><span style="color: #AE81FF;">(</span>gm: <span style="color: #66D9EF;">GasMixture</span>, targetEnergy: keV<span style="color: #AE81FF;">)</span>: <span style="color: #66D9EF;">Sampler</span> =
  <span style="color: #E6DB74;">## Generate the exponential distribution to sample from based on the</span>
  <span style="color: #E6DB74;">## given absorption length</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">`</span><span style="color: #AE81FF;">xrayAttenuation</span><span style="color: #75715E;">` `</span><span style="color: #AE81FF;">absorptionLength</span><span style="color: #75715E;">` returns number in meter!</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">λ </span>= absorptionLength<span style="color: #AE81FF;">(</span>gm, targetEnergy<span style="color: #AE81FF;">)</span>.to<span style="color: #AE81FF;">(</span>cm<span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">fnSample </span>= <span style="color: #AE81FF;">(</span><span style="color: #F92672;">proc</span><span style="color: #66D9EF;">(</span>x: <span style="color: #66D9EF;">float</span><span style="color: #66D9EF;">)</span>: <span style="color: #66D9EF;">float</span> =
                    <span style="color: #FD971F;">result</span> = expFn<span style="color: #66D9EF;">(</span>x, λ.<span style="color: #66D9EF;">float</span><span style="color: #66D9EF;">)</span> <span style="color: #75715E;"># </span><span style="color: #75715E;">expFn = 1/λ · exp(-x/λ)</span>
  <span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">const</span> <span style="color: #66D9EF;">SampleTo</span> <span style="color: #AE81FF;">{</span>.<span style="color: #F92672;">intdefine</span>.<span style="color: #AE81FF;">}</span> = <span style="font-style: italic;">20</span> <span style="color: #E6DB74;">## `</span><span style="color: #AE81FF;">SampleTo</span><span style="color: #E6DB74;">`, set via `</span><span style="color: #AE81FF;">-d:SampleTo=&lt;int&gt;</span><span style="color: #E6DB74;">`</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">num </span>= <span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">SampleTo</span>.<span style="color: #66D9EF;">float</span> / <span style="font-style: italic;">3</span>.<span style="font-style: italic;">0</span> * <span style="font-style: italic;">1000</span><span style="color: #AE81FF;">)</span>.round.<span style="color: #66D9EF;">int</span> <span style="color: #75715E;"># </span><span style="color: #75715E;"># of points to sample at</span>
  <span style="color: #FD971F;">result</span> = sampler<span style="color: #AE81FF;">(</span>fnSample, <span style="font-style: italic;">0</span>.<span style="font-style: italic;">0</span>, <span style="color: #66D9EF;">SampleTo</span>, num = num<span style="color: #AE81FF;">)</span>
</pre>
</div>
<p>
Note that this is inefficient, because we generate a new sampler from
which we only sample a single point, namely the conversion point of that
X-ray. If one intended to perform a more complex calculation or wanted
to sample orders of magnitude more X-rays, one should either
restructure the code (i.e. sample from known energies and then reorder
based on the weight defined by \(I(E)\)) or cache the samplers and
pre-bin the energies.
</p>

<p>
For reference let&apos;s compute the absorption length as a function of
energy for the CAST gas mixture:
</p>
<div class="org-src-container">
<pre class="src src-nim"><span style="color: #F92672;">block</span> <span style="color: #66D9EF;">GasAbs</span>:
  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">Es</span> = linspace<span style="color: #AE81FF;">(</span><span style="font-style: italic;">0</span>.<span style="font-style: italic;">03</span>, <span style="font-style: italic;">10</span>.<span style="font-style: italic;">0</span>, <span style="font-style: italic;">1000</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">lAbs </span>= <span style="color: #66D9EF;">Es</span>.mapIt<span style="color: #AE81FF;">(</span>absorptionLength<span style="color: #66D9EF;">(</span>gm, it.keV<span style="color: #66D9EF;">)</span>.m.to<span style="color: #66D9EF;">(</span>cm<span style="color: #66D9EF;">)</span>.<span style="color: #66D9EF;">float</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">df </span>= toDf<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">{</span> <span style="color: #E6DB74;">&quot;E [keV]&quot;</span> : <span style="color: #66D9EF;">Es</span>,
                  <span style="color: #E6DB74;">&quot;l_abs [cm]&quot;</span> : lAbs <span style="color: #66D9EF;">}</span><span style="color: #AE81FF;">)</span>
  ggplot<span style="color: #AE81FF;">(</span>df, aes<span style="color: #66D9EF;">(</span><span style="color: #E6DB74;">&quot;E [keV]&quot;</span>, <span style="color: #E6DB74;">&quot;l_abs [cm]&quot;</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span> +
    geom_line<span style="color: #AE81FF;">()</span> +
    ggtitle<span style="color: #AE81FF;">(</span>r<span style="color: #E6DB74;">&quot;Absorption length of X-rays in CAST gas mixture: \\&quot;</span> &amp; $gm<span style="color: #AE81FF;">)</span> +
    margin<span style="color: #AE81FF;">(</span>top = <span style="font-style: italic;">1</span>.<span style="font-style: italic;">5</span><span style="color: #AE81FF;">)</span> +
    thm<span style="color: #AE81FF;">()</span> + 
    ggsave<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">OutputPath</span> / <span style="color: #E6DB74;">&quot;cast_gas_absorption_length.pdf&quot;</span><span style="color: #AE81FF;">)</span>
</pre>
</div>
<p>
which yields fig. <a href="#fig:axion_conversion_point:absorption_length">3</a>
</p>


<figure id="fig:axion_conversion_point:absorption_length">
<img src="./figs/home/basti/phd/Figs/axion_conversion_point_sampling/cast_gas_absorption_length.svg" class="org-svg" alt="cast_gas_absorption_length.svg" />

<figcaption>Figure 3: <span class="figure-number">Figure 199: </span>Absorption length in the CAST gas mixture as a function of X-ray energy.</figcaption>
</figure>

<p>
So, finally: let&apos;s write the MC sampling!
</p>
<div class="org-src-container">
<pre class="src src-nim"><span style="color: #F92672;">const</span> <span style="color: #FD971F;">nmc </span>= <span style="font-style: italic;">500_000</span> <span style="color: #75715E;"># </span><span style="color: #75715E;">start with 100k samples</span>
<span style="color: #F92672;">var</span> <span style="color: #66D9EF;">Es</span> = newSeqOfCap<span style="color: #AE81FF;">[</span>keV<span style="color: #AE81FF;">](</span>nmc<span style="color: #AE81FF;">)</span>
<span style="color: #F92672;">var</span> <span style="color: #FD971F;">zs </span>= newSeqOfCap<span style="color: #AE81FF;">[</span>cm<span style="color: #AE81FF;">](</span>nmc<span style="color: #AE81FF;">)</span>
<span style="color: #F92672;">while</span> zs.<span style="color: #F92672;">len</span> &lt; nmc:
  <span style="color: #75715E;"># </span><span style="color: #75715E;">1. sample an energy according to `</span><span style="color: #AE81FF;">I(E)</span><span style="color: #75715E;">`</span>
  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">E</span> = rnd.sample<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">Isampler</span><span style="color: #AE81FF;">)</span>.keV
  <span style="color: #75715E;"># </span><span style="color: #75715E;">2. get the sampler for this energy</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">distSampler </span>= generateSampler<span style="color: #AE81FF;">(</span>gm, <span style="color: #66D9EF;">E</span><span style="color: #AE81FF;">)</span> 
  <span style="color: #75715E;"># </span><span style="color: #75715E;">3. sample from it</span>
  <span style="color: #F92672;">var</span> <span style="color: #FD971F;">z </span>= <span style="color: #66D9EF;">Inf</span>.cm
  <span style="color: #F92672;">when</span> <span style="color: #F92672; font-style: italic;">defined</span><span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">Equiv3cmSampling</span><span style="color: #AE81FF;">)</span>: <span style="color: #E6DB74;">## To get the same result as directly sampling</span>
                                  <span style="color: #E6DB74;">## only up to 3 cm use the following code</span>
    <span style="color: #F92672;">while</span> z &gt; <span style="font-style: italic;">3</span>.<span style="font-style: italic;">0</span>.cm:
      z = rnd.sample<span style="color: #AE81FF;">(</span>distSampler<span style="color: #AE81FF;">)</span>.cm 
  <span style="color: #F92672;">elif</span> <span style="color: #F92672; font-style: italic;">defined</span><span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">UnboundedVolume</span><span style="color: #AE81FF;">)</span>: <span style="color: #E6DB74;">## This branch pretends the detection volume</span>
                                 <span style="color: #E6DB74;">## is unbounded if we sample within 20cm</span>
    z = rnd.sample<span style="color: #AE81FF;">(</span>distSampler<span style="color: #AE81FF;">)</span>.cm 
  <span style="color: #F92672;">else</span>: <span style="color: #E6DB74;">## This branch is the physically correct one. If an X-ray reaches the</span>
        <span style="color: #E6DB74;">## readout plane it is _not_ recorded, but it was still part of the</span>
        <span style="color: #E6DB74;">## incoming flux!</span>
    z = rnd.sample<span style="color: #AE81FF;">(</span>distSampler<span style="color: #AE81FF;">)</span>.cm
    <span style="color: #F92672;">if</span> z &gt; <span style="font-style: italic;">3</span>.<span style="font-style: italic;">0</span>.cm: <span style="color: #F92672;">continue</span> <span style="color: #75715E;"># </span><span style="color: #75715E;">just drop this X-ray</span>
  zs.<span style="color: #F92672;">add</span> z
  <span style="color: #66D9EF;">Es</span>.<span style="color: #F92672;">add</span> <span style="color: #66D9EF;">E</span>
</pre>
</div>

<p>
Great, now we have sampled the conversion points according to the
correct intensity. We can now ask for statistics or create different
plots (e.g. conversion point by energies etc.).
</p>

<div class="org-src-container">
<pre class="src src-nim"><span style="color: #F92672;">import</span> stats, seqmath <span style="color: #75715E;"># </span><span style="color: #75715E;">mean, variance and percentile</span>
<span style="color: #F92672;">let</span> <span style="color: #FD971F;">zsF </span>= zs.mapIt<span style="color: #AE81FF;">(</span>it.<span style="color: #66D9EF;">float</span><span style="color: #AE81FF;">)</span> <span style="color: #75715E;"># </span><span style="color: #75715E;">for math</span>
<span style="color: #F92672;">echo</span> <span style="color: #E6DB74;">&quot;Mean conversion position = &quot;</span>, zsF.mean<span style="color: #AE81FF;">()</span>.cm
<span style="color: #F92672;">echo</span> <span style="color: #E6DB74;">&quot;Median conversion position = &quot;</span>, zsF.percentile<span style="color: #AE81FF;">(</span><span style="font-style: italic;">50</span><span style="color: #AE81FF;">)</span>.cm
<span style="color: #F92672;">echo</span> <span style="color: #E6DB74;">&quot;Variance of conversion position = &quot;</span>, zsF.variance<span style="color: #AE81FF;">()</span>.cm
</pre>
</div>

<p>
This prints the following:
</p>
<div class="org-src-container">
<pre class="src src-nim"><span style="color: #66D9EF;">Mean</span> conversion position = <span style="font-style: italic;">0</span>.<span style="font-style: italic;">556813</span> cm
<span style="color: #66D9EF;">Median</span> conversion position = <span style="font-style: italic;">0</span>.<span style="font-style: italic;">292802</span> cm
<span style="color: #66D9EF;">Variance</span> <span style="color: #F92672; font-style: italic;">of</span> conversion position = <span style="font-style: italic;">0</span>.<span style="font-style: italic;">424726</span> cm
</pre>
</div>

<p>
We see the mean conversion position is at about \(\SI{0.56}{cm}\). If we
consider the median it&apos;s only \(\SI{0.29}{cm}\) (the number we use in
<a href="./raytracing.html#sec:appendix:raytracing:axion_image">37.4</a>). This number provides the target
for the raytracing of the axion image as an offset from the focal
length in sec. <a href="./raytracing.html#sec:appendix:raytracing:axion_image">37.4</a>.
</p>

<p>
Let&apos;s plot the conversion points of all sampled (and recorded!) X-rays
as well as what their distribution against energy looks like.
</p>
<div class="org-src-container">
<pre class="src src-nim"><span style="color: #F92672;">let</span> <span style="color: #FD971F;">dfZ </span>= toDf<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">{</span> <span style="color: #E6DB74;">&quot;E [keV]&quot;</span> : <span style="color: #66D9EF;">Es</span>.mapIt<span style="color: #A6E22E;">(</span>it.<span style="color: #66D9EF;">float</span><span style="color: #A6E22E;">)</span>,
                 <span style="color: #E6DB74;">&quot;z [cm]&quot;</span>  : zs.mapIt<span style="color: #A6E22E;">(</span>it.<span style="color: #66D9EF;">float</span><span style="color: #A6E22E;">)</span> <span style="color: #66D9EF;">}</span><span style="color: #AE81FF;">)</span>
ggplot<span style="color: #AE81FF;">(</span>dfZ, aes<span style="color: #66D9EF;">(</span><span style="color: #E6DB74;">&quot;z [cm]&quot;</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span> +
  geom_histogram<span style="color: #AE81FF;">(</span>bins = <span style="font-style: italic;">200</span>, hdKind = hdOutline<span style="color: #AE81FF;">)</span> +
  ggtitle<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;Conversion points of all sampled X-rays according to I(E)&quot;</span><span style="color: #AE81FF;">)</span> +
  thm<span style="color: #AE81FF;">()</span> + 
  ggsave<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">OutputPath</span> / <span style="color: #E6DB74;">&quot;sampled_axion_conversion_points.pdf&quot;</span><span style="color: #AE81FF;">)</span>
ggplot<span style="color: #AE81FF;">(</span>dfZ, aes<span style="color: #66D9EF;">(</span><span style="color: #E6DB74;">&quot;E [keV]&quot;</span>, <span style="color: #E6DB74;">&quot;z [cm]&quot;</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span> +
  geom_point<span style="color: #AE81FF;">(</span>size = <span style="font-style: italic;">0</span>.<span style="font-style: italic;">5</span>, alpha = <span style="font-style: italic;">0</span>.<span style="font-style: italic;">2</span><span style="color: #AE81FF;">)</span> + 
  ggtitle<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;Conversion points of all sampled X-rays according to I(E) &quot;</span> &amp;
    <span style="color: #E6DB74;">&quot;against their energy&quot;</span><span style="color: #AE81FF;">)</span> +
  thm<span style="color: #AE81FF;">()</span> + 
  ggsave<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">OutputPath</span> / <span style="color: #E6DB74;">&quot;sampled_axion_conversion_points_vs_energy.pdf&quot;</span>,
         dataAsBitmap = <span style="color: #AE81FF;">true</span><span style="color: #AE81FF;">)</span>
</pre>
</div>

<p>
The former is shown in
fig. <a href="#fig:axion_conversion_point:sampled_axion_conversion_points">4</a>. The
overlapping exponential distribution is obvious, as one would expect.
The same data is shown in
fig. <a href="#fig:axion_conversion_point:sampled_axion_conversion_points_by_energy">5</a>,
but in this case not as a histogram, but by their energy as a scatter
plot. We can clearly see the impact of the absorption length on the
conversion points for each energy!
</p>


<figure id="fig:axion_conversion_point:sampled_axion_conversion_points">
<img src="./figs/home/basti/phd/Figs/axion_conversion_point_sampling/sampled_axion_conversion_points.svg" class="org-svg" alt="sampled_axion_conversion_points.svg" />

<figcaption>Figure 4: <span class="figure-number">Figure 200: </span>Distribution of the conversion points of all sampled X-rays for which conversion in the detector took place as sampled from \(I(E)\).</figcaption>
</figure>


<figure id="fig:axion_conversion_point:sampled_axion_conversion_points_by_energy">
<img src="./figs/home/basti/phd/Figs/axion_conversion_point_sampling/sampled_axion_conversion_points_vs_energy.svg" class="org-svg" alt="sampled_axion_conversion_points_vs_energy.svg" />

<figcaption>Figure 5: <span class="figure-number">Figure 201: </span>Distribution of the conversion points of all sampled X-rays for which conversion in the detector took place as sampled from \(I(E)\) as a scatter plot against the energy for each X-ray.</figcaption>
</figure>
</div>
</div>


<div class="outline-3" id="outline-container-org3327d77">
<h3 id="org3327d77"><span class="section-number-3">36.3.</span> Compiling and running the code   <span class="tag">  <span class="extended">extended</span></span></h3>
<div class="outline-text-3" id="text-36-3">
<p>
The code above is written in literate programming style. To compile
and run it we use <code>ntangle</code> to extract it from the Org file:
</p>
<div class="org-src-container">
<pre class="src src-nim">ntangle &lt;file&gt;
</pre>
</div>
<p>
which generates <a href="./code/sample_axion_xrays_conversion_points.nim">./code/sample_axion_xrays_conversion_points.nim</a>.
</p>

<p>
Compiling and running it can be done via:
</p>
<div class="org-src-container">
<pre class="src src-nim">nim r -d:danger code/sample_axion_xrays_conversion_points.nim
</pre>
</div>
<p>
which compiles and runs it as an optimized build.
</p>

<p>
We have the following compilation flags to compute different cases:
</p>
<ul class="org-ul">
<li><code>-d:noLLNL</code>: do not include the LLNL efficiency into the input
intensity</li>
<li><code>-d:noAxionFlux</code>: do not include the axion flux into the input
intensity</li>
<li><code>-d:SampleTo=&lt;int&gt;</code>: change to where we sample the position (only to
3cm for example)</li>
<li><code>-d:UnboundedVolume</code>: if used together with the default <code>SampleTo</code>
(or any large value) will effectively compute the case of an
unbounded detection volume (i.e. every X-ray recorded with 100%
certainty).</li>
<li><code>-d:Equiv3cmSampling</code>: Running this with the default <code>SampleTo</code> (or
any large value) will effectively change the sampling to a maximum
\SI{3}{cm} sampling. This can be used as a good crossheck to verify
the sampling behavior is independent of the sampling range.</li>
</ul>

<p>
Configurations of note:
</p>
<div class="org-src-container">
<pre class="src src-nim">nim r -d:danger -d:noAxionFlux code/sample_axion_xrays_conversion_points.nim
</pre>
</div>
<p>
\(⇒\) realistic case for a flat input spectrum
Yields:
</p>
<div class="org-src-container">
<pre class="src src-nim"><span style="color: #66D9EF;">Mean</span> conversion position = <span style="font-style: italic;">0</span>.<span style="font-style: italic;">712102</span> cm
<span style="color: #66D9EF;">Median</span> conversion position = <span style="font-style: italic;">0</span>.<span style="font-style: italic;">445233</span> cm
<span style="color: #66D9EF;">Variance</span> <span style="color: #F92672; font-style: italic;">of</span> conversion position = <span style="font-style: italic;">0</span>.<span style="font-style: italic;">528094</span> cm
</pre>
</div>

<div class="org-src-container">
<pre class="src src-nim">nim r -d:danger -d:noAxionFlux -d:<span style="color: #66D9EF;">UnboundedVolume</span> code/sample_axion_xrays_conversion_points.nim
</pre>
</div>
<p>
\(⇒\) the closest analogue to the analytical calculation from section
[BROKEN LINK: sec:axion_conversion_point:analytical] (outside of including isobutane
here)
Yields:
</p>
<div class="org-src-container">
<pre class="src src-nim"><span style="color: #66D9EF;">Mean</span> conversion position = <span style="font-style: italic;">1</span>.<span style="font-style: italic;">25789</span> cm
<span style="color: #66D9EF;">Median</span> conversion position = <span style="font-style: italic;">0</span>.<span style="font-style: italic;">560379</span> cm
<span style="color: #66D9EF;">Variance</span> <span style="color: #F92672; font-style: italic;">of</span> conversion position = <span style="font-style: italic;">3</span>.<span style="font-style: italic;">63818</span> cm
</pre>
</div>

<div class="org-src-container">
<pre class="src src-nim">nim r -d:danger code/sample_axion_xrays_conversion_points.nim
</pre>
</div>
<p>
\(⇒\) the case we most care about and of which the numbers are mentioned
in the text above. 
</p>
</div>
</div>
</div>

<div id="footnotes"><h2 class="footnotes">Footnotes: </h2><div class="footdef"><sup>  <a role="doc-backlink" class="footnum" id="fn.1" href="#fnr.1">1</a></sup> <div role="doc-footnote" class="footpara">  <p class="footpara">
This was one of the reasons I wrote <a href="https://github.com/SciNim/xrayAttenuation">xrayAttenuation</a>.
</p></div></div>

</div>
<div class="hint-message">Click on any heading marked '<span class="extended">extended</span>' to open it</div>
</div>
</body>
</html>
