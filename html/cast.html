<!DOCTYPE html>
<html lang="en">
<head>
<!--  2024-07-04 Thu 16:14  -->
<meta charset="utf-8" />
<meta content="width=device-width, initial-scale=1" name="viewport" />
<title>‎</title>
<meta content="Vindaar" name="author" />
<meta content="Org Mode" name="generator" />

<link type="text/css" rel="stylesheet" href="org_html_export.css" />
<script type="text/javascript">

document.addEventListener('DOMContentLoaded', function() {
    // Set the initial width for subfigures and their images
    document.querySelectorAll('figure.subfigure[data-width]').forEach(function(subfigure) {
        subfigure.style.width = subfigure.getAttribute('data-width');
    });

    document.querySelectorAll('figure.subfigure img[data-width]').forEach(function(img) {
        img.style.width = img.getAttribute('data-width');
    });

    // Event listener for images within subfigures
    document.querySelectorAll('figure.subfigure img[data-width]').forEach(function(img) {
        img.addEventListener('click', function() {
            // Determine the .figure-wrapper that contains the clicked image
            let wrapper = this.closest('.figure-wrapper');

            // If found, adjust the sizes of its subfigures
            if (wrapper) {
                let subfigures = wrapper.querySelectorAll('figure.subfigure');
                subfigures.forEach(subfigure => {
                    let width = parseFloat(subfigure.getAttribute('data-width'));
                    if (width < 50) { // Double size if less than 50%
                        subfigure.setAttribute('data-width', (width * 2) + '%');
                        subfigure.style.width = (width * 2) + '%';
                    } else { // Halve size otherwise
                        subfigure.setAttribute('data-width', (width / 2) + '%');
                        subfigure.style.width = (width / 2) + '%';
                    }
                });
            }
        });
    });
});

document.addEventListener('DOMContentLoaded', function () {
    var headers = document.querySelectorAll('h1 .extended, h2 .extended, h3 .extended, h4 .extended, h5 .extended, h6 .extended');

    headers.forEach(function (header) {
        var foldableHeader = header.closest('h1, h2, h3, h4, h5, h6');
        if (foldableHeader) {
            foldableHeader.classList.add('foldable-header');
            var nextElement = foldableHeader.nextElementSibling;
            var contentToFold = [];
            while (nextElement && !nextElement.matches('h1, h2, h3, h4, h5, h6')) {
                contentToFold.push(nextElement);
                nextElement = nextElement.nextElementSibling;
            }
            contentToFold.forEach(function (element) {
                element.classList.add('folded-content');
            });

            foldableHeader.addEventListener('click', function () {
                contentToFold.forEach(function (element) {
                    if (element.style.display === 'none' || element.style.display == '') {
                        element.style.display = 'block';
                    } else {
                        element.style.display = 'none';
                    }
                });
            });
        }
    });
});

</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript"></script>
<script type="text/x-mathjax-config">
<!-- /* --><![CDATA[/*><!--*/
    MathJax.Hub.Config({
        jax: ["input/TeX", "output/HTML-CSS"],
        extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js",
                     "TeX/noUndefined.js", "[Contrib]/siunitx/siunitx.js", "[Contrib]/mhchem/mhchem.js"],
        tex2jax: {
            inlineMath: [ ["\\(","\\)"], ['$', '$'], ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"], ["\\begin{displaymath}","\\end{displaymath}"] ],
            skipTags: ["script","noscript","style","textarea","pre","code"],
            ignoreClass: "tex2jax_ignore",
            processEscapes: false,
            processEnvironments: true,
            preview: "TeX"
        },
        showProcessingMessages: true,
        displayAlign: "center",
        displayIndent: "2em",

        "HTML-CSS": {
             scale: 1.0,
             availableFonts: ["STIX","TeX"],
             preferredFont: "TeX",
             webFont: "TeX",
             imageFont: "TeX",
             showMathMenu: true,
        },
        MMLorHTML: {
             prefer: {
                 MSIE:    "MML",
                 Firefox: "MML",
                 Opera:   "HTML",
                 other:   "HTML"
             }
        },
        TeX: {
              equationNumbers: { autoNumber: 'AMS' },
              Macros: {
                  ccsini: '{\\mathrm{Si}₃\\mathrm{N}₄}',
                  cefe: '{\\ce{^{55}Fe}}',
                  vektor: ['{\\begin{pmatrix}#1\\end{pmatrix}}', 1],
                  mtrix: ['{\\begin{pmatrix}#1\\end{pmatrix}}', 1],
                  cp: '{\\mathrm{CP}}',
                  cpt: '{\\mathrm{CPT}}',
                  dd: '{\\mathop{}\\!{\\mathrm{d}}}',
                  sinc: '{\\mathrm{sinc}}'
              }
        }
    });
/*]]>*///--&gt;
</script>
</head>
<body>
<div id="content" class="content">
<nav role="doc-toc" id="table-of-contents">
<h2>Table of Contents</h2>
<div role="doc-toc" id="text-table-of-contents">
<ul>
<li>  <a href="./errata.html#sec:errata">1. Errata   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./introduction.html#sec:introduction">2. Introduction   <span class="tag">    <span class="Intro">Intro</span>  </span></a></li>
<li><a href="./about_thesis.html#sec:about_thesis">3. About this thesis   <span class="tag">  <span class="Intro">Intro</span></span></a>
<ul>
<li>  <a href="./about_thesis.html#org5d43ac4">3.1. Extended notes for the extended thesis <code>[/]</code>   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./about_thesis.html#org59a57b1">3.2. Why Org mode   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./about_thesis.html#orga3ca525">3.3. Notes for future PhD students and IAXO analyses   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li><a href="./theory.html#sec:theory">4. Theory of axions   <span class="tag">  <span class="Theory">Theory</span></span></a>
<ul>
<li>  <a href="./theory.html#sec:theory:useful_reading_material">4.1. Useful reading material   <span class="tag">    <span class="optional">optional</span>  </span></a></li>
<li>  <a href="./theory.html#sec:theory:illustration_cpt">4.2. Illustration of the \cpt symmetry <code>[/]</code>   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./theory.html#sec:theory:invisible_axion_models">4.3. Invisible axion models and axion couplings</a></li>
<li>  <a href="./theory.html#sec:theory:axion_interactions">4.4. Implications for axion interactions - conversion probability</a></li>
<li>  <a href="./theory.html#sec:theory:solar_axion_flux">4.5. Solar axion flux</a></li>
<li>  <a href="./theory.html#sec:theory:chameleon">4.6. Chameleons</a></li>
<li>  <a href="./theory.html#sec:theory:current_bounds">4.7. Current bounds on coupling constants</a></li>
</ul>
</li>
<li><a href="./helioscopes.html#sec:helioscopes">5. Axion helioscopes   <span class="tag">  <span class="Theory">Theory</span></span></a>
<ul>
<li>  <a href="./helioscopes.html#sec:helioscopes:cast">5.1. CERN Axion Solar Telescope (CAST)</a></li>
<li>  <a href="./helioscopes.html#sec:helioscopes:iaxo">5.2. International AXion Observatory (IAXO)</a></li>
</ul>
</li>
<li><a href="./theory_detector.html#sec:theory_detector">6. X-rays, cosmic muons and gaseous detectors   <span class="tag">  <span class="Theory">Theory</span></span></a>
<ul>
<li>  <a href="./theory_detector.html#sec:theory:particle_int">6.1. Particle interactions with matter</a></li>
<li>  <a href="./theory_detector.html#sec:theory:cosmic_radiation">6.2. Cosmic rays</a></li>
<li>  <a href="./theory_detector.html#sec:theory:gas_fundamentals">6.3. Gaseous detector fundamentals</a></li>
</ul>
</li>
<li><a href="./septemboard.html#sec:septemboard">7. Septemboard detector   <span class="tag">  <span class="Detector">Detector</span></span></a>
<ul>
<li>  <a href="./septemboard.html#sec:detector:micromegas">7.1. Micromegas working principle</a></li>
<li>  <a href="./septemboard.html#sec:detector:timepix">7.2. Timepix ASIC</a></li>
<li>  <a href="./septemboard.html#sec:detector:gridpix">7.3. GridPix</a></li>
<li>  <a href="./septemboard.html#sec:detector:detector_2014_15">7.4. 2014 / 2015 GridPix detector for CAST</a></li>
<li>  <a href="./septemboard.html#sec:detector:detector_overview">7.5. Septemboard detector overview</a></li>
<li>  <a href="./septemboard.html#orge95b287">7.6. Detector readout system</a></li>
<li>  <a href="./septemboard.html#sec:detector:scintillators">7.7. Scintillator vetoes</a></li>
<li>  <a href="./septemboard.html#sec:detector:fadc">7.8. FADC</a></li>
<li>  <a href="./septemboard.html#sec:detector:sin_window">7.9. SiN window</a></li>
<li>  <a href="./septemboard.html#sec:detector:septemboard">7.10. Septemboard - 6 GridPixes around a center one</a></li>
<li>  <a href="./septemboard.html#sec:detector:water_cooling">7.11. Water cooling and temperature readout for the septemboard</a></li>
<li>  <a href="./septemboard.html#sec:septem:efficiency">7.12. Detector efficiency</a></li>
<li>  <a href="./septemboard.html#sec:detector:daq">7.13. Data acquisition and detector monitoring</a></li>
</ul>
</li>
<li><a href="./operation_calibration.html#sec:operation_calibration">8. Detector calibration for operation   <span class="tag">  <span class="Detector">Detector</span></span></a>
<ul>
<li>  <a href="./operation_calibration.html#sec:operation_calibration:timepix">8.1. Timepix calibrations</a></li>
<li>  <a href="./operation_calibration.html#sec:operation_calibration:fadc">8.2. FADC calibration</a></li>
<li>  <a href="./operation_calibration.html#sec:operation_calibration:scintillators">8.3. Scintillator calibration</a></li>
</ul>
</li>
<li><a href="./reconstruction.html#sec:reconstruction">9. Data reconstruction   <span class="tag">  <span class="Reconstruction">Reconstruction</span></span></a>
<ul>
<li>  <a href="./reconstruction.html#sec:reco:tpa">9.1. <code>TimepixAnalysis</code> and Nim</a></li>
<li>  <a href="./reconstruction.html#sec:reco:tos_data_parsing">9.2. TOS data parsing</a></li>
<li>  <a href="./reconstruction.html#sec:reco:event_shape">9.3. Expectation of event shapes</a></li>
<li>  <a href="./reconstruction.html#sec:reco:data_reconstruction">9.4. Data reconstruction</a></li>
<li>  <a href="./reconstruction.html#sec:reco:fadc_data">9.5. FADC reconstruction</a></li>
<li>  <a href="./reconstruction.html#sec:reco:scintillator_data">9.6. Scintillator data</a></li>
</ul>
</li>
<li><a href="./cast.html#sec:cast">10. Detector installation &amp; data taking at CAST   <span class="tag">  <span class="CAST">CAST</span></span></a>
<ul>
<li>  <a href="./cast.html#sec:cast:timeline">10.1. Timeline</a></li>
<li>  <a href="./cast.html#sec:cast:alignment">10.2. Alignment</a></li>
<li>  <a href="./cast.html#sec:cast:detector_setup">10.3. Detector setup at CAST</a></li>
<li>  <a href="./cast.html#sec:cast:window_accident">10.4. Window accident</a></li>
<li>  <a href="./cast.html#sec:cast:data_taking_woes">10.5. Data taking woes</a></li>
<li>  <a href="./cast.html#sec:cast:data_taking_campaigns">10.6. Summary of CAST data taking</a></li>
</ul>
</li>
<li><a href="./calibration.html#sec:calibration">11. Data calibration   <span class="tag">  <span class="Calibration">Calibration</span></span></a>
<ul>
<li>  <a href="./calibration.html#sec:calibration:energy">11.1. Energy calibration - in principle</a></li>
<li>  <a href="./calibration.html#sec:calib:detector_behavior_over_time">11.2. Detector behavior over time</a></li>
<li>  <a href="./calibration.html#sec:calib:final_energy_calibration">11.3. Energy calibration dependence on the gas gain</a></li>
<li>  <a href="./calibration.html#sec:calib:fadc">11.4. FADC</a></li>
</ul>
</li>
<li><a href="./background.html#sec:background">12. Finding signal and defining background | Background rate computation   <span class="tag">  <span class="Analysis">Analysis</span></span></a>
<ul>
<li>  <a href="./background.html#sec:background:likelihood_method">12.1. Likelihood method</a></li>
<li>  <a href="./background.html#sec:cdl">12.2. CAST Detector Lab</a></li>
<li>  <a href="./background.html#sec:background:likelihood_cut">12.3. Application of likelihood cut for background rate</a></li>
<li>  <a href="./background.html#sec:background:mlp">12.4. Artificial neural networks as cluster classifiers</a></li>
<li>  <a href="./background.html#sec:background:additional_vetoes">12.5. Additional detector features as vetoes</a></li>
<li>  <a href="./background.html#sec:background:all_vetoes_combined">12.6. Background rates of combined vetoes and efficiencies</a></li>
</ul>
</li>
<li><a href="./limit.html#sec:limit">13. Limit calculation   <span class="tag">  <span class="Limit">Limit</span></span></a>
<ul>
<li>  <a href="./limit.html#sec:limit:method_introduction">13.1. Limit method - introduction</a></li>
<li>  <a href="./limit.html#sec:limit:method_likelihood">13.2. Limit method - likelihood function \(\mathcal{L}\)</a></li>
<li>  <a href="./limit.html#sec:limit:method_computing_L">13.3. Limit method - computing \(\mathcal{L}\)</a></li>
<li>  <a href="./limit.html#sec:limit:method_computing_a_limit">13.4. Limit method - computing a limit</a></li>
<li>  <a href="./limit.html#sec:limit:method_expected_limit">13.5. Limit method - toy candidate sets and expected limits</a></li>
<li>  <a href="./limit.html#sec:limit:method_systematics">13.6. Limit method - extending \(\mathcal{L}\) for systematics</a></li>
<li>  <a href="./limit.html#sec:limit:method_mcmc">13.7. Limit method - evaluating \(\mathcal{L}\) with nuisance parameters</a></li>
<li>  <a href="./limit.html#org6a70446">13.8. Note about likelihood integral   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./limit.html#org7b723b3">13.9. Derivation of short form of \(\mathcal{L}\) <code>[/]</code>   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./limit.html#sec:limit:ingredients">13.10. Likelihood ingredients in detail</a></li>
<li>  <a href="./limit.html#sec:limit:systematics">13.11. Systematics</a></li>
<li>  <a href="./limit.html#sec:limit:mcmc_calc_limit">13.12. MCMC to sample the distribution and compute a limit</a></li>
<li>  <a href="./limit.html#sec:limit:expected_limits">13.13. Expected limits of different setups</a></li>
<li>  <a href="./limit.html#sec:limit:candidates">13.14. Solar tracking candidates</a></li>
<li>  <a href="./limit.html#sec:limit:observed_limit">13.15. Observed limit - \(g_{ae}\)</a></li>
<li>  <a href="./limit.html#sec:limit:other_couplings">13.16. Other coupling constants</a></li>
<li>  <a href="./limit.html#org5bfd145">13.17. Comparison to 2013 limit (using their method)   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./limit.html#org4483228">13.18. Observed limit for different axion masses   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li>  <a href="./outlook.html#sec:outlook">14. Outlook</a></li>
<li>  <a href="./summary.html#sec:summary">15. Summary &amp; conclusion</a></li>
<li>  <a href="./bibliography.html#sec:bibliography">16. Bibliography   <span class="tag">    <span class="html">html</span>  </span></a></li>
<li><a href="./daq.html#sec:daq">17. Data acquisition and detector monitoring   <span class="tag"><span class="Appendix">Appendix</span> <span class="Detector">Detector</span></span></a>
<ul>
<li>  <a href="./daq.html#sec:daq:tof">17.1. Timepix Operating Firmware - TOF</a></li>
<li>  <a href="./daq.html#sec:daq:tos">17.2. Timepix Operating Software - TOS</a></li>
<li>  <a href="./daq.html#sec:daq:septemboard_event_display">17.3. Septemboard event display</a></li>
</ul>
</li>
<li><a href="./configuration.html#sec:appendix:configuration">18. Configuration and TOS / TOF versions   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./configuration.html#sec:appendix:configuration:tos_config">18.1. TOS configuration file</a></li>
<li>  <a href="./configuration.html#sec:appendix:configuration:tos_tof_versions">18.2. TOS and TOF versions used at CAST</a></li>
</ul>
</li>
<li><a href="./calibration.html#sec:appendix:calibration">19. Calibrations   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./calibration.html#sec:appendix:calibration:timepix">19.1. Timepix calibrations</a></li>
<li>  <a href="./calibration.html#sec:appendix:septemboard_calibrations">19.2. Septemboard calibration</a></li>
<li>  <a href="./calibration.html#sec:appendix:scintillator_calibration_notes">19.3. Calibration measurements of the veto scintillator paddle   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li><a href="./cast_operations.html#sec:appendix:cast_operations">20. CAST operation procedures   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./cast_operations.html#sec:appendix:cast_operations:terminology">20.1. CAST terminology</a></li>
<li>  <a href="./cast_operations.html#sec:cast:high_voltage">20.2. High voltage supply</a></li>
<li>  <a href="./cast_operations.html#sec:cast:vacuum_system">20.3. Vacuum system</a></li>
<li>  <a href="./cast_operations.html#sec:cast:watercooling_gas">20.4. Watercooling system &amp; gas supply</a></li>
<li>  <a href="./cast_operations.html#sec:cast:interlock_systems">20.5. Interlock systems</a></li>
<li>  <a href="./cast_operations.html#sec:appendix:cast_log_files">20.6. CAST log files</a></li>
</ul>
</li>
<li><a href="./cast_run_list.html#sec:appendix:cast_run_list">21. CAST data taking run list   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./cast_run_list.html#org44146a9">21.1. Full version   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li><a href="./cast_data_taking_notes.html#sec:appendix:cast_data_taking_notes">22. CAST data taking notes <code>[0/1]</code>   <span class="tag"><span class="Appendix">Appendix</span> <span class="extended">extended</span></span></a>
<ul>
<li>  <a href="./cast_data_taking_notes.html#org71955d7">22.1. Run table</a></li>
<li>  <a href="./cast_data_taking_notes.html#org9d7f41b">22.2. Data runs</a></li>
<li>  <a href="./cast_data_taking_notes.html#org22073e2">22.3. Calibration runs</a></li>
<li>  <a href="./cast_data_taking_notes.html#orgeef82a7">22.4. Automatically generated run list</a></li>
<li>  <a href="./cast_data_taking_notes.html#orga3f56e9">22.5. Automatically calculated total run times</a></li>
<li>  <a href="./cast_data_taking_notes.html#org588cdc9">22.6. InGrid temperature from shift forms</a></li>
</ul>
</li>
<li><a href="./cabling_and_softwar_setup.html#sec:appendix:cabling_and_softwar_setup">23. Cabling &amp; software setup <code>[/]</code>   <span class="tag"><span class="Appendix">Appendix</span> <span class="extended">extended</span></span></a>
<ul>
<li>  <a href="./cabling_and_softwar_setup.html#org12cd48a">23.1. Virtex V6 cabling</a></li>
<li>  <a href="./cabling_and_softwar_setup.html#org2d33612">23.2. Detector cabling</a></li>
<li>  <a href="./cabling_and_softwar_setup.html#org41bd3bf">23.3. Vivado / ISE on void linux &amp; flashing Virtex V6</a></li>
<li>  <a href="./cabling_and_softwar_setup.html#org8bda112">23.4. Setting up the chips in TOS</a></li>
</ul>
</li>
<li><a href="./vacuum_contamination.html#sec:appendix:vacuum_contamination">24. Window rupture and vacuum contamination   <span class="tag"><span class="Appendix">Appendix</span> <span class="extended">extended</span></span></a>
<ul>
<li>  <a href="./vacuum_contamination.html#org1da7765">24.1. Calculation of vacuum volume</a></li>
<li>  <a href="./vacuum_contamination.html#org44db682">24.2. Calculation of potential influx of gas</a></li>
<li>  <a href="./vacuum_contamination.html#org77cae80">24.3. Consider pumping of pumps</a></li>
<li>  <a href="./vacuum_contamination.html#org56eaa1d">24.4. Calculation of possible contamination</a></li>
</ul>
</li>
<li><a href="./detector_time_behavior.html#sec:appendix:detector_time_behavior">25. Detector behavior over time   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./detector_time_behavior.html#sec:appendix:choice_gas_gain_binning">25.1. Choice of gas gain binning time interval</a></li>
<li>  <a href="./detector_time_behavior.html#sec:appendix:correlation_gas_gain_ambient_temp">25.2. Correlation of gas gain and ambient CAST temperature</a></li>
</ul>
</li>
<li><a href="./cast_detector_lab.html#sec:appendix:cast_detector_lab">26. CAST Detector Lab data   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./cast_detector_lab.html#org793ccbe">26.1. Generate all spectrum plots split by run   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./cast_detector_lab.html#sec:appendix:cdl_spectra_by_run">26.2. All spectra split by run</a></li>
<li>  <a href="./cast_detector_lab.html#sec:appendix:cdl:all_spectra_fits">26.3. All CDL spectra with line fits   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./cast_detector_lab.html#sec:appendix:cdl:all_spectra_fits_by_run">26.4. All CDL spectra with line fits by run</a></li>
</ul>
</li>
<li><a href="./fit_by_run_justification.html#sec:appendix:fit_by_run_justification">27. CAST Detector Lab variations and fitting by run   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./fit_by_run_justification.html#sec:appendix:fit_by_run:gas_gain_var_cluster_prop">27.1. Influence of gas gain variations on cluster properties</a></li>
<li>  <a href="./fit_by_run_justification.html#org3cd99aa">27.2. Data overview with pixel spectra <code>[/]</code>   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li><a href="./morphing_cdl_spectra.html#sec:appendix:morphing_cdl_spectra">28. Morphing of CDL reference spectra   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./morphing_cdl_spectra.html#org6582850">28.1. Generate all morphing / tile related plots   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./morphing_cdl_spectra.html#orgb2443eb">28.2. Generate plot comparing likelihood behavior   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./morphing_cdl_spectra.html#sec:appendix:morphing_cdl_spectra:tilemaps">28.3. Tilemap of each likelihood dataset</a></li>
<li>  <a href="./morphing_cdl_spectra.html#sec:appendix:morphing_cdl_spectra:interpolation_raster">28.4. Interpolation of each likelihood dataset</a></li>
<li>  <a href="./morphing_cdl_spectra.html#sec:appendix:morphing_cdl_spectra:binwise_linear">28.5. Binwise linear interpolations for each likelihood dataset</a></li>
<li>  <a href="./morphing_cdl_spectra.html#sec:appendix:morphing_cdl_spectra:notes">28.6. Notes on CDL morphing development   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li><a href="./occupancy.html#sec:appendix:occupancy">29. Occupancy maps   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./occupancy.html#org2fad4d2">29.1. Run-2</a></li>
<li>  <a href="./occupancy.html#org2d1efb7">29.2. Run-3</a></li>
<li>  <a href="./occupancy.html#org8214fc9">29.3. Generate occupancy map plots   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li><a href="./fadc.html#sec:appendix:fadc">30. FADC   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./fadc.html#sec:appendix:fadc:rise_fall">30.1. FADC rise and fall time</a></li>
<li>  <a href="./fadc.html#sec:appendix:background:fadc">30.2. FADC veto</a></li>
<li>  <a href="./fadc.html#org23df6a1">30.3. Generate plot of rise time vs skewness   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./fadc.html#sec:appendix:fadc_veto_empirical_cluster_length">30.4. Expected cluster size</a></li>
</ul>
</li>
<li><a href="./background_rates.html#sec:appendix:background_rates">31. Raw data and background rates   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./background_rates.html#sec:appendix:background_rates:full_chip">31.1. Background rates over full chip</a></li>
<li>  <a href="./background_rates.html#org9724ee2">31.2. Generate rate without any vetoes over full chip   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./background_rates.html#orgbb3d958">31.3. Generate background rates over full chip   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./background_rates.html#orgbb93df8">31.4. Generate table of background rates for all setups   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li>  <a href="./background_interpolation_chip_area.html#sec:appendix:background_interpolation_chip_area">32. Background interpolation chip cutout correction   <span class="tag">    <span class="Appendix">Appendix</span>  </span></a></li>
<li><a href="./limit_additional.html#sec:appendix:limit_additional">33. Additional limit information   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./limit_additional.html#sec:appendix:conversion_probability">33.1. Conversion probability as a function of mass   <span class="tag">    <span class="Appendix">Appendix</span>  </span></a></li>
<li>  <a href="./limit_additional.html#sec:appendix:exp_limit_percentiles">33.2. Expected limit table with percentiles</a></li>
<li>  <a href="./limit_additional.html#sec:appendix:limit_additional:axion_photon">33.3. Observed limit - axion photon \(g_{aγ}\)</a></li>
<li>  <a href="./limit_additional.html#sec:appendix:limit_additional:chameleon">33.4. Observed limit - chameleon \(β_γ\)</a></li>
</ul>
</li>
<li><a href="./software.html#sec:appendix:software">34. Software   <span class="tag"><span class="Software">Software</span> <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./software.html#org295a14b">34.1. Why did I start writing my own analysis framework?   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./software.html#orgbffadc2">34.2. Nim   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./software.html#sec:appendix:timepix_analysis">34.3. TimepixAnalysis</a></li>
<li>  <a href="./software.html#org7bd7a8d">34.4. Other libraries relevant for TimepixAnalysis</a></li>
</ul>
</li>
<li><a href="./full_data_reconstruction.html#sec:appendix:full_data_reconstruction">35. Full data reconstruction   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./full_data_reconstruction.html#orgfee1d0d">35.1. Raw data parsing and reconstruction</a></li>
<li>  <a href="./full_data_reconstruction.html#orgf495ce7">35.2. Parse and reconstruct the CDL data</a></li>
<li>  <a href="./full_data_reconstruction.html#org133b57c">35.3. Add tracking information to background files</a></li>
<li>  <a href="./full_data_reconstruction.html#org6f09f64">35.4. Using <code>runAnalysisChain</code></a></li>
<li>  <a href="./full_data_reconstruction.html#org9399d9f">35.5. Applying a classifier</a></li>
<li>  <a href="./full_data_reconstruction.html#orgdc1544f">35.6. Computing limits</a></li>
</ul>
</li>
<li><a href="./average_depth_xrays_argon.html#sec:appendix:average_depth_xrays_argon">36. Average distance X-rays travel in argon at CAST conditions   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./average_depth_xrays_argon.html#orge66ba3a">36.1. Reference to original document   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./average_depth_xrays_argon.html#orgcf4e5a1">36.2. Calculate conversion point numerically</a></li>
<li>  <a href="./average_depth_xrays_argon.html#orga2d674d">36.3. Compiling and running the code   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li><a href="./raytracing.html#sec:appendix:raytracing">37. Raytracing   <span class="tag"><span class="Software">Software</span> <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./raytracing.html#sec:appendix:raytracing:traxer">37.1. TrAXer - An interactive axion raytracer</a></li>
<li>  <a href="./raytracing.html#sec:appendix:raytracing:llnl_telescope">37.2. A few more details about the LLNL telescope</a></li>
<li>  <a href="./raytracing.html#sec:appendix:raytracing:panter">37.3. Comparison of TrAXer results with PANTER measurements</a></li>
<li>  <a href="./raytracing.html#sec:appendix:raytracing:axion_image">37.4. Computing an axion image with TrAXer</a></li>
<li>  <a href="./raytracing.html#org756c804">37.5. Reproducing an X-ray finger run with TrAXer   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./raytracing.html#orgaa6ce5e">37.6. <span class="done DONE">DONE</span> Can we finish our interactive ray tracer?   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./raytracing.html#org401e2a4">37.7. Rerunning Al Kα after replacing target   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./raytracing.html#orga4e0946">37.8. Figure error development notes   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li>  <a href="./acknowledgments.html#sec:appendix:acknowledgments">38. Acknowledgments   <span class="tag">    <span class="Ack">Ack</span>  </span></a></li>
</ul>
</div>
</nav>
<div class="outline-2" id="outline-container-sec:cast">
<h2 id="sec:cast"><span class="section-number-2">10.</span> Detector installation &amp; data taking at CAST   <span class="tag">  <span class="CAST">CAST</span></span></h2>
<div class="outline-text-2" id="text-sec:cast">
<p>
In this chapter we will cover the data taking with the Septemboard
detector at the CAST experiment. We will begin with a timeline of the
important events and the different data taking periods to give some
reference and put certain things into perspective,
sec. <a href="./cast.html#sec:cast:timeline">10.1</a>. We continue with the detector alignment in
sec. <a href="./cast.html#sec:cast:alignment">10.2</a>, as this is important for the position
uncertainty in the limit calculation. Then we discuss the detector
setup behind the LLNL telescope, sec. <a href="./cast.html#sec:cast:detector_setup">10.3</a>. Two
sections follow focusing on where things did not go according to our
plans, a window accident in sec. <a href="./cast.html#sec:cast:window_accident">10.4</a> and general
issues encountered in each run period in
sec. <a href="./cast.html#sec:cast:data_taking_woes">10.5</a>. We conclude with an overview of the
of the total data taken at CAST, sec. <a href="./cast.html#sec:cast:data_taking_campaigns">10.6</a>.
</p>

<p>
For an overview of the technical aspects of the CAST setup and
operation see the appendix <a href="./cast_operations.html#sec:appendix:cast_operations">20</a>. It contains
details about the operating procedures with respect to the gas supply
and vacuum system, interlocks and more. As the details of that are not
particularly relevant after shutdown of the experiment, it is not
discussed here.
</p>
</div>

<div class="outline-3" id="outline-container-sec:cast:timeline">
<h3 id="sec:cast:timeline"><span class="section-number-3">10.1.</span> Timeline</h3>
<div class="outline-text-3" id="text-sec:cast:timeline">
<p>
The Septemboard detector was prepared for data taking at the CAST
experiment in July 2017 for preliminary alignment and fit tests. The
detector beamline was prepared behind the LLNL telescope and aligned
with a laser from the opposite side of the magnet using an acrylic
glass target on <span class="timestamp-wrapper">  <span class="timestamp">&lt;2017-07-07 Fri&gt; </span></span> (see
fig. <a href="#fig:cast:laser_alignment1">1(a)</a>). Vacuum leak tests were performed
and the detector installed on <span class="timestamp-wrapper">  <span class="timestamp">&lt;2017-07-10 Mon&gt; </span></span> (see
fig. <a href="#fig:cast:detector_installed">1(b)</a>). In addition, geometer
measurements were done for final alignment and as a reference
measurement the day after. An Amptek COOL-X X-ray
generator <sup>  <a role="doc-backlink" class="footref" id="fnr.1" href="#fn.1">1</a></sup> (&apos;X-ray finger&apos;) was installed on the opposite
side of the magnet. A calibration measurement with the X-ray finger
ran from <span class="timestamp-wrapper">  <span class="timestamp">&lt;2017-07-13 Thu&gt; </span></span> over night. The aim of an X-ray finger run is to
roughly verify the focal spot of the X-ray telescope. After this
initial test the detector was dismounted to make space for the KWISP
experiment.
</p>

<p>
Two months later the detector was remounted between <span class="timestamp-wrapper">  <span class="timestamp">&lt;2017-09-11 Mon&gt;</span></span>
to <span class="timestamp-wrapper">  <span class="timestamp">&lt;2017-09-14 Thu&gt; </span></span> with another geometer measurement on the last
day. During an attempt to clean the detector water cooling system on
<span class="timestamp-wrapper">  <span class="timestamp">&lt;2017-09-19 Tue&gt;</span></span>, the window of the detector was destroyed (see section
<a href="./cast.html#sec:cast:window_accident">10.4</a>). This required a detector dismount and
transport to Bonn for repairs as the detector was electronically dead
after the incident.
</p>

<p>
Near the end of October <span class="timestamp-wrapper">  <span class="timestamp">&lt;2017-10-23 Mon&gt; </span></span> the remount of the detector
started and was finished by <span class="timestamp-wrapper">  <span class="timestamp">&lt;2017-10-26 Thu&gt; </span></span> in time for another geometer
measurement and alignment. The next day the veto paddle scintillator
was calibrated using a 3-way coincidence in the RD51 laboratory (see
sec. <a href="./operation_calibration.html#sec:operation_calibration:scintillators">8.3</a>), followed by the installation
of the lead shielding and scintillator installation another day
later. With everything ready, data taking of the first data taking
period with the Septemboard detector started on <span class="timestamp-wrapper">  <span class="timestamp">&lt;2017-10-30 Mon&gt;</span></span>. During
the period until <span class="timestamp-wrapper">  <span class="timestamp">&lt;2017-12-22 Fri&gt; </span></span> few minor issues were encountered, see
sec. <a href="./cast.html#sec:cast:data_taking_woes_2017">10.5.1</a>. As CERN is typically closed over
Christmas and well into January, data taking was paused until
<span class="timestamp-wrapper">  <span class="timestamp">&lt;2017-02-17 Fri&gt; </span></span> (further time is necessary to prepare the magnet for data
taking again).
</p>

<p>
The second part of the first data taking then continued on until
<span class="timestamp-wrapper">  <span class="timestamp">&lt;2017-04-17 Mon&gt;</span></span>, with a few more small problems encountered, see
<a href="./cast.html#sec:cast:data_taking_woes_2018">10.5.2</a>. After data taking concluded,
dismounting of the detector began the next day by removing the veto
scintillator and the lead shielding. On <span class="timestamp-wrapper">  <span class="timestamp">&lt;2018-04-20 Fri&gt; </span></span> another X-ray
finger run was performed to get a sense of the placement of the
detector during its actual mount as it was during the first data
taking period. Afterwards, the detector was fully removed by
<span class="timestamp-wrapper">  <span class="timestamp">&lt;2018-04-26 Thu&gt; </span></span> to bring it back to Bonn to fix a few problems.
</p>

<p>
Data taking was initially intended to continue by summer of 2018. The
fully repaired detector was installed between <span class="timestamp-wrapper">  <span class="timestamp">&lt;2018-07-16 Mon&gt; </span></span> and
<span class="timestamp-wrapper">  <span class="timestamp">&lt;2018-07-19 Thu&gt; </span></span> with a few minor delays due to a change in mounting of
the lead shielding support to accommodate a parallel data taking with
KWISP. For alignment another geometer measurement was performed on
<span class="timestamp-wrapper">  <span class="timestamp">&lt;2018-07-23 Mon&gt;</span></span>. Unfortunately, external delays pushed the begin of the
data taking campaign back into late October. On <span class="timestamp-wrapper">  <span class="timestamp">&lt;2018-10-20 Sat&gt; </span></span> the data
taking finally begins after a power supply issue was fixed the day
before. The issues encountered during this data taking period, which
lasted until <span class="timestamp-wrapper">  <span class="timestamp">&lt;2018-12-20 Thu&gt; </span></span> are mentioned in
sec. <a href="./cast.html#sec:cast:data_taking_woes_2018_2">10.5.3</a>.
</p>

<p>
With the end of 2018 the data taking campaign of the Septemboard was
at an end. The detector was moved over from CAST to the CAST Detector
Lab (CDL) on <span class="timestamp-wrapper">  <span class="timestamp">&lt;2019-02-14 Thu&gt; </span></span> for a measurement campaign behind an X-ray
tube for calibration purposes. Data was taken until <span class="timestamp-wrapper">  <span class="timestamp">&lt;2019-02-21 Thu&gt; </span></span> with
a variety of targets and filters (covered in sec. <a href="./background.html#sec:cdl">12.2</a>
later). Afterwards the detector was dismounted and taken back to Bonn.
</p>

<p>
For the results of the different alignments, further see section
<a href="./cast.html#sec:cast:alignment">10.2</a>.
</p>


<figure class="figure-wrapper" id="fig:cast:alignment_detector">
<figure class="subfigure" id="fig:cast:laser_alignment1" data-width="49%">  <img src="./figs/home/basti/phd/Figs/CAST_Alignment/laser_alignment_IMG_20170707_121738.jpg" data-width="94%" />  <figcaption>Figure 1(a): Laser alignment</figcaption></figure> <figure class="subfigure" id="fig:cast:detector_installed" data-width="49%">  <img src="./figs/home/basti/org/Figs/CAST_Alignment/detector_installed_after_laser_alignment_IMG_20170710_185009.jpg" data-width="94%" />  <figcaption>Figure 1(b): Detector installed after alignment</figcaption></figure>
<figcaption>Figure 1: <a href="#fig:cast:laser_alignment1">1(a)</a> Alignment of the telescope side pipes using an acrylic glass
           flange with a centered grid and a laser aligned to the magnet
           bore. The central laser spot is the point on the vertical line
           extending out from the center. The other points towards the lower right
           are further refractions. This was better visible by eye. <a href="#fig:cast:detector_installed">1(b)</a> Detector installed on the beamline behind the LLNL telescope on &lt;2017-07-10&gt;.</figcaption>
</figure>
</div>

<div class="outline-4" id="outline-container-org6d97a1d">
<h4 id="org6d97a1d"><span class="section-number-4">10.1.1.</span> Detailed technical timeline <code>[/]</code>   <span class="tag">  <span class="extended">extended</span></span></h4>
<div class="outline-text-4" id="text-10-1-1">
<dl class="org-dl">
<dt>Initial installation 2017</dt><dd>  <ul class="org-ul">
<li>ref:
<a href="https://espace.cern.ch/cast-share/elog/Lists/Posts/Post.aspx?ID=3420">https://espace.cern.ch/cast-share/elog/Lists/Posts/Post.aspx?ID=3420</a>
and <code>~/org/Documents/InGrid_calibration_installation_2017_elog.pdf</code></li>
<li>June/July detector brought to CERN</li>
<li>before <span class="timestamp-wrapper">    <span class="timestamp">&lt;2017-07-07 Fri&gt; </span>  </span> alignment of LLNL telescope by Jaime</li>
<li>  <span class="timestamp-wrapper">    <span class="timestamp">&lt;2017-07-07 Fri&gt; </span>  </span> laser alignment (see <img src="./figs/home/basti/org/Figs/CAST_Alignment/laser_alignment_IMG_20170707_121738.jpg" alt="laser_alignment_IMG_20170707_121738.jpg" />)</li>
<li>  <span class="timestamp-wrapper">    <span class="timestamp">&lt;2017-07-10 Mon&gt; </span>  </span> vacuum leak tests &amp; installation of detector
(see:
<img src="./figs/home/basti/org/Figs/CAST_Alignment/detector_installed_after_laser_alignment_IMG_20170710_185009.jpg" alt="detector_installed_after_laser_alignment_IMG_20170710_185009.jpg" />)</li>
<li>after <span class="timestamp-wrapper">    <span class="timestamp">&lt;2017-07-10 Mon&gt; </span>  </span> installation of lead shielding</li>
<li>  <span class="timestamp-wrapper">    <span class="timestamp">&lt;2017-07-11 Tue&gt; </span>  </span> Geometer measurement of InGrid alignment for
X-ray finger run</li>
<li>  <span class="timestamp-wrapper">    <span class="timestamp">&lt;2017-07-13 Thu&gt; </span>  </span> - <span class="timestamp-wrapper">    <span class="timestamp">&lt;2017-07-14 Fri&gt;</span>  </span>: first X-ray finger run (not
useful to determine position of detector, due to dismount after)</li>
<li>after: dismounted to make space for KWISP</li>
</ul></dd>

<dt>Installation for data taking start</dt><dd>  <ul class="org-ul">
<li>Remount in September 2017 <span class="timestamp-wrapper">    <span class="timestamp">&lt;2017-09-11 Mon&gt; </span>  </span> - <span class="timestamp-wrapper">    <span class="timestamp">&lt;2017-09-14 Thu&gt;</span>  </span></li>
<li>installation from <span class="timestamp-wrapper">    <span class="timestamp">&lt;2017-09-11 Mon&gt; </span>  </span> to <span class="timestamp-wrapper">    <span class="timestamp">&lt;2017-09-15 Fri&gt; </span>  </span></li>
<li>  <span class="timestamp-wrapper">    <span class="timestamp">&lt;2017-09-14 Thu&gt; </span>  </span> Alignment with geometers for data taking, magnet warm and under vacuum.</li>
</ul></dd>

<dt>Window explosion cleaning accident</dt><dd>  <ul class="org-ul">
<li>weekend: (ref: <a href="./../org/Talks/CCM_2017_Sep/CCM_2017_Sep.html">./../org/Talks/CCM_2017_Sep/CCM_2017_Sep.html</a>)
<ul class="org-ul">
<li>calibration (but all wrong)</li>
<li>water cooling stopped working</li>
</ul></li>
<li>next week: try fix water cooling</li>
<li>quick couplings: rubber disintegrating causing cooling flow to go to
zero</li>
<li>attempt to clean via compressed air</li>
<li>final cleaning <span class="timestamp-wrapper">    <span class="timestamp">&lt;2017-09-19 Tue&gt;</span>  </span>: wrong tube, compressed detector…</li>
<li>detector window exploded…
<ul class="org-ul">
<li>show image of window and inside detector</li>
</ul></li>
<li>detector investigation in CAST CDL <span class="timestamp-wrapper">    <span class="timestamp">&lt;2017-09-19 Tue&gt;</span>  </span>
see
<img src="./figs/home/basti/org/Figs/CAST_detector_exploded/broken_window_close_IMG_20170919_152130.jpg" alt="broken_window_close_IMG_20170919_152130.jpg" />
images &amp; timestamps of images</li>
<li>study of contamination &amp; end of Sep CCM</li>
<li>detector back to Bonn, fixed</li>
</ul></dd>

<dt>Reinstallation for data taking start (Run 2)</dt><dd>  <ul class="org-ul">
<li>detector installation before first data taking</li>
<li>reinstall in October for start of data taking in 30th Oct 2017</li>
<li>remount start <span class="timestamp-wrapper">    <span class="timestamp">&lt;2017-10-23 Mon&gt;</span>  </span></li>
<li>  <span class="timestamp-wrapper">    <span class="timestamp">&lt;2017-10-26 Thu&gt; </span>  </span> Alignment with Geometers (after removal &amp;
remounting due to window accident) for data taking. Magnet <b>cold</b>
and under vacuum.</li>
<li>  <span class="timestamp-wrapper">    <span class="timestamp">&lt;2017-10-27 Fri&gt; </span>  </span> calibration of scintillator veto paddle in RD51 lab</li>
<li>remount installation finished incl. lead shielding <span class="timestamp-wrapper">    <span class="timestamp">&lt;2017-10-28 Sat&gt;</span>  </span>
(mail &quot;InGrid status update&quot; to Satan Forum on <span class="timestamp-wrapper">    <span class="timestamp">&lt;2017-11-09 Thu&gt;</span>  </span>)</li>
<li>&lt;data taking period from <span class="timestamp-wrapper">    <span class="timestamp">&lt;2017-10-30 Mon&gt; </span>  </span> to <span class="timestamp-wrapper">    <span class="timestamp">&lt;2017-12-22 Fri&gt; </span>  </span> in
2017&gt;
<ul class="org-ul">
<li>between runs 85 &amp; 86: fix of <code>src/waitconditions.cpp</code> TOS bug,
which caused scinti triggers to be written in all files up to next
FADC trigger</li>
<li>run 101 <span class="timestamp-wrapper">    <span class="timestamp">&lt;2017-11-29 Wed 06:40&gt; </span>  </span> was the first with FADC noise
significant enough to make me change settings:
<ul class="org-ul">
<li>Diff: 50 ns -&gt; 20 ns (one to left)</li>
<li>Coarse gain: 6x -&gt; 10x (one to right)</li>
</ul></li>
<li>run 109: <span class="timestamp-wrapper">    <span class="timestamp">&lt;2017-12-04 Mon&gt; </span>  </span> crazy amounts of noise on FADC</li>
<li>run 111: stopped early. tried to debug noise and blew a fuse in
gas interlock box by connecting NIM crate to wrong power cable</li>
<li>run 112: change FADC settings again due to noise:
<ul class="org-ul">
<li>integration: 50 ns -&gt; 100 ns
This was done at around <span class="timestamp-wrapper">    <span class="timestamp">&lt;2017-12-07 Thu 08:00&gt;</span>  </span></li>
<li>integration: 100 ns -&gt; 50 ns again at around
<span class="timestamp-wrapper">    <span class="timestamp">&lt;2017-12-08 Fri 17:50&gt;</span>  </span>.</li>
</ul></li>
<li>run 121: Jochen set the FADC main amplifier
integration time from 50 -&gt; 100 ns again, around
<span class="timestamp-wrapper">    <span class="timestamp">&lt;2017-12-15 Fri 10:20&gt;</span>  </span></li>
</ul></li>
<li>&lt;data taking period from <span class="timestamp-wrapper">    <span class="timestamp">&lt;2018-02-17 Sat&gt; </span>  </span> to <span class="timestamp-wrapper">    <span class="timestamp">&lt;2018-04-17 Tue&gt;</span>  </span>
beginning 2018&gt;
<ul class="org-ul">
<li>start of 2018 period: temperature sensor broken!</li>
<li>  <span class="timestamp-wrapper">    <span class="timestamp">&lt;2018-02-15 Thu&gt; </span>  </span> to <span class="timestamp-wrapper">    <span class="timestamp">&lt;2018-02-17 Sat&gt; </span>  </span> issues with moving THL
values &amp; weird detector behavior. Changed THL values temporarily
as an attempted fix, but in the end didn&apos;t help, problem got worse.
<span class="timestamp-wrapper">    <span class="timestamp">&lt;2018-02-17 Sat&gt; </span>  </span> (ref: gmail &quot;Update 17/02&quot; and
<a href="./../org/Mails/cast_power_supply_problem_thlshift/power_supply_problem.html">./../org/Mails/cast_power_supply_problem_thlshift/power_supply_problem.html</a>)
issue with power supply causing severe drop in gain / increase
in THL (unclear, #hits in 55Fe dropped massively ; background
eventually only saw random active pixels).
Fixed by replugging all power cables and improving the grounding
situation.
iirc: this was later identified to be an issue with the
grounding between the water cooling system and the
detector.</li>
<li>by <span class="timestamp-wrapper">    <span class="timestamp">&lt;2018-02-17 Sat 20:41&gt; </span>  </span> everything was fixed and detector was
running correctly again.</li>
<li>  <p>
2 runs:
</p>
<ol class="org-ol">
<li>  <span class="timestamp-wrapper">    <span class="timestamp">&lt;2018-02-15 Thu 07:01&gt;    </span>  </span>    <span class="timestamp-wrapper">    <span class="timestamp">&lt;2018-02-15 Thu 08:33&gt;</span>  </span></li>
<li>  <span class="timestamp-wrapper">    <span class="timestamp">&lt;2018-02-16 Fri 07:00&gt;    </span>  </span>    <span class="timestamp-wrapper">    <span class="timestamp">&lt;2018-02-16 Fri 08:31&gt;</span>  </span></li>
</ol>
<p>
were missed because of this.
</p></li>
</ul></li>
<li>  <span class="timestamp-wrapper">    <span class="timestamp">&lt;2018-04-18 Wed&gt; </span>  </span> removal of veto scintillator and lead shielding</li>
<li>X-ray finger run 2 on <span class="timestamp-wrapper">    <span class="timestamp">&lt;2018-04-20 Fri&gt;</span>  </span>. This run is actually
useful to determine the position of the detector.</li>
<li>  <span class="timestamp-wrapper">    <span class="timestamp">&lt;2018-04-24 Tue&gt; </span>  </span> Geometer measurement after warming up magnet and
not under vacuum. Serves as reference for difference between
vacuum &amp; cold on <span class="timestamp-wrapper">    <span class="timestamp">&lt;2017-10-26 Thu&gt;</span>  </span>!</li>
<li>  <span class="timestamp-wrapper">    <span class="timestamp">&lt;2018-04-26 Thu&gt; </span>  </span> detector fully removed and taken back to Bonn</li>
</ul></dd>

<dt>Reinstallation for data taking in Oct 2018 (Run 3)</dt><dd>  <ul class="org-ul">
<li>installation started <span class="timestamp-wrapper">    <span class="timestamp">&lt;2018-07-16 Mon&gt;</span>  </span>. Mounting due to lead shielding
support was more complicated than intended (see mails &quot;ingrid
installation&quot; including Damien Bedat)</li>
<li>shielding fixed by <span class="timestamp-wrapper">    <span class="timestamp">&lt;2018-07-19 Thu&gt; </span>  </span> and detector installed the next
couple of days</li>
<li>  <span class="timestamp-wrapper">    <span class="timestamp">&lt;2018-07-23 Mon&gt; </span>  </span> Alignment with Geometers for data taking. Magnet
warm and not under vacuum.</li>
<li>data taking was supposed to start end of September, but delayed.</li>
<li>detector had issue w/ power supply, finally fixed on
<span class="timestamp-wrapper">    <span class="timestamp">&lt;2018-10-19 Fri&gt;</span>  </span>. Issue was a bad soldering joint on the Phoenix
connector on the intermediate board.
<b>Note</b>: See chain of mails titled &quot;Unser Detektor…&quot; starting on
<span class="timestamp-wrapper">    <span class="timestamp">&lt;2018-10-03 Wed&gt; </span>  </span> for more information. Detector behavior was weird
from beginning Oct. Weird behavior seen on the voltages of the
detector. Initial worry: power supply dead or supercaps on
it. Replaced power supply (Phips brought it a few days after), but no change.</li>
<li>data taking starts <span class="timestamp-wrapper">    <span class="timestamp">&lt;2018-10-20 Sat&gt;</span>  </span></li>
<li>run 297, 298 showed lots of noise again, disabled FADC on
<span class="timestamp-wrapper">    <span class="timestamp">&lt;2018-12-13 Thu 18:40&gt; </span>  </span> (went to CERN next day)</li>
<li>data taking ends <span class="timestamp-wrapper">    <span class="timestamp">&lt;2018-12-20 Thu&gt;</span>  </span></li>
<li>  <p>
runs that were missed:
</p>
<ol class="org-ol">
<li>  <span class="timestamp-wrapper">    <span class="timestamp">&lt;2018-10-19 Fri 06:21&gt;    </span>  </span>    <span class="timestamp-wrapper">    <span class="timestamp">&lt;2018-10-19 Fri 07:51&gt;</span>  </span></li>
<li>  <span class="timestamp-wrapper">    <span class="timestamp">&lt;2018-10-28 Sun 05:32&gt;    </span>  </span>    <span class="timestamp-wrapper">    <span class="timestamp">&lt;2018-10-28 Sun 07:05&gt;</span>  </span></li>
<li>  <span class="timestamp-wrapper">    <span class="timestamp">&lt;2018-11-24 Sat 07:08&gt;    </span>  </span>    <span class="timestamp-wrapper">    <span class="timestamp">&lt;2018-11-24 Sat 07:30&gt;</span>  </span></li>
</ol>
<p>
The last one was not a full run.
</p>
<ul class="org-ul">
<li class="off">  <code>[ ]</code> <b>CHECK THE ELOG FOR WHAT THE LAST RUN WAS ABOUT</b></li>
</ul></li>
</ul></dd>

<dt>CAST Detector Lab measurements</dt><dd>  <ul class="org-ul">
<li>detector mounted in CAST Detector Lab <span class="timestamp-wrapper">    <span class="timestamp">&lt;2019-02-14 Thu&gt;</span>  </span></li>
<li>data taking from <span class="timestamp-wrapper">    <span class="timestamp">&lt;2019-02-15 Fri&gt; </span>  </span> to <span class="timestamp-wrapper">    <span class="timestamp">&lt;2019-02-21 Thu&gt;</span>  </span>.</li>
<li>detector dismounted and taken back to Bonn</li>
</ul></dd>

<dt>Outer chip 55Fe calibrations</dt><dd>  <ul class="org-ul">
<li>ref: <a href="./../org/outerRingNotes.html">./../org/outerRingNotes.html</a></li>
<li>calibration measurements of outer chips with a 55Fe source using a
custom anode &amp; window</li>
<li>between <span class="timestamp-wrapper">    <span class="timestamp">&lt;2021-05-20 Thu&gt; </span>  </span> and <span class="timestamp-wrapper">    <span class="timestamp">&lt;2021-05-31 Mon 09:54&gt; </span>  </span> calibrations
of each outer chip using Run 2 and Run 3 detector calibrations</li>
<li>  <span class="timestamp-wrapper">    <span class="timestamp">&lt;2021-08-31 Tue&gt; </span>  </span> start of a new detector calibration</li>
<li>another set of measurements between <span class="timestamp-wrapper">    <span class="timestamp">&lt;2021-10-12 Tue 18:00&gt; </span>  </span> to
<span class="timestamp-wrapper">    <span class="timestamp">&lt;2021-10-16 Sat 19:55&gt; </span>  </span> with a new set of calibrations</li>
</ul></dd>
</dl>
</div>
</div>
</div>

<div class="outline-3" id="outline-container-sec:cast:alignment">
<h3 id="sec:cast:alignment"><span class="section-number-3">10.2.</span> Alignment</h3>
<div class="outline-text-3" id="text-sec:cast:alignment">
<p>
Detector alignment with the X-ray telescope, the magnet and by
extension the solar core during solar tracking is obviously crucial
for a helioscope for a good physics result. The alignment procedure
used for the Septemboard detector is a three-fold approach:
</p>

<ol class="org-ol">
<li>alignment of the piping up to the detector using an acrylic glass
target with a millimeter spaced cross, as seen in
fig. <a href="#fig:cast:laser_alignment1">1(a)</a>. This target is mounted to the
vacuum pipes in the same way the detector is mounted. A laser is
installed on the opposite side of the magnet. With the magnet bores
fully open the laser is aligned such that it propagates the full
bore and is reflected by the X-ray telescope into the focal
spot. This alignment guarantees the focal spot location to be near
the center of the detector. Uncertainty is introduced due to the
need to remove the acrylic glass target and install the detector,
as the mounting screws allow for small movements. In addition the
vacuum pipes are also not perfectly fixed.</li>
<li>alignment of the fully installed detector using an X-ray
finger. The &apos;X-ray finger&apos; is a small electric X-ray generator (in
particular an Amptek COOL-X), which is installed in the magnet bore
at the opposite end of the magnet. The generated X-rays must
traverse the magnet and telescope, thereby being focused by the
telescope into the focal spot. As the X-ray finger does not emit
parallel light, the resulting distribution of the X-rays on the
detector is not a perfect focal spot, even if the telescope was
perfect and the detector placed right in the focus. The close
distance also implies the focal length is slightly different than
for an infinite source. The mean position of the taken data can
anyhow be used to determine the likely focal spot position. See
below, fig. <a href="#fig:cast:xray_finger_centers">2(a)</a>, for an example and the
resulting position from one of the X-ray finger runs.</li>
<li>alignment by the geometer group at CERN. A theodolite is installed
in the CAST hall and the location of many targets on the magnet,
telescope, vacuum pipes and the detector itself are measured up to
\(\SI{0.5}{mm}\) precision at \(1σ\) level. See
fig. <a href="#fig:cast:alignment_targets">2(b)</a> for a picture of such a
target. The initial geometer measurement from <span class="timestamp-wrapper">  <span class="timestamp">&lt;2017-07-11 Tue&gt; </span></span> mainly
serves as a baseline reference. As the first two alignment
procedures provide a good alignment, a measurement of the existing
position by the geometers can then later be used to re-align the
detector after it was removed relative to the previous baseline
position relative to the telescope. This assures the detector can
be remounted and placed in the right location without the need for
an additional laser alignment.</li>
</ol>

<p>
The X-ray finger run taken in April 2018 can be used as a reference
for the alignment as used during the first data taking. The center
positions of each cluster can be shown as a heatmap, where the number
of hits each pixel received is colored. Computing the mean position of
all those clusters yields the most likely center position of the focal
spot. See fig. <a href="#fig:cast:xray_finger_centers">2(a)</a> for an example of
this. The position of the center based on the mean of all cluster
centers is about \(\SI{0.4}{mm}\) away from the center in both axes.
</p>


<figure class="figure-wrapper" id="fig:cast:xray_finger_alignment">
<figure class="subfigure" id="fig:cast:xray_finger_centers" data-width="49%">  <img src="./figs/home/basti/phd/Figs/CAST_Alignment/xray_finger_centers_run_189.svg" data-width="99%" />  <figcaption>Figure 2(a): X-ray finger clusters</figcaption></figure> <figure class="subfigure" id="fig:cast:alignment_targets" data-width="49%">  <img src="./figs/home/basti/phd/Figs/CAST_Alignment/detector_targets_for_alignment_small_crop.png" data-width="99%" />  <figcaption>Figure 2(b): Geometer target</figcaption></figure>
<figcaption>Figure 2: <a href="#fig:cast:xray_finger_centers">2(a)</a>: Cluster center positions of the X-ray finger run 189 from April
           2018. The red cross marks the center of all cluster centers,
           which is the most likely position of the focal spot. It is $\sim\SI{0.4}{mm}$ away from the chip center in both axes.
           The two parallel lines with less clusters are the window strongback.
           The orthogonal line is a graphite spacer in the center of the LLNL telescope. <a href="#fig:cast:alignment_targets">2(b)</a>: Image showing the targets on the detector. The acrylic glass
           cylinders are the fiducial marks used to hold the actual survey
           target. The survey target is a mirror to reflect the laser of the
           theodolite. Image from (<a href="./bibliography.html#citeproc_bib_item_15">B. C. Antje Behrens 2017</a>).</figcaption>
</figure>


<p>
With this setup after each remounting a geometer measurement was
performed to align the detector back to the initial laser
alignment. As the second mounting of the detector in September 2017
was not used for any data taking, the associated geometer measurement
is irrelevant.
</p>

<p>
Tab. <a href="#tab:cast:geometer_alignments">11</a> summarizes the values of the
geometer alignment results for each of the measurements using the
CenterR and CenterF positions defined based on the initial geometer
measurement in July 2017. In each case the shifts in X, Y and Z
direction is usually significantly less than \(\SI{1}{mm}\).
</p>

<table id="tab:cast:geometer_alignments">
<caption class="t-above"><span class="table-number">Table 11:</span> Overview of the results of the different geometer alignment measurements. The first measuremnt serves as the baseline to define 2 points (CenterR and CenterF) relative to which alignment later is done. The initial alignment is done both by laser and X-ray finger. The second geometer measurement is not useful, as no data was taken with it, due to the window rupture accident.</caption>

<colgroup>
<col class="org-right" />

<col class="org-left" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-left" />
</colgroup>
<thead>
<tr>
<th class="org-right" scope="col">Measurement</th>
<th class="org-left" scope="col">Target</th>
<th class="org-right" scope="col">ΔX [\(\si{mm}\)]</th>
<th class="org-right" scope="col">ΔY [\(\si{mm}\)]</th>
<th class="org-right" scope="col">ΔZ [\(\si{mm}\)]</th>
<th class="org-left" scope="col">Useful</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">11.07.2017</td>
<td class="org-left"> </td>
<td class="org-right"> </td>
<td class="org-right"> </td>
<td class="org-right"> </td>
<td class="org-left">yes</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">14.09.2017</td>
<td class="org-left">CenterR</td>
<td class="org-right">-0.1</td>
<td class="org-right">0.3</td>
<td class="org-right">-0.8</td>
<td class="org-left">no</td>
</tr>

<tr>
<td class="org-right"> </td>
<td class="org-left">CenterF</td>
<td class="org-right">-0.1</td>
<td class="org-right">0.3</td>
<td class="org-right">-0.9</td>
<td class="org-left"> </td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">26.10.2017</td>
<td class="org-left">CenterR</td>
<td class="org-right">0.2</td>
<td class="org-right">0.6</td>
<td class="org-right">0.2</td>
<td class="org-left">yes</td>
</tr>

<tr>
<td class="org-right"> </td>
<td class="org-left">CenterF</td>
<td class="org-right">0.1</td>
<td class="org-right">0.6</td>
<td class="org-right">-0.1</td>
<td class="org-left"> </td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">24.04.2018</td>
<td class="org-left">CenterR</td>
<td class="org-right">0.5</td>
<td class="org-right">0.5</td>
<td class="org-right">0.0</td>
<td class="org-left">yes</td>
</tr>

<tr>
<td class="org-right"> </td>
<td class="org-left">CenterF</td>
<td class="org-right">0.4</td>
<td class="org-right">0.5</td>
<td class="org-right">-0.3</td>
<td class="org-left"> </td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">23.07.2018</td>
<td class="org-left">CenterR</td>
<td class="org-right">1.1</td>
<td class="org-right">0.5</td>
<td class="org-right">0.6</td>
<td class="org-left">yes</td>
</tr>

<tr>
<td class="org-right"> </td>
<td class="org-left">CenterF</td>
<td class="org-right">1.0</td>
<td class="org-right">0.5</td>
<td class="org-right">0.3</td>
<td class="org-left"> </td>
</tr>
</tbody>
</table>

<p>
For a detailed overview of the geometer measurements see the public
EDMS links under (<a href="./bibliography.html#citeproc_bib_item_15">B. C. Antje Behrens 2017</a>; <a href="./bibliography.html#citeproc_bib_item_17">B. C. Antje Behrens Alexandre Beynel 2017b</a>, <a href="./bibliography.html#citeproc_bib_item_16">2017a</a>; <a href="./bibliography.html#citeproc_bib_item_14">Antje Behrens 2018b</a>, <a href="./bibliography.html#citeproc_bib_item_13">2018a</a>)
containing the PDF reports for each measurement.
</p>
</div>

<div class="outline-4" id="outline-container-orgd482967">
<h4 id="orgd482967"><span class="section-number-4">10.2.1.</span> Some extra info about the geometer alignment   <span class="tag">  <span class="extended">extended</span></span></h4>
<div class="outline-text-4" id="text-10-2-1">
<p>
The following is the snippet from the <span class="timestamp-wrapper">  <span class="timestamp">&lt;2017-09-14 Thu&gt; </span></span> PDF report about
the definition of the CenterR and CenterF positions.
</p>
<blockquote>
<p>
Goal of the operation has been to align the InGRID detector with
respect to the LLNL telescope as on 11.07.2017 after the alignment of
the setup with respect to the LASER installed.  Coordinates of the
measurement on 11.07.2017 are given below.
</p>

<p>
In order to compare InGRID position on 11.07 and 14.09, two points
close to the detector axis CenterR and CenterF have been defined on
11.07. Afterwards their coordinates for the measurement on 14.09 have
been calculated.
</p>
</blockquote>
</div>
</div>

<div class="outline-4" id="outline-container-sec:cast:alignment:xray_finger_plots">
<h4 id="sec:cast:alignment:xray_finger_plots"><span class="section-number-4">10.2.2.</span> Generate X-ray heatmap <code>[/]</code>   <span class="tag">  <span class="extended">extended</span></span></h4>
<div class="outline-text-4" id="text-sec:cast:alignment:xray_finger_plots">
<ul class="org-ul">
<li class="on"><code>[X]</code> <b>FIND XRAY FINGER RUN 2, RUN 189!</b>
<a href="./../CastData/data/XrayFingerRuns/">./../CastData/data/XrayFingerRuns/</a></li>
<li class="on"><code>[X]</code> <b>RECREATE BELOW FOR THE OTHER XRAY FINGER RUN!</b>
-&gt; Both are created and listed below.</li>
<li class="off"><code>[ ]</code> <b>RECREATE PLOTS AS TIKZ + VEGA</b>
-&gt; We create them on the Cairo backend using DejaVu Serif, same as
in the document of the thesis now. This is because the TikZ produced
vector graphic ends up much larger than the Cairo one.
Vega is on hold for now.</li>
<li class="on"><code>[X]</code> <b>VERIFY THAT WE (LIKELY) HAVE TO ROTATE THE DATA BY 90 DEGREES AS ONE OF THE VERTICAL LINES IS THE TELESCOPE AXIS WHICH SHOULD BE
HORIZONTAL TO THE GROUND</b>
-&gt; Yes, we do.</li>
</ul>

<p>
First let&apos;s reconstruct the X-ray finger run:
</p>
<div class="org-src-container">
<pre class="src src-nim"><span style="color: #F92672;">import</span> shell, strutils

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">main</span><span style="color: #AE81FF;">(</span>path: <span style="color: #66D9EF;">string</span>, run: <span style="color: #66D9EF;">int</span><span style="color: #AE81FF;">)</span> =
  <span style="color: #75715E;"># </span><span style="color: #75715E;">parse data</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">outfile </span>= <span style="color: #E6DB74;">&quot;/t/xray_finger_</span><span style="color: #F92672;">$#</span><span style="color: #E6DB74;">.h5&quot;</span> % $run
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">recoOut </span>= <span style="color: #E6DB74;">&quot;/t/reco_xray_finger_</span><span style="color: #F92672;">$#</span><span style="color: #E6DB74;">.h5&quot;</span> % $run
  
  shell:
    raw_data_manipulation -p <span style="color: #AE81FF;">(</span>$path<span style="color: #AE81FF;">)</span> <span style="color: #E6DB74;">&quot;--runType xray --out &quot;</span> <span style="color: #AE81FF;">(</span>$outfile<span style="color: #AE81FF;">)</span>
  shell:
    reconstruction -i <span style="color: #AE81FF;">(</span>$outfile<span style="color: #AE81FF;">)</span> <span style="color: #E6DB74;">&quot;--out &quot;</span> <span style="color: #AE81FF;">(</span>$recoOut<span style="color: #AE81FF;">)</span>
  
<span style="color: #F92672;">when</span> <span style="color: #AE81FF;">isMainModule</span>:
  <span style="color: #F92672;">import</span> cligen
  dispatch main
</pre>
</div>

<p>
And now we simply create a heatmap of the cluster centers:
</p>

<div class="org-src-container">
<pre class="src src-nim"><span style="color: #F92672;">import</span> nimhdf5, ggplotnim, options
<span style="color: #F92672;">import</span> ingrid / tos_helpers
<span style="color: #F92672;">import</span> std / <span style="color: #AE81FF;">[</span>strutils, tables<span style="color: #AE81FF;">]</span>

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">main</span><span style="color: #AE81FF;">(</span>run: <span style="color: #66D9EF;">int</span>, switchAxes: <span style="color: #66D9EF;">bool</span> = <span style="color: #AE81FF;">false</span>, useTeX = <span style="color: #AE81FF;">false</span><span style="color: #AE81FF;">)</span> =
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">file </span>= <span style="color: #E6DB74;">&quot;/t/reco_xray_finger_</span><span style="color: #F92672;">$#</span><span style="color: #E6DB74;">.h5&quot;</span> % $run
  
  <span style="color: #75715E;">#</span><span style="color: #75715E;">proc readClusters(h5f: H5File): (seq[float], seq[float]) =</span>
  <span style="color: #F92672;">var</span> <span style="color: #FD971F;">h5f </span>= <span style="color: #66D9EF;">H5open</span><span style="color: #AE81FF;">(</span>file, <span style="color: #E6DB74;">&quot;r&quot;</span><span style="color: #AE81FF;">)</span>
  
  <span style="color: #75715E;"># </span><span style="color: #75715E;">compute counts based on number of each pixel hit</span>
  <span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">toIdx</span><span style="color: #AE81FF;">(</span>x: <span style="color: #66D9EF;">float</span><span style="color: #AE81FF;">)</span>: <span style="color: #66D9EF;">int</span> = <span style="color: #AE81FF;">(</span>x / <span style="font-style: italic;">14</span>.<span style="font-style: italic;">0</span> * <span style="font-style: italic;">256</span>.<span style="font-style: italic;">0</span><span style="color: #AE81FF;">)</span>.round.<span style="color: #66D9EF;">int</span>.<span style="color: #F92672;">clamp</span><span style="color: #AE81FF;">(</span><span style="font-style: italic;">0</span>, <span style="font-style: italic;">255</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">var</span> <span style="color: #FD971F;">ctab </span>= initCountTable<span style="color: #AE81FF;">[</span><span style="color: #66D9EF;">(</span><span style="color: #66D9EF;">int</span>, <span style="color: #66D9EF;">int</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">]()</span> 
  
  <span style="color: #F92672;">var</span> <span style="color: #FD971F;">df </span>= readRunDsets<span style="color: #AE81FF;">(</span>h5f, run = run,
                        chipDsets = some<span style="color: #66D9EF;">(</span><span style="color: #A6E22E;">(</span>
                        chip: <span style="font-style: italic;">3</span>, dsets: @<span style="color: #E6DB74;">[</span><span style="color: #E6DB74;">&quot;centerX&quot;</span>, <span style="color: #E6DB74;">&quot;centerY&quot;</span><span style="color: #E6DB74;">]</span><span style="color: #A6E22E;">)</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
    .mutate<span style="color: #AE81FF;">(</span>f<span style="color: #66D9EF;">{</span><span style="color: #E6DB74;">&quot;xidx&quot;</span> ~ toIdx<span style="color: #A6E22E;">(</span>idx<span style="color: #E6DB74;">(</span><span style="color: #E6DB74;">&quot;centerX&quot;</span><span style="color: #E6DB74;">)</span><span style="color: #A6E22E;">)</span><span style="color: #66D9EF;">}</span>,
            f<span style="color: #66D9EF;">{</span><span style="color: #E6DB74;">&quot;yidx&quot;</span> ~ toIdx<span style="color: #A6E22E;">(</span>idx<span style="color: #E6DB74;">(</span><span style="color: #E6DB74;">&quot;centerY&quot;</span><span style="color: #E6DB74;">)</span><span style="color: #A6E22E;">)</span><span style="color: #66D9EF;">}</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">xidx </span>= df<span style="color: #AE81FF;">[</span><span style="color: #E6DB74;">&quot;xidx&quot;</span>, <span style="color: #66D9EF;">int</span><span style="color: #AE81FF;">]</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">yidx </span>= df<span style="color: #AE81FF;">[</span><span style="color: #E6DB74;">&quot;yidx&quot;</span>, <span style="color: #66D9EF;">int</span><span style="color: #AE81FF;">]</span>
  forEach x <span style="color: #F92672;">in</span> xidx, y <span style="color: #F92672;">in</span> yidx:
    <span style="color: #F92672;">inc</span> cTab, <span style="color: #AE81FF;">(</span>x, y<span style="color: #AE81FF;">)</span>
  df = df.mutate<span style="color: #AE81FF;">(</span>f<span style="color: #66D9EF;">{</span><span style="color: #66D9EF;">int</span>: <span style="color: #E6DB74;">&quot;count&quot;</span> ~ cTab<span style="color: #A6E22E;">[</span><span style="color: #E6DB74;">(</span>`xidx`, `yidx`<span style="color: #E6DB74;">)</span><span style="color: #A6E22E;">]</span><span style="color: #66D9EF;">}</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">centerX </span>= df<span style="color: #AE81FF;">[</span><span style="color: #E6DB74;">&quot;centerX&quot;</span>, <span style="color: #66D9EF;">float</span><span style="color: #AE81FF;">]</span>.mean
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">centerY </span>= df<span style="color: #AE81FF;">[</span><span style="color: #E6DB74;">&quot;centerY&quot;</span>, <span style="color: #66D9EF;">float</span><span style="color: #AE81FF;">]</span>.mean
  <span style="color: #F92672;">discard</span> h5f.<span style="color: #F92672;">close</span><span style="color: #AE81FF;">()</span>
 
  <span style="color: #F92672;">echo</span> <span style="color: #E6DB74;">&quot;Center position of the cluster is at: (x, y) = (&quot;</span>, centerX, <span style="color: #E6DB74;">&quot;, &quot;</span>, centerY, <span style="color: #E6DB74;">&quot;)&quot;</span>
  <span style="color: #E6DB74;">## NOTE: Exchanging the axes for X and Y is equivalent to a 90° clockwise rotation for our data</span>
  <span style="color: #E6DB74;">## because the centerX values are inverted `</span><span style="color: #AE81FF;">(256 - x), applyPitchConversion</span><span style="color: #E6DB74;">`. </span>
  <span style="color: #E6DB74;">## The real rotation of the Septemboard detector at CAST seen from the telescope onto the</span>
  <span style="color: #E6DB74;">## detector is precisely 90° clockwise. </span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">x </span>= <span style="color: #F92672;">if</span> switchAxes: <span style="color: #E6DB74;">&quot;centerY&quot;</span> <span style="color: #F92672;">else</span>: <span style="color: #E6DB74;">&quot;centerX&quot;</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">y </span>= <span style="color: #F92672;">if</span> switchAxes: <span style="color: #E6DB74;">&quot;centerX&quot;</span> <span style="color: #F92672;">else</span>: <span style="color: #E6DB74;">&quot;centerY&quot;</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">cX </span>= <span style="color: #F92672;">if</span> switchAxes: centerY <span style="color: #F92672;">else</span>: centerX
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">cY </span>= <span style="color: #F92672;">if</span> switchAxes: centerX <span style="color: #F92672;">else</span>: centerY
  ggplot<span style="color: #AE81FF;">(</span>df, aes<span style="color: #66D9EF;">(</span>x, y, color = <span style="color: #E6DB74;">&quot;count&quot;</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span> +
    geom_point<span style="color: #AE81FF;">(</span>size = <span style="font-style: italic;">0</span>.<span style="font-style: italic;">75</span><span style="color: #AE81FF;">)</span> +
    geom_point<span style="color: #AE81FF;">(</span>data = newDataFrame<span style="color: #66D9EF;">()</span>, aes = aes<span style="color: #66D9EF;">(</span>x = cX, y = cY<span style="color: #66D9EF;">)</span>,
               color = <span style="color: #E6DB74;">&quot;red&quot;</span>, marker = mkRotCross<span style="color: #AE81FF;">)</span> + 
    scale_color_continuous<span style="color: #AE81FF;">()</span> +
    ggtitle<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;X-ray finger clusters of run </span><span style="color: #F92672;">$#</span><span style="color: #E6DB74;">&quot;</span> % $run<span style="color: #AE81FF;">)</span> +
    xlab<span style="color: #AE81FF;">(</span>r<span style="color: #E6DB74;">&quot;x [mm]&quot;</span><span style="color: #AE81FF;">)</span> + ylab<span style="color: #AE81FF;">(</span>r<span style="color: #E6DB74;">&quot;y [mm]&quot;</span><span style="color: #AE81FF;">)</span> + 
    xlim<span style="color: #AE81FF;">(</span><span style="font-style: italic;">0</span>.<span style="font-style: italic;">0</span>, <span style="font-style: italic;">14</span>.<span style="font-style: italic;">0</span><span style="color: #AE81FF;">)</span> + ylim<span style="color: #AE81FF;">(</span><span style="font-style: italic;">0</span>.<span style="font-style: italic;">0</span>, <span style="font-style: italic;">14</span>.<span style="font-style: italic;">0</span><span style="color: #AE81FF;">)</span> +
    margin<span style="color: #AE81FF;">(</span>right = <span style="font-style: italic;">3</span>.<span style="font-style: italic;">5</span><span style="color: #AE81FF;">)</span> + 
    <span style="color: #75715E;">#</span><span style="color: #75715E;">theme_scale(1.0, family = &quot;serif&quot;) +</span>
    coord_fixed<span style="color: #AE81FF;">(</span><span style="font-style: italic;">1</span>.<span style="font-style: italic;">0</span><span style="color: #AE81FF;">)</span> + 
    themeLatex<span style="color: #AE81FF;">(</span>fWidth = <span style="font-style: italic;">0</span>.<span style="font-style: italic;">5</span>, width = <span style="font-style: italic;">600</span>, baseTheme = sideBySide<span style="color: #AE81FF;">)</span> +
    legendPosition<span style="color: #AE81FF;">(</span><span style="font-style: italic;">0</span>.<span style="font-style: italic;">83</span>, <span style="font-style: italic;">0</span>.<span style="font-style: italic;">0</span><span style="color: #AE81FF;">)</span> + 
    ggsave<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;/home/basti/phd/Figs/CAST_Alignment/xray_finger_centers_run_</span><span style="color: #F92672;">$#</span><span style="color: #E6DB74;">.pdf&quot;</span> % $run,
           useTeX = useTeX, standalone = useTeX, dataAsBitmap = <span style="color: #AE81FF;">true</span><span style="color: #AE81FF;">)</span>
           <span style="color: #75715E;">#</span><span style="color: #75715E;">useTeX = true, standalone = true)</span>

<span style="color: #F92672;">when</span> <span style="color: #AE81FF;">isMainModule</span>:
  <span style="color: #F92672;">import</span> cligen
  dispatch main
</pre>
</div>

<p>
First perform the data reconstruction:
</p>
<div class="org-src-container">
<pre class="src src-sh">./code/xray_finger_data_parsing -p ~/CastData/data/XrayFingerRuns/Run_21_170713-11-03 --run 21
./code/xray_finger_data_parsing -p ~/CastData/data/XrayFingerRuns/Run_189_180420-09-53 --run 189
</pre>
</div>
<p>
And now create the plots:
</p>
<div class="org-src-container">
<pre class="src src-sh">./code/xray_finger_center_plot -r 21 --switchAxes 
./code/xray_finger_center_plot -r 189 --switchAxes
</pre>
</div>

<p>
For run 21:
Center position of the cluster is at: (x, y) = (7.210714052855218,5.669514297250704)
For run 189:
Center position of the cluster is at: (x, y) = (7.428075467697270,6.594113570730057)
</p>

<p>
First the plot for the (unused) X-ray finger run taken at the first
installation before any data taking (detector removed afterwards):
<img src="./figs/home/basti/phd/Figs/CAST_Alignment/xray_finger_centers_run_21.svg" class="org-svg" alt="xray_finger_centers_run_21.svg" />
</p>

<p>
And second the plot of the 2018 X-ray finger run taken <span class="underline">before</span> the
detector was removed in Apr 2018. This is the baseline for our idea
where the focal spot is going to be.
<a href="Figs/CAST_Alignment/xray_finger_centers_run_189.pdf">Figs/CAST_Alignment/xray_finger_centers_run_189.pdf</a>
</p>

<p>
<b>NOTE</b>: For a longer explanation about the reasoning behind the
comment for <code>--switchAxes</code> in the code, see
sec. <a href="./limit.html#sec:limit:candidates:septemboard_layout_transformations">13.14.7</a>.
</p>
</div>
</div>

<div class="outline-4" id="outline-container-orgae477ac">
<h4 id="orgae477ac"><span class="section-number-4">10.2.3.</span> Systematic uncertainty from graphite spacer rotation <code>[/]</code>   <span class="tag">  <span class="extended">extended</span></span></h4>
<div class="outline-text-4" id="text-10-2-3">
<ul class="org-ul">
<li class="on"><code>[X]</code> Determine the rotation angle of the graphite spacer from the
X-ray finger data
-&gt; do now.
X-ray finger run:
<img src="./figs/home/basti/phd/Figs/CAST_Alignment/xray_finger_centers_run_189.svg" class="org-svg" alt="xray_finger_centers_run_189.svg" />
-&gt;
<img src="./figs/home/basti/org/Figs/statusAndProgress/xray_finger_graphite_spacer_angle_run189.png" alt="xray_finger_graphite_spacer_angle_run189.png" />
-&gt; It comes out to 14.17°!
But for run 21 (between which detector was dismounted of course):
<img src="./figs/home/basti/org/Figs/statusAndProgress/xray_finger_graphite_spacer_angle_run21.png" alt="xray_finger_graphite_spacer_angle_run21.png" />
-&gt; Only 11.36°!
That&apos;s a huge uncertainty given the detector was only dismounted!
3°.</li>

<li class="off"><code>[ ]</code> rotation of telescope!</li>
<li class="off"><code>[ ]</code> Effect on systematic uncertainty!</li>
</ul>
</div>
</div>
</div>

<div class="outline-3" id="outline-container-sec:cast:detector_setup">
<h3 id="sec:cast:detector_setup"><span class="section-number-3">10.3.</span> Detector setup at CAST</h3>
<div class="outline-text-3" id="text-sec:cast:detector_setup">
<p>
The setup of the full beamline from the magnet end cap to the detector
is shown in a render in fig. <a href="#fig:cast:render_beamline_setup">3</a>. The
piping shows a clear kink introduced using a flexible bellow. This
setup is used to move the detector mount further away from the other
beamline to provide more space for two setups side-by-side. At the
same time it is an artifact of the LLNL telescope only being a
\(\SI{30}{°}\) portion of a full telescope resulting in the focal plane
not being centered in front of the telescope. Not shown in the image
is the lead shielding installed around the detector as well as the
veto scintillator, which covers the majority of the beamline area. The
lead shielding is a \(\SIrange{5}{15}{cm}\) thick &apos;castle&apos; of lead around
the detector (\(\SI{10}{cm}\) on top and behind, \(\SI{15}{cm}\) in front and
\(\SI{5}{cm}\) and \(\SI{10}{cm}\) on each side). An annotated image of the
real setup is seen in fig. <a href="#fig:cast:annotated_setup">4</a>, which shows lead
shielding, veto scintillator, \cefe source manipulator and the LLNL
X-ray telescope. The setup is behind the VT3 gate valve of the CAST magnet.
</p>


<figure id="fig:cast:render_beamline_setup">
<img src="./figs/home/basti/phd/Figs/llnl_cast_gridpix_render_small_annotated.png" alt="llnl_cast_gridpix_render_small_annotated.png" />

<figcaption>Figure 3: <span class="figure-number">Figure 35: </span>Render of the detector setup up to the magnet end cap as seen from above. The beamline kinks away from the other beamline (&quot;below&quot; in this image) to provide more space for two detectors at the same time. Image courtesy of Tobias Schiffer.</figcaption>
</figure>


<figure id="fig:cast:annotated_setup">
<img src="./figs/home/basti/phd/Figs/CAST_Nov2017Aufbau_annotated_small.png" alt="CAST_Nov2017Aufbau_annotated_small.png" />

<figcaption>Figure 4: <span class="figure-number">Figure 36: </span>Annotated setup as installed in October 2017 for the first data taking campaign. The detector is seen in its lead shielding, with the veto scintillator covering a large angular portion above the detector. The \cefe source manipulator is seen head-on here. On the right towards the magnet we see the housing of the LLNL X-ray telescope.</figcaption>
</figure>
</div>

<div class="outline-4" id="outline-container-sec:cast:55fe_manipulator">
<h4 id="sec:cast:55fe_manipulator"><span class="section-number-4">10.3.1.</span> \cefe source and manipulator</h4>
<div class="outline-text-4" id="text-sec:cast:55fe_manipulator">
<p>
As seen in the previous section the setup includes a \cefe
source. Its purpose is both monitoring of the detector behavior and it
serves as a way to calibrate the energy of events (as mentioned in
theory section <a href="./theory_detector.html#sec:theory:escape_peaks_55fe">6.3.8</a>). More details on the
usage and importance for data analysis will be given in chapter
<a href="./calibration.html#sec:calibration">11</a>. It is installed on a pneumatic
manipulator. Using a compressed air line with about \(\SI{6}{bar}\)
pressure the manipulator can be moved up and down. Under vacuum
conditions of the setup the manipulator is inserted unless the
compressed air is used to push it out.
</p>

<p>
A Raspberry Pi <sup>  <a role="doc-backlink" class="footref" id="fnr.2" href="#fn.2">2</a></sup> is installed close to the manipulator and
connects to the two Festo <sup>  <a role="doc-backlink" class="footref" id="fnr.3" href="#fn.3">3</a></sup> control sensors at the top and
bottom end of the manipulator using the general purpose input/output
(GPIO) pins. Two pins are used to read the sensor status from
each. Five more pins connect to a \(\SI{24}{V}\) relay, which is used to
control the controllers for the compressed air line. The relay is
controlled by pulse width modulation (PWM). The software controlling
the GPIO pins of the Raspberry Pi is written in Python. A client
program is running on a computer in the CAST control room and
communicates with the Raspberry Pi using a network connection on which
a server process is running. It can receive connections through a
socket, allowing for remote and programmatic control of the
manipulator via a set of simple string based messages. Further, it
provides a REPL (read-evaluate-print loop) to control it
interactively. For more details about the software see the extended
version of this thesis.
</p>
</div>

<div class="outline-5" id="outline-container-orgec425b4">
<h5 id="orgec425b4"><span class="section-number-5">10.3.1.1.</span> Manipulator software and notes <code>[0/1]</code>   <span class="tag">  <span class="extended">extended</span></span></h5>
<div class="outline-text-5" id="text-10-3-1-1">
<ul class="org-ul">
<li class="off"><code>[ ]</code> <b>MOVE MANIPULATOR CODE TO TPA TOOLS AND LINK TO IT?</b>
-&gt; Code can definitely go to TPA repository. The notes I think are
enough if they are simply added as an Org file into the repository
as well. They are too specific in some sense?</li>
</ul>

<p>
The source code of the python script running on the Raspberry Pi to
control the manipulator is the following script:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #75715E;">#</span><span style="color: #75715E;">!/usr/bin/env python3.6</span>

<span style="color: #F92672;">import</span> sys
<span style="color: #F92672;">import</span> pigpio
<span style="color: #F92672;">import</span> readline
<span style="color: #F92672;">import</span> logging
<span style="color: #F92672;">import</span> argparse
<span style="color: #F92672;">import</span> time
<span style="color: #F92672;">import</span> socket
<span style="color: #F92672;">import</span> threading
<span style="color: #F92672;">import</span> json
<span style="color: #F92672;">import</span> asyncio
<span style="color: #F92672;">import</span> functools
<span style="color: #F92672;">import</span> weakref

<span style="color: #75715E;"># </span><span style="color: #75715E;">the program needs to do the following</span>
<span style="color: #75715E;"># </span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">- on RPi 7 pins used (5 controlled via software):</span>
<span style="color: #75715E;">#     </span><span style="color: #75715E;">- relay:</span>
<span style="color: #75715E;">#         </span><span style="color: #75715E;">- GOOD  - input, Pin 14</span>
<span style="color: #75715E;">#         </span><span style="color: #75715E;">- OUT   - input, Pin 15</span>
<span style="color: #75715E;">#         </span><span style="color: #75715E;">- RC IN - output (via PWM), via Pin 14</span>
<span style="color: #75715E;">#         </span><span style="color: #75715E;">- VRC   - const voltage, using 5V via PIN 2, not done in software</span>
<span style="color: #75715E;">#         </span><span style="color: #75715E;">- GND   - ground, pin 6, not done in software</span>
<span style="color: #75715E;">#     </span><span style="color: #75715E;">- sensors 2 pins:</span>
<span style="color: #75715E;">#         </span><span style="color: #75715E;">- input, read sensor output</span>
<span style="color: #75715E;"># </span>
<span style="color: #75715E;"># </span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">program always listens to GOOD and OUT</span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">using PWM we activate the manipulator. done by waiting for </span>
<span style="color: #75715E;">#  </span><span style="color: #75715E;">- command line input?</span>
<span style="color: #75715E;">#  </span><span style="color: #75715E;">- reading some file, s.t. this program runs as a daemon and we use</span>
<span style="color: #75715E;">#    </span><span style="color: #75715E;">some external tool to write file via usb to Pi</span>
<span style="color: #75715E;">#  </span><span style="color: #75715E;">- finally be able to execute from TOS. easiest via script to call</span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">reading sensor inputs done in connection with usage of PWM</span>
<span style="color: #75715E;"># </span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">finally compile this program to jar to run it</span>


<span style="color: #75715E;"># </span><span style="color: #75715E;">in order to control the source via network, the basic usage is something like</span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">the following:</span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">s.connect((&apos;localhost&apos;, 42000))</span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">s.send(&quot;insert&quot;.encode())</span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">depening on whether the call is from the local machine or not.</span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">&quot;insert&quot; and &quot;remove&quot; are supported at the moment</span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">sends back a byte string containing the bool of the</span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">insertion / removal</span>

<span style="color: #75715E;">#</span><span style="color: #75715E;">class client(asyncio.Protocol):</span>



<span style="color: #75715E;"># </span><span style="color: #75715E;">connect to pi at IP address</span>
<span style="color: #FD971F;">p</span> = pigpio.pi<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&apos;10.42.0.91&apos;</span><span style="color: #AE81FF;">)</span>

<span style="color: #75715E;"># </span><span style="color: #75715E;">define dict of pins</span>
<span style="color: #FD971F;">d</span> = <span style="color: #AE81FF;">{</span><span style="color: #E6DB74;">&quot;GOOD&quot;</span>    : 14,
     <span style="color: #E6DB74;">&quot;OUT&quot;</span>     : 15,
     <span style="color: #E6DB74;">&quot;RC_IN&quot;</span>   : 18,
     <span style="color: #E6DB74;">&quot;S_OPEN&quot;</span>  : 20,
     <span style="color: #E6DB74;">&quot;S_CLOSE&quot;</span> : 21<span style="color: #AE81FF;">}</span>

    

<span style="color: #F92672;">class</span> <span style="color: #66D9EF;">server</span><span style="color: #AE81FF;">(</span>threading.Thread<span style="color: #AE81FF;">)</span>:
    <span style="color: #75715E;"># </span><span style="color: #75715E;">this is a simple server class, which receives the necessary</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">parameters to control the raspberry pi and a socket, from</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">which it listens to commands</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">inherits from threading.Thread to run in a separate thread</span>

    <span style="color: #F92672;">def</span> <span style="color: #A6E22E;">__init__</span><span style="color: #AE81FF;">(</span><span style="color: #F92672;">self</span>, socket, p, d, pwm<span style="color: #AE81FF;">)</span>:
        <span style="color: #75715E;"># </span><span style="color: #75715E;">init the object</span>
        <span style="color: #F92672;">self</span>.<span style="color: #FD971F;">socket</span> = socket
        <span style="color: #F92672;">self</span>.<span style="color: #FD971F;">p</span>      = p 
        <span style="color: #F92672;">self</span>.<span style="color: #FD971F;">d</span>      = d
        <span style="color: #F92672;">self</span>.<span style="color: #FD971F;">pwm</span>    = pwm
        <span style="color: #F92672;">self</span>.<span style="color: #FD971F;">_stop</span>  = <span style="color: #AE81FF;">False</span>
        <span style="color: #75715E;"># </span><span style="color: #75715E;">now call the Thread init</span>
        threading.Thread.__init__<span style="color: #AE81FF;">(</span><span style="color: #F92672;">self</span><span style="color: #AE81FF;">)</span>
        <span style="color: #75715E;"># </span><span style="color: #75715E;">and set it as a daemon, so that it cannot</span>
        <span style="color: #75715E;"># </span><span style="color: #75715E;">stop the main program from quitting</span>
        <span style="color: #F92672;">self</span>.setDaemon<span style="color: #AE81FF;">(</span><span style="color: #AE81FF;">True</span><span style="color: #AE81FF;">)</span>

    <span style="color: #F92672;">async def</span> <span style="color: #A6E22E;">process_client</span><span style="color: #AE81FF;">(</span><span style="color: #F92672;">self</span>, reader, writer<span style="color: #AE81FF;">)</span>:
        <span style="color: #FD971F;">client</span> = writer.get_extra_info<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&apos;peername&apos;</span><span style="color: #AE81FF;">)</span>
        <span style="color: #F92672;">print</span><span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;New client connected: {}&quot;</span>.<span style="color: #F92672;">format</span><span style="color: #66D9EF;">(</span>client<span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
        <span style="color: #F92672;">while</span> <span style="color: #F92672;">self</span>._stop == <span style="color: #AE81FF;">False</span>:
            <span style="color: #75715E;">#</span><span style="color: #75715E;">data = socket.recv(1024).decode()</span>
            <span style="color: #FD971F;">data</span> = <span style="color: #AE81FF;">(</span><span style="color: #F92672;">await</span> reader.readline<span style="color: #66D9EF;">()</span><span style="color: #AE81FF;">)</span>.decode<span style="color: #AE81FF;">()</span>
            <span style="color: #F92672;">if</span> data:
                <span style="color: #FD971F;">success</span> = <span style="color: #F92672;">self</span>.parse_message<span style="color: #AE81FF;">(</span>data, client<span style="color: #AE81FF;">)</span>
                <span style="color: #FD971F;">message</span> = <span style="color: #F92672;">self</span>.create_message<span style="color: #AE81FF;">(</span>client<span style="color: #66D9EF;">[</span>0<span style="color: #66D9EF;">]</span>, success<span style="color: #AE81FF;">)</span>
                writer.write<span style="color: #AE81FF;">(</span>message<span style="color: #AE81FF;">)</span>
                <span style="color: #F92672;">await</span> writer.drain<span style="color: #AE81FF;">()</span>
            <span style="color: #F92672;">else</span>:
                writer.close<span style="color: #AE81FF;">()</span>
                <span style="color: #F92672;">break</span>

    <span style="color: #75715E;"># </span><span style="color: #75715E;">hacky get loop...</span>
    <span style="color: #F92672;">def</span> <span style="color: #A6E22E;">get_loop_and_server</span><span style="color: #AE81FF;">(</span><span style="color: #F92672;">self</span><span style="color: #AE81FF;">)</span>:
        <span style="color: #F92672;">return</span> <span style="color: #AE81FF;">(</span><span style="color: #F92672;">self</span>.loop, <span style="color: #F92672;">self</span>.socketserver<span style="color: #AE81FF;">)</span>

    <span style="color: #F92672;">def</span> <span style="color: #A6E22E;">run</span><span style="color: #AE81FF;">(</span><span style="color: #F92672;">self</span><span style="color: #AE81FF;">)</span>:
        <span style="color: #75715E;"># </span><span style="color: #75715E;">using run we start the thread</span>

        <span style="color: #75715E;"># </span><span style="color: #75715E;">need a new event loop, in which asyncio works</span>
        <span style="color: #F92672;">self</span>.<span style="color: #FD971F;">loop</span> = asyncio.new_event_loop<span style="color: #AE81FF;">()</span>
        asyncio.set_event_loop<span style="color: #AE81FF;">(</span><span style="color: #F92672;">self</span>.loop<span style="color: #AE81FF;">)</span>
        <span style="color: #75715E;"># </span><span style="color: #75715E;">start server on specific port open on all interfaces</span>
        <span style="color: #F92672;">self</span>.<span style="color: #FD971F;">server_future</span> = asyncio.start_server<span style="color: #AE81FF;">(</span><span style="color: #F92672;">self</span>.process_client, host = <span style="color: #E6DB74;">&quot;0.0.0.0&quot;</span>, port = 42000<span style="color: #AE81FF;">)</span>
        <span style="color: #75715E;"># </span><span style="color: #75715E;">the returned future is handed to the event loop</span>
        <span style="color: #F92672;">self</span>.<span style="color: #FD971F;">socketserver</span> = <span style="color: #F92672;">self</span>.loop.run_until_complete<span style="color: #AE81FF;">(</span>
            asyncio.ensure_future<span style="color: #66D9EF;">(</span>
                <span style="color: #F92672;">self</span>.server_future,
                loop = <span style="color: #F92672;">self</span>.loop<span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
        
        <span style="color: #F92672;">print</span><span style="color: #AE81FF;">(</span><span style="color: #F92672;">self</span>.socketserver.sockets<span style="color: #AE81FF;">)</span>
        <span style="color: #75715E;"># </span><span style="color: #75715E;">run </span>
        <span style="color: #F92672;">self</span>.loop.run_forever<span style="color: #AE81FF;">()</span>
                
    <span style="color: #F92672;">def</span> <span style="color: #A6E22E;">stop_server</span><span style="color: #AE81FF;">(</span><span style="color: #F92672;">self</span><span style="color: #AE81FF;">)</span>:
        <span style="color: #75715E;"># </span><span style="color: #75715E;">in case stop_server is called, the stop flag is</span>
        <span style="color: #75715E;"># </span><span style="color: #75715E;">set, such that the while loop, which waits for</span>
        <span style="color: #75715E;"># </span><span style="color: #75715E;">data from the socket stops</span>
        <span style="color: #F92672;">self</span>.<span style="color: #FD971F;">_stop</span> = <span style="color: #AE81FF;">True</span>

        <span style="color: #F92672;">while</span> <span style="color: #F92672;">self</span>.loop.is_running<span style="color: #AE81FF;">()</span> == <span style="color: #AE81FF;">True</span>:
            <span style="color: #F92672;">print</span><span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;current sockets still connected {}&quot;</span>.<span style="color: #F92672;">format</span><span style="color: #66D9EF;">(</span><span style="color: #F92672;">self</span>.socketserver.sockets<span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
            <span style="color: #F92672;">print</span><span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;loop is still running: {}&quot;</span>.<span style="color: #F92672;">format</span><span style="color: #66D9EF;">(</span><span style="color: #F92672;">self</span>.loop.is_running<span style="color: #A6E22E;">()</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>

            <span style="color: #75715E;">#</span><span style="color: #75715E;">self.socketserver.wait_closed()</span>
            <span style="color: #F92672;">self</span>.loop.stop<span style="color: #AE81FF;">()</span>
            <span style="color: #F92672;">self</span>.server_future.close<span style="color: #AE81FF;">()</span>
            <span style="color: #F92672;">self</span>.socketserver.close<span style="color: #AE81FF;">()</span>
            <span style="color: #75715E;"># </span><span style="color: #75715E;">next line raises an exception, loop still running....</span>
            <span style="color: #75715E;"># </span><span style="color: #75715E;">TODO: fix problem that we cannot stop the running event loop :(</span>
            <span style="color: #F92672;">self</span>.loop.close<span style="color: #AE81FF;">(</span><span style="color: #F92672;">self</span>.loop.run_until_complete<span style="color: #66D9EF;">(</span><span style="color: #F92672;">self</span>.socketserver.wait_closed<span style="color: #A6E22E;">()</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
            time.sleep<span style="color: #AE81FF;">(</span>0.2<span style="color: #AE81FF;">)</span>
        
        <span style="color: #F92672;">self</span>.loop.close<span style="color: #AE81FF;">()</span>


    <span style="color: #F92672;">def</span> <span style="color: #A6E22E;">parse_message</span><span style="color: #AE81FF;">(</span><span style="color: #F92672;">self</span>, data, address<span style="color: #AE81FF;">)</span>:
        <span style="color: #75715E;"># </span><span style="color: #75715E;">this function parses the data. If there is a function</span>
        <span style="color: #75715E;"># </span><span style="color: #75715E;">call in the data, we call the appropriate function</span>
        <span style="color: #FD971F;">ip</span>, <span style="color: #FD971F;">port</span> = address
        <span style="color: #FD971F;">result</span> = <span style="color: #AE81FF;">False</span>
        <span style="color: #F92672;">if</span> <span style="color: #E6DB74;">&apos;insert&apos;</span> <span style="color: #F92672;">in</span> data:
            <span style="color: #FD971F;">result</span> = insert_source<span style="color: #AE81FF;">(</span><span style="color: #F92672;">self</span>.p, <span style="color: #F92672;">self</span>.d, <span style="color: #F92672;">self</span>.pwm<span style="color: #AE81FF;">)</span>
            <span style="color: #75715E;">#</span><span style="color: #75715E;">logging.info(&quot;source inserted via network socket {}:{}&quot;.format(ip, port))</span>
        <span style="color: #F92672;">elif</span> <span style="color: #E6DB74;">&apos;remove&apos;</span> <span style="color: #F92672;">in</span> data:
            <span style="color: #FD971F;">result</span> = remove_source<span style="color: #AE81FF;">(</span><span style="color: #F92672;">self</span>.p, <span style="color: #F92672;">self</span>.d, <span style="color: #F92672;">self</span>.pwm<span style="color: #AE81FF;">)</span>
            <span style="color: #75715E;">#</span><span style="color: #75715E;">logging.info(&quot;source removed via network socket {}:{}&quot;.format(ip, port))</span>
        <span style="color: #F92672;">elif</span> <span style="color: #E6DB74;">&apos;out?&apos;</span> <span style="color: #F92672;">in</span> data:
            <span style="color: #FD971F;">result</span> = read_out<span style="color: #AE81FF;">(</span><span style="color: #F92672;">self</span>.p, <span style="color: #F92672;">self</span>.d<span style="color: #AE81FF;">)</span>
            <span style="color: #75715E;">#</span><span style="color: #75715E;">logging.info(&quot;out? status requestet via network socket {}:{}&quot;.format(ip, port))</span>
        <span style="color: #F92672;">elif</span> <span style="color: #E6DB74;">&apos;good?&apos;</span> <span style="color: #F92672;">in</span> data:
            <span style="color: #75715E;"># </span><span style="color: #75715E;">read GOOD and print</span>
            <span style="color: #FD971F;">result</span> = read_good<span style="color: #AE81FF;">(</span><span style="color: #F92672;">self</span>.p, <span style="color: #F92672;">self</span>.d<span style="color: #AE81FF;">)</span>
            <span style="color: #75715E;">#</span><span style="color: #75715E;">logging.info(&quot;good? status requestet via network socket {}:{}&quot;.format(ip, port))</span>
        <span style="color: #F92672;">elif</span> <span style="color: #E6DB74;">&apos;s_open?&apos;</span> <span style="color: #F92672;">in</span> data:
            <span style="color: #75715E;"># </span><span style="color: #75715E;">read sensor 1 and print</span>
            <span style="color: #FD971F;">result</span> = read_sensor_open<span style="color: #AE81FF;">(</span><span style="color: #F92672;">self</span>.p, <span style="color: #F92672;">self</span>.d<span style="color: #AE81FF;">)</span>
            <span style="color: #75715E;">#</span><span style="color: #75715E;">logging.info(&quot;s_open? status requestet via network socket {}:{}&quot;.format(ip, port))</span>
        <span style="color: #F92672;">elif</span> <span style="color: #E6DB74;">&apos;s_close?&apos;</span> <span style="color: #F92672;">in</span> data:
            <span style="color: #75715E;"># </span><span style="color: #75715E;">read sensor 1 and print</span>
            <span style="color: #FD971F;">result</span> = read_sensor_close<span style="color: #AE81FF;">(</span><span style="color: #F92672;">self</span>.p, <span style="color: #F92672;">self</span>.d<span style="color: #AE81FF;">)</span>
            <span style="color: #75715E;">#</span><span style="color: #75715E;">logging.info(&quot;s_close? status requestet via network socket {}:{}&quot;.format(ip, port))</span>
        <span style="color: #F92672;">else</span>:
            <span style="color: #FD971F;">result</span> = <span style="color: #E6DB74;">&quot;Unknown command&quot;</span>

        <span style="color: #F92672;">return</span> result

    <span style="color: #F92672;">def</span> <span style="color: #A6E22E;">create_message</span><span style="color: #AE81FF;">(</span><span style="color: #F92672;">self</span>, client, data<span style="color: #AE81FF;">)</span>:
        <span style="color: #75715E;"># </span><span style="color: #75715E;">this function creates a JSON message containing the returned value</span>
        <span style="color: #75715E;"># </span><span style="color: #75715E;">of the RPi call and a clientname</span>
        <span style="color: #75715E;"># </span><span style="color: #75715E;">using dictionary, we create a json dump and return the encoded</span>
        <span style="color: #75715E;"># </span><span style="color: #75715E;">string</span>
        <span style="color: #FD971F;">message</span> = <span style="color: #AE81FF;">{</span><span style="color: #E6DB74;">&quot;username&quot;</span> : client, <span style="color: #E6DB74;">&quot;message&quot;</span> : data<span style="color: #AE81FF;">}</span>
        <span style="color: #75715E;"># </span><span style="color: #75715E;">add trailing \r\l to indicate end of data stream</span>
        <span style="color: #FD971F;">json_data</span> = json.dumps<span style="color: #AE81FF;">(</span>message<span style="color: #AE81FF;">)</span> + <span style="color: #E6DB74;">&apos;</span><span style="color: #AE81FF;">\n</span><span style="color: #E6DB74;">&apos;</span>
        <span style="color: #F92672;">return</span> json_data.encode<span style="color: #AE81FF;">()</span>


<span style="color: #75715E;"># </span><span style="color: #75715E;">set relay_sleep time (time to wait for activation of relay): 50ms</span>
<span style="color: #FD971F;">relay_sleep</span> = 50e-3
<span style="color: #75715E;"># </span><span style="color: #75715E;">set manipulator_sleep time: 1s</span>
<span style="color: #FD971F;">manip_sleep</span> = 1

<span style="color: #F92672;">def</span> <span style="color: #A6E22E;">print_help</span><span style="color: #AE81FF;">()</span>:

    <span style="color: #FD971F;">help_string</span> = <span style="color: #E6DB74;">&quot;&quot;&quot;</span>
<span style="color: #E6DB74;">    The following commands are available:</span><span style="color: #AE81FF;">\n</span>
<span style="color: #E6DB74;">        insert : insert source into bore</span>
<span style="color: #E6DB74;">        remove : remove source from bore</span>
<span style="color: #E6DB74;">        out?   : print current value of relay OUT</span>
<span style="color: #E6DB74;">        good?  : print current value of relay GOOD</span>
<span style="color: #E6DB74;">        d?     : parameters used for relay (pin layout etc.)</span>
<span style="color: #E6DB74;">        pwm?   : parameters used for PWM (frequency, duty cycle, ...)</span>
<span style="color: #E6DB74;">        help   : prints this help</span>
<span style="color: #E6DB74;">    &quot;&quot;&quot;</span>

    <span style="color: #F92672;">print</span><span style="color: #AE81FF;">(</span>help_string<span style="color: #AE81FF;">)</span>
    <span style="color: #F92672;">return</span>

    

<span style="color: #F92672;">def</span> <span style="color: #A6E22E;">read_good</span><span style="color: #AE81FF;">(</span>p, d<span style="color: #AE81FF;">)</span>:
    <span style="color: #75715E;"># </span><span style="color: #75715E;">simple function which returns the value of the</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">GPIO pin for the GOOD output of the relay</span>
    <span style="color: #FD971F;">good</span> = <span style="color: #F92672;">bool</span><span style="color: #AE81FF;">(</span>p.read<span style="color: #66D9EF;">(</span>d<span style="color: #A6E22E;">[</span><span style="color: #E6DB74;">&quot;GOOD&quot;</span><span style="color: #A6E22E;">]</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
    <span style="color: #F92672;">return</span> good

<span style="color: #F92672;">def</span> <span style="color: #A6E22E;">read_out</span><span style="color: #AE81FF;">(</span>p, d<span style="color: #AE81FF;">)</span>:
    <span style="color: #75715E;"># </span><span style="color: #75715E;">simple function which returns the value of the</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">GPIO pin for the OUT output of the relay</span>
    <span style="color: #FD971F;">out</span> = <span style="color: #F92672;">bool</span><span style="color: #AE81FF;">(</span>p.read<span style="color: #66D9EF;">(</span>d<span style="color: #A6E22E;">[</span><span style="color: #E6DB74;">&quot;OUT&quot;</span><span style="color: #A6E22E;">]</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
    <span style="color: #F92672;">return</span> out

<span style="color: #F92672;">def</span> <span style="color: #A6E22E;">read_sensor_open</span><span style="color: #AE81FF;">(</span>p, d<span style="color: #AE81FF;">)</span>:
    <span style="color: #75715E;"># </span><span style="color: #75715E;">simple function which returns bool corresponding to</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">GPIO pin of sensor for OPEN</span>
    <span style="color: #FD971F;">val</span> = <span style="color: #F92672;">bool</span><span style="color: #AE81FF;">(</span>p.read<span style="color: #66D9EF;">(</span>d<span style="color: #A6E22E;">[</span><span style="color: #E6DB74;">&quot;S_OPEN&quot;</span><span style="color: #A6E22E;">]</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
    <span style="color: #F92672;">return</span> val

<span style="color: #F92672;">def</span> <span style="color: #A6E22E;">read_sensor_close</span><span style="color: #AE81FF;">(</span>p, d<span style="color: #AE81FF;">)</span>:
    <span style="color: #75715E;"># </span><span style="color: #75715E;">simple function which returns bool corresponding to</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">GPIO pin of sensor for CLOSED</span>
    <span style="color: #FD971F;">val</span> = <span style="color: #F92672;">bool</span><span style="color: #AE81FF;">(</span>p.read<span style="color: #66D9EF;">(</span>d<span style="color: #A6E22E;">[</span><span style="color: #E6DB74;">&quot;S_CLOSE&quot;</span><span style="color: #A6E22E;">]</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
    <span style="color: #F92672;">return</span> val

<span style="color: #F92672;">def</span> <span style="color: #A6E22E;">configure_pins</span><span style="color: #AE81FF;">(</span>p, d<span style="color: #AE81FF;">)</span>:
    <span style="color: #75715E;"># </span><span style="color: #75715E;">function to export all pins and set to correct modes</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">relay control / reading</span>
    p.set_mode<span style="color: #AE81FF;">(</span>d<span style="color: #66D9EF;">[</span><span style="color: #E6DB74;">&quot;GOOD&quot;</span><span style="color: #66D9EF;">]</span>, pigpio.INPUT<span style="color: #AE81FF;">)</span>
    p.set_mode<span style="color: #AE81FF;">(</span>d<span style="color: #66D9EF;">[</span><span style="color: #E6DB74;">&quot;OUT&quot;</span><span style="color: #66D9EF;">]</span>, pigpio.INPUT<span style="color: #AE81FF;">)</span>
    p.set_mode<span style="color: #AE81FF;">(</span>d<span style="color: #66D9EF;">[</span><span style="color: #E6DB74;">&quot;RC_IN&quot;</span><span style="color: #66D9EF;">]</span>, pigpio.OUTPUT<span style="color: #AE81FF;">)</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">sensor reading</span>
    p.set_mode<span style="color: #AE81FF;">(</span>d<span style="color: #66D9EF;">[</span><span style="color: #E6DB74;">&quot;S_OPEN&quot;</span><span style="color: #66D9EF;">]</span>, pigpio.INPUT<span style="color: #AE81FF;">)</span>
    p.set_mode<span style="color: #AE81FF;">(</span>d<span style="color: #66D9EF;">[</span><span style="color: #E6DB74;">&quot;S_CLOSE&quot;</span><span style="color: #66D9EF;">]</span>, pigpio.INPUT<span style="color: #AE81FF;">)</span>
    <span style="color: #F92672;">return</span>

<span style="color: #F92672;">def</span> <span style="color: #A6E22E;">pwm_control</span><span style="color: #AE81FF;">(</span>p, d, freq, duty_cycle<span style="color: #AE81FF;">)</span>:
    <span style="color: #75715E;"># </span><span style="color: #75715E;">function to control the pwm of the RC IN pin</span>
    p.hardware_PWM<span style="color: #AE81FF;">(</span>d<span style="color: #66D9EF;">[</span><span style="color: #E6DB74;">&quot;RC_IN&quot;</span><span style="color: #66D9EF;">]</span>, freq, duty_cycle<span style="color: #AE81FF;">)</span>
    <span style="color: #F92672;">return</span>

<span style="color: #F92672;">def</span> <span style="color: #A6E22E;">insert_source</span><span style="color: #AE81FF;">(</span>p, d, pwm<span style="color: #AE81FF;">)</span>:
    <span style="color: #75715E;"># </span><span style="color: #75715E;">inserts the source into the bore by activating the relay</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">wrapper for source_control</span>
    <span style="color: #FD971F;">success</span> = source_control<span style="color: #AE81FF;">(</span>p, d, pwm, <span style="color: #E6DB74;">&quot;on&quot;</span><span style="color: #AE81FF;">)</span>
    <span style="color: #F92672;">return</span> success

<span style="color: #F92672;">def</span> <span style="color: #A6E22E;">remove_source</span><span style="color: #AE81FF;">(</span>p, d, pwm<span style="color: #AE81FF;">)</span>:
    <span style="color: #75715E;"># </span><span style="color: #75715E;">removes source from bore by disabling the relay</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">wrapping source control</span>
    <span style="color: #FD971F;">success</span> = source_control<span style="color: #AE81FF;">(</span>p, d, pwm, <span style="color: #E6DB74;">&quot;off&quot;</span><span style="color: #AE81FF;">)</span>
    <span style="color: #F92672;">return</span> success

<span style="color: #F92672;">def</span> <span style="color: #A6E22E;">source_control</span><span style="color: #AE81FF;">(</span>p, d, pwm, direction<span style="color: #AE81FF;">)</span>:
    <span style="color: #75715E;"># </span><span style="color: #75715E;">this function provides a generalized interface to control the source</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">inputs:</span>
    <span style="color: #75715E;">#     </span><span style="color: #75715E;">p: the Pi object</span>
    <span style="color: #75715E;">#     </span><span style="color: #75715E;">d: the dict. containing the parameters</span>
    <span style="color: #75715E;">#     </span><span style="color: #75715E;">pwm: the dict. containing pwm parameters</span>
    <span style="color: #75715E;">#     </span><span style="color: #75715E;">direction: a string describing the direction to move the source</span>
    <span style="color: #75715E;">#         </span><span style="color: #75715E;">&quot;on&quot;  : insert source</span>
    <span style="color: #75715E;">#         </span><span style="color: #75715E;">&quot;off&quot; : remove source</span>

    
    pwm_control<span style="color: #AE81FF;">(</span>p, d, pwm<span style="color: #66D9EF;">[</span><span style="color: #E6DB74;">&quot;f&quot;</span><span style="color: #66D9EF;">]</span>, pwm<span style="color: #66D9EF;">[</span>direction<span style="color: #66D9EF;">]</span><span style="color: #AE81FF;">)</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">relay was triggered: means relay should now read</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">insert:</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">GOOD == True &amp;</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">OUT  == True</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">remove:</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">GOOD == True &amp;</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">OUT  == False</span>
    time.sleep<span style="color: #AE81FF;">(</span>relay_sleep<span style="color: #AE81FF;">)</span>
    <span style="color: #FD971F;">good</span> = read_good<span style="color: #AE81FF;">(</span>p, d<span style="color: #AE81FF;">)</span>
    <span style="color: #FD971F;">out</span>  = read_out<span style="color: #AE81FF;">(</span>p, d<span style="color: #AE81FF;">)</span>
    <span style="color: #FD971F;">success</span> = <span style="color: #AE81FF;">False</span>

    <span style="color: #75715E;"># </span><span style="color: #75715E;">set expected values based on insertion / removal</span>
    <span style="color: #F92672;">if</span> direction == <span style="color: #E6DB74;">&quot;on&quot;</span>:
        <span style="color: #FD971F;">good_exp</span> = <span style="color: #AE81FF;">True</span>
        <span style="color: #FD971F;">out_exp</span>  = <span style="color: #AE81FF;">True</span>
    <span style="color: #F92672;">elif</span> direction == <span style="color: #E6DB74;">&quot;off&quot;</span>:
        <span style="color: #FD971F;">good_exp</span> = <span style="color: #AE81FF;">True</span>
        <span style="color: #FD971F;">out_exp</span>  = <span style="color: #AE81FF;">False</span>
    <span style="color: #F92672;">else</span>:
        <span style="color: #F92672;">raise</span> <span style="color: #66D9EF;">NotImplementedError</span><span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;only &apos;on&apos; and &apos;off&apos; implemented to control source.&quot;</span><span style="color: #AE81FF;">)</span>

    <span style="color: #FD971F;">s1</span> = <span style="color: #AE81FF;">None</span>
    <span style="color: #FD971F;">s2</span> = <span style="color: #AE81FF;">None</span>
    <span style="color: #F92672;">if</span> good == good_exp <span style="color: #F92672;">and</span> out == out_exp:
        <span style="color: #75715E;"># </span><span style="color: #75715E;">if good is True and out False, everything fine</span>
        <span style="color: #75715E;">#</span><span style="color: #75715E;">logging.debug(&quot;pwm set to {}, relay reports: (good : {}), (out : {})&quot;.format(direction, good ,out))</span>
        <span style="color: #75715E;"># </span><span style="color: #75715E;">after setting of relay, wait again and check sensors</span>
        <span style="color: #F92672;">print</span><span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&apos;pwm switched, waiting for manipulator to be moved&apos;</span><span style="color: #AE81FF;">)</span>
        time.sleep<span style="color: #AE81FF;">(</span>manip_sleep<span style="color: #AE81FF;">)</span>
        <span style="color: #75715E;"># </span><span style="color: #75715E;">check sensors</span>
        <span style="color: #FD971F;">s1</span> = read_sensor_open<span style="color: #AE81FF;">(</span>p, d<span style="color: #AE81FF;">)</span>
        <span style="color: #FD971F;">s2</span> = read_sensor_close<span style="color: #AE81FF;">(</span>p, d<span style="color: #AE81FF;">)</span>

        <span style="color: #75715E;">#</span><span style="color: #75715E;">logging.debug(&apos;sensors report: s1 = {}, s2 = {}&apos;.format(s1, s2))</span>
        <span style="color: #75715E;"># </span><span style="color: #75715E;">TODO: implement logic, which deals with sensors of manipulators</span>

        <span style="color: #F92672;">if</span> direction <span style="color: #F92672;">is</span> <span style="color: #E6DB74;">&quot;on&quot;</span>:
            <span style="color: #75715E;"># </span><span style="color: #75715E;">after insertion the sensors should read:</span>
            <span style="color: #75715E;"># </span><span style="color: #75715E;">s1 (sensor open) == True</span>
            <span style="color: #75715E;"># </span><span style="color: #75715E;">s2 (sensor close) == False</span>
            <span style="color: #F92672;">if</span> s1 == <span style="color: #AE81FF;">True</span> <span style="color: #F92672;">and</span> s2 == <span style="color: #AE81FF;">False</span>:
                <span style="color: #FD971F;">success</span> = <span style="color: #AE81FF;">True</span>
            <span style="color: #F92672;">else</span>:
                <span style="color: #FD971F;">success</span> = <span style="color: #AE81FF;">False</span>
        <span style="color: #F92672;">else</span>:
            <span style="color: #F92672;">if</span> s1 == <span style="color: #AE81FF;">False</span> <span style="color: #F92672;">and</span> s2 == <span style="color: #AE81FF;">True</span>:
                <span style="color: #75715E;"># </span><span style="color: #75715E;">after removal the sensors should read:</span>
                <span style="color: #75715E;"># </span><span style="color: #75715E;">s1 (sensor open) == False</span>
                <span style="color: #75715E;"># </span><span style="color: #75715E;">s2 (sensor close) == True</span>
                <span style="color: #FD971F;">success</span> = <span style="color: #AE81FF;">True</span>
            <span style="color: #F92672;">else</span>:
                <span style="color: #FD971F;">success</span> = <span style="color: #AE81FF;">False</span>
        
        <span style="color: #F92672;">if</span> success == <span style="color: #AE81FF;">False</span>:
            <span style="color: #75715E;">#</span><span style="color: #75715E;">logging.warning(&quot;&quot;&quot;WARNING: direction was {}, but sensors read (open): {} (close): {}. </span>
            <span style="color: #75715E;">#</span><span style="color: #75715E;">Relay switched correctly.&quot;&quot;&quot;.format(direction, s1, s2))</span>
            <span style="color: #F92672;">pass</span>

    <span style="color: #F92672;">elif</span> good == good_exp <span style="color: #F92672;">and</span> out != out_exp:
        <span style="color: #75715E;"># </span><span style="color: #75715E;">something is wrong, seems like relay did not change, both still repot True</span>
        <span style="color: #75715E;">#</span><span style="color: #75715E;">logging.warning(&quot;pwm set to {}, relay good, but OUT still reports True: {}, {}&quot;.format(direction, good, out))</span>
        <span style="color: #F92672;">pass</span>
    <span style="color: #F92672;">elif</span> good == <span style="color: #AE81FF;">False</span>:
        <span style="color: #75715E;">#</span><span style="color: #75715E;">logging.warning(&quot;relay reports bad signal: {}&quot;.format(good))</span>
        <span style="color: #F92672;">pass</span>
    <span style="color: #F92672;">else</span>:
        <span style="color: #75715E;">#</span><span style="color: #75715E;">logging.warning(&quot;should not happen. Contact developer.&quot;)</span>
        <span style="color: #F92672;">pass</span>

    <span style="color: #F92672;">if</span> direction == <span style="color: #E6DB74;">&quot;on&quot;</span>:
        <span style="color: #F92672;">print</span><span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;Insertion returned {}&quot;</span>.<span style="color: #F92672;">format</span><span style="color: #66D9EF;">(</span>success<span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
        <span style="color: #F92672;">if</span> success == <span style="color: #AE81FF;">False</span>:
            <span style="color: #F92672;">print</span><span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;WARNING: insertion may have failed, but sensors read (open): {} (close): {}&quot;</span>.<span style="color: #F92672;">format</span><span style="color: #66D9EF;">(</span>direction, s1, s2<span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
            <span style="color: #F92672;">print</span><span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;However, relay was activated correctly.&quot;</span><span style="color: #AE81FF;">)</span>    
    <span style="color: #F92672;">elif</span> direction == <span style="color: #E6DB74;">&quot;off&quot;</span>:
        <span style="color: #F92672;">print</span><span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;Removal returned {}&quot;</span>.<span style="color: #F92672;">format</span><span style="color: #66D9EF;">(</span>success<span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
        <span style="color: #F92672;">if</span> success == <span style="color: #AE81FF;">False</span>:
            <span style="color: #F92672;">print</span><span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;WARNING: removal may have failed, but sensors read (open): {} (close): {}&quot;</span>.<span style="color: #F92672;">format</span><span style="color: #66D9EF;">(</span>direction, s1, s2<span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
            <span style="color: #F92672;">print</span><span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;However, relay was activated correctly.&quot;</span><span style="color: #AE81FF;">)</span>    


    <span style="color: #75715E;"># </span><span style="color: #75715E;">the following lines are here to make sure there is a new prompt</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">even in case a network call was made before</span>
    sys.stdout.write<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&apos;&gt; &apos;</span><span style="color: #AE81FF;">)</span>
    sys.stdout.flush<span style="color: #AE81FF;">()</span>

    <span style="color: #F92672;">return</span> success
    
<span style="color: #F92672;">def</span> <span style="color: #A6E22E;">control_loop</span><span style="color: #AE81FF;">(</span>p, d, pwm<span style="color: #AE81FF;">)</span>:
    <span style="color: #75715E;"># </span><span style="color: #75715E;">this function defines the main control loop of the manipulator</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">control</span>
    <span style="color: #F92672;">print</span><span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&apos;Starting command prompt&apos;</span><span style="color: #AE81FF;">)</span>
    <span style="color: #F92672;">print</span><span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&apos;</span><span style="color: #AE81FF;">\t</span><span style="color: #E6DB74;"> insert : inserts source into bore&apos;</span><span style="color: #AE81FF;">)</span>
    <span style="color: #F92672;">print</span><span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&apos;</span><span style="color: #AE81FF;">\t</span><span style="color: #E6DB74;"> remove : removes source out of bore&apos;</span><span style="color: #AE81FF;">)</span>
    <span style="color: #F92672;">print</span><span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&apos;</span><span style="color: #AE81FF;">\t</span><span style="color: #E6DB74;"> quit   : stop the program&apos;</span><span style="color: #AE81FF;">)</span>

    <span style="color: #75715E;"># </span><span style="color: #75715E;">TODO: still need to implement the checks for</span>
    <span style="color: #75715E;">#       </span><span style="color: #75715E;">- sensor positions</span>
    <span style="color: #75715E;">#         </span><span style="color: #75715E;">output warning to console and log file in case sensors</span>
    <span style="color: #75715E;">#         </span><span style="color: #75715E;">don&apos;t report what was commanded</span>
    <span style="color: #75715E;">#       </span><span style="color: #75715E;">- output warning in case signal not good</span>
    
    <span style="color: #F92672;">while</span> <span style="color: #AE81FF;">True</span>:
        <span style="color: #75715E;"># </span><span style="color: #75715E;">the sys calls are used to make sure the line is empty before we</span>
        <span style="color: #75715E;"># </span><span style="color: #75715E;">write to it via input. Don&apos;t want two &gt; &gt; to appear (depening</span>
        <span style="color: #75715E;"># </span><span style="color: #75715E;">on network calls this might happen)</span>
        sys.stdout.write<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&apos;</span><span style="color: #AE81FF;">\r</span><span style="color: #E6DB74;">&apos;</span><span style="color: #AE81FF;">)</span>
        sys.stdout.flush<span style="color: #AE81FF;">()</span>
        <span style="color: #FD971F;">line</span> = <span style="color: #F92672;">input</span><span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&apos;&gt; &apos;</span><span style="color: #AE81FF;">)</span>
        <span style="color: #F92672;">if</span> <span style="color: #E6DB74;">&apos;insert&apos;</span> <span style="color: #F92672;">in</span> line:
            insert_source<span style="color: #AE81FF;">(</span>p, d, pwm<span style="color: #AE81FF;">)</span>
            <span style="color: #75715E;">#</span><span style="color: #75715E;">logging.info(&quot;source inserted&quot;)</span>
        <span style="color: #F92672;">elif</span> <span style="color: #E6DB74;">&apos;remove&apos;</span> <span style="color: #F92672;">in</span> line:
            remove_source<span style="color: #AE81FF;">(</span>p, d, pwm<span style="color: #AE81FF;">)</span>
            <span style="color: #75715E;">#</span><span style="color: #75715E;">logging.info(&quot;source removed&quot;)</span>
        <span style="color: #F92672;">elif</span> <span style="color: #E6DB74;">&apos;out?&apos;</span> <span style="color: #F92672;">in</span> line:
            <span style="color: #75715E;"># </span><span style="color: #75715E;">read OUT and print</span>
            <span style="color: #F92672;">print</span><span style="color: #AE81FF;">(</span>read_out<span style="color: #66D9EF;">(</span>p, d<span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
        <span style="color: #F92672;">elif</span> <span style="color: #E6DB74;">&apos;good?&apos;</span> <span style="color: #F92672;">in</span> line:
            <span style="color: #75715E;"># </span><span style="color: #75715E;">read GOOD and print</span>
            <span style="color: #F92672;">print</span><span style="color: #AE81FF;">(</span>read_good<span style="color: #66D9EF;">(</span>p, d<span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
        <span style="color: #F92672;">elif</span> <span style="color: #E6DB74;">&apos;s_open?&apos;</span> <span style="color: #F92672;">in</span> line:
            <span style="color: #75715E;"># </span><span style="color: #75715E;">read sensor 1 and print</span>
            <span style="color: #F92672;">print</span><span style="color: #AE81FF;">(</span>read_sensor_open<span style="color: #66D9EF;">(</span>p, d<span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
        <span style="color: #F92672;">elif</span> <span style="color: #E6DB74;">&apos;s_close?&apos;</span> <span style="color: #F92672;">in</span> line:
            <span style="color: #75715E;"># </span><span style="color: #75715E;">read sensor 1 and print</span>
            <span style="color: #F92672;">print</span><span style="color: #AE81FF;">(</span>read_sensor_close<span style="color: #66D9EF;">(</span>p, d<span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
        <span style="color: #F92672;">elif</span> <span style="color: #E6DB74;">&apos;d?&apos;</span> <span style="color: #F92672;">in</span> line:
            <span style="color: #75715E;"># </span><span style="color: #75715E;">print dictionary</span>
            <span style="color: #F92672;">print</span><span style="color: #AE81FF;">(</span>d<span style="color: #AE81FF;">)</span>
        <span style="color: #F92672;">elif</span> <span style="color: #E6DB74;">&apos;pwm?&apos;</span> <span style="color: #F92672;">in</span> line:
            <span style="color: #75715E;"># </span><span style="color: #75715E;">print dictionary</span>
            <span style="color: #F92672;">print</span><span style="color: #AE81FF;">(</span>pwm<span style="color: #AE81FF;">)</span>
        <span style="color: #F92672;">elif</span> line <span style="color: #F92672;">in</span> <span style="color: #AE81FF;">[</span><span style="color: #E6DB74;">&apos;help&apos;</span>, <span style="color: #E6DB74;">&apos;h&apos;</span>, <span style="color: #E6DB74;">&apos;help?&apos;</span><span style="color: #AE81FF;">]</span>:
            print_help<span style="color: #AE81FF;">()</span>
        <span style="color: #F92672;">elif</span> line <span style="color: #F92672;">in</span> <span style="color: #AE81FF;">[</span><span style="color: #E6DB74;">&apos;quit&apos;</span>, <span style="color: #E6DB74;">&apos;q&apos;</span>, <span style="color: #E6DB74;">&apos;stop&apos;</span><span style="color: #AE81FF;">]</span>:
            <span style="color: #F92672;">break</span>
        <span style="color: #F92672;">elif</span> line <span style="color: #F92672;">is</span> <span style="color: #F92672;">not</span> <span style="color: #E6DB74;">&quot;&quot;</span>:
            <span style="color: #F92672;">print</span><span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&apos;not a valid command.&apos;</span><span style="color: #AE81FF;">)</span>
        <span style="color: #F92672;">else</span>:
            <span style="color: #F92672;">continue</span>

        <span style="color: #75715E;"># </span><span style="color: #75715E;">perform some logging of input, exit</span>
        <span style="color: #75715E;">#</span><span style="color: #75715E;">logging.debug(&quot;command: {}&quot;.format(line))</span>


    <span style="color: #75715E;"># </span><span style="color: #75715E;">after loop perform final logging?</span>
    <span style="color: #75715E;">#</span><span style="color: #75715E;">logging.info(&apos;stopping program.&apos;)</span>

    <span style="color: #F92672;">return</span>

<span style="color: #F92672;">def</span> <span style="color: #A6E22E;">create_message</span><span style="color: #AE81FF;">(</span>client, data<span style="color: #AE81FF;">)</span>:
    <span style="color: #75715E;"># </span><span style="color: #75715E;">this function creates a JSON message containing the returned value</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">of the RPi call and a clientname</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">using dictionary, we create a json dump and return the encoded</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">string</span>
    <span style="color: #FD971F;">message</span> = <span style="color: #AE81FF;">{</span><span style="color: #E6DB74;">&quot;username&quot;</span> : client, <span style="color: #E6DB74;">&quot;message&quot;</span> : data<span style="color: #AE81FF;">}</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">add trailing \r\l to indicate end of data stream</span>
    <span style="color: #FD971F;">json_data</span> = json.dumps<span style="color: #AE81FF;">(</span>message<span style="color: #AE81FF;">)</span> + <span style="color: #E6DB74;">&apos;</span><span style="color: #AE81FF;">\n</span><span style="color: #E6DB74;">&apos;</span>
    <span style="color: #F92672;">return</span> json_data.encode<span style="color: #AE81FF;">()</span>

<span style="color: #F92672;">def</span> <span style="color: #A6E22E;">main</span><span style="color: #AE81FF;">(</span>args<span style="color: #AE81FF;">)</span>:

    <span style="color: #75715E;"># </span><span style="color: #75715E;">setup arg parser</span>
    <span style="color: #FD971F;">parser</span> = argparse.ArgumentParser<span style="color: #AE81FF;">(</span>description = <span style="color: #E6DB74;">&apos;parse log level&apos;</span><span style="color: #AE81FF;">)</span>
    parser.add_argument<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&apos;--log&apos;</span>, default=<span style="color: #E6DB74;">&quot;DEBUG&quot;</span>, <span style="color: #F92672;">type</span>=<span style="color: #F92672;">str</span><span style="color: #AE81FF;">)</span>

    <span style="color: #FD971F;">parsed_args</span> = parser.parse_args<span style="color: #AE81FF;">()</span>
    <span style="color: #FD971F;">loglevel</span> = parsed_args.log

    <span style="color: #75715E;"># </span><span style="color: #75715E;">setup logger</span>
    <span style="color: #FD971F;">numeric_level</span> = <span style="color: #F92672;">getattr</span><span style="color: #AE81FF;">(</span>logging, loglevel.upper<span style="color: #66D9EF;">()</span>, <span style="color: #AE81FF;">None</span><span style="color: #AE81FF;">)</span>
    <span style="color: #F92672;">if</span> <span style="color: #F92672;">not</span> <span style="color: #F92672;">isinstance</span><span style="color: #AE81FF;">(</span>numeric_level, <span style="color: #F92672;">int</span><span style="color: #AE81FF;">)</span>:
        <span style="color: #F92672;">raise</span> <span style="color: #66D9EF;">ValueError</span><span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&apos;Invalid log level: {}&apos;</span>.<span style="color: #F92672;">format</span><span style="color: #66D9EF;">(</span>loglevel<span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>


    <span style="color: #75715E;"># </span><span style="color: #75715E;">add an additional handler for the asyncio logger so that it also</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">writes the errors and exceptions to console</span>
    <span style="color: #FD971F;">console</span> = logging.StreamHandler<span style="color: #AE81FF;">()</span>
    logging.getLogger<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;asyncio&quot;</span><span style="color: #AE81FF;">)</span>.addHandler<span style="color: #AE81FF;">(</span>console<span style="color: #AE81FF;">)</span>

    <span style="color: #FD971F;">LOG_FILENAME</span> = <span style="color: #E6DB74;">&apos;log/manipulator.log&apos;</span>
    logging.basicConfig<span style="color: #AE81FF;">(</span>filename = LOG_FILENAME,
                        <span style="color: #75715E;">#</span><span style="color: #75715E;">stream = sys.stdout, </span>
                        <span style="color: #F92672;">format</span> = <span style="color: #E6DB74;">&apos;%(levelname)s %(asctime)s: %(message)s&apos;</span>,
                        datefmt=<span style="color: #E6DB74;">&apos;%d/%m/%Y %H:%M:%S&apos;</span>,
                        level = numeric_level<span style="color: #AE81FF;">)</span>


    <span style="color: #75715E;"># </span><span style="color: #75715E;">now configure all pins</span>
    configure_pins<span style="color: #AE81FF;">(</span>p, d<span style="color: #AE81FF;">)</span>

    <span style="color: #75715E;"># </span><span style="color: #75715E;">define PWM settings</span>
    <span style="color: #FD971F;">pwm</span> = <span style="color: #AE81FF;">{</span><span style="color: #E6DB74;">&quot;f&quot;</span>   : 200,
           <span style="color: #E6DB74;">&quot;off&quot;</span> : 200000,
           <span style="color: #E6DB74;">&quot;on&quot;</span>  : 400000<span style="color: #AE81FF;">}</span>

    <span style="color: #75715E;"># </span><span style="color: #75715E;">set pwm for RC IN pin</span>
    pwm_control<span style="color: #AE81FF;">(</span>p, d, pwm<span style="color: #66D9EF;">[</span><span style="color: #E6DB74;">&quot;f&quot;</span><span style="color: #66D9EF;">]</span>, pwm<span style="color: #66D9EF;">[</span><span style="color: #E6DB74;">&quot;off&quot;</span><span style="color: #66D9EF;">]</span><span style="color: #AE81FF;">)</span>

    <span style="color: #75715E;"># </span><span style="color: #75715E;">configure readline</span>
    readline.parse_and_bind<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&apos;tab: complete&apos;</span><span style="color: #AE81FF;">)</span>
    readline.set_auto_history<span style="color: #AE81FF;">(</span><span style="color: #AE81FF;">True</span><span style="color: #AE81FF;">)</span>

    <span style="color: #75715E;"># </span><span style="color: #75715E;">create the socket for the server</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">instantiate the server object</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">thr = server(serversocket, p, d, pwm)</span>
    <span style="color: #FD971F;">thr</span> = server<span style="color: #AE81FF;">(</span><span style="color: #AE81FF;">None</span>, p, d, pwm<span style="color: #AE81FF;">)</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">and start</span>
    thr.start<span style="color: #AE81FF;">()</span>

    <span style="color: #75715E;"># </span><span style="color: #75715E;">now that everything is configured, start the control loop</span>
    control_loop<span style="color: #AE81FF;">(</span>p, d, pwm<span style="color: #AE81FF;">)</span>

    <span style="color: #75715E;">#</span><span style="color: #75715E;">try:</span>
    <span style="color: #75715E;">#</span><span style="color: #75715E;">thr.stop_server()</span>
    <span style="color: #75715E;">#</span><span style="color: #75715E;">except:</span>
        

    <span style="color: #75715E;"># </span><span style="color: #75715E;">after control loop has finished, shut down the server thread</span>
    <span style="color: #FD971F;">loop</span>, <span style="color: #FD971F;">socketserver</span> = thr.get_loop_and_server<span style="color: #AE81FF;">()</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">the following is an ugly hack to close the program without getting any</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">exceptions, thrown because the event loop in the server class is</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">not being shut down. Trying, but doesn&apos;t work, so this will have</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">to do for now</span>
    <span style="color: #F92672;">try</span>:
        thr.stop_server<span style="color: #AE81FF;">()</span>
    <span style="color: #F92672;">except</span>:
        socketserver.close<span style="color: #AE81FF;">()</span>
    
    <span style="color: #75715E;">#</span><span style="color: #75715E;">loop.close()</span>
    
    
<span style="color: #F92672;">if</span> <span style="color: #F92672;">__name__</span>==<span style="color: #E6DB74;">&quot;__main__&quot;</span>:
    <span style="color: #F92672;">import</span> sys
    main<span style="color: #AE81FF;">(</span>sys.argv<span style="color: #66D9EF;">[</span>1:<span style="color: #66D9EF;">]</span><span style="color: #AE81FF;">)</span>
</pre>
</div>

<p>
The following are my notes taken during development of the hardware &amp;
software that describe the specific hardware in use.
</p>
</div>

<ol class="org-ol">
<li><a id="org5fc4801"> </a><span class="done DONE">DONE</span> Manipulator <code>[3/3]</code><br />
<ol class="org-ol">
<li><a id="orgbf10c3a"> </a><span class="done DONE">DONE</span> test for leaks<br /></li>
<li><a id="orgc6a7fe9"> </a><span class="done DONE">DONE</span> test using compressed air, reading sensors<br />
<div class="outline-text-7" id="text-10-3-1-1-1-2">
<p>
Regarding sensors, setup and hardware: 
Hardware:
</p>
<ul class="org-ul">
<li>sensors: Festo 150 857
accept between 12 and 30 V DC
max. output amperage: 500 mA
switch on time: 0.5 ms
switch off time: 0.03 ms</li>
<li>cable  : Festo NEBU-M8G3-K5-LE3 (541 334)</li>
<li>cable (power): Festo NEBV-Z4WA2L-R-E-5-N-LE2-S1</li>
</ul>
<p>
Thus, supply sensors with 24 V DC as well. Build setup such that 
valve and sensors receive same 24 V. 
Sensor outputs need to go on RPi GPIO pins. These max value of 
3.3 V (!). 
Using voltage divider something like the following seems
reasonable
</p>
<div class="LaTeX" id="org7ed71a1">
<p>
\(\frac{U_{\text{Pi, in}}}{U_{\text{sensor, out}}} = \frac{R_2}{R_1 + R_2}\)
</p>

</div>
<p>
with 
</p>
<div class="LaTeX" id="orgf1ba315">
<p>
\(U_{\text{Pi, in}} &lt; 3.3\,\text{V}\)
\(U_{\text{sensor, out}} = 24\,\text{V}\)
</p>

</div>
<p>
Thus, we&apos;d get:
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #FD971F;">R2</span> = 1e3
<span style="color: #FD971F;">R1</span> = 8.2e3
<span style="color: #FD971F;">U_sensor_out</span> = 24
<span style="color: #FD971F;">U_pi_in</span> = U_sensor_out * R2 / <span style="color: #AE81FF;">(</span>R1 + R2<span style="color: #AE81FF;">)</span>
<span style="color: #F92672;">return</span> U_pi_in
</pre>
</div>

<p>
Build simple board using these resistors (first check output
 current of sensor does not exceed 0.5 mA! max of RPi) to feed
the sensor values into the RPi. Should be simple?
</p>

<p>
Tested basic setup today (<span class="timestamp-wrapper">  <span class="timestamp">&lt;2017-08-29 Tue 18:47&gt;</span></span>). 
</p>
<ul class="org-ul">
<li>24V power supply prepared</li>
<li>RPi connected to relay</li>
<li>tpc20 used to run PyS<sub>manipController.py</sub></li>
<li>relay connected as:
<ul class="org-ul">
<li>power supply 24V+: relay COM</li>
<li>power supply GND: valve GND</li>
<li>valve +: relay NO</li>
</ul></li>
</ul>
<p>
is all there is to do. :)
</p>
</div>
</li>

<li><a id="orge172ec7"> </a><span class="done DONE">DONE</span> finalize software<br />
<div class="outline-text-7" id="text-10-3-1-1-1-3">
<p>
The software to readout and control the manipulator needs to be
finished. The <a href="./../CastData/ManipulatorController/PyS_manipController.py">./../CastData/ManipulatorController/PyS_manipController.py</a> currently
creates a server, which listens for connections from a client
connecting to it. Commands are not final yet (use only &quot;insert&quot;
and &quot;remove&quot; so far). 
Still need to:
</p>
<ol class="org-ol">
<li>DONE separate server and client into two actually separate threads</li>
<li>DONE try using nim client of chat app as the client. allows me to
use nim, yay.</li>
</ol>

<p>
Note <span class="timestamp-wrapper">  <span class="timestamp">&lt;2017-09-07 Thu&gt;</span></span>: took me the last two days to figure out, why the server
application was buggy. See mails to Lucian and Fabian for an
explanation titled &apos;Python asyncio&apos;. 
Having a logger enabled, causes asyncio to redirect all error
output from the asyncio code parts to land in the log file.
</p>

<p>
CLOSED: <span class="timestamp-wrapper">  <span class="timestamp">&lt;2017-09-09 Sat 01:51&gt;</span></span>
Python server is finished, allows multiple incoming connections at the
same time, thanks to asyncio (what a PITA…).
Final version is <a href="./../CastData/ManipulatorController/PyS_manipController.py">./../CastData/ManipulatorController/PyS_manipController.py</a>.
Nim client works well as a client to control the server. See
<a href="./../CastData/ManipulatorController/nim/client.nim">./../CastData/ManipulatorController/nim/client.nim</a> for the code currently in use.
</p>
</div>
</li>
</ol>
</li>
</ol>
</div>
</div>

<div class="outline-4" id="outline-container-org18bc1a9">
<h4 id="org18bc1a9"><span class="section-number-4">10.3.2.</span> Lead shielding layout   <span class="tag">  <span class="extended">extended</span></span></h4>
<div class="outline-text-4" id="text-10-3-2">
<p>
The full lead shielding layout can be found here (created by Christoph Krieger):
</p>


<figure id="org573160a">
<img src="./figs/home/basti/phd/resources/lead_shielding_assembly_ingrid_2017.svg" class="org-svg" alt="lead_shielding_assembly_ingrid_2017.svg" />

</figure>
</div>
</div>
</div>

<div class="outline-3" id="outline-container-sec:cast:window_accident">
<h3 id="sec:cast:window_accident"><span class="section-number-3">10.4.</span> Window accident</h3>
<div class="outline-text-3" id="text-sec:cast:window_accident">
<p>
During the preparations of the detector for data taking, it became
clear that the rubber seals of the quick connectors used for the water
cooling system started to disintegrate. The connectors were replaced
by Swagelok connectors, but the water cooling system still contained
rubber pieces blocking the flow. Due to the small diameter and twisted
layout of the cooling ducts in the copper body, the only way at hand
to clean them was a compressed air line, normally used for operation
of the \cefe manipulator (see sec. <a href="./cast.html#sec:cast:55fe_manipulator">10.3.1</a>). This
cleaning process worked very well. Multiple cleaning &amp; water pumping
cycles were needed, as after cleaning the system with compressed air,
pumping water the next time moved some remaining pieces, which blocked
it again. After multiple cycles at which no more clogging happened
upon water pumping a final cycle was intended. As the gas supply and
the water cooling system after replacement of the quick connectors now
used not only the same tubing, but also the same connectors, the
compressed air line was mistakenly connected to the gas supply instead
of water cooling line by me. The windows – tested up to
\(\SI{1.5}{bar}\) pressure – could not withstand the sudden pressure of
the compressed air line of about \(\SI{6}{bar}\). A sudden and
catastrophic window failure broke the vacuum and shot window pieces as
well as possible contamination into the vacuum pipes towards the X-ray
optics.
</p>

<p>
Because the LLNL telescope is an experimental optics there was worry
about potential oil contamination coming from dirty air of the
compressed air line. A conservative estimate of this given an upper
bound on contamination of the air, volume of the vacuum pipes and the
telescope area was computed. Assuming a flow of compressed air of
\(\SI{5}{s}\), a ISO 8573-1:2010 class 4 compressed air contamination of
\(\text{ppmv}_{\text{oil}} = \SI{10}{\milli\gram\per\meter\cubed}\) and
all oil in the air sticking to the telescope shells would lead to a
contamination of \(c_{\text{oil}} =
\SI{41.7}{\nano\gram\per\cm\squared}\). More realistic is about
\(\SI{1}{\percent}\) of that due to the telescope only being less than
\(\frac{1}{10}\) of the full system area and the primary membrane pump
likely removing the majority (\(&gt;\SI{90}{\percent}\)) of the oil in the
first place. This puts an upper limit of \(c_{\text{oil}} =
\SI{0.417}{\nano\gram\per\cm\squared}\), which is well below anything
considered problematic for further data taking.
</p>

<p>
Further, the \cefe source manipulator likely caught most of the
debris, as it was fully inserted due to the necessary removal of the
compressed air line from it, which is normally needed to keep the
manipulator extruded when the system is under vacuum. For this reason
it is unlikely any window debris could have caused significant
scratches in the telescope layers.
</p>

<p>
After the incident the detector was dismounted and taken to the CAST
detector lab. Fig. <a href="#fig:cast:window_accident:broken_window">6(a)</a> shows the
detector from above with the small remaining pieces of the
window. Fig. <a href="#fig:cast:window_accident:broken_window_inside">6(b)</a> shows the
detector inside after opening it. A bulge is visible where the gas
inlet is and the compressed air entered. As the detector was
electronically dead after the incident, the decision was made to move
it back to Bonn for repairs. It turned out that the Septemboard had
become loose from the connector.
</p>


<figure class="figure-wrapper" id="fig:cast:window_accident:broken_window_subfig">
<figure class="subfigure" id="fig:cast:window_accident:broken_window" data-width="49%">  <img src="./figs/home/basti/phd/Figs/CAST_detector_exploded/broken_window_close_IMG_20170919_152130.jpg" data-width="94%" />  <figcaption>Figure 6(a): Broken window from the inside</figcaption></figure> <figure class="subfigure" id="fig:cast:window_accident:broken_window_inside" data-width="49%">  <img src="./figs/home/basti/phd/Figs/CAST_detector_exploded/detector_broken_window_open_top_IMG_20170919_152130.jpg" data-width="94%" />  <figcaption>Figure 6(b): View into the detector after accident</figcaption></figure>
<figcaption>Figure 6: <a href="#fig:cast:window_accident:broken_window">6(a)</a> shows the cathode of the detector from the inside
           with the broken window. Essentially the full window directly exposed to vacuum is gone. <a href="#fig:cast:window_accident:broken_window_inside">6(b)</a> is the view into the detector without the cathode.
           A bulge of the field cage is visible where the compressed air entered.</figcaption>
</figure>
</div>



<div class="outline-4" id="outline-container-orgb1fa3db">
<h4 id="orgb1fa3db"><span class="section-number-4">10.4.1.</span> Calculations of contamination <code>[0/1]</code>   <span class="tag">  <span class="extended">extended</span></span></h4>
<div class="outline-text-4" id="text-10-4-1">
<ul class="org-ul">
<li class="off"><code>[ ]</code> <b>REWRITE TO USE UNCHAINED!!</b></li>
</ul>

<p>
Check the appendix <a href="./vacuum_contamination.html#sec:appendix:vacuum_contamination">24</a> for the document
written that contains my thoughts about the calculations below.
</p>

<p>
Here are the calculations done to estimate the contamination. First a
file containing the tubing sizes of the vacuum system:
</p>
<div class="org-src-container">
<pre class="src src-nim"><span style="color: #F92672;">import</span> tables

<span style="color: #F92672;">type</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">defines the TubesMap datatype, which is a combined object to</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">store the different parts of the tubing each sequences of tuples</span>
  <span style="color: #66D9EF;">TubesMap</span>* = <span style="color: #F92672;">object</span>
    <span style="color: #A6E22E; font-weight: bold; font-style: italic;">static_tubes*</span> : <span style="color: #66D9EF;">seq</span><span style="color: #AE81FF;">[</span><span style="color: #F92672;">tuple</span><span style="color: #66D9EF;">[</span>diameter: <span style="color: #66D9EF;">float</span>, length: <span style="color: #66D9EF;">float</span><span style="color: #66D9EF;">]</span><span style="color: #AE81FF;">]</span>
    <span style="color: #A6E22E; font-weight: bold; font-style: italic;">flexible_tubes*</span> : <span style="color: #66D9EF;">seq</span><span style="color: #AE81FF;">[</span><span style="color: #F92672;">tuple</span><span style="color: #66D9EF;">[</span>diameter: <span style="color: #66D9EF;">float</span>, length: <span style="color: #66D9EF;">float</span><span style="color: #66D9EF;">]</span><span style="color: #AE81FF;">]</span>
    <span style="color: #A6E22E; font-weight: bold; font-style: italic;">t_pieces*</span> : <span style="color: #66D9EF;">seq</span><span style="color: #AE81FF;">[</span><span style="color: #F92672;">tuple</span><span style="color: #66D9EF;">[</span>diameter: <span style="color: #66D9EF;">float</span>, length_long: <span style="color: #66D9EF;">float</span>, length_short: <span style="color: #66D9EF;">float</span><span style="color: #66D9EF;">]</span><span style="color: #AE81FF;">]</span>
    <span style="color: #A6E22E; font-weight: bold; font-style: italic;">crosses*</span> : <span style="color: #66D9EF;">seq</span><span style="color: #AE81FF;">[</span><span style="color: #F92672;">tuple</span><span style="color: #66D9EF;">[</span>diameter: <span style="color: #66D9EF;">float</span>, length: <span style="color: #66D9EF;">float</span><span style="color: #66D9EF;">]</span><span style="color: #AE81FF;">]</span>

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E; font-weight: bold; font-style: italic;">getVacuumTubing*</span><span style="color: #AE81FF;">()</span>: <span style="color: #66D9EF;">TubesMap</span> =
  <span style="color: #75715E;"># </span><span style="color: #75715E;">this function returns the data (originally written in calc_vacuum_volume.org</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">as a set of hash maps as a &quot;TubesMap&quot; datatype</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">st_tubing </span>= @<span style="color: #AE81FF;">[</span><span style="color: #66D9EF;">(</span><span style="font-style: italic;">63</span>.<span style="font-style: italic;">0</span>, <span style="font-style: italic;">10</span>.<span style="font-style: italic;">0</span><span style="color: #66D9EF;">)</span>,
                    <span style="color: #66D9EF;">(</span><span style="font-style: italic;">63</span>.<span style="font-style: italic;">0</span>, <span style="font-style: italic;">51</span>.<span style="font-style: italic;">0</span><span style="color: #66D9EF;">)</span>,
                    <span style="color: #66D9EF;">(</span><span style="font-style: italic;">63</span>.<span style="font-style: italic;">0</span>, <span style="font-style: italic;">21</span>.<span style="font-style: italic;">5</span><span style="color: #66D9EF;">)</span>,
                    <span style="color: #66D9EF;">(</span><span style="font-style: italic;">25</span>.<span style="font-style: italic;">0</span>, <span style="font-style: italic;">33</span>.<span style="font-style: italic;">7</span><span style="color: #66D9EF;">)</span>,
                    <span style="color: #66D9EF;">(</span><span style="font-style: italic;">63</span>.<span style="font-style: italic;">0</span>, <span style="font-style: italic;">20</span>.<span style="font-style: italic;">0</span><span style="color: #66D9EF;">)</span>,
                    <span style="color: #66D9EF;">(</span><span style="font-style: italic;">63</span>.<span style="font-style: italic;">0</span>, <span style="font-style: italic;">50</span>.<span style="font-style: italic;">0</span><span style="color: #66D9EF;">)</span>,
                    <span style="color: #66D9EF;">(</span><span style="font-style: italic;">40</span>.<span style="font-style: italic;">0</span>, <span style="font-style: italic;">15</span>.<span style="font-style: italic;">5</span><span style="color: #66D9EF;">)</span>,
                    <span style="color: #66D9EF;">(</span><span style="font-style: italic;">16</span>.<span style="font-style: italic;">0</span>, <span style="font-style: italic;">13</span>.<span style="font-style: italic;">0</span><span style="color: #66D9EF;">)</span>,
                    <span style="color: #66D9EF;">(</span><span style="font-style: italic;">40</span>.<span style="font-style: italic;">0</span>, <span style="font-style: italic;">10</span>.<span style="font-style: italic;">0</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">]</span>

  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">fl_tubing </span>= @<span style="color: #AE81FF;">[</span><span style="color: #66D9EF;">(</span><span style="font-style: italic;">16</span>.<span style="font-style: italic;">0</span>,  <span style="font-style: italic;">25</span>.<span style="font-style: italic;">0</span><span style="color: #66D9EF;">)</span>,
                    <span style="color: #66D9EF;">(</span><span style="font-style: italic;">16</span>.<span style="font-style: italic;">0</span>,  <span style="font-style: italic;">25</span>.<span style="font-style: italic;">0</span> <span style="color: #66D9EF;">)</span>,
                    <span style="color: #66D9EF;">(</span><span style="font-style: italic;">16</span>.<span style="font-style: italic;">0</span>,  <span style="font-style: italic;">25</span>.<span style="font-style: italic;">0</span> <span style="color: #66D9EF;">)</span>,
                    <span style="color: #66D9EF;">(</span><span style="font-style: italic;">16</span>.<span style="font-style: italic;">0</span>,  <span style="font-style: italic;">25</span>.<span style="font-style: italic;">0</span> <span style="color: #66D9EF;">)</span>,
                    <span style="color: #66D9EF;">(</span><span style="font-style: italic;">16</span>.<span style="font-style: italic;">0</span>,  <span style="font-style: italic;">40</span>.<span style="font-style: italic;">0</span> <span style="color: #66D9EF;">)</span>,
                    <span style="color: #66D9EF;">(</span><span style="font-style: italic;">25</span>.<span style="font-style: italic;">0</span>,  <span style="font-style: italic;">90</span>.<span style="font-style: italic;">0</span> <span style="color: #66D9EF;">)</span>,
                    <span style="color: #66D9EF;">(</span><span style="font-style: italic;">25</span>.<span style="font-style: italic;">0</span>,  <span style="font-style: italic;">80</span>.<span style="font-style: italic;">0</span> <span style="color: #66D9EF;">)</span>,
                    <span style="color: #66D9EF;">(</span><span style="font-style: italic;">40</span>.<span style="font-style: italic;">0</span>,  <span style="font-style: italic;">50</span>.<span style="font-style: italic;">0</span> <span style="color: #66D9EF;">)</span>,
                    <span style="color: #66D9EF;">(</span><span style="font-style: italic;">16</span>.<span style="font-style: italic;">0</span>, <span style="font-style: italic;">150</span>.<span style="font-style: italic;">0</span> <span style="color: #66D9EF;">)</span>,
                    <span style="color: #66D9EF;">(</span><span style="font-style: italic;">40</span>.<span style="font-style: italic;">0</span>,  <span style="font-style: italic;">80</span>.<span style="font-style: italic;">0</span> <span style="color: #66D9EF;">)</span>,
                    <span style="color: #66D9EF;">(</span><span style="font-style: italic;">40</span>.<span style="font-style: italic;">0</span>,  <span style="font-style: italic;">80</span>.<span style="font-style: italic;">0</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">]</span>

  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">t_pieces </span>= @<span style="color: #AE81FF;">[</span><span style="color: #66D9EF;">(</span><span style="font-style: italic;">40</span>.<span style="font-style: italic;">0</span>, <span style="font-style: italic;">18</span>.<span style="font-style: italic;">0</span>, <span style="font-style: italic;">21</span>.<span style="font-style: italic;">0</span><span style="color: #66D9EF;">)</span>,
                   <span style="color: #66D9EF;">(</span><span style="font-style: italic;">16</span>.<span style="font-style: italic;">0</span>, <span style="font-style: italic;">7</span>.<span style="font-style: italic;">0</span>, <span style="font-style: italic;">4</span>.<span style="font-style: italic;">5</span><span style="color: #66D9EF;">)</span>,
                   <span style="color: #66D9EF;">(</span><span style="font-style: italic;">40</span>.<span style="font-style: italic;">0</span>, <span style="font-style: italic;">10</span>.<span style="font-style: italic;">0</span>, <span style="font-style: italic;">10</span>.<span style="font-style: italic;">0</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">]</span>

  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">crosses </span>= @<span style="color: #AE81FF;">[</span><span style="color: #66D9EF;">(</span><span style="font-style: italic;">16</span>.<span style="font-style: italic;">0</span>, <span style="font-style: italic;">10</span>.<span style="font-style: italic;">0</span><span style="color: #66D9EF;">)</span>,
                  <span style="color: #66D9EF;">(</span><span style="font-style: italic;">40</span>.<span style="font-style: italic;">0</span>, <span style="font-style: italic;">14</span>.<span style="font-style: italic;">0</span><span style="color: #66D9EF;">)</span>,
                  <span style="color: #66D9EF;">(</span><span style="font-style: italic;">40</span>.<span style="font-style: italic;">0</span>, <span style="font-style: italic;">14</span>.<span style="font-style: italic;">0</span><span style="color: #66D9EF;">)</span>,
                  <span style="color: #66D9EF;">(</span><span style="font-style: italic;">40</span>.<span style="font-style: italic;">0</span>, <span style="font-style: italic;">14</span>.<span style="font-style: italic;">0</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">]</span>
                    
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">t </span>= <span style="color: #66D9EF;">TubesMap</span><span style="color: #AE81FF;">(</span>static_tubes: st_tubing, flexible_tubes: fl_tubing, t_pieces: t_pieces, crosses: crosses<span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">echo</span> <span style="color: #E6DB74;">&quot;Vacuum tubing is as follows:&quot;</span>
  <span style="color: #F92672;">echo</span> t
  <span style="color: #F92672;">return</span> t
</pre>
</div>

<p>
And the actual code using the tubing to calculate possible
contamination:
</p>

<div class="org-src-container">
<pre class="src src-nim"><span style="color: #F92672;">import</span> math
<span style="color: #F92672;">import</span> tubing
<span style="color: #F92672;">import</span> sequtils, future
<span style="color: #F92672;">import</span> typeinfo

<span style="color: #75715E;"># </span><span style="color: #75715E;">This script contains a calculation for the total volume of the</span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">currently in use vacuum system at CAST (behind and including LLNL</span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">telescope)</span>

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">cylinder_volume</span><span style="color: #AE81FF;">(</span>diameter, length: <span style="color: #66D9EF;">float</span><span style="color: #AE81FF;">)</span>: <span style="color: #66D9EF;">float</span> =
  <span style="color: #75715E;"># </span><span style="color: #75715E;">this proc calculates the volume of a cylinder, given a</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">diameter and a length both in cm</span>
  <span style="color: #FD971F;">result</span> = <span style="color: #66D9EF;">PI</span> * pow<span style="color: #AE81FF;">(</span>diameter / <span style="font-style: italic;">2</span>.<span style="font-style: italic;">0</span>, <span style="font-style: italic;">2</span><span style="color: #AE81FF;">)</span> * length
  
<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">t_piece_volume</span><span style="color: #AE81FF;">(</span>diameter, length_long, length_short: <span style="color: #66D9EF;">float</span><span style="color: #AE81FF;">)</span>: <span style="color: #66D9EF;">float</span> =
  <span style="color: #75715E;"># </span><span style="color: #75715E;">this proc calculates the volume of a T shaped vacuum piece, using</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">the cylinder volume proc</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">inputs:</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">diameter: diameter of the tubing in cm</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">length_long: length of the long axis of the tubing</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">length_short: length of the short axis of the tubing</span>
  <span style="color: #FD971F;">result</span> = cylinder_volume<span style="color: #AE81FF;">(</span>diameter, length_long<span style="color: #AE81FF;">)</span> + cylinder_volume<span style="color: #AE81FF;">(</span>diameter, length_short - diameter<span style="color: #AE81FF;">)</span>

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">cross_piece_volume</span><span style="color: #AE81FF;">(</span>diameter, length: <span style="color: #66D9EF;">float</span><span style="color: #AE81FF;">)</span>: <span style="color: #66D9EF;">float</span> =
  <span style="color: #75715E;"># </span><span style="color: #75715E;">this proc calculates the volume of a cross shaped vacuum piece, using</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">the cylinder volume proc</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">inputs:</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">diameter: diameter of the tubing in cm</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">length: length of one axis of the tubing</span>
  <span style="color: #FD971F;">result</span> = <span style="font-style: italic;">2</span> * cylinder_volume<span style="color: #AE81FF;">(</span>diameter, length<span style="color: #AE81FF;">)</span> - pow<span style="color: #AE81FF;">(</span>diameter, <span style="font-style: italic;">3</span><span style="color: #AE81FF;">)</span>

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">calcTotalVacuumVolume</span><span style="color: #AE81FF;">(</span>t: <span style="color: #66D9EF;">TubesMap</span><span style="color: #AE81FF;">)</span>: <span style="color: #66D9EF;">float</span> =
  <span style="color: #75715E;"># </span><span style="color: #75715E;">function which calculates the total vacuum volume, using</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">the rough measurements of the length and diameters of all the</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">piping</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">the TubesMap consists of:</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">static_tubes : seq[tuple[diameter: float, length: float]]</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">flexible_tubes : seq[tuple[diameter: float, length: float]]</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">t_pieces : seq[tuple[diameter: float, length_long: float, length_short: float]]</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">crosses : seq[tuple[diameter: float, length: float]]</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">define variables to store static volume etc</span>

  <span style="color: #75715E;"># </span><span style="color: #75715E;">calc volume of static tubing</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">static_vol </span>= sum<span style="color: #AE81FF;">(</span>map<span style="color: #66D9EF;">(</span>
    t.static_tubes, <span style="color: #A6E22E;">(</span>b: <span style="color: #F92672;">tuple</span><span style="color: #E6DB74;">[</span>diameter, length: <span style="color: #66D9EF;">float</span><span style="color: #E6DB74;">]</span><span style="color: #A6E22E;">)</span> -&gt;
    <span style="color: #66D9EF;">float</span> =&gt;
    cylinder_volume<span style="color: #A6E22E;">(</span>b.diameter / <span style="font-style: italic;">10</span>, b.length<span style="color: #A6E22E;">)</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">flexible_vol </span>= sum<span style="color: #AE81FF;">(</span>map<span style="color: #66D9EF;">(</span>
    t.flexible_tubes, <span style="color: #A6E22E;">(</span>b: <span style="color: #F92672;">tuple</span><span style="color: #E6DB74;">[</span>diameter, length: <span style="color: #66D9EF;">float</span><span style="color: #E6DB74;">]</span><span style="color: #A6E22E;">)</span> -&gt; 
    <span style="color: #66D9EF;">float</span> =&gt;
    cylinder_volume<span style="color: #A6E22E;">(</span>b.diameter / <span style="font-style: italic;">10</span>, b.length<span style="color: #A6E22E;">)</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">t_vol </span>= sum<span style="color: #AE81FF;">(</span>map<span style="color: #66D9EF;">(</span>
    t.t_pieces, <span style="color: #A6E22E;">(</span>b: <span style="color: #F92672;">tuple</span><span style="color: #E6DB74;">[</span>diameter, length_long, length_short: <span style="color: #66D9EF;">float</span><span style="color: #E6DB74;">]</span><span style="color: #A6E22E;">)</span> -&gt;
    <span style="color: #66D9EF;">float</span> =&gt;
    t_piece_volume<span style="color: #A6E22E;">(</span>b.diameter / <span style="font-style: italic;">10</span>, b.length_long, b.length_short<span style="color: #A6E22E;">)</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">crosses_vol </span>= sum<span style="color: #AE81FF;">(</span>map<span style="color: #66D9EF;">(</span>
    t.crosses, <span style="color: #A6E22E;">(</span>b: <span style="color: #F92672;">tuple</span><span style="color: #E6DB74;">[</span>diameter, length: <span style="color: #66D9EF;">float</span><span style="color: #E6DB74;">]</span><span style="color: #A6E22E;">)</span> -&gt;
    <span style="color: #66D9EF;">float</span> =&gt;
    cross_piece_volume<span style="color: #A6E22E;">(</span>b.diameter / <span style="font-style: italic;">10</span>, b.length<span style="color: #A6E22E;">)</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>

  <span style="color: #FD971F;">result</span> = static_vol + flexible_vol + t_vol + crosses_vol

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">calcFlowRate</span><span style="color: #AE81FF;">(</span>d, p, mu, x: <span style="color: #66D9EF;">float</span><span style="color: #AE81FF;">)</span>: <span style="color: #66D9EF;">float</span> =
  <span style="color: #75715E;"># </span><span style="color: #75715E;">this function calculates the flow rate following the Poiseuille Equation</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">for a non-ideal gas under laminar flow.</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">inputs:</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">d: diameter of the tube in m</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">p: pressure difference between both ends of the tube in Pa</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">mu: dynamic viscosity of the medium</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">x: length of the tube</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">note: get viscosity e.g. from https://www.lmnoeng.com/Flow/GasViscosity.php</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">returns the flow rate in m^3 / s</span>
  <span style="color: #FD971F;">result</span> = <span style="color: #66D9EF;">PI</span> * pow<span style="color: #AE81FF;">(</span>d, <span style="font-style: italic;">4</span><span style="color: #AE81FF;">)</span> * p / <span style="color: #AE81FF;">(</span><span style="font-style: italic;">128</span> * mu * x<span style="color: #AE81FF;">)</span>

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">calcGasAmount</span><span style="color: #AE81FF;">(</span>p, <span style="color: #66D9EF;">V</span>, <span style="color: #66D9EF;">T</span>: <span style="color: #66D9EF;">float</span><span style="color: #AE81FF;">)</span>: <span style="color: #66D9EF;">float</span> =
  <span style="color: #75715E;"># </span><span style="color: #75715E;">this function calculates the amount of gas in moles follinwg</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">the ideal gas equation p V = n R T for a given pressure, volume</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">and temperature</span>
  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">R</span> = <span style="font-style: italic;">8</span>.<span style="font-style: italic;">31446</span>
  <span style="color: #FD971F;">result</span> = p * <span style="color: #66D9EF;">V</span> / <span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">R</span> * <span style="color: #66D9EF;">T</span><span style="color: #AE81FF;">)</span>

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">calcVolumeFromMol</span><span style="color: #AE81FF;">(</span>p, n, <span style="color: #66D9EF;">T</span>: <span style="color: #66D9EF;">float</span><span style="color: #AE81FF;">)</span>: <span style="color: #66D9EF;">float</span> =
  <span style="color: #75715E;"># </span><span style="color: #75715E;">this function calculates the volume in m^3 follinwg</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">the ideal gas equation p V = n R T for a given pressure, amount in mol</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">and temperature</span>
  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">R</span> = <span style="font-style: italic;">8</span>.<span style="font-style: italic;">31446</span>
  <span style="color: #FD971F;">result</span> = n * <span style="color: #66D9EF;">R</span> * <span style="color: #66D9EF;">T</span> / p
    
<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">main</span><span style="color: #AE81FF;">()</span> =

  <span style="color: #75715E;"># </span><span style="color: #75715E;">TODO: checke whether diameter of 63mm for telescope is a reasonable</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">number!</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">t </span>= getVacuumTubing<span style="color: #AE81FF;">()</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">first of all we need to calculate the total volume of the vacuum</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">volume </span>= calcTotalVacuumVolume<span style="color: #AE81FF;">(</span>t<span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">echo</span> volume

  <span style="color: #75715E;"># </span><span style="color: #75715E;">now calcualte flow rate through pipe</span>
  <span style="color: #F92672;">let</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">3 mm diameter</span>
    d = 3e-<span style="font-style: italic;">3</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">6 bar pressure diff</span>
    p = <span style="font-style: italic;">6</span>.0e5
    <span style="color: #75715E;"># </span><span style="color: #75715E;">viscosity of air</span>
    mu = <span style="font-style: italic;">1</span>.8369247e-<span style="font-style: italic;">4</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">~2m of tubing</span>
    x = <span style="font-style: italic;">2</span>.<span style="font-style: italic;">0</span>
    flow = calcFlowRate<span style="color: #AE81FF;">(</span>d, p, mu, x<span style="color: #AE81FF;">)</span>

  <span style="color: #F92672;">echo</span><span style="color: #AE81FF;">(</span>flow * 1e3, <span style="color: #E6DB74;">&quot; l / s&quot;</span><span style="color: #AE81FF;">)</span>

  <span style="color: #75715E;"># </span><span style="color: #75715E;">given the flow in liter, calc total gas inserted into the system</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">flow_l </span>= flow * 1e3

  <span style="color: #75715E;"># </span><span style="color: #75715E;">detector volume in m^3</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">det_vol </span>= cylinder_volume<span style="color: #AE81FF;">(</span><span style="font-style: italic;">12</span>.<span style="font-style: italic;">0</span>, <span style="font-style: italic;">3</span>.<span style="font-style: italic;">0</span><span style="color: #AE81FF;">)</span> * 1e-<span style="font-style: italic;">6</span>
  <span style="color: #F92672;">echo</span><span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;Detector volume is : &quot;</span>, det_vol<span style="color: #AE81FF;">)</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">initial gas volume inside detector (1 bar is argon!), thus</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">only .5 bar</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">n_initial </span>= calcGasAmount<span style="color: #AE81FF;">(</span><span style="font-style: italic;">0</span>.5e5, det_vol, <span style="font-style: italic;">293</span>.<span style="font-style: italic;">15</span><span style="color: #AE81FF;">)</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">gas which came in after window ruptured</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">valve_open </span>= <span style="font-style: italic;">5</span>.<span style="font-style: italic;">0</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">total volume in m^3</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">flow_vol </span>= flow_l * 1e-<span style="font-style: italic;">3</span> * valve_open
  
  <span style="color: #75715E;"># </span><span style="color: #75715E;">since the flown volume is given for normal pressure and temp, calc</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">amount of gas</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">n_flow </span>= calcGasAmount<span style="color: #AE81FF;">(</span><span style="font-style: italic;">1</span>.0e5, flow_vol, <span style="font-style: italic;">293</span>.<span style="font-style: italic;">15</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">echo</span><span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;Initial gas is : &quot;</span>, n_initial, <span style="color: #E6DB74;">&quot; mol&quot;</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">echo</span><span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;Gas from flow is : &quot;</span>, n_flow, <span style="color: #E6DB74;">&quot; mol&quot;</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">n_total </span>= n_initial + n_flow
  <span style="color: #F92672;">echo</span><span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;Total compressed air, which entered system : &quot;</span>, n_total<span style="color: #AE81FF;">)</span>

  <span style="color: #75715E;"># </span><span style="color: #75715E;">calc volume corresponding to normal pressure</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">tot_vol_atm </span>= calcVolumeFromMol<span style="color: #AE81FF;">(</span>1e5, n_total, <span style="font-style: italic;">293</span>.<span style="font-style: italic;">15</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">echo</span><span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;Total volume of air at normal pressure : &quot;</span>, tot_vol_atm * 1e3, <span style="color: #E6DB74;">&quot; l&quot;</span><span style="color: #AE81FF;">)</span>
  
<span style="color: #F92672;">when</span> <span style="color: #AE81FF;">isMainModule</span>:
  main<span style="color: #AE81FF;">()</span>
</pre>
</div>
</div>
</div>
</div>

<div class="outline-3" id="outline-container-sec:cast:data_taking_woes">
<h3 id="sec:cast:data_taking_woes"><span class="section-number-3">10.5.</span> Data taking woes</h3>
<div class="outline-text-3" id="text-sec:cast:data_taking_woes">
<p>
In this section we will cover the smaller issues encountered during
the data taking. These are worth naming, due to having an impact on
the quality of the data as well as affecting certain aspects of data
analysis. In case someone wishes to analyze the data, they should be
aware of them. We will cover each of the effectively three data taking
periods one after another.
</p>
</div>

<div class="outline-4" id="outline-container-sec:cast:data_taking_woes_2017">
<h4 id="sec:cast:data_taking_woes_2017"><span class="section-number-4">10.5.1.</span> 2017 Oct - Dec</h4>
<div class="outline-text-4" id="text-sec:cast:data_taking_woes_2017">
<p>
The first data taking period from <span class="timestamp-wrapper">  <span class="timestamp">&lt;2017-10-30 Mon&gt; </span></span> to <span class="timestamp-wrapper">  <span class="timestamp">&lt;2017-12-22 Fri&gt;</span></span>
initially had a bug in the data acquisition software, which failed to
reset the veto scintillator values from one event to the next, if the
next one did not have an FADC trigger. In that case in principle the
veto scintillators should not have any values other than <code>0</code>. However,
as there is a flag in the data readout for whether the FADC triggered
at all, this is nowadays handled neatly in the software by only
checking the triggers if there was an FADC trigger in the first
place. Unfortunately, it was later found that the scintillator
triggers were nonsensical in this data taking period due to a firmware
bug anyway.
</p>

<p>
Starting from the solar tracking run on <span class="timestamp-wrapper">  <span class="timestamp">&lt;2017-11-29 Wed&gt; </span></span> the analogue
FADC signals showed significant signs of noise activity. This lead to
an effectively extremely high dead time of the detector, because the
FADC triggered pretty much immediately after the Timepix shutter was
opened. As I was on shift during this tracking, I changed the FADC
settings to a value, which got rid of the noise enough to continue
normal data taking. The following changes were made:
</p>

<ul class="org-ul">
<li>differentiation time reduced from \(\SI{50}{ns}\) to \(\SI{20}{ns}\)</li>
<li>coarse gain of the main amplifier increased from <code>6x</code> to <code>10x</code></li>
</ul>

<p>
Evidently this has a direct effect on the shape of the FADC signals,
to be discussed in sec. <a href="./calibration.html#sec:calibration:fadc_noise">11.4.1</a>.
</p>

<p>
On <span class="timestamp-wrapper">  <span class="timestamp">&lt;2017-12-05 Tue&gt; </span></span> while trying to investigate the noise problem
which resurfaced the day before despite the different settings, a fuse
blew in the gas interlock box. This caused a loss of a solar tracking
the next day. The still present FADC noise lead me to change the
amplification settings more drastically on <span class="timestamp-wrapper">  <span class="timestamp">&lt;2017-12-07 Thu 08:00&gt;</span></span>
during the shift:
</p>

<ul class="org-ul">
<li>integration time from \(\SI{50}{ns}\) to \(\SI{100}{ns}\)</li>
</ul>

<p>
The same day in the evening the magnet quenched causing the shift to
be missed the next day. In the evening of <span class="timestamp-wrapper">  <span class="timestamp">&lt;2017-12-08 Fri&gt; </span></span> the
integration time was turned down to \(\SI{50}{ns}\) again, as the noise
issue was gone again.
</p>

<p>
A week later the integration time was finally changed again to
\(\SI{100}{ns}\). By this time it was clear that there would be no easy
fix to the problem and that it is strongly correlated to the magnet
activity during a shift. For that reason the setting was kept for the
remaining data taking periods.
</p>
</div>
</div>

<div class="outline-4" id="outline-container-sec:cast:data_taking_woes_2018">
<h4 id="sec:cast:data_taking_woes_2018"><span class="section-number-4">10.5.2.</span> 2018 Feb - Apr</h4>
<div class="outline-text-4" id="text-sec:cast:data_taking_woes_2018">
<p>
Two days before the data taking period was supposed to start again in
2018, there were issues with the detector behavior with respect to the
thresholds and the gain of the GridPixes. During one calibration run
with the \cefe source the effective gain dropped further and
further such that instead of \(\sim\num{220}\) electrons less than
\(\sim\num{100}\) were recorded. This turned out to be a grounding issue
of the detector relative to the water cooling system.
</p>

<p>
Further, the temperature readout of the detector did not work
anymore. It is unclear what happened exactly, but the female micro
USB connector on the detector had a bad soldering joint as was found
out after the data taking campaign. It is possible that replugging
cables to fix the above mentioned issue caused an already weak
connector to fully break.
</p>

<p>
The second data taking period finally started on <span class="timestamp-wrapper">  <span class="timestamp">&lt;2018-02-17 Sat&gt; </span></span> and
ran until <span class="timestamp-wrapper">  <span class="timestamp">&lt;2018-04-17 Tue&gt;</span></span>.
</p>

<p>
This data taking campaign still ran without functioning scintillators,
due to lack of time and alternative hardware in Bonn to debug the
underlying issue and develop a solution.
</p>
</div>
</div>

<div class="outline-4" id="outline-container-sec:cast:data_taking_woes_2018_2">
<h4 id="sec:cast:data_taking_woes_2018_2"><span class="section-number-4">10.5.3.</span> 2018 Oct - Dec</h4>
<div class="outline-text-4" id="text-sec:cast:data_taking_woes_2018_2">
<p>
Between the spring and final data taking campaign the temperature
readout as well as the firmware were fixed to get the scintillator
triggers working correctly, with the installation being done end of
July 2018. By the time of the start of the actual solar tracking data
taking campaign at the end of October however, a powering issue had
appeared. This time the Phoenix connector on the intermediate board
had a bad soldering joint, which was finally fixed
<span class="timestamp-wrapper">  <span class="timestamp">&lt;2018-10-19 Fri&gt;</span></span>. Data taking started the day after.
</p>

<p>
Two runs in mid December showed strong noise on the FADC again. This
time no amount of changing amplifier settings had any effect, which is
why 2 runs were done without the FADC. See runs 298 and 299 in the
appendix, tab. <a href="./cast_run_list.html#sec:appendix:cast_run_list">21</a>. For the last runs it was
activated again and no more noise issues appeared.
</p>
</div>
</div>

<div class="outline-4" id="outline-container-org31bdad4">
<h4 id="org31bdad4"><span class="section-number-4">10.5.4.</span> Concluding thoughts about issues</h4>
<div class="outline-text-4" id="text-10-5-4">
<p>
The FADC noise issue was in many ways the most disrupting active issue
the detector was plagued by. In hindsight, the standard LEMO cable used
should have been a properly shielded cable. Someone with more
knowledge about RF interference should have assisted in the
installation. In a later section, <a href="./calibration.html#sec:calibration:fadc_noise">11.4.1</a>, the
typical signals recorded by the FADC under noise will be shown as well
as mitigation strategies on the software side. Also how the signals and
the FADC activation threshold changed due to the changed settings will
be presented.
</p>
</div>
</div>
</div>

<div class="outline-3" id="outline-container-sec:cast:data_taking_campaigns">
<h3 id="sec:cast:data_taking_campaigns"><span class="section-number-3">10.6.</span> Summary of CAST data taking</h3>
<div class="outline-text-3" id="text-sec:cast:data_taking_campaigns">
<p>
In summary then, the data taken at CAST with the Septemboard detector
can be split into two periods. The first from October 2017 to April
2018 and the second from October 2018 to December 2018. The former
will from here on be called &quot;Run-2&quot; and the latter &quot;Run-3&quot;. Run-1
refers to the data taking campaign with the single GridPix detector in
2014 and 2015. The distinction of run periods is mainly based on the
fact that the detector was dismounted between Run-2 and Run-3 and
additionally a full detector recalibration was performed, meaning the
datasets require slightly different parameters for calibration related aspects.
</p>

<p>
During Run-2 the scintillator vetoes were not working correctly. The
FADC was partially noisy. In Run-3 all detector features were working
as intended. The feature list is summarized in
tab. <a href="#tab:cast:features_by_run">12</a>.
</p>

<table id="tab:cast:features_by_run">
<caption class="t-above"><span class="table-number">Table 12:</span> Overview of working (\green{o}), mostly working (\orange{m}), not working (\red{x}) features in each run. FADC was partially noisy in Run-2.</caption>

<colgroup>
<col class="org-left" />

<col class="org-left" />

<col class="org-left" />
</colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Feature</th>
<th class="org-left" scope="col">Run 2</th>
<th class="org-left" scope="col">Run 3</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Septemboard</td>
<td class="org-left">\green{o}</td>
<td class="org-left">\green{o}</td>
</tr>

<tr>
<td class="org-left">FADC</td>
<td class="org-left">\orange{m}</td>
<td class="org-left">\green{o}</td>
</tr>

<tr>
<td class="org-left">Veto scinti</td>
<td class="org-left">\red{x}</td>
<td class="org-left">\green{o}</td>
</tr>

<tr>
<td class="org-left">SiPM</td>
<td class="org-left">\red{x}</td>
<td class="org-left">\green{o}</td>
</tr>
</tbody>
</table>

<p>
Run-2 ran with a Timepix shutter time of <code>2/32</code>
(ref. sec. <a href="./reconstruction.html#sec:reco:event_duration">9.4.5</a>) resulting in about \(\SI{2.4}{s}\)
long frames. This was changed with the start of 2018 (still in Run-2)
to <code>2/30</code> (\(\sim\SI{2.2}{s}\)).
</p>

<p>
In total 115 solar trackings were recorded between Run-2 and Run-3,
out of 120 solar trackings taking place. 4 of the 120 total were
missed for detector related reasons and one was aborted after 30
minutes of tracking time. This amounts to about \(\SI{180}{\hour}\) of
tracking data. Further, \(\SI{3526}{\hour}\) of background data and
\(\SI{194}{\hour}\) of \cefe calibration data were recorded. The total
active fraction of these times is about \(\SI{90}{\%}\) in both run
periods. See tab. <a href="#tab:cast:total_data_time">13</a> for the precise times and
fractions of active data taking. Two X-ray finger runs were done for
alignment purposes (out of which only 1 is directly useful).
</p>

<table id="tab:cast:total_data_time">
<caption class="t-above"><span class="table-number">Table 13:</span> Overview of the total data taken with the Septemboard detector at CAST in the time between October 2017 and December 2018. &apos;Active s&apos; and &apos;Active b.&apos; refers to the total solar tracking and background time excluding the dead time due to readout of the septemboard. See the table below <a href="#tab:cast:data_stats_overview">14</a> for more details.</caption>

<colgroup>
<col class="org-left" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />
</colgroup>
<thead>
<tr>
<th class="org-left" scope="col"> </th>
<th class="org-right" scope="col">Solar tracking [h]</th>
<th class="org-right" scope="col">Active s. [h]</th>
<th class="org-right" scope="col">Background [h]</th>
<th class="org-right" scope="col">Active b. [h]</th>
<th class="org-right" scope="col">Active [%]</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Run-2</td>
<td class="org-right">106.006</td>
<td class="org-right">93.3689</td>
<td class="org-right">2391.16</td>
<td class="org-right">2144.12</td>
<td class="org-right">89.65</td>
</tr>

<tr>
<td class="org-left">Run-3</td>
<td class="org-right">74.2981</td>
<td class="org-right">67.0066</td>
<td class="org-right">1124.93</td>
<td class="org-right">1012.68</td>
<td class="org-right">90.02</td>
</tr>

<tr>
<td class="org-left">Total</td>
<td class="org-right">180.3041</td>
<td class="org-right">160.3755</td>
<td class="org-right">3516.09</td>
<td class="org-right">3157.35</td>
<td class="org-right">89.52</td>
</tr>
</tbody>
</table>

<p>
Outside the issues mentioned in the previous section
<a href="./cast.html#sec:cast:data_taking_woes">10.5</a>, the detector generally ran very
stable. Certain detector behaviors will be discussed later, which do
not affect data quality as they can be calibrated out. 
</p>

<p>
Table <a href="#tab:cast:data_stats_overview">14</a> provides a comprehensive overview
of different statistics of each data taking period, split by
calibration and background / solar tracking data. The appendix
<a href="./cast_run_list.html#sec:appendix:cast_run_list">21</a> lists the full run list with additional
information about each run. Further, appendix <a href="./occupancy.html#sec:appendix:occupancy">29</a>
shows occupancy maps of the Septemboard for Run-2 and Run-3, showing a
mostly homogeneous activity, as one would expect for background data
taking. Fig. <a href="#fig:appendix:background_rates:all_cast_data">190</a> in appendix
<a href="./background_rates.html#sec:appendix:background_rates">31</a> shows the raw rate of activity on the
center chip over the entire CAST data taking period.
</p>

<table id="tab:cast:data_stats_overview">
<caption class="t-above"><span class="table-number">Table 14:</span> Overview of the data taken in each of the runs split by calibration data (&quot;calib&quot;) and background (&quot;back&quot;). First information about the total recorded time and trackings and then event information regarding general activity and activity split by chips, FADC and scintillators. Note that the scintillator information for Run-2 is not useful, as the signals recorded were not actually real signals.</caption>

<colgroup>
<col class="org-left" />

<col class="org-left" />

<col class="org-left" />

<col class="org-left" />

<col class="org-left" />
</colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Field</th>
<th class="org-left" scope="col">calib Run-2</th>
<th class="org-left" scope="col">calib Run-3</th>
<th class="org-left" scope="col">back Run-2</th>
<th class="org-left" scope="col">back Run-3</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">total duration</td>
<td class="org-left">107.42 h</td>
<td class="org-left">87.06 h</td>
<td class="org-left">2497.16 h</td>
<td class="org-left">1199.22 h</td>
</tr>

<tr>
<td class="org-left">active duration</td>
<td class="org-left">2.6 h</td>
<td class="org-left">3.53 h</td>
<td class="org-left">2238.78 h</td>
<td class="org-left">1079.6 h</td>
</tr>

<tr>
<td class="org-left">active fraction</td>
<td class="org-left">2.422 %</td>
<td class="org-left">4.049 %</td>
<td class="org-left">89.65 %</td>
<td class="org-left">90.02 %</td>
</tr>

<tr>
<td class="org-left"># trackings</td>
<td class="org-left">\num{0}</td>
<td class="org-left">\num{0}</td>
<td class="org-left">\num{68}</td>
<td class="org-left">\num{47}</td>
</tr>

<tr>
<td class="org-left">non tracking time</td>
<td class="org-left">107.42 h</td>
<td class="org-left">87.06 h</td>
<td class="org-left">2391.15 h</td>
<td class="org-left">1124.93 h</td>
</tr>

<tr>
<td class="org-left">active non tracking time</td>
<td class="org-left">2.6 h</td>
<td class="org-left">3.53 h</td>
<td class="org-left">2144.11 h</td>
<td class="org-left">1012.67 h</td>
</tr>

<tr>
<td class="org-left">tracking time</td>
<td class="org-left">0 h</td>
<td class="org-left">0 h</td>
<td class="org-left">106.01 h</td>
<td class="org-left">74.3 h</td>
</tr>

<tr>
<td class="org-left">active tracking time</td>
<td class="org-left">0 h</td>
<td class="org-left">0 h</td>
<td class="org-left">93.36 h</td>
<td class="org-left">67 h</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">Events</td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">total # events</td>
<td class="org-left">\num{532020}</td>
<td class="org-left">\num{415927}</td>
<td class="org-left">\num{3758960}</td>
<td class="org-left">\num{1837330}</td>
</tr>

<tr>
<td class="org-left">only center chip</td>
<td class="org-left">\num{472048}</td>
<td class="org-left">\num{361244}</td>
<td class="org-left">\num{21684}</td>
<td class="org-left">\num{10342}</td>
</tr>

<tr>
<td class="org-left">only any outer chip</td>
<td class="org-left">\num{5}</td>
<td class="org-left">\num{5}</td>
<td class="org-left">\num{1558546}</td>
<td class="org-left">\num{744722}</td>
</tr>

<tr>
<td class="org-left">center + outer</td>
<td class="org-left">\num{59554}</td>
<td class="org-left">\num{53499}</td>
<td class="org-left">\num{1014651}</td>
<td class="org-left">\num{486478}</td>
</tr>

<tr>
<td class="org-left">center chip</td>
<td class="org-left">\num{531602}</td>
<td class="org-left">\num{414743}</td>
<td class="org-left">\num{1036335}</td>
<td class="org-left">\num{496820}</td>
</tr>

<tr>
<td class="org-left">any chip</td>
<td class="org-left">\num{531607}</td>
<td class="org-left">\num{414748}</td>
<td class="org-left">\num{2594881}</td>
<td class="org-left">\num{1241542}</td>
</tr>

<tr>
<td class="org-left">fraction with center</td>
<td class="org-left">99.92 %</td>
<td class="org-left">99.72 %</td>
<td class="org-left">27.57 %</td>
<td class="org-left">27.04 %</td>
</tr>

<tr>
<td class="org-left">fraction with any</td>
<td class="org-left">99.92 %</td>
<td class="org-left">99.72 %</td>
<td class="org-left">69.03 %</td>
<td class="org-left">67.57 %</td>
</tr>

<tr>
<td class="org-left">with fadc readouts</td>
<td class="org-left">\num{531529}</td>
<td class="org-left">\num{413853}</td>
<td class="org-left">\num{542233}</td>
<td class="org-left">\num{211683}</td>
</tr>

<tr>
<td class="org-left">fraction with FADC</td>
<td class="org-left">99.91 %</td>
<td class="org-left">99.50 %</td>
<td class="org-left">14.43 %</td>
<td class="org-left">11.52 %</td>
</tr>

<tr>
<td class="org-left">with SiPM trigger &lt;4095</td>
<td class="org-left">\num{1656}</td>
<td class="org-left">\num{20}</td>
<td class="org-left">\num{8585}</td>
<td class="org-left">\num{4304}</td>
</tr>

<tr>
<td class="org-left">with veto scinti trigger &lt;4095</td>
<td class="org-left">\num{0}</td>
<td class="org-left">\num{2888}</td>
<td class="org-left">\num{0}</td>
<td class="org-left">\num{70016}</td>
</tr>

<tr>
<td class="org-left">with any SiPM trigger</td>
<td class="org-left">\num{531528}</td>
<td class="org-left">\num{1312}</td>
<td class="org-left">\num{825460}</td>
<td class="org-left">\num{34969}</td>
</tr>

<tr>
<td class="org-left">with any veto scinti trigger</td>
<td class="org-left">\num{0}</td>
<td class="org-left">\num{216170}</td>
<td class="org-left">\num{0}</td>
<td class="org-left">\num{206025}</td>
</tr>

<tr>
<td class="org-left">fraction with any SiPM</td>
<td class="org-left">99.91 %</td>
<td class="org-left">0.3154 %</td>
<td class="org-left">21.96 %</td>
<td class="org-left">1.903 %</td>
</tr>

<tr>
<td class="org-left">fraction with any veto scinti</td>
<td class="org-left">0.000 %</td>
<td class="org-left">51.97 %</td>
<td class="org-left">0.000 %</td>
<td class="org-left">11.21 %</td>
</tr>
</tbody>
</table>
</div>

<div class="outline-4" id="outline-container-orge782062">
<h4 id="orge782062"><span class="section-number-4">10.6.1.</span> Extended table about total time   <span class="tag">  <span class="extended">extended</span></span></h4>
<div class="outline-text-4" id="text-10-6-1">
<p>
This, tab. <a href="#tab:cast:total_data_time_extended">15</a>, is an extended version
(wider + total times) of the table presented in the section above.
</p>

<table id="tab:cast:total_data_time_extended">
<caption class="t-above"><span class="table-number">Table 15:</span> Overview of the total data taken with the Septemboard detector at CAST in the time between October 2017 and December 2018. See the table below <a href="#tab:cast:data_stats_overview">14</a> for more precise numbers including the time the detector was active (shutter open).</caption>

<colgroup>
<col class="org-left" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />
</colgroup>
<thead>
<tr>
<th class="org-left" scope="col"> </th>
<th class="org-right" scope="col">Solar tracking [h]</th>
<th class="org-right" scope="col">Background [h]</th>
<th class="org-right" scope="col">Active tracking [h]</th>
<th class="org-right" scope="col">Active tracking (eventDuration) [h]</th>
<th class="org-right" scope="col">Active background [h]</th>
<th class="org-right" scope="col">Total time [h]</th>
<th class="org-right" scope="col">Active time [h]</th>
<th class="org-right" scope="col">Active [%]</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Run-2</td>
<td class="org-right">106.006</td>
<td class="org-right">2391.16</td>
<td class="org-right">93.3689</td>
<td class="org-right">93.3689</td>
<td class="org-right">2144.12</td>
<td class="org-right">2497.16</td>
<td class="org-right">2238.78</td>
<td class="org-right">0.89653046</td>
</tr>

<tr>
<td class="org-left">Run-3</td>
<td class="org-right">74.2981</td>
<td class="org-right">1124.93</td>
<td class="org-right">67.0066</td>
<td class="org-right">67.0066</td>
<td class="org-right">1012.68</td>
<td class="org-right">1199.23</td>
<td class="org-right">1079.6</td>
<td class="org-right">0.90024432</td>
</tr>

<tr>
<td class="org-left">Total</td>
<td class="org-right">180.3041</td>
<td class="org-right">3516.09</td>
<td class="org-right">160.3755</td>
<td class="org-right">160.3755</td>
<td class="org-right">3157.35</td>
<td class="org-right">3706.66</td>
<td class="org-right">3318.38</td>
<td class="org-right">0.89524801</td>
</tr>
</tbody>
</table>
</div>
</div>


<div class="outline-4" id="outline-container-sec:cast:compute_statistics">
<h4 id="sec:cast:compute_statistics"><span class="section-number-4">10.6.2.</span> Code to compute statistics <code>[10/17]</code>   <span class="tag">  <span class="extended">extended</span></span></h4>
<div class="outline-text-4" id="text-sec:cast:compute_statistics">
<ul class="org-ul">
<li class="off"><code>[ ]</code> code to compute the total run duration of the different parts</li>
<li class="off"><code>[ ]</code> code to produce the outer chip &amp; central chip activity</li>
<li class="off"><code>[ ]</code> produce number of events with FADC trigger</li>
<li class="off"><code>[ ]</code> number of events with scintillator trigger + non trivial
triggers (i.e. not maximum)</li>
</ul>


<p>
Tools we have for this and related:
</p>

<ul class="org-ul">
<li><a href="./../CastData/ExternCode/TimepixAnalysis/Tools/extractScintiRandomRate.nim">./../CastData/ExternCode/TimepixAnalysis/Tools/extractScintiRandomRate.nim</a>
-&gt; works by single run</li>
<li><a href="./../CastData/ExternCode/TimepixAnalysis/Tools/outerChipActivity/outerChipActivity.nim">./../CastData/ExternCode/TimepixAnalysis/Tools/outerChipActivity/outerChipActivity.nim</a>
-&gt; works on full files</li>
<li><a href="./../CastData/ExternCode/TimepixAnalysis/Tools/countNonEmptyFrames/countNonEmptyFrames.nim">./../CastData/ExternCode/TimepixAnalysis/Tools/countNonEmptyFrames/countNonEmptyFrames.nim</a>
-&gt; works on full files
-&gt; only looks at center chip</li>
<li><a href="./../CastData/ExternCode/TimepixAnalysis/Tools/extractAlphasInBackground/extractAlphasInBackground.nim">./../CastData/ExternCode/TimepixAnalysis/Tools/extractAlphasInBackground/extractAlphasInBackground.nim</a>
-&gt; works on full files
-&gt; extracts all events with energy &gt; 1 MeV</li>
<li><a href="./../CastData/ExternCode/TimepixAnalysis/Tools/extractScintiTriggers/extractScintiTriggers.nim">./../CastData/ExternCode/TimepixAnalysis/Tools/extractScintiTriggers/extractScintiTriggers.nim</a>
-&gt; (super old, still uses plotly)
-&gt; works on full files
-&gt; reads scinti trigger values and plots all != 0 &amp; 4095 &amp; and plots
all &lt; 300</li>
<li><a href="./../CastData/ExternCode/TimepixAnalysis/Tools/extractSparks/extractSparks.nim">./../CastData/ExternCode/TimepixAnalysis/Tools/extractSparks/extractSparks.nim</a>
-&gt; works on full files
-&gt; counts events with more than MinPix hits in a region. Written for
Lucian iirc</li>
<li><a href="./../CastData/ExternCode/TimepixAnalysis/Tools/mapSeptemTempToFePeak.nim">./../CastData/ExternCode/TimepixAnalysis/Tools/mapSeptemTempToFePeak.nim</a>
-&gt; works on full files (all calibration)
-&gt; maps peak position by fit parameter to temperature from <code>/resources</code> directory</li>
<li><a href="./../CastData/ExternCode/TimepixAnalysis/Tools/writeRunList/writeRunList.nim">./../CastData/ExternCode/TimepixAnalysis/Tools/writeRunList/writeRunList.nim</a>
-&gt; works on full files
-&gt; uses the <code>ExtendedRunInfo</code> type
Also outputs tracking &amp; non tracking duration already.</li>

<li class="off"><code>[ ]</code> <b>CREATE PLOT OF DURATIONS, HIGHLIGHT 2017 USED 2/32 WHILE 2018 2/30</b></li>
</ul>


<p>
Combined the above gives us more than we need. The one thing missing
(outside of details, like computing rates instead of numbers etc) is
<span class="underline">maybe</span> FADC related, i.e. number of noisy events.
But we haven&apos;t even talked about noisy events, so I&apos;m not sure if this
is the right place for that anyway.
</p>

<p>
So the information we want:
</p>
<ul class="org-ul">
<li class="on"><code>[X]</code> total duration (sum of all runs, background + calibration)</li>
<li class="on"><code>[X]</code> total active duration (event durations)</li>
<li class="on"><code>[X]</code> total # of trackings</li>
<li class="on"><code>[X]</code> total tracking time</li>
<li class="on"><code>[X]</code> total active tracking time</li>
<li class="off"><code>[ ]</code> total # of events for each chip (non empty ones, &amp; split between
center &amp; outside)</li>
<li class="on"><code>[X]</code> fraction of events with only center / only outer chips</li>
<li class="on"><code>[X]</code> total # of FADC triggers</li>
<li class="on"><code>[X]</code> total # of scintillator triggers (run 3, by scintillator)</li>
<li class="on"><code>[X]</code> total # of non trivial scintillator triggers</li>
<li class="off"><code>[ ]</code> total # of non trivial center chip events w/o FADC trigger (some
runs don&apos;t have FADC though) ?</li>
<li>?</li>
</ul>

<p>
Better to just write a new piece of code that extracts exactly what we
need using <code>ExtendedRunInfo</code>.
</p>
<div class="org-src-container">
<pre class="src src-nim"><span style="color: #75715E;"># </span><span style="color: #75715E;">1. open file</span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">2. get file info</span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">3. for each run get extended run info</span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">?</span>
<span style="color: #F92672;">import</span> std / <span style="color: #AE81FF;">[</span>times, strformat, strutils<span style="color: #AE81FF;">]</span>
<span style="color: #F92672;">import</span> nimhdf5, unchained
<span style="color: #F92672;">import</span> ingrid / tos_helpers

<span style="color: #F92672;">type</span>
  <span style="color: #66D9EF;">CastInformation</span> = <span style="color: #F92672;">object</span>
    totalDuration: <span style="color: #66D9EF;">Second</span>
    activeDuration: <span style="color: #66D9EF;">Second</span>
    activeFraction: <span style="color: #66D9EF;">float</span> <span style="color: #75715E;"># </span><span style="color: #75715E;">ratio of active / total    </span>
    numTrackings: <span style="color: #66D9EF;">int</span>
    nonTrackingDuration: <span style="color: #66D9EF;">Second</span>
    activeNonTrackingTime: <span style="color: #66D9EF;">Second</span>
    trackingTime: <span style="color: #66D9EF;">Second</span>
    activeTrackingTime: <span style="color: #66D9EF;">Second</span>
    totalEvents: <span style="color: #66D9EF;">int</span> <span style="color: #75715E;"># </span><span style="color: #75715E;">total number of recorded events</span>
    onlyCenter: <span style="color: #66D9EF;">int</span>  <span style="color: #75715E;"># </span><span style="color: #75715E;">events with activity only on center chip (&gt; 3 hits)</span>
    onlyOuter: <span style="color: #66D9EF;">int</span>   <span style="color: #75715E;"># </span><span style="color: #75715E;">events with activity only on outer, but not center chip</span>
    centerAndOuter: <span style="color: #66D9EF;">int</span> <span style="color: #75715E;"># </span><span style="color: #75715E;">events with activity on center &amp; any outer chip</span>
    center: <span style="color: #66D9EF;">int</span>      <span style="color: #75715E;"># </span><span style="color: #75715E;">events with activity on center (irrespective any other)</span>
    anyActive: <span style="color: #66D9EF;">int</span> <span style="color: #75715E;"># </span><span style="color: #75715E;">events with any active chip</span>
    fractionWithCenter: <span style="color: #66D9EF;">float</span> <span style="color: #75715E;"># </span><span style="color: #75715E;">fraction of events that have center chip activity</span>
    fractionWithAny: <span style="color: #66D9EF;">float</span> <span style="color: #75715E;"># </span><span style="color: #75715E;">fraction of events that have any activity</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">... add mean of event durations?</span>
    fadcReadouts: <span style="color: #66D9EF;">int</span>
    fractionFadc: <span style="color: #66D9EF;">float</span> <span style="color: #75715E;"># </span><span style="color: #75715E;">fraction of events having FADC readout</span>
    scinti1NonTrivial: <span style="color: #66D9EF;">int</span> <span style="color: #75715E;"># </span><span style="color: #75715E;">number of non trivial scinti triggers 0 &lt; x &lt; 4095</span>
    scinti2NonTrivial: <span style="color: #66D9EF;">int</span> <span style="color: #75715E;"># </span><span style="color: #75715E;">number of non trivial scinti triggers 0 &lt; x &lt; 4095</span>
    scinti1Triggers: <span style="color: #66D9EF;">int</span> <span style="color: #75715E;"># </span><span style="color: #75715E;">number of any scinti triggers != 0</span>
    scinti2Triggers: <span style="color: #66D9EF;">int</span> <span style="color: #75715E;"># </span><span style="color: #75715E;">number of any scinti triggers != 0</span>
    fractionScinti1: <span style="color: #66D9EF;">float</span> <span style="color: #75715E;"># </span><span style="color: #75715E;">fraction of events with any scinti 1 activity    </span>
    fractionScinti2: <span style="color: #66D9EF;">float</span> <span style="color: #75715E;"># </span><span style="color: #75715E;">fraction of events with any scinti 2 activity</span>

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">fieldToStr</span><span style="color: #AE81FF;">(</span>s: <span style="color: #66D9EF;">string</span><span style="color: #AE81FF;">)</span>: <span style="color: #66D9EF;">string</span> =
  <span style="color: #F92672;">case</span> s
  <span style="color: #F92672; font-style: italic;">of</span> <span style="color: #E6DB74;">&quot;totalDuration&quot;</span>:         <span style="color: #FD971F;">result</span> = <span style="color: #E6DB74;">&quot;total duration&quot;</span>
  <span style="color: #F92672; font-style: italic;">of</span> <span style="color: #E6DB74;">&quot;activeDuration&quot;</span>:        <span style="color: #FD971F;">result</span> = <span style="color: #E6DB74;">&quot;active duration&quot;</span>
  <span style="color: #F92672; font-style: italic;">of</span> <span style="color: #E6DB74;">&quot;activeFraction&quot;</span>:        <span style="color: #FD971F;">result</span> = <span style="color: #E6DB74;">&quot;active fraction&quot;</span>
  <span style="color: #F92672; font-style: italic;">of</span> <span style="color: #E6DB74;">&quot;numTrackings&quot;</span>:          <span style="color: #FD971F;">result</span> = <span style="color: #E6DB74;">&quot;# trackings&quot;</span>
  <span style="color: #F92672; font-style: italic;">of</span> <span style="color: #E6DB74;">&quot;nonTrackingDuration&quot;</span>:   <span style="color: #FD971F;">result</span> = <span style="color: #E6DB74;">&quot;non tracking time&quot;</span>
  <span style="color: #F92672; font-style: italic;">of</span> <span style="color: #E6DB74;">&quot;activeNonTrackingTime&quot;</span>: <span style="color: #FD971F;">result</span> = <span style="color: #E6DB74;">&quot;active non tracking time&quot;</span>
  <span style="color: #F92672; font-style: italic;">of</span> <span style="color: #E6DB74;">&quot;trackingTime&quot;</span>:          <span style="color: #FD971F;">result</span> = <span style="color: #E6DB74;">&quot;tracking time&quot;</span>
  <span style="color: #F92672; font-style: italic;">of</span> <span style="color: #E6DB74;">&quot;activeTrackingTime&quot;</span>:    <span style="color: #FD971F;">result</span> = <span style="color: #E6DB74;">&quot;active tracking time&quot;</span>
  <span style="color: #F92672; font-style: italic;">of</span> <span style="color: #E6DB74;">&quot;totalEvents&quot;</span>:           <span style="color: #FD971F;">result</span> = <span style="color: #E6DB74;">&quot;total # events&quot;</span>
  <span style="color: #F92672; font-style: italic;">of</span> <span style="color: #E6DB74;">&quot;center&quot;</span>:                <span style="color: #FD971F;">result</span> = <span style="color: #E6DB74;">&quot;center chip&quot;</span>
  <span style="color: #F92672; font-style: italic;">of</span> <span style="color: #E6DB74;">&quot;onlyCenter&quot;</span>:            <span style="color: #FD971F;">result</span> = <span style="color: #E6DB74;">&quot;only center chip&quot;</span>
  <span style="color: #F92672; font-style: italic;">of</span> <span style="color: #E6DB74;">&quot;onlyOuter&quot;</span>:             <span style="color: #FD971F;">result</span> = <span style="color: #E6DB74;">&quot;only any outer chip&quot;</span>
  <span style="color: #F92672; font-style: italic;">of</span> <span style="color: #E6DB74;">&quot;centerAndOuter&quot;</span>:        <span style="color: #FD971F;">result</span> = <span style="color: #E6DB74;">&quot;center + outer&quot;</span>
  <span style="color: #F92672; font-style: italic;">of</span> <span style="color: #E6DB74;">&quot;anyActive&quot;</span>:             <span style="color: #FD971F;">result</span> = <span style="color: #E6DB74;">&quot;any chip&quot;</span>
  <span style="color: #F92672; font-style: italic;">of</span> <span style="color: #E6DB74;">&quot;fractionWithCenter&quot;</span>:    <span style="color: #FD971F;">result</span> = <span style="color: #E6DB74;">&quot;fraction with center&quot;</span>
  <span style="color: #F92672; font-style: italic;">of</span> <span style="color: #E6DB74;">&quot;fractionWithAny&quot;</span>:       <span style="color: #FD971F;">result</span> = <span style="color: #E6DB74;">&quot;fraction with any&quot;</span>
  <span style="color: #F92672; font-style: italic;">of</span> <span style="color: #E6DB74;">&quot;fadcReadouts&quot;</span>:          <span style="color: #FD971F;">result</span> = <span style="color: #E6DB74;">&quot;with fadc readouts&quot;</span>
  <span style="color: #F92672; font-style: italic;">of</span> <span style="color: #E6DB74;">&quot;fractionFadc&quot;</span>:          <span style="color: #FD971F;">result</span> = <span style="color: #E6DB74;">&quot;fraction with FADC&quot;</span>
  <span style="color: #F92672; font-style: italic;">of</span> <span style="color: #E6DB74;">&quot;scinti1NonTrivial&quot;</span>:     <span style="color: #FD971F;">result</span> = <span style="color: #E6DB74;">&quot;with SiPM trigger &lt;4095&quot;</span>
  <span style="color: #F92672; font-style: italic;">of</span> <span style="color: #E6DB74;">&quot;scinti2NonTrivial&quot;</span>:     <span style="color: #FD971F;">result</span> = <span style="color: #E6DB74;">&quot;with veto scinti trigger &lt;4095&quot;</span>
  <span style="color: #F92672; font-style: italic;">of</span> <span style="color: #E6DB74;">&quot;scinti1Triggers&quot;</span>:       <span style="color: #FD971F;">result</span> = <span style="color: #E6DB74;">&quot;with any SiPM trigger&quot;</span>
  <span style="color: #F92672; font-style: italic;">of</span> <span style="color: #E6DB74;">&quot;scinti2Triggers&quot;</span>:       <span style="color: #FD971F;">result</span> = <span style="color: #E6DB74;">&quot;with any veto scinti trigger&quot;</span>
  <span style="color: #F92672; font-style: italic;">of</span> <span style="color: #E6DB74;">&quot;fractionScinti1&quot;</span>:       <span style="color: #FD971F;">result</span> = <span style="color: #E6DB74;">&quot;fraction with any SiPM&quot;</span>
  <span style="color: #F92672; font-style: italic;">of</span> <span style="color: #E6DB74;">&quot;fractionScinti2&quot;</span>:       <span style="color: #FD971F;">result</span> = <span style="color: #E6DB74;">&quot;fraction with any veto scinti&quot;</span>  

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">`$`</span><span style="color: #AE81FF;">(</span>castInfo: <span style="color: #66D9EF;">CastInformation</span><span style="color: #AE81FF;">)</span>: <span style="color: #66D9EF;">string</span> =
  <span style="color: #FD971F;">result</span>.<span style="color: #F92672;">add</span> &amp;<span style="color: #E6DB74;">&quot;Total duration: {pretty(castInfo.totalDuration.to(Hour), 4, true)}\n&quot;</span>
  <span style="color: #FD971F;">result</span>.<span style="color: #F92672;">add</span> &amp;<span style="color: #E6DB74;">&quot;Active duration: {pretty(castInfo.activeDuration.to(Hour), 4, true)}\n&quot;</span>
  <span style="color: #FD971F;">result</span>.<span style="color: #F92672;">add</span> &amp;<span style="color: #E6DB74;">&quot;Active fraction: {castInfo.activeFraction}\n&quot;</span>
  <span style="color: #FD971F;">result</span>.<span style="color: #F92672;">add</span> &amp;<span style="color: #E6DB74;">&quot;Number of trackings: {castInfo.numTrackings}\n&quot;</span>
  <span style="color: #FD971F;">result</span>.<span style="color: #F92672;">add</span> &amp;<span style="color: #E6DB74;">&quot;Non-tracking time: {pretty(castInfo.nonTrackingDuration.to(Hour), 4, true)}\n&quot;</span>
  <span style="color: #FD971F;">result</span>.<span style="color: #F92672;">add</span> &amp;<span style="color: #E6DB74;">&quot;Active non-tracking time: {pretty(castInfo.activeNonTrackingTime.to(Hour), 4, true)}\n&quot;</span>
  <span style="color: #FD971F;">result</span>.<span style="color: #F92672;">add</span> &amp;<span style="color: #E6DB74;">&quot;Tracking time: {pretty(castInfo.trackingTime.to(Hour), 4, true)}\n&quot;</span>
  <span style="color: #FD971F;">result</span>.<span style="color: #F92672;">add</span> &amp;<span style="color: #E6DB74;">&quot;Active tracking time: {pretty(castInfo.activeTrackingTime.to(Hour), 4, true)}\n&quot;</span>
  <span style="color: #FD971F;">result</span>.<span style="color: #F92672;">add</span> &amp;<span style="color: #E6DB74;">&quot;Number of total events:   {castInfo.totalEvents}\n&quot;</span>
  <span style="color: #FD971F;">result</span>.<span style="color: #F92672;">add</span> &amp;<span style="color: #E6DB74;">&quot;Number of events without center: {castInfo.onlyOuter}\n&quot;</span>
  <span style="color: #FD971F;">result</span>.<span style="color: #F92672;">add</span> &amp;<span style="color: #E6DB74;">&quot;\t| {(castInfo.onlyOuter.float / castInfo.totalEvents.float) * 100.0} %\n&quot;</span>
  <span style="color: #FD971F;">result</span>.<span style="color: #F92672;">add</span> &amp;<span style="color: #E6DB74;">&quot;Number of events only center: {castInfo.onlyCenter}\n&quot;</span>
  <span style="color: #FD971F;">result</span>.<span style="color: #F92672;">add</span> &amp;<span style="color: #E6DB74;">&quot;\t| {(castInfo.onlyCenter.float / castInfo.totalEvents.float) * 100.0} %\n&quot;</span>
  <span style="color: #FD971F;">result</span>.<span style="color: #F92672;">add</span> &amp;<span style="color: #E6DB74;">&quot;Number of events with center activity and outer: {castInfo.centerAndOuter}\n&quot;</span>
  <span style="color: #FD971F;">result</span>.<span style="color: #F92672;">add</span> &amp;<span style="color: #E6DB74;">&quot;\t| {(castInfo.centerAndOuter.float / castInfo.totalEvents.float) * 100.0} %\n&quot;</span>
  <span style="color: #FD971F;">result</span>.<span style="color: #F92672;">add</span> &amp;<span style="color: #E6DB74;">&quot;Number of events any hit events: {castInfo.anyActive}\n&quot;</span>
  <span style="color: #FD971F;">result</span>.<span style="color: #F92672;">add</span> &amp;<span style="color: #E6DB74;">&quot;\t| {(castInfo.anyActive.float / castInfo.totalEvents.float) * 100.0} %\n&quot;</span>

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">countEvents</span><span style="color: #AE81FF;">(</span>df: <span style="color: #66D9EF;">DataFrame</span><span style="color: #AE81FF;">)</span>: <span style="color: #66D9EF;">int</span> =
  <span style="color: #F92672;">for</span> <span style="color: #AE81FF;">(</span>tup, subdf<span style="color: #AE81FF;">)</span> <span style="color: #F92672;">in</span> groups<span style="color: #AE81FF;">(</span>df.group_by<span style="color: #66D9EF;">(</span><span style="color: #E6DB74;">&quot;runNumber&quot;</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>:
    <span style="color: #F92672;">inc</span> <span style="color: #FD971F;">result</span>, subDf<span style="color: #AE81FF;">[</span><span style="color: #E6DB74;">&quot;eventNumber&quot;</span>, <span style="color: #66D9EF;">int</span><span style="color: #AE81FF;">]</span>.<span style="color: #F92672;">max</span>

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">contains</span><span style="color: #AE81FF;">[</span><span style="color: #66D9EF;">T</span><span style="color: #AE81FF;">](</span>t: <span style="color: #66D9EF;">Tensor</span><span style="color: #66D9EF;">[</span><span style="color: #66D9EF;">T</span><span style="color: #66D9EF;">]</span>, x: <span style="color: #66D9EF;">T</span><span style="color: #AE81FF;">)</span>: <span style="color: #66D9EF;">bool</span> =
  <span style="color: #F92672;">for</span> i <span style="color: #F92672;">in</span> <span style="font-style: italic;">0</span> ..&lt; t.size:
    <span style="color: #F92672;">if</span> x == t<span style="color: #AE81FF;">[</span>i<span style="color: #AE81FF;">]</span>:
      <span style="color: #F92672;">return</span> <span style="color: #AE81FF;">true</span>

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">countChipActivity</span><span style="color: #AE81FF;">(</span>castInfo: <span style="color: #F92672;">var</span> <span style="color: #66D9EF;">CastInformation</span>, df: <span style="color: #66D9EF;">DataFrame</span><span style="color: #AE81FF;">)</span> =
  <span style="color: #F92672;">for</span> <span style="color: #AE81FF;">(</span>tup, subDf<span style="color: #AE81FF;">)</span> <span style="color: #F92672;">in</span> groups<span style="color: #AE81FF;">(</span>df.group_by<span style="color: #66D9EF;">(</span><span style="color: #A6E22E;">[</span><span style="color: #E6DB74;">&quot;eventNumber&quot;</span>, <span style="color: #E6DB74;">&quot;runNumber&quot;</span><span style="color: #A6E22E;">]</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>:
    <span style="color: #F92672;">let</span> <span style="color: #FD971F;">chips </span>= subDf<span style="color: #AE81FF;">[</span><span style="color: #E6DB74;">&quot;chip&quot;</span><span style="color: #AE81FF;">]</span>.unique.toTensor<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">int</span><span style="color: #AE81FF;">)</span>
    <span style="color: #F92672;">if</span> <span style="font-style: italic;">3</span> <span style="color: #F92672;">in</span> chips:
      <span style="color: #F92672;">inc</span> castInfo.center
    <span style="color: #75715E;"># </span><span style="color: #75715E;">start new if </span>
    <span style="color: #F92672;">if</span> <span style="font-style: italic;">3</span> <span style="color: #F92672;">notin</span> chips: 
      <span style="color: #F92672;">inc</span> castInfo.onlyOuter
    <span style="color: #F92672;">elif</span> <span style="color: #AE81FF;">[</span><span style="font-style: italic;">3</span><span style="color: #AE81FF;">]</span>.toTensor == chips:
      <span style="color: #F92672;">inc</span> castInfo.onlyCenter
    <span style="color: #F92672;">elif</span> <span style="font-style: italic;">3</span> <span style="color: #F92672;">in</span> chips <span style="color: #F92672;">and</span> chips.<span style="color: #F92672;">len</span> &gt; <span style="font-style: italic;">1</span>:
      <span style="color: #F92672;">inc</span> castInfo.centerAndOuter
    <span style="color: #F92672;">inc</span> castInfo.anyActive

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">processFile</span><span style="color: #AE81FF;">(</span>fname: <span style="color: #66D9EF;">string</span><span style="color: #AE81FF;">)</span>: <span style="color: #66D9EF;">CastInformation</span> = <span style="color: #75715E;"># </span><span style="color: #75715E;">extend to both calib &amp; both background</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">h5f </span>= <span style="color: #66D9EF;">H5open</span><span style="color: #AE81FF;">(</span>fname, <span style="color: #E6DB74;">&quot;r&quot;</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">fileInfo </span>= getFileInfo<span style="color: #AE81FF;">(</span>h5f<span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">var</span> <span style="color: #FD971F;">castInfo</span>: <span style="color: #66D9EF;">CastInformation</span>
  <span style="color: #F92672;">for</span> run <span style="color: #F92672;">in</span> fileInfo.runs:
    <span style="color: #F92672;">let</span> <span style="color: #FD971F;">runInfo </span>= getExtendedRunInfo<span style="color: #AE81FF;">(</span>h5f, run, fileInfo.runType<span style="color: #AE81FF;">)</span>
    castInfo.totalDuration  += runInfo.timeInfo.t_length.inSeconds<span style="color: #AE81FF;">()</span>.<span style="color: #66D9EF;">Second</span>
    castInfo.activeDuration += runInfo.activeTime.inSeconds.<span style="color: #66D9EF;">Second</span>
    castInfo.nonTrackingDuration += runInfo.nonTrackingDuration.inSeconds.<span style="color: #66D9EF;">Second</span>
    castInfo.activeNonTrackingTime += runInfo.activeNonTrackingTime.inSeconds.<span style="color: #66D9EF;">Second</span>    
    castInfo.numTrackings   += runInfo.trackings.<span style="color: #F92672;">len</span>
    castInfo.trackingTime   += runInfo.trackingDuration.inSeconds.<span style="color: #66D9EF;">Second</span>
    castInfo.activeTrackingTime += runInfo.activeTrackingTime.inSeconds.<span style="color: #66D9EF;">Second</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">read the data of all chips &amp; FADC</span>
    <span style="color: #F92672;">const</span> <span style="color: #FD971F;">names </span>= <span style="color: #AE81FF;">[</span><span style="color: #E6DB74;">&quot;eventNumber&quot;</span>, <span style="color: #E6DB74;">&quot;fadcReadout&quot;</span>, <span style="color: #E6DB74;">&quot;szint1ClockInt&quot;</span>, <span style="color: #E6DB74;">&quot;szint2ClockInt&quot;</span><span style="color: #AE81FF;">]</span>
    <span style="color: #F92672;">let</span> <span style="color: #FD971F;">dfNoChips </span>= h5f.readRunDsets<span style="color: #AE81FF;">(</span>run, commonDsets = names<span style="color: #AE81FF;">)</span>
    <span style="color: #F92672;">let</span> <span style="color: #FD971F;">dfChips </span>= h5f.readRunDsetsAllChips<span style="color: #AE81FF;">(</span>run, fileInfo.chips,
                                           dsets = @<span style="color: #66D9EF;">[]</span><span style="color: #AE81FF;">)</span> <span style="color: #75715E;"># </span><span style="color: #75715E;">don&apos;t need additional dsets</span>
    castInfo.totalEvents       += dfNoChips.countEvents<span style="color: #AE81FF;">()</span>
    castInfo.countChipActivity<span style="color: #AE81FF;">(</span>dfChips<span style="color: #AE81FF;">)</span>
    castInfo.fadcReadouts      += dfNoChips.filter<span style="color: #AE81FF;">(</span>f<span style="color: #66D9EF;">{</span>`fadcReadout` == <span style="font-style: italic;">1</span><span style="color: #66D9EF;">}</span><span style="color: #AE81FF;">)</span>.<span style="color: #F92672;">len</span>
    castInfo.scinti1Triggers   += dfNoChips.filter<span style="color: #AE81FF;">(</span>f<span style="color: #66D9EF;">{</span>`szint1ClockInt` != <span style="font-style: italic;">0</span><span style="color: #66D9EF;">}</span><span style="color: #AE81FF;">)</span>.<span style="color: #F92672;">len</span>
    castInfo.scinti2Triggers   += dfNoChips.filter<span style="color: #AE81FF;">(</span>f<span style="color: #66D9EF;">{</span>`szint2ClockInt` != <span style="font-style: italic;">0</span><span style="color: #66D9EF;">}</span><span style="color: #AE81FF;">)</span>.<span style="color: #F92672;">len</span>
    castInfo.scinti1NonTrivial += dfNoChips.filter<span style="color: #AE81FF;">(</span>f<span style="color: #66D9EF;">{</span>`szint1ClockInt` != <span style="font-style: italic;">0</span> <span style="color: #F92672;">and</span> `szint1ClockInt` &lt; <span style="font-style: italic;">4095</span><span style="color: #66D9EF;">}</span><span style="color: #AE81FF;">)</span>.<span style="color: #F92672;">len</span>
    castInfo.scinti2NonTrivial += dfNoChips.filter<span style="color: #AE81FF;">(</span>f<span style="color: #66D9EF;">{</span>`szint2ClockInt` != <span style="font-style: italic;">0</span> <span style="color: #F92672;">and</span> `szint2ClockInt` &lt; <span style="font-style: italic;">4095</span><span style="color: #66D9EF;">}</span><span style="color: #AE81FF;">)</span>.<span style="color: #F92672;">len</span>
      

<span style="color: #75715E;"># </span><span style="color: #75715E;">compute at the end as we need total information about fraction of total / active</span>
  <span style="color: #F92672;">template</span> <span style="color: #A6E22E;">fraction</span><span style="color: #AE81FF;">(</span>arg, by: <span style="color: #66D9EF;">untyped</span><span style="color: #AE81FF;">)</span>: <span style="color: #66D9EF;">untyped</span> = <span style="color: #AE81FF;">(</span>castInfo.arg / castInfo.by<span style="color: #AE81FF;">)</span> * <span style="font-style: italic;">100</span>.<span style="font-style: italic;">0</span>
  castInfo.activeFraction = fraction<span style="color: #AE81FF;">(</span>activeDuration, totalDuration<span style="color: #AE81FF;">)</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">fractions</span>
  castInfo.fractionWithCenter = fraction<span style="color: #AE81FF;">(</span>center         , totalEvents<span style="color: #AE81FF;">)</span>
  castInfo.fractionWithAny    = fraction<span style="color: #AE81FF;">(</span>anyActive      , totalEvents<span style="color: #AE81FF;">)</span>
  castInfo.fractionFadc       = fraction<span style="color: #AE81FF;">(</span>fadcReadouts   , totalEvents<span style="color: #AE81FF;">)</span>
  castInfo.fractionScinti1    = fraction<span style="color: #AE81FF;">(</span>scinti1Triggers, totalEvents<span style="color: #AE81FF;">)</span>
  castInfo.fractionScinti2    = fraction<span style="color: #AE81FF;">(</span>scinti2Triggers, totalEvents<span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">echo</span> castInfo
  <span style="color: #FD971F;">result</span> = castInfo

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">toTable</span><span style="color: #AE81FF;">(</span>castInfos: <span style="color: #66D9EF;">Table</span><span style="color: #66D9EF;">[</span><span style="color: #A6E22E;">(</span><span style="color: #66D9EF;">string</span>,<span style="color: #66D9EF;">string</span><span style="color: #A6E22E;">)</span>, <span style="color: #66D9EF;">CastInformation</span><span style="color: #66D9EF;">]</span><span style="color: #AE81FF;">)</span>: <span style="color: #66D9EF;">string</span> =
  <span style="color: #E6DB74;">## Turns the input into an Org table</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">| Field | Back Run-2 | Back Run-3 | Calib Run-2 | Calib Run-3 |</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">|-</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">...</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">turn the input into a DF, then `</span><span style="color: #AE81FF;">toOrgTable</span><span style="color: #75715E;">` it</span>
  <span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">toColName</span><span style="color: #AE81FF;">(</span>tup: <span style="color: #66D9EF;">(</span><span style="color: #66D9EF;">string</span>, <span style="color: #66D9EF;">string</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>: <span style="color: #66D9EF;">string</span> =
    <span style="color: #FD971F;">result</span> = tup<span style="color: #AE81FF;">[</span><span style="font-style: italic;">1</span><span style="color: #AE81FF;">]</span> &amp; <span style="color: #E6DB74;">&quot; &quot;</span>
    <span style="color: #F92672;">if</span> <span style="color: #E6DB74;">&quot;2017&quot;</span> <span style="color: #F92672;">in</span> tup<span style="color: #AE81FF;">[</span><span style="font-style: italic;">0</span><span style="color: #AE81FF;">]</span>:
      <span style="color: #FD971F;">result</span>.<span style="color: #F92672;">add</span> <span style="color: #E6DB74;">&quot;Run-2&quot;</span>
    <span style="color: #F92672;">else</span>:
      <span style="color: #FD971F;">result</span>.<span style="color: #F92672;">add</span> <span style="color: #E6DB74;">&quot;Run-3&quot;</span>
      
  <span style="color: #F92672;">var</span> <span style="color: #FD971F;">df </span>= newDataFrame<span style="color: #AE81FF;">()</span>
  <span style="color: #F92672;">for</span> k, v <span style="color: #F92672;">in</span> <span style="color: #F92672;">pairs</span><span style="color: #AE81FF;">(</span>castInfos<span style="color: #AE81FF;">)</span>:
    <span style="color: #F92672;">var</span> <span style="color: #FD971F;">fields </span>= <span style="color: #F92672;">newSeq</span><span style="color: #AE81FF;">[</span><span style="color: #66D9EF;">string</span><span style="color: #AE81FF;">]()</span>
    <span style="color: #F92672;">var</span> <span style="color: #FD971F;">vals </span>= <span style="color: #F92672;">newSeq</span><span style="color: #AE81FF;">[</span><span style="color: #66D9EF;">string</span><span style="color: #AE81FF;">]()</span>
    <span style="color: #F92672;">for</span> field, val <span style="color: #F92672;">in</span> <span style="color: #F92672;">fieldPairs</span><span style="color: #AE81FF;">(</span>v<span style="color: #AE81FF;">)</span>:
      <span style="color: #F92672;">fields</span>.<span style="color: #F92672;">add</span> field.fieldToStr<span style="color: #AE81FF;">()</span>
      <span style="color: #F92672;">when</span> typeof<span style="color: #AE81FF;">(</span>val<span style="color: #AE81FF;">)</span> <span style="color: #F92672; font-style: italic;">is</span> <span style="color: #66D9EF;">Second</span>:
        vals.<span style="color: #F92672;">add</span> pretty<span style="color: #AE81FF;">(</span>val.to<span style="color: #66D9EF;">(</span><span style="color: #66D9EF;">Hour</span><span style="color: #66D9EF;">)</span>, precision = <span style="font-style: italic;">2</span>, short = <span style="color: #AE81FF;">true</span>,
                        format = ffDecimal<span style="color: #AE81FF;">)</span>
      <span style="color: #F92672;">elif</span> typeof<span style="color: #AE81FF;">(</span>val<span style="color: #AE81FF;">)</span> <span style="color: #F92672; font-style: italic;">is</span> <span style="color: #66D9EF;">float</span>:
        vals.<span style="color: #F92672;">add</span> $<span style="color: #AE81FF;">(</span>val.formatFloat<span style="color: #66D9EF;">(</span>precision = <span style="font-style: italic;">4</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span> &amp; <span style="color: #E6DB74;">&quot; %&quot;</span>
      <span style="color: #F92672;">else</span>:
        vals.<span style="color: #F92672;">add</span> <span style="color: #E6DB74;">&quot;\\num{&quot;</span> &amp; $val &amp; <span style="color: #E6DB74;">&quot;}&quot;</span>
    <span style="color: #F92672;">let</span> <span style="color: #FD971F;">colName </span>= k.toColName<span style="color: #AE81FF;">()</span>
    <span style="color: #F92672;">let</span> <span style="color: #FD971F;">dfLoc </span>= toDf<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">{</span><span style="color: #E6DB74;">&quot;Field&quot;</span> : <span style="color: #F92672;">fields</span>, colName : vals<span style="color: #66D9EF;">}</span><span style="color: #AE81FF;">)</span>
    <span style="color: #F92672;">if</span> df.<span style="color: #F92672;">len</span> == <span style="font-style: italic;">0</span>:
      df = dfLoc
    <span style="color: #F92672;">else</span>:
      df<span style="color: #AE81FF;">[</span>colName<span style="color: #AE81FF;">]</span> = dfLoc<span style="color: #AE81FF;">[</span>colName<span style="color: #AE81FF;">]</span>

  df = df.select<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">[</span><span style="color: #E6DB74;">&quot;Field&quot;</span>, <span style="color: #E6DB74;">&quot;calib Run-2&quot;</span>, <span style="color: #E6DB74;">&quot;calib Run-3&quot;</span>, <span style="color: #E6DB74;">&quot;back Run-2&quot;</span>, <span style="color: #E6DB74;">&quot;back Run-3&quot;</span><span style="color: #66D9EF;">]</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">echo</span> df.toOrgTable<span style="color: #AE81FF;">(</span>emphStrNumber = <span style="color: #AE81FF;">false</span><span style="color: #AE81FF;">)</span>

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">main</span><span style="color: #AE81FF;">(</span>background: <span style="color: #66D9EF;">seq</span><span style="color: #66D9EF;">[</span><span style="color: #66D9EF;">string</span><span style="color: #66D9EF;">]</span>, calibration: <span style="color: #66D9EF;">seq</span><span style="color: #66D9EF;">[</span><span style="color: #66D9EF;">string</span><span style="color: #66D9EF;">]</span><span style="color: #AE81FF;">)</span> =

  <span style="color: #F92672;">var</span> <span style="color: #FD971F;">tab </span>= initTable<span style="color: #AE81FF;">[</span><span style="color: #66D9EF;">(</span><span style="color: #66D9EF;">string</span>, <span style="color: #66D9EF;">string</span><span style="color: #66D9EF;">)</span>, <span style="color: #66D9EF;">CastInformation</span><span style="color: #AE81FF;">]()</span>
  <span style="color: #F92672;">for</span> b <span style="color: #F92672;">in</span> background:
    <span style="color: #F92672;">echo</span> <span style="color: #E6DB74;">&quot;--------------- Processing: &quot;</span>, b, <span style="color: #E6DB74;">&quot; ---------------&quot;</span>
    tab<span style="color: #AE81FF;">[</span><span style="color: #66D9EF;">(</span>b, <span style="color: #E6DB74;">&quot;back&quot;</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">]</span> = processFile<span style="color: #AE81FF;">(</span>b<span style="color: #AE81FF;">)</span>
    
  <span style="color: #F92672;">for</span> c <span style="color: #F92672;">in</span> calibration:
    <span style="color: #F92672;">echo</span> <span style="color: #E6DB74;">&quot;--------------- Processing: &quot;</span>, c, <span style="color: #E6DB74;">&quot; ---------------&quot;</span>    
    tab<span style="color: #AE81FF;">[</span><span style="color: #66D9EF;">(</span>c, <span style="color: #E6DB74;">&quot;calib&quot;</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">]</span> = processFile<span style="color: #AE81FF;">(</span>c<span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">echo</span> tab
  <span style="color: #F92672;">echo</span> tab.toTable<span style="color: #AE81FF;">()</span>

<span style="color: #F92672;">when</span> <span style="color: #AE81FF;">isMainModule</span>:
  <span style="color: #F92672;">import</span> cligen
  dispatch main
</pre>
</div>

<table>


<colgroup>
<col class="org-left" />

<col class="org-left" />

<col class="org-left" />

<col class="org-left" />

<col class="org-left" />
</colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Field</th>
<th class="org-left" scope="col">calib Run-2</th>
<th class="org-left" scope="col">calib Run-3</th>
<th class="org-left" scope="col">back Run-2</th>
<th class="org-left" scope="col">back Run-3</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">total duration</td>
<td class="org-left">107.42 h</td>
<td class="org-left">87.06 h</td>
<td class="org-left">2507.43 h</td>
<td class="org-left">1199.22 h</td>
</tr>

<tr>
<td class="org-left">active duration</td>
<td class="org-left">2.6 h</td>
<td class="org-left">3.53 h</td>
<td class="org-left">2238.78 h</td>
<td class="org-left">1079.6 h</td>
</tr>

<tr>
<td class="org-left">active fraction</td>
<td class="org-left">2.422 %</td>
<td class="org-left">4.049 %</td>
<td class="org-left">89.29 %</td>
<td class="org-left">90.02 %</td>
</tr>

<tr>
<td class="org-left"># trackings</td>
<td class="org-left">\num{0}</td>
<td class="org-left">\num{0}</td>
<td class="org-left">\num{68}</td>
<td class="org-left">\num{47}</td>
</tr>

<tr>
<td class="org-left">tracking time</td>
<td class="org-left">0 h</td>
<td class="org-left">0 h</td>
<td class="org-left">106.01 h</td>
<td class="org-left">74.3 h</td>
</tr>

<tr>
<td class="org-left">active tracking time</td>
<td class="org-left">0 h</td>
<td class="org-left">0 h</td>
<td class="org-left">94.65 h</td>
<td class="org-left">66.89 h</td>
</tr>

<tr>
<td class="org-left">total # events</td>
<td class="org-left">\num{532020}</td>
<td class="org-left">\num{415927}</td>
<td class="org-left">\num{3758960}</td>
<td class="org-left">\num{1837330}</td>
</tr>

<tr>
<td class="org-left">only center chip</td>
<td class="org-left">\num{480232}</td>
<td class="org-left">\num{366917}</td>
<td class="org-left">\num{23820}</td>
<td class="org-left">\num{9462}</td>
</tr>

<tr>
<td class="org-left">only any outer chip</td>
<td class="org-left">\num{7}</td>
<td class="org-left">\num{5}</td>
<td class="org-left">\num{1557934}</td>
<td class="org-left">\num{741199}</td>
</tr>

<tr>
<td class="org-left">center + outer</td>
<td class="org-left">\num{51368}</td>
<td class="org-left">\num{47825}</td>
<td class="org-left">\num{960499}</td>
<td class="org-left">\num{460726}</td>
</tr>

<tr>
<td class="org-left">center chip</td>
<td class="org-left">\num{531600}</td>
<td class="org-left">\num{414742}</td>
<td class="org-left">\num{984319}</td>
<td class="org-left">\num{470188}</td>
</tr>

<tr>
<td class="org-left">any chip</td>
<td class="org-left">\num{531607}</td>
<td class="org-left">\num{414747}</td>
<td class="org-left">\num{2542253}</td>
<td class="org-left">\num{1211387}</td>
</tr>

<tr>
<td class="org-left">fraction with center</td>
<td class="org-left">99.92 %</td>
<td class="org-left">99.72 %</td>
<td class="org-left">26.19 %</td>
<td class="org-left">25.59 %</td>
</tr>

<tr>
<td class="org-left">fraction with any</td>
<td class="org-left">99.92 %</td>
<td class="org-left">99.72 %</td>
<td class="org-left">67.63 %</td>
<td class="org-left">65.93 %</td>
</tr>

<tr>
<td class="org-left">with fadc readouts</td>
<td class="org-left">\num{531529}</td>
<td class="org-left">\num{413853}</td>
<td class="org-left">\num{542233}</td>
<td class="org-left">\num{211683}</td>
</tr>

<tr>
<td class="org-left">fraction with FADC</td>
<td class="org-left">99.91 %</td>
<td class="org-left">99.50 %</td>
<td class="org-left">14.43 %</td>
<td class="org-left">11.52 %</td>
</tr>

<tr>
<td class="org-left">with SiPM trigger &lt;4095</td>
<td class="org-left">\num{1656}</td>
<td class="org-left">\num{20}</td>
<td class="org-left">\num{8585}</td>
<td class="org-left">\num{4304}</td>
</tr>

<tr>
<td class="org-left">with veto scinti trigger &lt;4095</td>
<td class="org-left">\num{0}</td>
<td class="org-left">\num{2888}</td>
<td class="org-left">\num{0}</td>
<td class="org-left">\num{70016}</td>
</tr>

<tr>
<td class="org-left">with any SiPM trigger</td>
<td class="org-left">\num{531528}</td>
<td class="org-left">\num{1312}</td>
<td class="org-left">\num{825460}</td>
<td class="org-left">\num{34969}</td>
</tr>

<tr>
<td class="org-left">with any veto scinti trigger</td>
<td class="org-left">\num{0}</td>
<td class="org-left">\num{216170}</td>
<td class="org-left">\num{0}</td>
<td class="org-left">\num{206025}</td>
</tr>

<tr>
<td class="org-left">fraction with any SiPM</td>
<td class="org-left">99.91 %</td>
<td class="org-left">0.3154 %</td>
<td class="org-left">21.96 %</td>
<td class="org-left">1.903 %</td>
</tr>

<tr>
<td class="org-left">fraction with any veto scinti</td>
<td class="org-left">0.000 %</td>
<td class="org-left">51.97 %</td>
<td class="org-left">0.000 %</td>
<td class="org-left">11.21 %</td>
</tr>
</tbody>
</table>

<ul class="org-ul">
<li class="on"><code>[X]</code> generate that table… then onto calibration finally!</li>
</ul>

<div class="org-src-container">
<pre class="src src-sh">code/cast_run_information <span style="color: #E6DB74; font-weight: bold;">\</span>
    ~/CastData/data/DataRuns2017_Reco.h5 <span style="color: #E6DB74; font-weight: bold;">\</span>
    ~/CastData/data/DataRuns2018_Reco.h5 <span style="color: #E6DB74; font-weight: bold;">\</span>
    -c ~/CastData/data/CalibrationRuns2017_Reco.h5 <span style="color: #E6DB74; font-weight: bold;">\</span>
    -c ~/CastData/data/CalibrationRuns2018_Reco.h5
</pre>
</div>

<table>


<colgroup>
<col class="org-left" />

<col class="org-left" />

<col class="org-left" />

<col class="org-left" />

<col class="org-left" />
</colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Field</th>
<th class="org-left" scope="col">calib Run-2</th>
<th class="org-left" scope="col">calib Run-3</th>
<th class="org-left" scope="col">back Run-2</th>
<th class="org-left" scope="col">back Run-3</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">total duration</td>
<td class="org-left">107.42 h</td>
<td class="org-left">87.06 h</td>
<td class="org-left">2497.16 h</td>
<td class="org-left">1199.22 h</td>
</tr>

<tr>
<td class="org-left">active duration</td>
<td class="org-left">2.6 h</td>
<td class="org-left">3.53 h</td>
<td class="org-left">2238.78 h</td>
<td class="org-left">1079.6 h</td>
</tr>

<tr>
<td class="org-left">active fraction</td>
<td class="org-left">2.422 %</td>
<td class="org-left">4.049 %</td>
<td class="org-left">89.65 %</td>
<td class="org-left">90.02 %</td>
</tr>

<tr>
<td class="org-left"># trackings</td>
<td class="org-left">\num{0}</td>
<td class="org-left">\num{0}</td>
<td class="org-left">\num{68}</td>
<td class="org-left">\num{47}</td>
</tr>

<tr>
<td class="org-left">non tracking time</td>
<td class="org-left">107.42 h</td>
<td class="org-left">87.06 h</td>
<td class="org-left">2391.15 h</td>
<td class="org-left">1124.93 h</td>
</tr>

<tr>
<td class="org-left">active non tracking time</td>
<td class="org-left">2.6 h</td>
<td class="org-left">3.53 h</td>
<td class="org-left">2144.11 h</td>
<td class="org-left">1012.67 h</td>
</tr>

<tr>
<td class="org-left">tracking time</td>
<td class="org-left">0 h</td>
<td class="org-left">0 h</td>
<td class="org-left">106.01 h</td>
<td class="org-left">74.3 h</td>
</tr>

<tr>
<td class="org-left">active tracking time</td>
<td class="org-left">0 h</td>
<td class="org-left">0 h</td>
<td class="org-left">93.36 h</td>
<td class="org-left">67 h</td>
</tr>

<tr>
<td class="org-left">total # events</td>
<td class="org-left">\num{532020}</td>
<td class="org-left">\num{415927}</td>
<td class="org-left">\num{3758960}</td>
<td class="org-left">\num{1837330}</td>
</tr>

<tr>
<td class="org-left">only center chip</td>
<td class="org-left">\num{472048}</td>
<td class="org-left">\num{361244}</td>
<td class="org-left">\num{21684}</td>
<td class="org-left">\num{10342}</td>
</tr>

<tr>
<td class="org-left">only any outer chip</td>
<td class="org-left">\num{5}</td>
<td class="org-left">\num{5}</td>
<td class="org-left">\num{1558546}</td>
<td class="org-left">\num{744722}</td>
</tr>

<tr>
<td class="org-left">center + outer</td>
<td class="org-left">\num{59554}</td>
<td class="org-left">\num{53499}</td>
<td class="org-left">\num{1014651}</td>
<td class="org-left">\num{486478}</td>
</tr>

<tr>
<td class="org-left">center chip</td>
<td class="org-left">\num{531602}</td>
<td class="org-left">\num{414743}</td>
<td class="org-left">\num{1036335}</td>
<td class="org-left">\num{496820}</td>
</tr>

<tr>
<td class="org-left">any chip</td>
<td class="org-left">\num{531607}</td>
<td class="org-left">\num{414748}</td>
<td class="org-left">\num{2594881}</td>
<td class="org-left">\num{1241542}</td>
</tr>

<tr>
<td class="org-left">fraction with center</td>
<td class="org-left">99.92 %</td>
<td class="org-left">99.72 %</td>
<td class="org-left">27.57 %</td>
<td class="org-left">27.04 %</td>
</tr>

<tr>
<td class="org-left">fraction with any</td>
<td class="org-left">99.92 %</td>
<td class="org-left">99.72 %</td>
<td class="org-left">69.03 %</td>
<td class="org-left">67.57 %</td>
</tr>

<tr>
<td class="org-left">with fadc readouts</td>
<td class="org-left">\num{531529}</td>
<td class="org-left">\num{413853}</td>
<td class="org-left">\num{542233}</td>
<td class="org-left">\num{211683}</td>
</tr>

<tr>
<td class="org-left">fraction with FADC</td>
<td class="org-left">99.91 %</td>
<td class="org-left">99.50 %</td>
<td class="org-left">14.43 %</td>
<td class="org-left">11.52 %</td>
</tr>

<tr>
<td class="org-left">with SiPM trigger &lt;4095</td>
<td class="org-left">\num{1656}</td>
<td class="org-left">\num{20}</td>
<td class="org-left">\num{8585}</td>
<td class="org-left">\num{4304}</td>
</tr>

<tr>
<td class="org-left">with veto scinti trigger &lt;4095</td>
<td class="org-left">\num{0}</td>
<td class="org-left">\num{2888}</td>
<td class="org-left">\num{0}</td>
<td class="org-left">\num{70016}</td>
</tr>

<tr>
<td class="org-left">with any SiPM trigger</td>
<td class="org-left">\num{531528}</td>
<td class="org-left">\num{1312}</td>
<td class="org-left">\num{825460}</td>
<td class="org-left">\num{34969}</td>
</tr>

<tr>
<td class="org-left">with any veto scinti trigger</td>
<td class="org-left">\num{0}</td>
<td class="org-left">\num{216170}</td>
<td class="org-left">\num{0}</td>
<td class="org-left">\num{206025}</td>
</tr>

<tr>
<td class="org-left">fraction with any SiPM</td>
<td class="org-left">99.91 %</td>
<td class="org-left">0.3154 %</td>
<td class="org-left">21.96 %</td>
<td class="org-left">1.903 %</td>
</tr>

<tr>
<td class="org-left">fraction with any veto scinti</td>
<td class="org-left">0.000 %</td>
<td class="org-left">51.97 %</td>
<td class="org-left">0.000 %</td>
<td class="org-left">11.21 %</td>
</tr>
</tbody>
</table>
</div>


<div class="outline-5" id="outline-container-sec:cast:data_taking_campaigns:gen_total_time_table">
<h5 id="sec:cast:data_taking_campaigns:gen_total_time_table"><span class="section-number-5">10.6.2.1.</span> Cross check with <code>writeRunList</code> and regenerate short table</h5>
<div class="outline-text-5" id="text-sec:cast:data_taking_campaigns:gen_total_time_table">
<p>
Cross check with logic in <code>writeRunList</code>:
-&gt; <b>Yes, they match</b>, <span class="timestamp-wrapper">  <span class="timestamp">&lt;2023-11-23 Thu&gt;</span></span>.
</p>

<p>
The above commands produce this table (after creating the active
column and total sum row):
</p>

<table>


<colgroup>
<col class="org-left" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />
</colgroup>
<thead>
<tr>
<th class="org-left" scope="col"> </th>
<th class="org-right" scope="col">Solar tracking [h]</th>
<th class="org-right" scope="col">Background [h]</th>
<th class="org-right" scope="col">Active tracking [h]</th>
<th class="org-right" scope="col">Active tracking (eventDuration) [h]</th>
<th class="org-right" scope="col">Active background [h]</th>
<th class="org-right" scope="col">Total time [h]</th>
<th class="org-right" scope="col">Active time [h]</th>
<th class="org-right" scope="col">Active [%]</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Run-2</td>
<td class="org-right">106.006</td>
<td class="org-right">2391.16</td>
<td class="org-right">93.3689</td>
<td class="org-right">93.3689</td>
<td class="org-right">2144.12</td>
<td class="org-right">2497.16</td>
<td class="org-right">2238.78</td>
<td class="org-right">0.89653046</td>
</tr>

<tr>
<td class="org-left">Run-3</td>
<td class="org-right">74.2981</td>
<td class="org-right">1124.93</td>
<td class="org-right">67.0066</td>
<td class="org-right">67.0066</td>
<td class="org-right">1012.68</td>
<td class="org-right">1199.23</td>
<td class="org-right">1079.6</td>
<td class="org-right">0.90024432</td>
</tr>

<tr>
<td class="org-left">Total</td>
<td class="org-right">180.3041</td>
<td class="org-right">3516.09</td>
<td class="org-right">160.3755</td>
<td class="org-right">160.3755</td>
<td class="org-right">3157.35</td>
<td class="org-right">3706.66</td>
<td class="org-right">3318.38</td>
<td class="org-right">0.89524801</td>
</tr>
</tbody>
</table>



<div class="org-src-container">
<pre class="src src-sh">./writeRunList -b ~/CastData/data/DataRuns2017_Reco.h5 -c ~/CastData/data/CalibrationRuns2017_Reco.h5 --runList /tmp/runList_2017.org
</pre>
</div>
<p>
total duration: 14 weeks, 6 days, 1 hour, 9 minutes, 53 seconds, 97 milliseconds, 615 microseconds, and 921 nanoseconds
  In hours: 2497.1647493375
  active duration: 2238.783333333333
trackingDuration: 4 days, 10 hours, and 20 seconds
  In hours: 106.0055555555556
  active tracking duration: 93.36890683888889
  active tracking duration from event durations: 93.36890683861111
nonTrackingDuration: 14 weeks, 1 day, 15 hours, 9 minutes, 33 seconds, 97 milliseconds, 615 microseconds, and 921 nanoseconds
  In hours: 2391.159193781944
  active background duration: 2144.122404722222
</p>
<table>


<colgroup>
<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />
</colgroup>
<thead>
<tr>
<th class="org-right" scope="col">Solar tracking [h]</th>
<th class="org-right" scope="col">Background [h]</th>
<th class="org-right" scope="col">Active tracking [h]</th>
<th class="org-right" scope="col">Active tracking (eventDuration) [h]</th>
<th class="org-right" scope="col">Active background [h]</th>
<th class="org-right" scope="col">Total time [h]</th>
<th class="org-right" scope="col">Active time [h]</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">106.006</td>
<td class="org-right">2391.16</td>
<td class="org-right">93.3689</td>
<td class="org-right">93.3689</td>
<td class="org-right">2144.12</td>
<td class="org-right">2497.16</td>
<td class="org-right">2238.78</td>
</tr>
</tbody>
</table>
<p>
total duration: 4 days, 11 hours, 25 minutes, 20 seconds, 453 milliseconds, 596 microseconds, and 104 nanoseconds
  In hours: 107.4223482211111
  active duration: 2.601388888888889
trackingDuration: 0 nanoseconds
  In hours: 0.0
  active tracking duration: 0.0
  active tracking duration from event durations: 0.0
nonTrackingDuration: 4 days, 11 hours, 25 minutes, 20 seconds, 453 milliseconds, 596 microseconds, and 104 nanoseconds
  In hours: 107.4223482211111
  active background duration: 2.601391883888889
</p>
<table>


<colgroup>
<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />
</colgroup>
<thead>
<tr>
<th class="org-right" scope="col">Solar tracking [h]</th>
<th class="org-right" scope="col">Background [h]</th>
<th class="org-right" scope="col">Active tracking [h]</th>
<th class="org-right" scope="col">Active tracking (eventDuration) [h]</th>
<th class="org-right" scope="col">Active background [h]</th>
<th class="org-right" scope="col">Total time [h]</th>
<th class="org-right" scope="col">Active time [h]</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">107.422</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">2.60139</td>
<td class="org-right">107.422</td>
<td class="org-right">2.60139</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-sh">./writeRunList -b ~/CastData/data/DataRuns2018_Reco.h5 -c ~/CastData/data/CalibrationRuns2018_Reco.h5 --runList /tmp/runList_2018.org
</pre>
</div>
<p>
total duration: 7 weeks, 23 hours, 13 minutes, 35 seconds, 698 milliseconds, 399 microseconds, and 775 nanoseconds
  In hours: 1199.226582888611
  active duration: 1079.598333333333
trackingDuration: 3 days, 2 hours, 17 minutes, and 53 seconds
  In hours: 74.29805555555555
  active tracking duration: 67.00656808194445
  active tracking duration from event durations: 67.00656808222222
nonTrackingDuration: 6 weeks, 4 days, 20 hours, 55 minutes, 42 seconds, 698 milliseconds, 399 microseconds, and 775 nanoseconds
  In hours: 1124.928527333056
  active background duration: 1012.677445774444
</p>
<table>


<colgroup>
<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />
</colgroup>
<thead>
<tr>
<th class="org-right" scope="col">Solar tracking [h]</th>
<th class="org-right" scope="col">Background [h]</th>
<th class="org-right" scope="col">Active tracking [h]</th>
<th class="org-right" scope="col">Active tracking (eventDuration) [h]</th>
<th class="org-right" scope="col">Active background [h]</th>
<th class="org-right" scope="col">Total time [h]</th>
<th class="org-right" scope="col">Active time [h]</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">74.2981</td>
<td class="org-right">1124.93</td>
<td class="org-right">67.0066</td>
<td class="org-right">67.0066</td>
<td class="org-right">1012.68</td>
<td class="org-right">1199.23</td>
<td class="org-right">1079.6</td>
</tr>
</tbody>
</table>
<p>
total duration: 3 days, 15 hours, 3 minutes, 47 seconds, 557 milliseconds, 131 microseconds, and 279 nanoseconds
  In hours: 87.06321031416667
  active duration: 3.525555555555556
trackingDuration: 0 nanoseconds
  In hours: 0.0
  active tracking duration: 0.0
  active tracking duration from event durations: 0.0
nonTrackingDuration: 3 days, 15 hours, 3 minutes, 47 seconds, 557 milliseconds, 131 microseconds, and 279 nanoseconds
  In hours: 87.06321031416667
  active background duration: 3.525561761944445
</p>
<table>


<colgroup>
<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />
</colgroup>
<thead>
<tr>
<th class="org-right" scope="col">Solar tracking [h]</th>
<th class="org-right" scope="col">Background [h]</th>
<th class="org-right" scope="col">Active tracking [h]</th>
<th class="org-right" scope="col">Active tracking (eventDuration) [h]</th>
<th class="org-right" scope="col">Active background [h]</th>
<th class="org-right" scope="col">Total time [h]</th>
<th class="org-right" scope="col">Active time [h]</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">87.0632</td>
<td class="org-right">0</td>
<td class="org-right">0</td>
<td class="org-right">3.52556</td>
<td class="org-right">87.0632</td>
<td class="org-right">3.52556</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>

<div id="footnotes"><h2 class="footnotes">Footnotes: </h2><div class="footdef"><sup>  <a role="doc-backlink" class="footnum" id="fn.1" href="#fnr.1">1</a></sup> <div role="doc-footnote" class="footpara">  <p class="footpara">
<a href="https://www.amptek.com/internal-products/obsolete-products/cool-x-pyroelectric-x-ray-generator">https://www.amptek.com/internal-products/obsolete-products/cool-x-pyroelectric-x-ray-generator</a>
</p></div></div>

<div class="footdef"><sup>  <a role="doc-backlink" class="footnum" id="fn.2" href="#fnr.2">2</a></sup> <div role="doc-footnote" class="footpara">  <p class="footpara">
<a href="https://www.raspberrypi.org/about/">https://www.raspberrypi.org/about/</a>
</p></div></div>

<div class="footdef"><sup>  <a role="doc-backlink" class="footnum" id="fn.3" href="#fnr.3">3</a></sup> <div role="doc-footnote" class="footpara">  <p class="footpara">
<a href="https://www.festo.com/">https://www.festo.com/</a>
</p></div></div>

</div>
<div class="hint-message">Click on any heading marked '<span class="extended">extended</span>' to open it</div>
</div>
</body>
</html>
