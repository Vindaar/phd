<!DOCTYPE html>
<html lang="en">
<head>
<!--  2024-06-25 Tue 14:17  -->
<meta charset="utf-8" />
<meta content="width=device-width, initial-scale=1" name="viewport" />
<title>‎</title>
<meta content="Vindaar" name="author" />
<meta content="Org Mode" name="generator" />

<link type="text/css" rel="stylesheet" href="org_html_export.css" />
<script type="text/javascript">

document.addEventListener('DOMContentLoaded', function() {
    // Set the initial width for subfigures and their images
    document.querySelectorAll('figure.subfigure[data-width]').forEach(function(subfigure) {
        subfigure.style.width = subfigure.getAttribute('data-width');
    });

    document.querySelectorAll('figure.subfigure img[data-width]').forEach(function(img) {
        img.style.width = img.getAttribute('data-width');
    });

    // Event listener for images within subfigures
    document.querySelectorAll('figure.subfigure img[data-width]').forEach(function(img) {
        img.addEventListener('click', function() {
            // Determine the .figure-wrapper that contains the clicked image
            let wrapper = this.closest('.figure-wrapper');

            // If found, adjust the sizes of its subfigures
            if (wrapper) {
                let subfigures = wrapper.querySelectorAll('figure.subfigure');
                subfigures.forEach(subfigure => {
                    let width = parseFloat(subfigure.getAttribute('data-width'));
                    if (width < 50) { // Double size if less than 50%
                        subfigure.setAttribute('data-width', (width * 2) + '%');
                        subfigure.style.width = (width * 2) + '%';
                    } else { // Halve size otherwise
                        subfigure.setAttribute('data-width', (width / 2) + '%');
                        subfigure.style.width = (width / 2) + '%';
                    }
                });
            }
        });
    });
});

document.addEventListener('DOMContentLoaded', function () {
    var headers = document.querySelectorAll('h1 .extended, h2 .extended, h3 .extended, h4 .extended, h5 .extended, h6 .extended');

    headers.forEach(function (header) {
        var foldableHeader = header.closest('h1, h2, h3, h4, h5, h6');
        if (foldableHeader) {
            foldableHeader.classList.add('foldable-header');
            var nextElement = foldableHeader.nextElementSibling;
            var contentToFold = [];
            while (nextElement && !nextElement.matches('h1, h2, h3, h4, h5, h6')) {
                contentToFold.push(nextElement);
                nextElement = nextElement.nextElementSibling;
            }
            contentToFold.forEach(function (element) {
                element.classList.add('folded-content');
            });

            foldableHeader.addEventListener('click', function () {
                contentToFold.forEach(function (element) {
                    if (element.style.display === 'none' || element.style.display == '') {
                        element.style.display = 'block';
                    } else {
                        element.style.display = 'none';
                    }
                });
            });
        }
    });
});

</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript"></script>
<script type="text/x-mathjax-config">
<!-- /* --><![CDATA[/*><!--*/
    MathJax.Hub.Config({
        jax: ["input/TeX", "output/HTML-CSS"],
        extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js",
                     "TeX/noUndefined.js", "[Contrib]/siunitx/siunitx.js", "[Contrib]/mhchem/mhchem.js"],
        tex2jax: {
            inlineMath: [ ["\\(","\\)"], ['$', '$'], ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"], ["\\begin{displaymath}","\\end{displaymath}"] ],
            skipTags: ["script","noscript","style","textarea","pre","code"],
            ignoreClass: "tex2jax_ignore",
            processEscapes: false,
            processEnvironments: true,
            preview: "TeX"
        },
        showProcessingMessages: true,
        displayAlign: "center",
        displayIndent: "2em",

        "HTML-CSS": {
             scale: 1.0,
             availableFonts: ["STIX","TeX"],
             preferredFont: "TeX",
             webFont: "TeX",
             imageFont: "TeX",
             showMathMenu: true,
        },
        MMLorHTML: {
             prefer: {
                 MSIE:    "MML",
                 Firefox: "MML",
                 Opera:   "HTML",
                 other:   "HTML"
             }
        },
        TeX: {
              equationNumbers: { autoNumber: 'AMS' },
              Macros: {
                  ccsini: '{\\mathrm{Si}₃\\mathrm{N}₄}',
                  cefe: '{\\ce{^{55}Fe}}',
                  vektor: ['{\\begin{pmatrix}#1\\end{pmatrix}}', 1],
                  mtrix: ['{\\begin{pmatrix}#1\\end{pmatrix}}', 1],
                  cp: '{\\mathrm{CP}}',
                  cpt: '{\\mathrm{CPT}}',
                  dd: '{\\mathop{}\\!{\\mathrm{d}}}',
                  sinc: '{\\mathrm{sinc}}'
              }
        }
    });
/*]]>*///--&gt;
</script>
</head>
<body>
<div id="content" class="content">
<nav role="doc-toc" id="table-of-contents">
<h2>Table of Contents</h2>
<div role="doc-toc" id="text-table-of-contents">
<ul>
<li>  <a href="./errata.html#sec:errata">1. Errata   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./introduction.html#sec:introduction">2. Introduction   <span class="tag">    <span class="Intro">Intro</span>  </span></a></li>
<li><a href="./about_thesis.html#sec:about_thesis">3. About this thesis   <span class="tag">  <span class="Intro">Intro</span></span></a>
<ul>
<li>  <a href="./about_thesis.html#orgfbe9803">3.1. Extended notes for the extended thesis <code>[/]</code>   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./about_thesis.html#org440d307">3.2. Why Org mode   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./about_thesis.html#org1090aaf">3.3. Notes for future PhD students and IAXO analyses   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li><a href="./theory.html#sec:theory">4. Theory of axions   <span class="tag">  <span class="Theory">Theory</span></span></a>
<ul>
<li>  <a href="./theory.html#sec:theory:useful_reading_material">4.1. Useful reading material   <span class="tag">    <span class="optional">optional</span>  </span></a></li>
<li>  <a href="./theory.html#sec:theory:illustration_cpt">4.2. Illustration of the \cpt symmetry <code>[/]</code>   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./theory.html#sec:theory:invisible_axion_models">4.3. Invisible axion models and axion couplings</a></li>
<li>  <a href="./theory.html#sec:theory:axion_interactions">4.4. Implications for axion interactions - conversion probability</a></li>
<li>  <a href="./theory.html#sec:theory:solar_axion_flux">4.5. Solar axion flux</a></li>
<li>  <a href="./theory.html#sec:theory:chameleon">4.6. Chameleons</a></li>
<li>  <a href="./theory.html#sec:theory:current_bounds">4.7. Current bounds on coupling constants</a></li>
</ul>
</li>
<li><a href="./helioscopes.html#sec:helioscopes">5. Axion helioscopes   <span class="tag">  <span class="Theory">Theory</span></span></a>
<ul>
<li>  <a href="./helioscopes.html#sec:helioscopes:cast">5.1. CERN Axion Solar Telescope (CAST)</a></li>
<li>  <a href="./helioscopes.html#sec:helioscopes:iaxo">5.2. International AXion Observatory (IAXO)</a></li>
</ul>
</li>
<li><a href="./theory_detector.html#sec:theory_detector">6. X-rays, cosmic muons and gaseous detectors   <span class="tag">  <span class="Theory">Theory</span></span></a>
<ul>
<li>  <a href="./theory_detector.html#sec:theory:particle_int">6.1. Particle interactions with matter</a></li>
<li>  <a href="./theory_detector.html#sec:theory:cosmic_radiation">6.2. Cosmic rays</a></li>
<li>  <a href="./theory_detector.html#sec:theory:gas_fundamentals">6.3. Gaseous detector fundamentals</a></li>
</ul>
</li>
<li><a href="./septemboard.html#sec:septemboard">7. Septemboard detector   <span class="tag">  <span class="Detector">Detector</span></span></a>
<ul>
<li>  <a href="./septemboard.html#sec:detector:micromegas">7.1. Micromegas working principle</a></li>
<li>  <a href="./septemboard.html#sec:detector:timepix">7.2. Timepix ASIC</a></li>
<li>  <a href="./septemboard.html#sec:detector:gridpix">7.3. GridPix</a></li>
<li>  <a href="./septemboard.html#sec:detector:detector_2014_15">7.4. 2014 / 2015 GridPix detector for CAST</a></li>
<li>  <a href="./septemboard.html#sec:detector:detector_overview">7.5. Septemboard detector overview</a></li>
<li>  <a href="./septemboard.html#orgaff9f43">7.6. Detector readout system</a></li>
<li>  <a href="./septemboard.html#sec:detector:scintillators">7.7. Scintillator vetoes</a></li>
<li>  <a href="./septemboard.html#sec:detector:fadc">7.8. FADC</a></li>
<li>  <a href="./septemboard.html#sec:detector:sin_window">7.9. SiN window</a></li>
<li>  <a href="./septemboard.html#sec:detector:septemboard">7.10. Septemboard - 6 GridPixes around a center one</a></li>
<li>  <a href="./septemboard.html#sec:detector:water_cooling">7.11. Water cooling and temperature readout for the septemboard</a></li>
<li>  <a href="./septemboard.html#sec:septem:efficiency">7.12. Detector efficiency</a></li>
<li>  <a href="./septemboard.html#sec:detector:daq">7.13. Data acquisition and detector monitoring</a></li>
</ul>
</li>
<li><a href="./operation_calibration.html#sec:operation_calibration">8. Detector calibration for operation   <span class="tag">  <span class="Detector">Detector</span></span></a>
<ul>
<li>  <a href="./operation_calibration.html#sec:operation_calibration:timepix">8.1. Timepix calibrations</a></li>
<li>  <a href="./operation_calibration.html#sec:operation_calibration:fadc">8.2. FADC calibration</a></li>
<li>  <a href="./operation_calibration.html#sec:operation_calibration:scintillators">8.3. Scintillator calibration</a></li>
</ul>
</li>
<li><a href="./reconstruction.html#sec:reconstruction">9. Data reconstruction   <span class="tag">  <span class="Reconstruction">Reconstruction</span></span></a>
<ul>
<li>  <a href="./reconstruction.html#sec:reco:tpa">9.1. <code>TimepixAnalysis</code> and Nim</a></li>
<li>  <a href="./reconstruction.html#sec:reco:tos_data_parsing">9.2. TOS data parsing</a></li>
<li>  <a href="./reconstruction.html#sec:reco:event_shape">9.3. Expectation of event shapes</a></li>
<li>  <a href="./reconstruction.html#sec:reco:data_reconstruction">9.4. Data reconstruction</a></li>
<li>  <a href="./reconstruction.html#sec:reco:fadc_data">9.5. FADC reconstruction</a></li>
<li>  <a href="./reconstruction.html#sec:reco:scintillator_data">9.6. Scintillator data</a></li>
</ul>
</li>
<li><a href="./cast.html#sec:cast">10. Detector installation &amp; data taking at CAST   <span class="tag">  <span class="CAST">CAST</span></span></a>
<ul>
<li>  <a href="./cast.html#sec:cast:timeline">10.1. Timeline</a></li>
<li>  <a href="./cast.html#sec:cast:alignment">10.2. Alignment</a></li>
<li>  <a href="./cast.html#sec:cast:detector_setup">10.3. Detector setup at CAST</a></li>
<li>  <a href="./cast.html#sec:cast:window_accident">10.4. Window accident</a></li>
<li>  <a href="./cast.html#sec:cast:data_taking_woes">10.5. Data taking woes</a></li>
<li>  <a href="./cast.html#sec:cast:data_taking_campaigns">10.6. Summary of CAST data taking</a></li>
</ul>
</li>
<li><a href="./calibration.html#sec:calibration">11. Data calibration   <span class="tag">  <span class="Calibration">Calibration</span></span></a>
<ul>
<li>  <a href="./calibration.html#sec:calibration:energy">11.1. Energy calibration - in principle</a></li>
<li>  <a href="./calibration.html#sec:calib:detector_behavior_over_time">11.2. Detector behavior over time</a></li>
<li>  <a href="./calibration.html#sec:calib:final_energy_calibration">11.3. Energy calibration dependence on the gas gain</a></li>
<li>  <a href="./calibration.html#sec:calib:fadc">11.4. FADC</a></li>
</ul>
</li>
<li><a href="./background.html#sec:background">12. Finding signal and defining background | Background rate computation   <span class="tag">  <span class="Analysis">Analysis</span></span></a>
<ul>
<li>  <a href="./background.html#sec:background:likelihood_method">12.1. Likelihood method</a></li>
<li>  <a href="./background.html#sec:cdl">12.2. CAST Detector Lab</a></li>
<li>  <a href="./background.html#sec:background:likelihood_cut">12.3. Application of likelihood cut for background rate</a></li>
<li>  <a href="./background.html#sec:background:mlp">12.4. Artificial neural networks as cluster classifiers</a></li>
<li>  <a href="./background.html#sec:background:additional_vetoes">12.5. Additional detector features as vetoes</a></li>
<li>  <a href="./background.html#sec:background:all_vetoes_combined">12.6. Background rates of combined vetoes and efficiencies</a></li>
</ul>
</li>
<li><a href="./limit.html#sec:limit">13. Limit calculation   <span class="tag">  <span class="Limit">Limit</span></span></a>
<ul>
<li>  <a href="./limit.html#sec:limit:method_introduction">13.1. Limit method - introduction</a></li>
<li>  <a href="./limit.html#sec:limit:method_likelihood">13.2. Limit method - likelihood function \(\mathcal{L}\)</a></li>
<li>  <a href="./limit.html#sec:limit:method_computing_L">13.3. Limit method - computing \(\mathcal{L}\)</a></li>
<li>  <a href="./limit.html#sec:limit:method_computing_a_limit">13.4. Limit method - computing a limit</a></li>
<li>  <a href="./limit.html#sec:limit:method_expected_limit">13.5. Limit method - toy candidate sets and expected limits</a></li>
<li>  <a href="./limit.html#sec:limit:method_systematics">13.6. Limit method - extending \(\mathcal{L}\) for systematics</a></li>
<li>  <a href="./limit.html#sec:limit:method_mcmc">13.7. Limit method - evaluating \(\mathcal{L}\) with nuisance parameters</a></li>
<li>  <a href="./limit.html#orgc19f576">13.8. Note about likelihood integral   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./limit.html#org2a59043">13.9. Derivation of short form of \(\mathcal{L}\) <code>[/]</code>   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./limit.html#sec:limit:ingredients">13.10. Likelihood ingredients in detail</a></li>
<li>  <a href="./limit.html#sec:limit:systematics">13.11. Systematics</a></li>
<li>  <a href="./limit.html#sec:limit:mcmc_calc_limit">13.12. MCMC to sample the distribution and compute a limit</a></li>
<li>  <a href="./limit.html#sec:limit:expected_limits">13.13. Expected limits of different setups</a></li>
<li>  <a href="./limit.html#sec:limit:candidates">13.14. Solar tracking candidates</a></li>
<li>  <a href="./limit.html#sec:limit:observed_limit">13.15. Observed limit - \(g_{ae}\)</a></li>
<li>  <a href="./limit.html#sec:limit:other_couplings">13.16. Other coupling constants</a></li>
<li>  <a href="./limit.html#org0e96f12">13.17. Comparison to 2013 limit (using their method)   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./limit.html#orgfc85c61">13.18. Observed limit for different axion masses   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li>  <a href="./outlook.html#sec:outlook">14. Outlook</a></li>
<li>  <a href="./summary.html#sec:summary">15. Summary &amp; conclusion</a></li>
<li>  <a href="./bibliography.html#sec:bibliography">16. Bibliography   <span class="tag">    <span class="html">html</span>  </span></a></li>
<li><a href="./daq.html#sec:daq">17. Data acquisition and detector monitoring   <span class="tag"><span class="Appendix">Appendix</span> <span class="Detector">Detector</span></span></a>
<ul>
<li>  <a href="./daq.html#sec:daq:tof">17.1. Timepix Operating Firmware - TOF</a></li>
<li>  <a href="./daq.html#sec:daq:tos">17.2. Timepix Operating Software - TOS</a></li>
<li>  <a href="./daq.html#sec:daq:septemboard_event_display">17.3. Septemboard event display</a></li>
</ul>
</li>
<li><a href="./configuration.html#sec:appendix:configuration">18. Configuration and TOS / TOF versions   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./configuration.html#sec:appendix:configuration:tos_config">18.1. TOS configuration file</a></li>
<li>  <a href="./configuration.html#sec:appendix:configuration:tos_tof_versions">18.2. TOS and TOF versions used at CAST</a></li>
</ul>
</li>
<li><a href="./calibration.html#sec:appendix:calibration">19. Calibrations   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./calibration.html#sec:appendix:calibration:timepix">19.1. Timepix calibrations</a></li>
<li>  <a href="./calibration.html#sec:appendix:septemboard_calibrations">19.2. Septemboard calibration</a></li>
<li>  <a href="./calibration.html#sec:appendix:scintillator_calibration_notes">19.3. Calibration measurements of the veto scintillator paddle   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li><a href="./cast_operations.html#sec:appendix:cast_operations">20. CAST operation procedures   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./cast_operations.html#sec:appendix:cast_operations:terminology">20.1. CAST terminology</a></li>
<li>  <a href="./cast_operations.html#sec:cast:high_voltage">20.2. High voltage supply</a></li>
<li>  <a href="./cast_operations.html#sec:cast:vacuum_system">20.3. Vacuum system</a></li>
<li>  <a href="./cast_operations.html#sec:cast:watercooling_gas">20.4. Watercooling system &amp; gas supply</a></li>
<li>  <a href="./cast_operations.html#sec:cast:interlock_systems">20.5. Interlock systems</a></li>
<li>  <a href="./cast_operations.html#sec:appendix:cast_log_files">20.6. CAST log files</a></li>
</ul>
</li>
<li><a href="./cast_run_list.html#sec:appendix:cast_run_list">21. CAST data taking run list   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./cast_run_list.html#orgb33251e">21.1. Full version   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li><a href="./cast_data_taking_notes.html#sec:appendix:cast_data_taking_notes">22. CAST data taking notes <code>[0/1]</code>   <span class="tag"><span class="Appendix">Appendix</span> <span class="extended">extended</span></span></a>
<ul>
<li>  <a href="./cast_data_taking_notes.html#org05f7e0f">22.1. Run table</a></li>
<li>  <a href="./cast_data_taking_notes.html#org7394dc2">22.2. Data runs</a></li>
<li>  <a href="./cast_data_taking_notes.html#orgdb2c57f">22.3. Calibration runs</a></li>
<li>  <a href="./cast_data_taking_notes.html#orgb70c00a">22.4. Automatically generated run list</a></li>
<li>  <a href="./cast_data_taking_notes.html#org6e5236a">22.5. Automatically calculated total run times</a></li>
<li>  <a href="./cast_data_taking_notes.html#orgcc95a0e">22.6. InGrid temperature from shift forms</a></li>
</ul>
</li>
<li><a href="./cabling_and_softwar_setup.html#sec:appendix:cabling_and_softwar_setup">23. Cabling &amp; software setup <code>[/]</code>   <span class="tag"><span class="Appendix">Appendix</span> <span class="extended">extended</span></span></a>
<ul>
<li>  <a href="./cabling_and_softwar_setup.html#org1b11899">23.1. Virtex V6 cabling</a></li>
<li>  <a href="./cabling_and_softwar_setup.html#orgd7f1578">23.2. Detector cabling</a></li>
<li>  <a href="./cabling_and_softwar_setup.html#orga067de2">23.3. Vivado / ISE on void linux &amp; flashing Virtex V6</a></li>
<li>  <a href="./cabling_and_softwar_setup.html#org161062c">23.4. Setting up the chips in TOS</a></li>
</ul>
</li>
<li><a href="./vacuum_contamination.html#sec:appendix:vacuum_contamination">24. Window rupture and vacuum contamination   <span class="tag"><span class="Appendix">Appendix</span> <span class="extended">extended</span></span></a>
<ul>
<li>  <a href="./vacuum_contamination.html#orgc569a37">24.1. Calculation of vacuum volume</a></li>
<li>  <a href="./vacuum_contamination.html#org15cc216">24.2. Calculation of potential influx of gas</a></li>
<li>  <a href="./vacuum_contamination.html#org8ea925c">24.3. Consider pumping of pumps</a></li>
<li>  <a href="./vacuum_contamination.html#org819d69c">24.4. Calculation of possible contamination</a></li>
</ul>
</li>
<li><a href="./detector_time_behavior.html#sec:appendix:detector_time_behavior">25. Detector behavior over time   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./detector_time_behavior.html#sec:appendix:choice_gas_gain_binning">25.1. Choice of gas gain binning time interval</a></li>
<li>  <a href="./detector_time_behavior.html#sec:appendix:correlation_gas_gain_ambient_temp">25.2. Correlation of gas gain and ambient CAST temperature</a></li>
</ul>
</li>
<li><a href="./cast_detector_lab.html#sec:appendix:cast_detector_lab">26. CAST Detector Lab data   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./cast_detector_lab.html#orga19ac1b">26.1. Generate all spectrum plots split by run   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./cast_detector_lab.html#sec:appendix:cdl_spectra_by_run">26.2. All spectra split by run</a></li>
<li>  <a href="./cast_detector_lab.html#sec:appendix:cdl:all_spectra_fits">26.3. All CDL spectra with line fits   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./cast_detector_lab.html#sec:appendix:cdl:all_spectra_fits_by_run">26.4. All CDL spectra with line fits by run</a></li>
</ul>
</li>
<li><a href="./fit_by_run_justification.html#sec:appendix:fit_by_run_justification">27. CAST Detector Lab variations and fitting by run   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./fit_by_run_justification.html#sec:appendix:fit_by_run:gas_gain_var_cluster_prop">27.1. Influence of gas gain variations on cluster properties</a></li>
</ul>
</li>
<li><a href="./morphing_cdl_spectra.html#sec:appendix:morphing_cdl_spectra">28. Morphing of CDL reference spectra   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./morphing_cdl_spectra.html#org0265ab6">28.1. Generate all morphing / tile related plots   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./morphing_cdl_spectra.html#org8bc5717">28.2. Generate plot comparing likelihood behavior   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./morphing_cdl_spectra.html#sec:appendix:morphing_cdl_spectra:tilemaps">28.3. Tilemap of each likelihood dataset</a></li>
<li>  <a href="./morphing_cdl_spectra.html#sec:appendix:morphing_cdl_spectra:interpolation_raster">28.4. Interpolation of each likelihood dataset</a></li>
<li>  <a href="./morphing_cdl_spectra.html#sec:appendix:morphing_cdl_spectra:binwise_linear">28.5. Binwise linear interpolations for each likelihood dataset</a></li>
<li>  <a href="./morphing_cdl_spectra.html#sec:appendix:morphing_cdl_spectra:notes">28.6. Notes on CDL morphing development   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li><a href="./occupancy.html#sec:appendix:occupancy">29. Occupancy maps   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./occupancy.html#org479bdea">29.1. Run-2</a></li>
<li>  <a href="./occupancy.html#org01c4816">29.2. Run-3</a></li>
<li>  <a href="./occupancy.html#org4b0d778">29.3. Generate occupancy map plots   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li><a href="./fadc.html#sec:appendix:fadc">30. FADC   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./fadc.html#sec:appendix:fadc:rise_fall">30.1. FADC rise and fall time</a></li>
<li>  <a href="./fadc.html#sec:appendix:background:fadc">30.2. FADC veto</a></li>
<li>  <a href="./fadc.html#orgbca5f22">30.3. Generate plot of rise time vs skewness   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./fadc.html#sec:appendix:fadc_veto_empirical_cluster_length">30.4. Expected cluster size</a></li>
</ul>
</li>
<li><a href="./background_rates.html#sec:appendix:background_rates">31. Raw data and background rates   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./background_rates.html#sec:appendix:background_rates:full_chip">31.1. Background rates over full chip</a></li>
<li>  <a href="./background_rates.html#orgef7b3d8">31.2. Generate rate without any vetoes over full chip   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./background_rates.html#org6d2bec5">31.3. Generate background rates over full chip   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./background_rates.html#orga3f0df1">31.4. Generate table of background rates for all setups   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li>  <a href="./background_interpolation_chip_area.html#sec:appendix:background_interpolation_chip_area">32. Background interpolation chip cutout correction   <span class="tag">    <span class="Appendix">Appendix</span>  </span></a></li>
<li><a href="./limit_additional.html#sec:appendix:limit_additional">33. Additional limit information   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./limit_additional.html#sec:appendix:conversion_probability">33.1. Conversion probability as a function of mass   <span class="tag">    <span class="Appendix">Appendix</span>  </span></a></li>
<li>  <a href="./limit_additional.html#sec:appendix:exp_limit_percentiles">33.2. Expected limit table with percentiles</a></li>
<li>  <a href="./limit_additional.html#sec:appendix:limit_additional:axion_photon">33.3. Observed limit - axion photon \(g_{aγ}\)</a></li>
<li>  <a href="./limit_additional.html#sec:appendix:limit_additional:chameleon">33.4. Observed limit - chameleon \(β_γ\)</a></li>
</ul>
</li>
<li><a href="./software.html#sec:appendix:software">34. Software   <span class="tag"><span class="Software">Software</span> <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./software.html#org7bca65c">34.1. Why did I start writing my own analysis framework?   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./software.html#org9f0a545">34.2. Nim   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./software.html#sec:appendix:timepix_analysis">34.3. TimepixAnalysis</a></li>
<li>  <a href="./software.html#org400c48e">34.4. Other libraries relevant for TimepixAnalysis</a></li>
</ul>
</li>
<li><a href="./full_data_reconstruction.html#sec:appendix:full_data_reconstruction">35. Full data reconstruction   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./full_data_reconstruction.html#orge240f30">35.1. Raw data parsing and reconstruction</a></li>
<li>  <a href="./full_data_reconstruction.html#orgb93cc52">35.2. Parse and reconstruct the CDL data</a></li>
<li>  <a href="./full_data_reconstruction.html#orga74a5b7">35.3. Add tracking information to background files</a></li>
<li>  <a href="./full_data_reconstruction.html#org9829d57">35.4. Using <code>runAnalysisChain</code></a></li>
<li>  <a href="./full_data_reconstruction.html#orgdb12e28">35.5. Applying a classifier</a></li>
<li>  <a href="./full_data_reconstruction.html#org1e93ed8">35.6. Computing limits</a></li>
</ul>
</li>
<li><a href="./average_depth_xrays_argon.html#sec:appendix:average_depth_xrays_argon">36. Average distance X-rays travel in argon at CAST conditions   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./average_depth_xrays_argon.html#orgd6eb4a8">36.1. Reference to original document   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./average_depth_xrays_argon.html#orgebfb8f7">36.2. Calculate conversion point numerically</a></li>
<li>  <a href="./average_depth_xrays_argon.html#org3327d77">36.3. Compiling and running the code   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li><a href="./raytracing.html#sec:appendix:raytracing">37. Raytracing   <span class="tag"><span class="Software">Software</span> <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./raytracing.html#sec:appendix:raytracing:traxer">37.1. TrAXer - An interactive axion raytracer</a></li>
<li>  <a href="./raytracing.html#sec:appendix:raytracing:llnl_telescope">37.2. A few more details about the LLNL telescope</a></li>
<li>  <a href="./raytracing.html#sec:appendix:raytracing:panter">37.3. Comparison of TrAXer results with PANTER measurements</a></li>
<li>  <a href="./raytracing.html#sec:appendix:raytracing:axion_image">37.4. Computing an axion image with TrAXer</a></li>
<li>  <a href="./raytracing.html#org1352117">37.5. Reproducing an X-ray finger run with TrAXer   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./raytracing.html#org06f5b15">37.6. Figure error development notes   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li>  <a href="./acknowledgments.html#sec:appendix:acknowledgments">38. Acknowledgments   <span class="tag">    <span class="Ack">Ack</span>  </span></a></li>
</ul>
</div>
</nav>
<div class="outline-2" id="outline-container-sec:appendix:full_data_reconstruction">
<h2 id="sec:appendix:full_data_reconstruction"><span class="section-number-2">35.</span> Full data reconstruction   <span class="tag">  <span class="Appendix">Appendix</span></span></h2>
<div class="outline-text-2" id="text-sec:appendix:full_data_reconstruction">
<p>
We will now go over how to fully reconstruct all CAST data from the
Run-2 and Run-3 data taking campaigns all the way up to the
computation of the observed limit. This assumes the following:
</p>

<ul class="org-ul">
<li>all CAST data files are located in a directory accessible by a
<code>DATA</code> environment variable. Inside should be the directory
structure containing directories <code>2017</code>, <code>2018</code>, <code>2018_2</code> and
<code>CDL_2019</code> as downloaded from Zenodo (<a href="./bibliography.html#citeproc_bib_item_198">Schmidt 2024</a>).</li>
<li>all binaries used below are compiled and their location is in your
<code>PATH</code> variable. There is a <code>bin</code> directory in the repository root,
which contains symbolic links to the binaries if they are placed
next to the source file. I recommend adding this directory to your
<code>PATH</code>.</li>
</ul>

<blockquote>
<p>
Note: There is also the <code>Analysis/ingrid/runAnalysisChain</code> program,
which automates a majority of these calls. See the section below on
how it replaces the data parsing and reconstruction. Here I wish to
illustrate the actual steps and don&apos;t hide any.
</p>
</blockquote>

<p>
Furthermore, the commands below produce the correct results assuming
the <code>Analysis/ingrid/config.toml</code> file is used as committed as part of
the <code>phd</code> tag in the TimepixAnalysis repository.
</p>
</div>

<div class="outline-3" id="outline-container-orge240f30">
<h3 id="orge240f30"><span class="section-number-3">35.1.</span> Raw data parsing and reconstruction</h3>
<div class="outline-text-3" id="text-35-1">
<p>
If this is all in place, first perform the raw data parsing. 
</p>

<p>
Run-2, background and calibration:
</p>
<div class="org-src-container">
<pre class="src src-sh">raw_data_manipulation -p $<span style="color: #FD971F;">DATA</span>/2017/DataRuns <span style="color: #E6DB74; font-weight: bold;">\</span>
                      --runType rtBackground <span style="color: #E6DB74; font-weight: bold;">\</span>
                      --out $<span style="color: #FD971F;">DATA</span>/DataRuns2017_Raw.h5
raw_data_manipulation -p $<span style="color: #FD971F;">DATA</span>/2017/CalibrationRuns <span style="color: #E6DB74; font-weight: bold;">\</span>
                      --runType rtCalibration <span style="color: #E6DB74; font-weight: bold;">\</span>
                      --out $<span style="color: #FD971F;">DATA</span>/DataRuns2017_Raw.h5
</pre>
</div>

<p>
Run-3:
</p>
<div class="org-src-container">
<pre class="src src-sh">raw_data_manipulation -p $<span style="color: #FD971F;">DATA</span>/2018_2/DataRuns <span style="color: #E6DB74; font-weight: bold;">\</span>
                      --runType rtBackground <span style="color: #E6DB74; font-weight: bold;">\</span>
                      --out $<span style="color: #FD971F;">DATA</span>/DataRuns2018_Raw.h5
raw_data_manipulation -p $<span style="color: #FD971F;">DATA</span>/2018_2/CalibrationRuns <span style="color: #E6DB74; font-weight: bold;">\</span>
                      --runType rtCalibration <span style="color: #E6DB74; font-weight: bold;">\</span>
                      --out $<span style="color: #FD971F;">DATA</span>/DataRuns2018_Raw.h5
</pre>
</div>

<p>
Next, the initial data reconstruction (geometric properties):
</p>

<p>
Run-2:
</p>
<div class="org-src-container">
<pre class="src src-sh">reconstruction -i $<span style="color: #FD971F;">DATA</span>/DataRuns2017_Raw.h5 <span style="color: #E6DB74; font-weight: bold;">\</span>
               -o $<span style="color: #FD971F;">DATA</span>/DataRuns2017_Reco.h5
reconstruction -i $<span style="color: #FD971F;">DATA</span>/CalibrationRuns2017_Raw.h5 <span style="color: #E6DB74; font-weight: bold;">\</span>
               -o $<span style="color: #FD971F;">DATA</span>/CalibrationRuns2017_Reco.h5
</pre>
</div>
<p>
Run-3:
</p>
<div class="org-src-container">
<pre class="src src-sh">reconstruction -i $<span style="color: #FD971F;">DATA</span>/DataRuns2018_Raw.h5 <span style="color: #E6DB74; font-weight: bold;">\</span>
               -o $<span style="color: #FD971F;">DATA</span>/DataRuns2018_Reco.h5
reconstruction -i $<span style="color: #FD971F;">DATA</span>/CalibrationRuns2018_Raw.h5 <span style="color: #E6DB74; font-weight: bold;">\</span>
               -o $<span style="color: #FD971F;">DATA</span>/CalibrationRuns2018_Reco.h5
</pre>
</div>

<p>
Now, the next steps of the reconstruction (charge calibration, gas
gain and FADC reconstruction):
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #FD971F;">DATA</span>=~/CastData/data
<span style="color: #F92672;">for</span> typ<span style="color: #F92672;"> in</span> Data Calibration; <span style="color: #F92672;">do</span>
    <span style="color: #F92672;">for</span> year<span style="color: #F92672;"> in</span> 2017 2018; <span style="color: #F92672;">do</span>
        <span style="color: #FD971F;">file</span>=<span style="color: #E6DB74;">&quot;${DATA}/${typ}Runs${year}_Reco.h5&quot;</span>
        reconstruction -i $<span style="color: #FD971F;">file</span> --only_charge
        reconstruction -i $<span style="color: #FD971F;">file</span> --only_fadc
        reconstruction -i $<span style="color: #FD971F;">file</span> --only_gas_gain
    <span style="color: #F92672;">done</span>
<span style="color: #F92672;">done</span>
</pre>
</div>

<p>
where we simply loop over the <code>Data</code> and <code>Calibration</code> prefixes and
years.
</p>

<p>
With this done, we can perform the \cefe calibration fits:
</p>
<div class="org-src-container">
<pre class="src src-sh">reconstruction -i $<span style="color: #FD971F;">DATA</span>/CalibrationRuns2017_Reco.h5 --only_fe_spec
reconstruction -i $<span style="color: #FD971F;">DATA</span>/CalibrationRuns2018_Reco.h5 --only_fe_spec
</pre>
</div>
<p>
and then finally the fit of energy calibration factors determined from
each fit against its gas gain:
</p>
<div class="org-src-container">
<pre class="src src-sh">reconstruction -i $<span style="color: #FD971F;">DATA</span>/CalibrationRuns2017_Reco.h5 --only_gain_fit
reconstruction -i $<span style="color: #FD971F;">DATA</span>/CalibrationRuns2018_Reco.h5 --only_gain_fit
</pre>
</div>

<p>
This then allows to calibrate the energy for each file:
</p>
<div class="org-src-container">
<pre class="src src-sh">reconstruction -i $<span style="color: #FD971F;">DATA</span>/DataRuns2017_Reco.h5 --only_energy_from_e
reconstruction -i $<span style="color: #FD971F;">DATA</span>/DataRuns2018_Reco.h5 --only_energy_from_e
reconstruction -i $<span style="color: #FD971F;">DATA</span>/CalibrationRuns2017_Reco.h5 --only_energy_from_e
reconstruction -i $<span style="color: #FD971F;">DATA</span>/CalibrationRuns2018_Reco.h5 --only_energy_from_e
</pre>
</div>
</div>
</div>

<div class="outline-3" id="outline-container-orgb93cc52">
<h3 id="orgb93cc52"><span class="section-number-3">35.2.</span> Parse and reconstruct the CDL data</h3>
<div class="outline-text-3" id="text-35-2">
<p>
In order to use the likelihood cut method we also need to parse and
reconstruct the CDL data. Note that this can be done before even
reconstructing any of the CAST data files (with the exception of
<code>--only_energy_from_e</code>, which is optional anyway).
</p>
<div class="org-src-container">
<pre class="src src-sh">raw_data_manipulation -p $<span style="color: #FD971F;">DATA</span>/CDL_2019/ -r Xray -o $<span style="color: #FD971F;">DATA</span>/CDL_2019/CDL_2019_Raw.h5
reconstruction -i $<span style="color: #FD971F;">DATA</span>/CDL_2019/CDL_2019_Raw.h5 -o $<span style="color: #FD971F;">DATA</span>/CDL_2019/CDL_2019_Reco.h5
reconstruction -i $<span style="color: #FD971F;">DATA</span>/CDL_2019/CDL_2019_Reco.h5 --only_charge
reconstruction -i $<span style="color: #FD971F;">DATA</span>/CDL_2019/CDL_2019_Reco.h5 --only_fadc
reconstruction -i $<span style="color: #FD971F;">DATA</span>/CDL_2019/CDL_2019_Reco.h5 --only_gas_gain
reconstruction -i $<span style="color: #FD971F;">DATA</span>/CDL_2019/CDL_2019_Reco.h5 --only_energy_from_e
</pre>
</div>

<p>
With this file we can then run <code>cdl_spectrum_calibration</code> in order to
produce the <code>calibration-cdl-2018.h5</code> file:
</p>
<div class="org-src-container">
<pre class="src src-sh">cdl_spectrum_creation $<span style="color: #FD971F;">DATA</span>/CDL_2019/CDL_2019_reco.h5 <span style="color: #E6DB74; font-weight: bold;">\</span>
                      --genCdlFile --year=2018
</pre>
</div>
</div>
</div>

<div class="outline-3" id="outline-container-orga74a5b7">
<h3 id="orga74a5b7"><span class="section-number-3">35.3.</span> Add tracking information to background files</h3>
<div class="outline-text-3" id="text-35-3">
<p>
To add the tracking information, the CAST log files are needed. The
default path (which may be a symbolic link of course) is in
<code>resources/LogFiles/tracking-logs</code> from the TimepixAnalysis root. 
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #F92672;">for</span> year<span style="color: #F92672;"> in</span> 2017 2018; <span style="color: #F92672;">do</span>
    cast_log_reader tracking <span style="color: #E6DB74; font-weight: bold;">\</span>
                -p $<span style="color: #FD971F;">TPXDIR</span>/resources/LogFiles/tracking-logs <span style="color: #E6DB74; font-weight: bold;">\</span>
                --startTime <span style="color: #E6DB74;">&quot;2017/01/01&quot;</span> <span style="color: #E6DB74; font-weight: bold;">\</span>
                --endTime <span style="color: #E6DB74;">&quot;2018/12/31&quot;</span> <span style="color: #E6DB74; font-weight: bold;">\</span>
                --h5out <span style="color: #E6DB74;">&quot;${DATA}/DataRuns${year}_Reco.h5&quot;</span>
<span style="color: #F92672;">done</span>
</pre>
</div>

<p>
Here we assume <code>TPXDIR</code> is an environment variable to the root of the
TimepixAnalysis repository. Feel free to adjust if your path differs.
</p>
</div>
</div>

<div class="outline-3" id="outline-container-org9829d57">
<h3 id="org9829d57"><span class="section-number-3">35.4.</span> Using <code>runAnalysisChain</code></h3>
<div class="outline-text-3" id="text-35-4">
<p>
All of the commands above can also be performed in one by using <code>runAnalysisChain</code>:
</p>
<div class="org-src-container">
<pre class="src src-sh">./runAnalysisChain <span style="color: #E6DB74; font-weight: bold;">\</span>
    -i $<span style="color: #FD971F;">DATA</span> <span style="color: #E6DB74; font-weight: bold;">\</span>
    --outpath $<span style="color: #FD971F;">DATA</span> <span style="color: #E6DB74; font-weight: bold;">\</span>
    --years 2017 --years 2018 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --calib --back --cdl <span style="color: #E6DB74; font-weight: bold;">\</span>
    --raw --reco <span style="color: #E6DB74; font-weight: bold;">\</span>
    --logL <span style="color: #E6DB74; font-weight: bold;">\</span>
    --tracking
</pre>
</div>
<p>
which tells the <code>runAnalysisChain</code> helper to parse all data files for
Run-2 and Run-3, do the same for the CDL data files, reconstruct with
all steps, compute the likelihood values and add the tracking
information to the background data files. It makes the same
assumptions about the location of the data files as in the above.
</p>

<p>
In particular, if the tracking log files are in a different location,
add the <code>--trackingLogs</code> argument to the above with the correct path.
</p>
</div>
</div>

<div class="outline-3" id="outline-container-orgdb12e28">
<h3 id="orgdb12e28"><span class="section-number-3">35.5.</span> Applying a classifier</h3>
<div class="outline-text-3" id="text-35-5">
<p>
To apply a classifier we use the <code>likelihood</code> program. We will show
how to apply it for one file now here. Generally, manual calling of
<code>likelihood</code> is not needed, more on that below.
</p>

<p>
Let&apos;s apply the likelihood cut method using all vetoes for the Run-2
data:
</p>
<div class="org-src-container">
<pre class="src src-sh">likelihood <span style="color: #E6DB74; font-weight: bold;">\</span>
    -f $<span style="color: #FD971F;">DATA</span>/DataRuns2017_Reco.h5 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --h5out $<span style="color: #FD971F;">DATA</span>/classifier/run2_lnL_80_all_vetoes.h5 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --region=crAll <span style="color: #E6DB74; font-weight: bold;">\</span>
    --cdlYear=2018 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --lnL --signalEfficiency=0.8 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --scintiveto --fadcveto --septemveto --lineveto <span style="color: #E6DB74; font-weight: bold;">\</span>
    --vetoPercentile=0.99 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --cdlFile=$<span style="color: #FD971F;">DATA</span>/CDL_2019/calibration-cdl-2018.h5 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --calibFile=$<span style="color: #FD971F;">DATA</span>/CalibrationRuns2017_Reco.h5
</pre>
</div>
<p>
which should be mostly self explanatory. The <code>--signalEfficiency</code>
argument is the software efficiency of the likelihood
cut. <code>--vetoPercentile</code> refers to the FADC veto cut. The method is
applied to the entire center chip (<code>--region=crAll</code>). A <code>--tracking</code>
flag could be added to apply the classifier only to the tracking data
(in this case it is applied only to <i>non</i> tracking data).
</p>

<p>
As explained in sec. <a href="./background.html#sec:background:all_vetoes_combined">12.6</a>, many
different veto setups were considered. For this reason a helper tool
<code>createAllLikelihoodCombinations</code> (excuse the verbose name, heh)
exists to simplify the process of calling <code>likelihood</code>. It is located
in the <code>Analysis</code> directory.
</p>

<p>
For example:
</p>
<div class="org-src-container">
<pre class="src src-sh">./createAllLikelihoodCombinations <span style="color: #E6DB74; font-weight: bold;">\</span>
    --f2017 $<span style="color: #FD971F;">DATA</span>/DataRuns2017_Reco.h5 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --f2018 $<span style="color: #FD971F;">DATA</span>/DataRuns2018_Reco.h5 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --c2017 $<span style="color: #FD971F;">DATA</span>/CalibrationRuns2017_Reco.h5 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --c2018 $<span style="color: #FD971F;">DATA</span>/CalibrationRuns2018_Reco.h5 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --regions crAll <span style="color: #E6DB74; font-weight: bold;">\</span>
    --vetoSets <span style="color: #E6DB74;">&quot;{fkMLP, fkFadc, fkScinti, fkSeptem, fkLineVeto, fkExclusiveLineVeto}&quot;</span> <span style="color: #E6DB74; font-weight: bold;">\</span>
    --mlpPath $<span style="color: #FD971F;">MLP</span>/&lt;mlp_of_choice&gt;.pt <span style="color: #E6DB74; font-weight: bold;">\</span>
    --fadcVetoPercentile 0.99 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --signalEfficiency 0.85 --signalEfficiency 0.90 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --signalEfficiency 0.95 --signalEfficiency 0.98 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --out $<span style="color: #FD971F;">DATA</span>/classifier/mlp <span style="color: #E6DB74; font-weight: bold;">\</span>
    --cdlFile $<span style="color: #FD971F;">DATA</span>/CDL_2019/calibration-cdl-2018.h5 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --multiprocessing <span style="color: #E6DB74; font-weight: bold;">\</span>
    --jobs 6 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --dryRun
</pre>
</div>

<p>
would apply the MLP classifier (here with a dummy name) with
successive additions of all vetoes in <code>vetoSets</code> at 4 different signal
efficiencies and store the HDF5 output files in
<code>DATA/classifier/mlp</code>. Multiple <code>vetoSets</code> arguments can be given in
one call. Also each <code>fk</code> entry can be prefixed with a <code>+</code> to indicate
that this veto should not be run on its own. This allows
flexibility. As indicated by <code>--multiprocessing</code> and <code>--jobs 6</code> this
would run 6 processes in parallel. Note that each process can peak at
up to 10 GB of RAM (depending on the used classifier and vetoes).
</p>
</div>
</div>

<div class="outline-3" id="outline-container-org1e93ed8">
<h3 id="org1e93ed8"><span class="section-number-3">35.6.</span> Computing limits</h3>
<div class="outline-text-3" id="text-35-6">
<p>
To compute limits we now feed each of the produced HDF5 output files
of the <code>likelihood</code> program (in pairs including Run-2 and Run-3 output
files) into <code>mcmc_limit_calculation</code>. As the number of combinations
can be quite large, this can again be automated using the
<code>Analysis/runLimits</code> program.
</p>

<p>
Let&apos;s continue with the example from above and pretend we wish to run
<code>1000</code> toy candidate sets for each input pair, but only those that
include the line veto. This can be accomplished by using the
<code>--prefix</code> argument to <code>runLimits</code>, which understands standard glob patterns. 
</p>
<div class="org-src-container">
<pre class="src src-sh">./runLimits <span style="color: #E6DB74; font-weight: bold;">\</span>
    --path $<span style="color: #FD971F;">DATA</span>/classifier/mlp <span style="color: #E6DB74; font-weight: bold;">\</span>
    --prefix <span style="color: #E6DB74;">&quot;lhood_c18_R2_crAll_*line*&quot;</span> <span style="color: #E6DB74; font-weight: bold;">\</span>
    --exclude <span style="color: #E6DB74;">&quot;_septem_&quot;</span> <span style="color: #E6DB74; font-weight: bold;">\</span>
    --outpath $<span style="color: #FD971F;">DATA</span>/limits/mlp/ <span style="color: #E6DB74; font-weight: bold;">\</span>
    --energyMin 0.2 --energyMax 12.0 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --axionModel &lt;path_to_differential_axion_flux&gt;.csv <span style="color: #E6DB74; font-weight: bold;">\</span>
    --axionImage &lt;path_to_axion_image&gt;.csv <span style="color: #E6DB74; font-weight: bold;">\</span>
    --combinedEfficiencyFile &lt;path_to_detection_efficiency&gt;.csv <span style="color: #E6DB74; font-weight: bold;">\</span>
    --switchAxes <span style="color: #E6DB74; font-weight: bold;">\</span>
    --nmc 1000 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --dryRun
</pre>
</div>

<p>
Note that the CSV files mentioned here are found in the <code>resources</code>
directory of the repository of this thesis. See the extended thesis on
how to produce them.
</p>

<p>
To produce the observed limit, we run:
</p>
<div class="org-src-container">
<pre class="src src-sh">mcmc_limit_calculation <span style="color: #E6DB74; font-weight: bold;">\</span>
    <span style="color: #F92672;">limit</span> <span style="color: #E6DB74; font-weight: bold;">\</span>
    -f &lt;path_to_background_run2&gt;.h5 <span style="color: #E6DB74; font-weight: bold;">\</span>
    -f &lt;path_to_background_run3&gt;.h5 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --tracking &lt;path_to_tracking_run2&gt;.h5 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --tracking &lt;path_to_tracking_run3&gt;.h5 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --axionModel &lt;path_to_differential_axion_flux&gt;.csv <span style="color: #E6DB74; font-weight: bold;">\</span>
    --axionImage &lt;path_to_axion_image&gt;.csv <span style="color: #E6DB74; font-weight: bold;">\</span>
    --combinedEfficiencyFile &lt;path_to_detection_efficiency&gt;.csv <span style="color: #E6DB74; font-weight: bold;">\</span>
    --switchAxes <span style="color: #E6DB74; font-weight: bold;">\</span>
    --path <span style="color: #E6DB74;">&quot;&quot;</span> <span style="color: #E6DB74; font-weight: bold;">\</span>
    --years 2017 --years 2018 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --σ_p 0.05 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --energyMin 0.2 --energyMax 12.0 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --limitKind lkMCMC <span style="color: #E6DB74; font-weight: bold;">\</span>
    --outpath ~/phd/Figs/trackingCandidates/ <span style="color: #E6DB74; font-weight: bold;">\</span>
    --suffix <span style="color: #E6DB74;">&quot;&quot;</span>
</pre>
</div>

<p>
where the <code>&lt;path_to_*_run&gt;</code> refers to the output HDF5 file of the
<code>likelihood</code> program for the best setup as described in
sec. <a href="./limit.html#sec:limit:expected_limits">13.13</a>. <code>--σ_p</code> refers to the position
uncertainty to use. The signal and background uncertainties have the
real value placed as the default.
</p>

<p>
With this done, you have successfully reproduced the entire final
results of the thesis! As mentioned in chapter <a href="./about_thesis.html#sec:about_thesis">3</a>, see
the extended thesis for commands, code snippets and more information
about how each figure and table is produced exactly.
</p>
</div>

<div class="outline-4" id="outline-container-org374cb7a">
<h4 id="org374cb7a"><span class="section-number-4">35.6.1.</span> Produce the axion model, axion image and detection efficiency file   <span class="tag">  <span class="extended">extended</span></span></h4>
<div class="outline-text-4" id="text-35-6-1">
<p>
For the axion model and axion image, see
sec. <a href="./raytracing.html#sec:appendix:raytracing:generate_axion_image">37.4.3</a>. For the detection
efficiency see sec. <a href="sec:limit:ingredients:gen_detection_eff">13.10.4.4.1</a>.
</p>
</div>
</div>
</div>
</div>


<div class="hint-message">Click on any heading marked '<span class="extended">extended</span>' to open it</div>
</div>
</body>
</html>
