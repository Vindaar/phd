<!DOCTYPE html>
<html lang="en">
<head>
<!--  2024-06-25 Tue 13:17  -->
<meta charset="utf-8" />
<meta content="width=device-width, initial-scale=1" name="viewport" />
<title>‎</title>
<meta content="Vindaar" name="author" />
<meta content="Org Mode" name="generator" />

<link type="text/css" rel="stylesheet" href="org_html_export.css" />
<script type="text/javascript">

document.addEventListener('DOMContentLoaded', function() {
    // Set the initial width for subfigures and their images
    document.querySelectorAll('figure.subfigure[data-width]').forEach(function(subfigure) {
        subfigure.style.width = subfigure.getAttribute('data-width');
    });

    document.querySelectorAll('figure.subfigure img[data-width]').forEach(function(img) {
        img.style.width = img.getAttribute('data-width');
    });

    // Event listener for images within subfigures
    document.querySelectorAll('figure.subfigure img[data-width]').forEach(function(img) {
        img.addEventListener('click', function() {
            // Determine the .figure-wrapper that contains the clicked image
            let wrapper = this.closest('.figure-wrapper');

            // If found, adjust the sizes of its subfigures
            if (wrapper) {
                let subfigures = wrapper.querySelectorAll('figure.subfigure');
                subfigures.forEach(subfigure => {
                    let width = parseFloat(subfigure.getAttribute('data-width'));
                    if (width < 50) { // Double size if less than 50%
                        subfigure.setAttribute('data-width', (width * 2) + '%');
                        subfigure.style.width = (width * 2) + '%';
                    } else { // Halve size otherwise
                        subfigure.setAttribute('data-width', (width / 2) + '%');
                        subfigure.style.width = (width / 2) + '%';
                    }
                });
            }
        });
    });
});

document.addEventListener('DOMContentLoaded', function () {
    var headers = document.querySelectorAll('h1 .extended, h2 .extended, h3 .extended, h4 .extended, h5 .extended, h6 .extended');

    headers.forEach(function (header) {
        var foldableHeader = header.closest('h1, h2, h3, h4, h5, h6');
        if (foldableHeader) {
            foldableHeader.classList.add('foldable-header');
            var nextElement = foldableHeader.nextElementSibling;
            var contentToFold = [];
            while (nextElement && !nextElement.matches('h1, h2, h3, h4, h5, h6')) {
                contentToFold.push(nextElement);
                nextElement = nextElement.nextElementSibling;
            }
            contentToFold.forEach(function (element) {
                element.classList.add('folded-content');
            });

            foldableHeader.addEventListener('click', function () {
                contentToFold.forEach(function (element) {
                    if (element.style.display === 'none' || element.style.display == '') {
                        element.style.display = 'block';
                    } else {
                        element.style.display = 'none';
                    }
                });
            });
        }
    });
});

</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript"></script>
<script type="text/x-mathjax-config">
<!-- /* --><![CDATA[/*><!--*/
    MathJax.Hub.Config({
        jax: ["input/TeX", "output/HTML-CSS"],
        extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js",
                     "TeX/noUndefined.js", "[Contrib]/siunitx/siunitx.js", "[Contrib]/mhchem/mhchem.js"],
        tex2jax: {
            inlineMath: [ ["\\(","\\)"], ['$', '$'], ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"], ["\\begin{displaymath}","\\end{displaymath}"] ],
            skipTags: ["script","noscript","style","textarea","pre","code"],
            ignoreClass: "tex2jax_ignore",
            processEscapes: false,
            processEnvironments: true,
            preview: "TeX"
        },
        showProcessingMessages: true,
        displayAlign: "center",
        displayIndent: "2em",

        "HTML-CSS": {
             scale: 1.0,
             availableFonts: ["STIX","TeX"],
             preferredFont: "TeX",
             webFont: "TeX",
             imageFont: "TeX",
             showMathMenu: true,
        },
        MMLorHTML: {
             prefer: {
                 MSIE:    "MML",
                 Firefox: "MML",
                 Opera:   "HTML",
                 other:   "HTML"
             }
        },
        TeX: {
              equationNumbers: { autoNumber: 'AMS' },
              Macros: {
                  ccsini: '{\\mathrm{Si}₃\\mathrm{N}₄}',
                  cefe: '{\\ce{^{55}Fe}}',
                  vektor: ['{\\begin{pmatrix}#1\\end{pmatrix}}', 1],
                  mtrix: ['{\\begin{pmatrix}#1\\end{pmatrix}}', 1],
                  cp: '{\\mathrm{CP}}',
                  cpt: '{\\mathrm{CPT}}',
                  dd: '{\\mathop{}\\!{\\mathrm{d}}}',
                  sinc: '{\\mathrm{sinc}}'
              }
        }
    });
/*]]>*///--&gt;
</script>
</head>
<body>
<div id="content" class="content">
<nav role="doc-toc" id="table-of-contents">
<h2>Table of Contents</h2>
<div role="doc-toc" id="text-table-of-contents">
<ul>
<li>  <a href="./errata.html#sec:errata">1. Errata   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./introduction.html#sec:introduction">2. Introduction   <span class="tag">    <span class="Intro">Intro</span>  </span></a></li>
<li><a href="./about_thesis.html#sec:about_thesis">3. About this thesis   <span class="tag">  <span class="Intro">Intro</span></span></a>
<ul>
<li>  <a href="./about_thesis.html#orgaf83542">3.1. Extended notes for the extended thesis <code>[/]</code>   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./about_thesis.html#org6da08d2">3.2. Why Org mode   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./about_thesis.html#orgd04e97f">3.3. Notes for future PhD students and IAXO analyses   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li><a href="./theory.html#sec:theory">4. Theory of axions   <span class="tag">  <span class="Theory">Theory</span></span></a>
<ul>
<li>  <a href="./theory.html#sec:theory:useful_reading_material">4.1. Useful reading material   <span class="tag">    <span class="optional">optional</span>  </span></a></li>
<li>  <a href="./theory.html#sec:theory:illustration_cpt">4.2. Illustration of the \cpt symmetry <code>[/]</code>   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./theory.html#sec:theory:invisible_axion_models">4.3. Invisible axion models and axion couplings</a></li>
<li>  <a href="./theory.html#sec:theory:axion_interactions">4.4. Implications for axion interactions - conversion probability</a></li>
<li>  <a href="./theory.html#sec:theory:solar_axion_flux">4.5. Solar axion flux</a></li>
<li>  <a href="./theory.html#sec:theory:chameleon">4.6. Chameleons</a></li>
<li>  <a href="./theory.html#sec:theory:current_bounds">4.7. Current bounds on coupling constants</a></li>
</ul>
</li>
<li><a href="./helioscopes.html#sec:helioscopes">5. Axion helioscopes   <span class="tag">  <span class="Theory">Theory</span></span></a>
<ul>
<li>  <a href="./helioscopes.html#sec:helioscopes:cast">5.1. CERN Axion Solar Telescope (CAST)</a></li>
<li>  <a href="./helioscopes.html#sec:helioscopes:iaxo">5.2. International AXion Observatory (IAXO)</a></li>
</ul>
</li>
<li><a href="./theory_detector.html#sec:theory_detector">6. X-rays, cosmic muons and gaseous detectors   <span class="tag">  <span class="Theory">Theory</span></span></a>
<ul>
<li>  <a href="./theory_detector.html#sec:theory:particle_int">6.1. Particle interactions with matter</a></li>
<li>  <a href="./theory_detector.html#sec:theory:cosmic_radiation">6.2. Cosmic rays</a></li>
<li>  <a href="./theory_detector.html#sec:theory:gas_fundamentals">6.3. Gaseous detector fundamentals</a></li>
</ul>
</li>
<li><a href="./septemboard.html#sec:septemboard">7. Septemboard detector   <span class="tag">  <span class="Detector">Detector</span></span></a>
<ul>
<li>  <a href="./septemboard.html#sec:detector:micromegas">7.1. Micromegas working principle</a></li>
<li>  <a href="./septemboard.html#sec:detector:timepix">7.2. Timepix ASIC</a></li>
<li>  <a href="./septemboard.html#sec:detector:gridpix">7.3. GridPix</a></li>
<li>  <a href="./septemboard.html#sec:detector:detector_2014_15">7.4. 2014 / 2015 GridPix detector for CAST</a></li>
<li>  <a href="./septemboard.html#sec:detector:detector_overview">7.5. Septemboard detector overview</a></li>
<li>  <a href="./septemboard.html#org1020a1a">7.6. Detector readout system</a></li>
<li>  <a href="./septemboard.html#sec:detector:scintillators">7.7. Scintillator vetoes</a></li>
<li>  <a href="./septemboard.html#sec:detector:fadc">7.8. FADC</a></li>
<li>  <a href="./septemboard.html#sec:detector:sin_window">7.9. SiN window</a></li>
<li>  <a href="./septemboard.html#sec:detector:septemboard">7.10. Septemboard - 6 GridPixes around a center one</a></li>
<li>  <a href="./septemboard.html#sec:detector:water_cooling">7.11. Water cooling and temperature readout for the septemboard</a></li>
<li>  <a href="./septemboard.html#sec:septem:efficiency">7.12. Detector efficiency</a></li>
<li>  <a href="./septemboard.html#sec:detector:daq">7.13. Data acquisition and detector monitoring</a></li>
</ul>
</li>
<li><a href="./operation_calibration.html#sec:operation_calibration">8. Detector calibration for operation   <span class="tag">  <span class="Detector">Detector</span></span></a>
<ul>
<li>  <a href="./operation_calibration.html#sec:operation_calibration:timepix">8.1. Timepix calibrations</a></li>
<li>  <a href="./operation_calibration.html#sec:operation_calibration:fadc">8.2. FADC calibration</a></li>
<li>  <a href="./operation_calibration.html#sec:operation_calibration:scintillators">8.3. Scintillator calibration</a></li>
</ul>
</li>
<li><a href="./reconstruction.html#sec:reconstruction">9. Data reconstruction   <span class="tag">  <span class="Reconstruction">Reconstruction</span></span></a>
<ul>
<li>  <a href="./reconstruction.html#sec:reco:tpa">9.1. <code>TimepixAnalysis</code> and Nim</a></li>
<li>  <a href="./reconstruction.html#sec:reco:tos_data_parsing">9.2. TOS data parsing</a></li>
<li>  <a href="./reconstruction.html#sec:reco:event_shape">9.3. Expectation of event shapes</a></li>
<li>  <a href="./reconstruction.html#sec:reco:data_reconstruction">9.4. Data reconstruction</a></li>
<li>  <a href="./reconstruction.html#sec:reco:fadc_data">9.5. FADC reconstruction</a></li>
<li>  <a href="./reconstruction.html#sec:reco:scintillator_data">9.6. Scintillator data</a></li>
</ul>
</li>
<li><a href="./cast.html#sec:cast">10. Detector installation &amp; data taking at CAST   <span class="tag">  <span class="CAST">CAST</span></span></a>
<ul>
<li>  <a href="./cast.html#sec:cast:timeline">10.1. Timeline</a></li>
<li>  <a href="./cast.html#sec:cast:alignment">10.2. Alignment</a></li>
<li>  <a href="./cast.html#sec:cast:detector_setup">10.3. Detector setup at CAST</a></li>
<li>  <a href="./cast.html#sec:cast:window_accident">10.4. Window accident</a></li>
<li>  <a href="./cast.html#sec:cast:data_taking_woes">10.5. Data taking woes</a></li>
<li>  <a href="./cast.html#sec:cast:data_taking_campaigns">10.6. Summary of CAST data taking</a></li>
</ul>
</li>
<li><a href="./calibration.html#sec:calibration">11. Data calibration   <span class="tag">  <span class="Calibration">Calibration</span></span></a>
<ul>
<li>  <a href="./calibration.html#sec:calibration:energy">11.1. Energy calibration - in principle</a></li>
<li>  <a href="./calibration.html#sec:calib:detector_behavior_over_time">11.2. Detector behavior over time</a></li>
<li>  <a href="./calibration.html#sec:calib:final_energy_calibration">11.3. Energy calibration dependence on the gas gain</a></li>
<li>  <a href="./calibration.html#sec:calib:fadc">11.4. FADC</a></li>
</ul>
</li>
<li><a href="./background.html#sec:background">12. Finding signal and defining background | Background rate computation   <span class="tag">  <span class="Analysis">Analysis</span></span></a>
<ul>
<li>  <a href="./background.html#sec:background:likelihood_method">12.1. Likelihood method</a></li>
<li>  <a href="./background.html#sec:cdl">12.2. CAST Detector Lab</a></li>
<li>  <a href="./background.html#sec:background:likelihood_cut">12.3. Application of likelihood cut for background rate</a></li>
<li>  <a href="./background.html#sec:background:mlp">12.4. Artificial neural networks as cluster classifiers</a></li>
<li>  <a href="./background.html#sec:background:additional_vetoes">12.5. Additional detector features as vetoes</a></li>
<li>  <a href="./background.html#sec:background:all_vetoes_combined">12.6. Background rates of combined vetoes and efficiencies</a></li>
</ul>
</li>
<li><a href="./limit.html#sec:limit">13. Limit calculation   <span class="tag">  <span class="Limit">Limit</span></span></a>
<ul>
<li>  <a href="./limit.html#sec:limit:method_introduction">13.1. Limit method - introduction</a></li>
<li>  <a href="./limit.html#sec:limit:method_likelihood">13.2. Limit method - likelihood function \(\mathcal{L}\)</a></li>
<li>  <a href="./limit.html#sec:limit:method_computing_L">13.3. Limit method - computing \(\mathcal{L}\)</a></li>
<li>  <a href="./limit.html#sec:limit:method_computing_a_limit">13.4. Limit method - computing a limit</a></li>
<li>  <a href="./limit.html#sec:limit:method_expected_limit">13.5. Limit method - toy candidate sets and expected limits</a></li>
<li>  <a href="./limit.html#sec:limit:method_systematics">13.6. Limit method - extending \(\mathcal{L}\) for systematics</a></li>
<li>  <a href="./limit.html#sec:limit:method_mcmc">13.7. Limit method - evaluating \(\mathcal{L}\) with nuisance parameters</a></li>
<li>  <a href="./limit.html#orgd2e58b4">13.8. Note about likelihood integral   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./limit.html#orgb6d0d17">13.9. Derivation of short form of \(\mathcal{L}\) <code>[/]</code>   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./limit.html#sec:limit:ingredients">13.10. Likelihood ingredients in detail</a></li>
<li>  <a href="./limit.html#sec:limit:systematics">13.11. Systematics</a></li>
<li>  <a href="./limit.html#sec:limit:mcmc_calc_limit">13.12. MCMC to sample the distribution and compute a limit</a></li>
<li>  <a href="./limit.html#sec:limit:expected_limits">13.13. Expected limits of different setups</a></li>
<li>  <a href="./limit.html#sec:limit:candidates">13.14. Solar tracking candidates</a></li>
<li>  <a href="./limit.html#sec:limit:observed_limit">13.15. Observed limit - \(g_{ae}\)</a></li>
<li>  <a href="./limit.html#sec:limit:other_couplings">13.16. Other coupling constants</a></li>
<li>  <a href="./limit.html#org807f700">13.17. Comparison to 2013 limit (using their method)   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./limit.html#orgfb02698">13.18. Observed limit for different axion masses   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li>  <a href="./outlook.html#sec:outlook">14. Outlook</a></li>
<li>  <a href="./summary.html#sec:summary">15. Summary &amp; conclusion</a></li>
<li>  <a href="./bibliography.html#sec:bibliography">16. Bibliography   <span class="tag">    <span class="html">html</span>  </span></a></li>
<li><a href="./daq.html#sec:daq">17. Data acquisition and detector monitoring   <span class="tag"><span class="Appendix">Appendix</span> <span class="Detector">Detector</span></span></a>
<ul>
<li>  <a href="./daq.html#sec:daq:tof">17.1. Timepix Operating Firmware - TOF</a></li>
<li>  <a href="./daq.html#sec:daq:tos">17.2. Timepix Operating Software - TOS</a></li>
<li>  <a href="./daq.html#sec:daq:septemboard_event_display">17.3. Septemboard event display</a></li>
</ul>
</li>
<li><a href="./configuration.html#sec:appendix:configuration">18. Configuration and TOS / TOF versions   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./configuration.html#sec:appendix:configuration:tos_config">18.1. TOS configuration file</a></li>
<li>  <a href="./configuration.html#sec:appendix:configuration:tos_tof_versions">18.2. TOS and TOF versions used at CAST</a></li>
</ul>
</li>
<li><a href="./calibration.html#sec:appendix:calibration">19. Calibrations   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./calibration.html#sec:appendix:calibration:timepix">19.1. Timepix calibrations</a></li>
<li>  <a href="./calibration.html#sec:appendix:septemboard_calibrations">19.2. Septemboard calibration</a></li>
<li>  <a href="./calibration.html#sec:appendix:scintillator_calibration_notes">19.3. Calibration measurements of the veto scintillator paddle   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li><a href="./cast_operations.html#sec:appendix:cast_operations">20. CAST operation procedures   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./cast_operations.html#sec:appendix:cast_operations:terminology">20.1. CAST terminology</a></li>
<li>  <a href="./cast_operations.html#sec:cast:high_voltage">20.2. High voltage supply</a></li>
<li>  <a href="./cast_operations.html#sec:cast:vacuum_system">20.3. Vacuum system</a></li>
<li>  <a href="./cast_operations.html#sec:cast:watercooling_gas">20.4. Watercooling system &amp; gas supply</a></li>
<li>  <a href="./cast_operations.html#sec:cast:interlock_systems">20.5. Interlock systems</a></li>
<li>  <a href="./cast_operations.html#sec:appendix:cast_log_files">20.6. CAST log files</a></li>
</ul>
</li>
<li><a href="./cast_run_list.html#sec:appendix:cast_run_list">21. CAST data taking run list   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./cast_run_list.html#orgd378847">21.1. Full version   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li><a href="./cast_data_taking_notes.html#sec:appendix:cast_data_taking_notes">22. CAST data taking notes <code>[0/1]</code>   <span class="tag"><span class="Appendix">Appendix</span> <span class="extended">extended</span></span></a>
<ul>
<li>  <a href="./cast_data_taking_notes.html#org3f92df6">22.1. Run table</a></li>
<li>  <a href="./cast_data_taking_notes.html#orgffc6c24">22.2. Data runs</a></li>
<li>  <a href="./cast_data_taking_notes.html#orgbd16850">22.3. Calibration runs</a></li>
<li>  <a href="./cast_data_taking_notes.html#org41f3e7b">22.4. Automatically generated run list</a></li>
<li>  <a href="./cast_data_taking_notes.html#org439166d">22.5. Automatically calculated total run times</a></li>
<li>  <a href="./cast_data_taking_notes.html#org66cb01d">22.6. InGrid temperature from shift forms</a></li>
</ul>
</li>
<li><a href="./cabling_and_softwar_setup.html#sec:appendix:cabling_and_softwar_setup">23. Cabling &amp; software setup <code>[/]</code>   <span class="tag"><span class="Appendix">Appendix</span> <span class="extended">extended</span></span></a>
<ul>
<li>  <a href="./cabling_and_softwar_setup.html#orgf368b97">23.1. Virtex V6 cabling</a></li>
<li>  <a href="./cabling_and_softwar_setup.html#org7e29c2a">23.2. Detector cabling</a></li>
<li>  <a href="./cabling_and_softwar_setup.html#orgf87d8db">23.3. Vivado / ISE on void linux &amp; flashing Virtex V6</a></li>
<li>  <a href="./cabling_and_softwar_setup.html#orga0b2000">23.4. Setting up the chips in TOS</a></li>
</ul>
</li>
<li><a href="./vacuum_contamination.html#sec:appendix:vacuum_contamination">24. Window rupture and vacuum contamination   <span class="tag"><span class="Appendix">Appendix</span> <span class="extended">extended</span></span></a>
<ul>
<li>  <a href="./vacuum_contamination.html#orgd77e100">24.1. Calculation of vacuum volume</a></li>
<li>  <a href="./vacuum_contamination.html#org1a43024">24.2. Calculation of potential influx of gas</a></li>
<li>  <a href="./vacuum_contamination.html#org695452c">24.3. Consider pumping of pumps</a></li>
<li>  <a href="./vacuum_contamination.html#orgd1d1e0a">24.4. Calculation of possible contamination</a></li>
</ul>
</li>
<li><a href="./detector_time_behavior.html#sec:appendix:detector_time_behavior">25. Detector behavior over time   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./detector_time_behavior.html#sec:appendix:choice_gas_gain_binning">25.1. Choice of gas gain binning time interval</a></li>
<li>  <a href="./detector_time_behavior.html#sec:appendix:correlation_gas_gain_ambient_temp">25.2. Correlation of gas gain and ambient CAST temperature</a></li>
</ul>
</li>
<li><a href="./cast_detector_lab.html#sec:appendix:cast_detector_lab">26. CAST Detector Lab data   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./cast_detector_lab.html#org7e64495">26.1. Generate all spectrum plots split by run   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./cast_detector_lab.html#sec:appendix:cdl_spectra_by_run">26.2. All spectra split by run</a></li>
<li>  <a href="./cast_detector_lab.html#sec:appendix:cdl:all_spectra_fits">26.3. All CDL spectra with line fits   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./cast_detector_lab.html#sec:appendix:cdl:all_spectra_fits_by_run">26.4. All CDL spectra with line fits by run</a></li>
</ul>
</li>
<li><a href="./fit_by_run_justification.html#sec:appendix:fit_by_run_justification">27. CAST Detector Lab variations and fitting by run   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./fit_by_run_justification.html#sec:appendix:fit_by_run:gas_gain_var_cluster_prop">27.1. Influence of gas gain variations on cluster properties</a></li>
</ul>
</li>
<li><a href="./morphing_cdl_spectra.html#sec:appendix:morphing_cdl_spectra">28. Morphing of CDL reference spectra   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./morphing_cdl_spectra.html#org7169334">28.1. Generate all morphing / tile related plots   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./morphing_cdl_spectra.html#orgdf3b084">28.2. Generate plot comparing likelihood behavior   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./morphing_cdl_spectra.html#sec:appendix:morphing_cdl_spectra:tilemaps">28.3. Tilemap of each likelihood dataset</a></li>
<li>  <a href="./morphing_cdl_spectra.html#sec:appendix:morphing_cdl_spectra:interpolation_raster">28.4. Interpolation of each likelihood dataset</a></li>
<li>  <a href="./morphing_cdl_spectra.html#sec:appendix:morphing_cdl_spectra:binwise_linear">28.5. Binwise linear interpolations for each likelihood dataset</a></li>
<li>  <a href="./morphing_cdl_spectra.html#org06b2d73">28.6. Notes on CDL morphing development   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li><a href="./occupancy.html#sec:appendix:occupancy">29. Occupancy maps   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./occupancy.html#org2639874">29.1. Run-2</a></li>
<li>  <a href="./occupancy.html#org2371de5">29.2. Run-3</a></li>
<li>  <a href="./occupancy.html#org3a4e68d">29.3. Generate occupancy map plots   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li><a href="./fadc.html#sec:appendix:fadc">30. FADC   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./fadc.html#sec:appendix:fadc:rise_fall">30.1. FADC rise and fall time</a></li>
<li>  <a href="./fadc.html#sec:appendix:background:fadc">30.2. FADC veto</a></li>
<li>  <a href="./fadc.html#orgf509e88">30.3. Generate plot of rise time vs skewness   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./fadc.html#sec:appendix:fadc_veto_empirical_cluster_length">30.4. Expected cluster size</a></li>
</ul>
</li>
<li><a href="./background_rates.html#sec:appendix:background_rates">31. Raw data and background rates   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./background_rates.html#sec:appendix:background_rates:full_chip">31.1. Background rates over full chip</a></li>
<li>  <a href="./background_rates.html#org8028852">31.2. Generate rate without any vetoes over full chip   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./background_rates.html#orgef16e20">31.3. Generate background rates over full chip   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./background_rates.html#org193b7a7">31.4. Generate table of background rates for all setups   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li>  <a href="./background_interpolation_chip_area.html#sec:appendix:background_interpolation_chip_area">32. Background interpolation chip cutout correction   <span class="tag">    <span class="Appendix">Appendix</span>  </span></a></li>
<li><a href="./limit_additional.html#sec:appendix:limit_additional">33. Additional limit information   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./limit_additional.html#sec:appendix:conversion_probability">33.1. Conversion probability as a function of mass   <span class="tag">    <span class="Appendix">Appendix</span>  </span></a></li>
<li>  <a href="./limit_additional.html#sec:appendix:exp_limit_percentiles">33.2. Expected limit table with percentiles</a></li>
<li>  <a href="./limit_additional.html#sec:appendix:limit_additional:axion_photon">33.3. Observed limit - axion photon \(g_{aγ}\)</a></li>
<li>  <a href="./limit_additional.html#sec:appendix:limit_additional:chameleon">33.4. Observed limit - chameleon \(β_γ\)</a></li>
</ul>
</li>
<li><a href="./software.html#sec:appendix:software">34. Software   <span class="tag"><span class="Software">Software</span> <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./software.html#org0090377">34.1. Why did I start writing my own analysis framework?   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./software.html#orgfc52afc">34.2. Nim   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./software.html#sec:appendix:timepix_analysis">34.3. TimepixAnalysis</a></li>
<li>  <a href="./software.html#org2bc66b3">34.4. Other libraries relevant for TimepixAnalysis</a></li>
</ul>
</li>
<li><a href="./full_data_reconstruction.html#sec:appendix:full_data_reconstruction">35. Full data reconstruction   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./full_data_reconstruction.html#orgf41789a">35.1. Raw data parsing and reconstruction</a></li>
<li>  <a href="./full_data_reconstruction.html#org9ca9fac">35.2. Parse and reconstruct the CDL data</a></li>
<li>  <a href="./full_data_reconstruction.html#org0bab982">35.3. Add tracking information to background files</a></li>
<li>  <a href="./full_data_reconstruction.html#org25b74bd">35.4. Using <code>runAnalysisChain</code></a></li>
<li>  <a href="./full_data_reconstruction.html#orgf1bc139">35.5. Applying a classifier</a></li>
<li>  <a href="./full_data_reconstruction.html#org34c40d8">35.6. Computing limits</a></li>
</ul>
</li>
<li><a href="./average_depth_xrays_argon.html#sec:appendix:average_depth_xrays_argon">36. Average distance X-rays travel in argon at CAST conditions   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./average_depth_xrays_argon.html#org79c4f0b">36.1. Reference to original document   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./average_depth_xrays_argon.html#orgec11934">36.2. Calculate conversion point numerically</a></li>
<li>  <a href="./average_depth_xrays_argon.html#orgd4ec8f2">36.3. Compiling and running the code   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li><a href="./raytracing.html#sec:appendix:raytracing">37. Raytracing   <span class="tag"><span class="Software">Software</span> <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./raytracing.html#sec:appendix:raytracing:traxer">37.1. TrAXer - An interactive axion raytracer</a></li>
<li>  <a href="./raytracing.html#sec:appendix:raytracing:llnl_telescope">37.2. A few more details about the LLNL telescope</a></li>
<li>  <a href="./raytracing.html#sec:appendix:raytracing:panter">37.3. Comparison of TrAXer results with PANTER measurements</a></li>
<li>  <a href="./raytracing.html#sec:appendix:raytracing:axion_image">37.4. Computing an axion image with TrAXer</a></li>
<li>  <a href="./raytracing.html#orgeb78e88">37.5. Reproducing an X-ray finger run with TrAXer   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./raytracing.html#org9c2b226">37.6. Figure error development notes   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li>  <a href="./acknowledgments.html#sec:appendix:acknowledgments">38. Acknowledgments   <span class="tag">    <span class="Ack">Ack</span>  </span></a></li>
</ul>
</div>
</nav>
<div class="outline-2" id="outline-container-sec:appendix:morphing_cdl_spectra">
<h2 id="sec:appendix:morphing_cdl_spectra"><span class="section-number-2">28.</span> Morphing of CDL reference spectra   <span class="tag">  <span class="Appendix">Appendix</span></span></h2>
<div class="outline-text-2" id="text-sec:appendix:morphing_cdl_spectra">
<p>
This appendix contains further figures about the interpolation of the
reference distributions entering the likelihood method as discussed in
sec. <a href="./background.html#sec:cdl:cdl_morphing">12.2.6</a> and
sec. <a href="./background.html#sec:cdl:cdl_morphing_energy_logL">12.2.7</a>. Fig. <a href="#fig:appendix:cdl_morphing_logL_vs_energy">1</a>
directly shows the impact of interpolating the reference distributions
on the likelihood values (colored points for each different
target/filter combination) and the cut value (black line). Both the
points and the cut values become smoother utilizing the
interpolation. Note that even the interpolation is not perfectly
smooth, as the underlying reference data is still binned to a
histogram.
</p>

<p>
Further, section <a href="./morphing_cdl_spectra.html#sec:appendix:morphing_cdl_spectra:tilemaps">28.3</a> contains
tilemaps of the not interpolated reference data for each dataset and
sec. <a href="./morphing_cdl_spectra.html#sec:appendix:morphing_cdl_spectra:interpolation_raster">28.4</a> shows the
fully interpolated space for each dataset. Finally,
sec. <a href="./morphing_cdl_spectra.html#sec:appendix:morphing_cdl_spectra:binwise_linear">28.5</a> contains the
histograms of the binwise linear interpolations where for each ridge
one dataset is skipped.
</p>

<p>
See the extended thesis for the development notes of the interpolation
technique, including different approaches (e.g. binwise spline interpolation
instead of linear interpolation).
</p>


<figure id="fig:appendix:cdl_morphing_logL_vs_energy">
<img src="./figs/home/basti/phd/Figs/background/logL_of_CDL_vs_energy.svg" class="org-svg" alt="logL_of_CDL_vs_energy.svg" />

<figcaption>Figure 1: <span class="figure-number">Figure 139: </span>\(\ln\mathcal{L}\) values for all the cleaned CDL cluster data against the energy of the cluster. Left is the binwise linear interpolation and right is the calculation using the old <a href="krieger2018search">krieger2018search</a> approach of fixed energy intervals. The bin wise linear interpolation helps to provide a smoother description of the \(\ln\mathcal{L}\) data.</figcaption>
</figure>

<p>
\clearpage
</p>
</div>
<div class="outline-3" id="outline-container-org7169334">
<h3 id="org7169334"><span class="section-number-3">28.1.</span> Generate all morphing / tile related plots   <span class="tag">  <span class="extended">extended</span></span></h3>
<div class="outline-text-3" id="text-28-1">
<p>
In principle the plots are produced with the same command as in
sec. <a href="./background.html#sec:background:generated_morphing_plots">12.2.7.2</a>, but here we wish to
have wider versions that are not side-by-side:
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #FD971F;">FWIDTH</span>=0.9 <span style="color: #FD971F;">HEIGHT</span>=420 <span style="color: #FD971F;">WRITE_PLOT_CSV</span>=true <span style="color: #FD971F;">USE_TEX</span>=true ./cdlMorphing <span style="color: #E6DB74; font-weight: bold;">\</span>
    --cdlFile ~/CastData/data/CDL_2019/calibration-cdl-2018.h5 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --outpath ~/phd/Figs/CDL/cdlMorphing/fWidth0.9/
</pre>
</div>
</div>
</div>

<div class="outline-3" id="outline-container-orgdf3b084">
<h3 id="orgdf3b084"><span class="section-number-3">28.2.</span> Generate plot comparing likelihood behavior   <span class="tag">  <span class="extended">extended</span></span></h3>
<div class="outline-text-3" id="text-28-2">
<p>
Fig. <a href="#fig:appendix:cdl_morphing_logL_vs_energy">1</a> is produced in sec. <a href="./background.html#sec:background:correlation_lnL_variables">12.2.5.2</a>.
</p>
</div>
</div>

<div class="outline-3" id="outline-container-sec:appendix:morphing_cdl_spectra:tilemaps">
<h3 id="sec:appendix:morphing_cdl_spectra:tilemaps"><span class="section-number-3">28.3.</span> Tilemap of each likelihood dataset</h3>
<div class="outline-text-3" id="text-sec:appendix:morphing_cdl_spectra:tilemaps">
<p>
The tilemaps shown here should be compared to the resulting raster
plots of the next section,
sec. <a href="./morphing_cdl_spectra.html#sec:appendix:morphing_cdl_spectra:interpolation_raster">28.4</a>. For each
dataset entering the likelihood method the reference distribution
computed for each target/filter combination is spread over its
applicable energy range. In the plots the colormap is the height of
the distribution. The fluorescence lines are indicated that define the
X-ray energy of each target. This illustrates how a cluster energy is
mapped to a probability from each of the 8 target/filter
distributions. The distinct jump in the distributions is visible in
the form of a cut along the horizontal axis at different energies.
</p>


<figure id="fig:appendix:morphing_cdl_spectra:cdl_as_tile_eccentricity">
<img src="./figs/home/basti/phd/Figs/CDL/cdlMorphing/fWidth0.9/cdl_as_tile_morph_mtNone_eccentricity.svg" class="org-svg" alt="cdl_as_tile_morph_mtNone_eccentricity.svg" />

<figcaption>Figure 2: <span class="figure-number">Figure 140: </span>Tilemap of the eccentricity dataset against energy. The colormap corresponds to the height of the eccentricity distribution at that point. Along the energy axis the data is constant within the applicable energy range of the target/filter kind. The energy of each fluorescence line is indicated.</figcaption>
</figure>


<figure id="fig:appendix:morphing_cdl_spectra:cdl_as_tile_fracRms">
<img src="./figs/home/basti/phd/Figs/CDL/cdlMorphing/fWidth0.9/cdl_as_tile_morph_mtNone_fractionInTransverseRms.svg" class="org-svg" alt="cdl_as_tile_morph_mtNone_fractionInTransverseRms.svg" />

<figcaption>Figure 3: <span class="figure-number">Figure 141: </span>Tilemap of the fractionInTransverseRms dataset against energy. The colormap corresponds to the height of the fractionInTransverseRms distribution at that point. Along the energy axis the data is constant within the applicable energy range of the target/filter kind. The energy of each fluorescence line is indicated.</figcaption>
</figure>


<figure id="fig:appendix:morphing_cdl_spectra:cdl_as_tile_ldiv">
<img src="./figs/home/basti/phd/Figs/CDL/cdlMorphing/fWidth0.9/cdl_as_tile_morph_mtNone_lengthDivRmsTrans.svg" class="org-svg" alt="cdl_as_tile_morph_mtNone_lengthDivRmsTrans.svg" />

<figcaption>Figure 4: <span class="figure-number">Figure 142: </span>Tilemap of the lengthDivRmsTrans dataset against energy. The colormap corresponds to the height of the lengthDivRmsTrans distribution at that point. Along the energy axis the data is constant within the applicable energy range of the target/filter kind. The energy of each fluorescence line is indicated.</figcaption>
</figure>

<p>
\clearpage
</p>
</div>
</div>
<div class="outline-3" id="outline-container-sec:appendix:morphing_cdl_spectra:interpolation_raster">
<h3 id="sec:appendix:morphing_cdl_spectra:interpolation_raster"><span class="section-number-3">28.4.</span> Interpolation of each likelihood dataset</h3>
<div class="outline-text-3" id="text-sec:appendix:morphing_cdl_spectra:interpolation_raster">
<p>
In contrast to the plots of the previous section,
sec. <a href="./morphing_cdl_spectra.html#sec:appendix:morphing_cdl_spectra:tilemaps">28.3</a> all plots of the
different datasets entering the likelihood method here show the
distribution in property / energy space after binwise linear
interpolation. Compared to the previous plots it results in a smooth
transition over the entire energy range.
</p>


<figure id="fig:appendix:morphing_cdl_spectra:cdl_as_raster_eccentricity">
<img src="./figs/home/basti/phd/Figs/CDL/cdlMorphing/fWidth0.9/cdl_as_raster_interpolated_morph_mtNone_eccentricity.svg" class="org-svg" alt="cdl_as_raster_interpolated_morph_mtNone_eccentricity.svg" />

<figcaption>Figure 5: <span class="figure-number">Figure 143: </span>Raster plot of the eccentricity dataset against energy after binwise linear interpolation. The colormap corresponds to the height of the eccentricity distribution at that point. The energy of each fluorescence line is indicated.</figcaption>
</figure>


<figure id="fig:appendix:morphing_cdl_spectra:cdl_as_raster_fracRms">
<img src="./figs/home/basti/phd/Figs/CDL/cdlMorphing/fWidth0.9/cdl_as_raster_interpolated_morph_mtNone_fractionInTransverseRms.svg" class="org-svg" alt="cdl_as_raster_interpolated_morph_mtNone_fractionInTransverseRms.svg" />

<figcaption>Figure 6: <span class="figure-number">Figure 144: </span>Raster plot of the fractionInTransverseRms dataset against energy after binwise linear interpolation. The colormap corresponds to the height of the fractionInTransverseRms distribution at that point. The energy of each fluorescence line is indicated.</figcaption>
</figure>


<figure id="fig:appendix:morphing_cdl_spectra:cdl_as_raster_ldiv">
<img src="./figs/home/basti/phd/Figs/CDL/cdlMorphing/fWidth0.9/cdl_as_raster_interpolated_morph_mtNone_lengthDivRmsTrans.svg" class="org-svg" alt="cdl_as_raster_interpolated_morph_mtNone_lengthDivRmsTrans.svg" />

<figcaption>Figure 7: <span class="figure-number">Figure 145: </span>Raster plot of the lengthDivRmsTrans dataset against energy after binwise linear interpolation. The colormap corresponds to the height of the lengthDivRmsTrans distribution at that point. The energy of each fluorescence line is indicated.</figcaption>
</figure>

<p>
\clearpage
</p>
</div>
</div>
<div class="outline-3" id="outline-container-sec:appendix:morphing_cdl_spectra:binwise_linear">
<h3 id="sec:appendix:morphing_cdl_spectra:binwise_linear"><span class="section-number-3">28.5.</span> Binwise linear interpolations for each likelihood dataset</h3>
<div class="outline-text-3" id="text-sec:appendix:morphing_cdl_spectra:binwise_linear">
<p>
The figures in this section show the binwise linear interpolation by
skipping the dataset in each ridge and interpolating using the nearest
neighbors above/below in energy. These are the same as shown in
fig. <a href="#fig:cdl:cdl_morphing_frac_known_lines">#fig:cdl:cdl_morphing_frac_known_lines</a> for all three datasets
(i.e. fig. <a href="#fig:appendix:morphing_cdl_spectra:fracRms_binwise">9</a> is the
same). As mentioned in the main text, skipping the dataset at each
ridge means the interpolation errors are much larger than used in
practice (as shown in the previous section <a href="./morphing_cdl_spectra.html#sec:appendix:morphing_cdl_spectra:interpolation_raster">28.4</a>).
</p>


<figure id="fig:appendix:morphing_cdl_spectra:eccentricity_binwise">
<img src="./figs/home/basti/phd/Figs/CDL/cdlMorphing/fWidth0.9/eccentricity_ridgeline_morph_mtLinear_calibration-cdl-2018.h5_2018.svg" class="org-svg" alt="eccentricity_ridgeline_morph_mtLinear_calibration-cdl-2018.h5_2018.svg" />

<figcaption>Figure 8: <span class="figure-number">Figure 146: </span>Binwise linear interpolation of the eccentricity dataset skipping the target/filter dataset being interpolated.</figcaption>
</figure>


<figure id="fig:appendix:morphing_cdl_spectra:fracRms_binwise">
<img src="./figs/home/basti/phd/Figs/CDL/cdlMorphing/fWidth0.9/fractionInTransverseRms_ridgeline_morph_mtLinear_calibration-cdl-2018.h5_2018.svg" class="org-svg" alt="fractionInTransverseRms_ridgeline_morph_mtLinear_calibration-cdl-2018.h5_2018.svg" />

<figcaption>Figure 9: <span class="figure-number">Figure 147: </span>Binwise linear interpolation of the fractionInTransverseRms dataset skipping the target/filter dataset being interpolated.</figcaption>
</figure>


<figure id="fig:appendix:morphing_cdl_spectra:ldiv_binwise">
<img src="./figs/home/basti/phd/Figs/CDL/cdlMorphing/fWidth0.9/lengthDivRmsTrans_ridgeline_morph_mtLinear_calibration-cdl-2018.h5_2018.svg" class="org-svg" alt="lengthDivRmsTrans_ridgeline_morph_mtLinear_calibration-cdl-2018.h5_2018.svg" />

<figcaption>Figure 10: <span class="figure-number">Figure 148: </span>Binwise linear interpolation of the lengthDivRmsTrans dataset skipping the target/filter dataset being interpolated.</figcaption>
</figure>
</div>
</div>

<div class="outline-3" id="outline-container-org06b2d73">
<h3 id="org06b2d73"><span class="section-number-3">28.6.</span> Notes on CDL morphing development   <span class="tag">  <span class="extended">extended</span></span></h3>
<div class="outline-text-3" id="text-28-6">
<p>
This section of the (not exported) appendix contains our notes about
building and implementing the linear interpolation of CDL data (when
talking about &apos;current approach&apos; in the below, we refer to the old,
non interpolating approach). It should give an understanding of what
was considered and why the final choice is a linear interpolation.
</p>



<p>
One problem with the current approach of utilizing the CDL data is that the
reference distributions for the different logL variables are non continuous
between two energy bins. This means that if a cluster is moved from one bin to
another it suddenly has a very different cut for each property.
</p>

<p>
It might be possible to morph CDL spectra between two energies. That is to
allow interpolation between the shape of two neighboring reference
datasets.
</p>

<p>
This is the likely cause for the sudden steps visible in the background
rate. With a fully morphed function this should hopefully disappear.
</p>
</div>


<div class="outline-4" id="outline-container-orgb8f3cb4">
<h4 id="orgb8f3cb4"><span class="section-number-4">28.6.1.</span> References &amp; ideas</h4>
<div class="outline-text-4" id="text-28-6-1">
<p>
Read up on morphing of different functions:
</p>
<ul class="org-ul">
<li>in HEP: <a href="https://indico.cern.ch/event/507948/contributions/2028505/attachments/1262169/1866169/atlas-hcomb-morphwshop-intro-v1.pdf">https://indico.cern.ch/event/507948/contributions/2028505/attachments/1262169/1866169/atlas-hcomb-morphwshop-intro-v1.pdf</a></li>
<li>  <a href="https://mathematica.stackexchange.com/questions/208990/morphing-between-two-functions">https://mathematica.stackexchange.com/questions/208990/morphing-between-two-functions</a></li>
<li>  <a href="https://mathematica.stackexchange.com/questions/209039/convert-symbolic-to-numeric-code-speed-up-morphing">https://mathematica.stackexchange.com/questions/209039/convert-symbolic-to-numeric-code-speed-up-morphing</a></li>
</ul>

<p>
Aside from morphing, the theory of optimal transport seems to be directly
related to such problems:
</p>
<ul class="org-ul">
<li><a href="https://de.wikipedia.org/wiki/Optimaler_Transport">https://de.wikipedia.org/wiki/Optimaler_Transport</a>
(funny, this can be described by topology using GR lingo; there&apos;s no English
article on this)</li>
<li><a href="https://en.wikipedia.org/wiki/Transportation_theory_(mathematics)">https://en.wikipedia.org/wiki/Transportation_theory_(mathematics)</a>
see in particular: <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c3/Continuous_optimal_transport.png/200px-Continuous_optimal_transport.png" alt="200px-Continuous_optimal_transport.png" /></li>
</ul>
<p>
This seems to imply that given some functions \(f(x)\), \(g(x)\) we are looking for
the transport function \(T\) which maps \(T: f(x) \rightarrow g(x)\) in the language
of transportation theory.
</p>

<p>
See the linked article about the Wasserstein metric:
</p>
<ul class="org-ul">
<li><a href="https://en.wikipedia.org/wiki/Wasserstein_metric">https://en.wikipedia.org/wiki/Wasserstein_metric</a>
in particular the section about its connection to the optimal transport
problem</li>
</ul>
<p>
It describes a distance metric between two probability distributions. In that
sense the distance between two distributions to be transported is directly
related to the Wasserstein distance.
</p>

<p>
One of the major constraints of transportation theory is that the transportation
has to preserve the integral of the transported function. Technically, this is
not the case for our application to the CDL data, due to different amount of
data available for each target. However, of course we normalize the CDL data and
assume that the given data actually is a PDF. At that point each distribution is
normalized to 1 and thus each morphed function has to be normalized to 1 as
well. This is a decent check for a morph result. If a morphing technique does
<b>not</b> satisfy this property we need to renormalize the result.
</p>

<p>
On the other hand, considering the slides by Verkerke (indico.cern.ch link
above), the morphing between two functions can also be interpreted as a simple
interpolation problem.
</p>

<p>
In that sense there are multiple approaches to compute an intermediate
step of the CDL distributions.
</p>

<ol class="org-ol">
<li>visualize the CDL data as a 2D heatmap:
<ul class="org-ul">
<li>value of the logL variable is x</li>
<li>energy of each fluorescence line is y</li>
</ul></li>
<li>linear interpolation at a specific energy \(E\) based on the two
neighboring CDL distributions (interpolation thus <b>only</b> along y axis)</li>
<li>spline interpolation over all energy ranges</li>
<li>KDE along the energy axis (only along <b>y</b>)
Extend KDE to 2D?</li>
<li>bicubic interpolation (-&gt; problematic, because our energies/variables are
<b>not</b> spread on a rectilinear grid (energy is not spread evenly)</li>
<li>other distance based interpolations, i.e. KD-tree? Simply perform
an interpolation based on all neighboring points in a certain
distance?</li>
</ol>

<p>
Of these 2 and 4 seem to be the easiest implementations. KD-tree would
also be easy, provided I finish the implementation finally.
</p>

<p>
We will investigate different ideas in
<a href="./../CastData/ExternCode/TimepixAnalysis/Tools/cdlMorphing/cdlMorphing.nim">./../CastData/ExternCode/TimepixAnalysis/Tools/cdlMorphing/cdlMorphing.nim</a>.
</p>
</div>

<div class="outline-5" id="outline-container-orgdc46a3d">
<h5 id="orgdc46a3d"><span class="section-number-5">28.6.1.1.</span> <span class="done DONE">DONE</span> Visualize CDL data as a 2D heatmap</h5>
<div class="outline-text-5" id="text-28-6-1-1">
<p>
In each of the following plots each distribution (= target filter
combination) is normalized to 1.
</p>

<p>
First let&apos;s visualize all of the CDL data as a scatter plot. That is
pretty simple and gives an idea where the lines are and what the shape
is roughly, fig. <a href="logL_scatter_lengthDivRmsTrans">11</a>.
</p>


<figure id="logL_scatter_lengthDivRmsTrans">
<img src="./figs/home/basti/phd/Figs/CDL/cdlMorphing/cdl_as_scatter_lengthDivRmsTrans.svg" class="org-svg" alt="cdl_as_scatter_lengthDivRmsTrans.svg" />

<figcaption>Figure 11: <span class="figure-number">Figure 149: </span>Scatter plot of the reference dataset for the length / transverse RMS logL variable, colored by the normalized counts for each distribution (each is normalized to 1). The distributions are drawn at the energy of the fluorescence lines.</figcaption>
</figure>

<p>
Now we can check out what the data looks like if we interpret the whole (value
of each variable, Energy) phase space as a tile map. In this way, morphing can
be interpreted as performing interpolation along the energy axis in the
resulting tile map.
</p>

<p>
Each figure contains in addition as colored lines the <b>start</b> of each energy
range as currently used. So clusters will be with the distribution defined by
the line below.
</p>

<p>
In addition the energy of each fluorescence lines is plotted in red at the
corresponding energy value. This also shows that the intervals and the energy
of the lines are highly asymmetric.
</p>


<figure id="logL_tile_eccentricity">
<img src="./figs/home/basti/phd/Figs/CDL/cdlMorphing/cdl_as_tile_eccentricity.svg" class="org-svg" alt="cdl_as_tile_eccentricity.svg" />

<figcaption>Figure 12: <span class="figure-number">Figure 150: </span>Tile map of the reference dataset for the eccentricity logL variable, colored by the normalized counts for each distribution (each is normalized to 1 along the x axis). Each tile covers the range from start to end interval. In addition in red the energy of each fluorescence line is plotted.</figcaption>
</figure>


<figure id="logL_tile_lengthDivRmsTrans">
<img src="./figs/home/basti/phd/Figs/CDL/cdlMorphing/cdl_as_tile_lengthDivRmsTrans.svg" class="org-svg" alt="cdl_as_tile_lengthDivRmsTrans.svg" />

<figcaption>Figure 13: <span class="figure-number">Figure 151: </span>Tile map of the reference dataset for the length / transverse RMS logL variable, colored by the normalized counts for each distribution (each is normalized to 1 along the x axis). Each tile covers the range from start to end interval. In addition in red the energy of each fluorescence line is plotted.</figcaption>
</figure>


<figure id="logL_tile_fracRmsTrans">
<img src="./figs/home/basti/phd/Figs/CDL/cdlMorphing/cdl_as_tile_fractionInTransverseRms.svg" class="org-svg" alt="cdl_as_tile_fractionInTransverseRms.svg" />

<figcaption>Figure 14: <span class="figure-number">Figure 152: </span>Tile map of the reference dataset for the fraction within transverse RMS logL variable, colored by the normalized counts for each distribution (each is normalized to 1 along the x axis). Each tile covers the range from start to end interval. In addition in red the energy of each fluorescence line is plotted.</figcaption>
</figure>
</div>
</div>

<div class="outline-5" id="outline-container-org3cd7623">
<h5 id="org3cd7623"><span class="section-number-5">28.6.1.2.</span> <span class="done DONE">DONE</span> Morph by linear interpolation bin by bin</h5>
<div class="outline-text-5" id="text-28-6-1-2">
<p>
Based on the tile maps in the previous section it seems like a decent idea to
perform a linear interpolation for any point in between two intervals:
</p>
<p>
where \(f_\text{low,high}\) are the distributions below / above the given energy
\(E\). \(L_\text{low,high}\) corresponds to the energy of the fluorescence line
corresponding to the distribution below / above \(E\). \(\Delta E\) is the
difference in energy between the lower and higher fluorescence lines. \(x\) is the
value of the given logL variable.
</p>

<p>
In code this is:
</p>
<div class="org-src-container">
<pre class="src src-nim">  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">E</span> = ... <span style="color: #75715E;"># </span><span style="color: #75715E;">given as argument to function</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">lineEnergies </span>= getXrayFluorescenceLines<span style="color: #AE81FF;">()</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">refLowT </span>= df.filter<span style="color: #AE81FF;">(</span>f<span style="color: #66D9EF;">{</span><span style="color: #66D9EF;">string</span> -&gt; <span style="color: #66D9EF;">bool</span>: `<span style="color: #66D9EF;">Dset</span>` == refLow<span style="color: #66D9EF;">}</span><span style="color: #AE81FF;">)[</span><span style="color: #E6DB74;">&quot;Hist&quot;</span>, <span style="color: #66D9EF;">float</span><span style="color: #AE81FF;">]</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">refHighT </span>= df.filter<span style="color: #AE81FF;">(</span>f<span style="color: #66D9EF;">{</span><span style="color: #66D9EF;">string</span> -&gt; <span style="color: #66D9EF;">bool</span>: `<span style="color: #66D9EF;">Dset</span>` == refHigh<span style="color: #66D9EF;">}</span><span style="color: #AE81FF;">)[</span><span style="color: #E6DB74;">&quot;Hist&quot;</span>, <span style="color: #66D9EF;">float</span><span style="color: #AE81FF;">]</span>
  <span style="color: #FD971F;">result</span> = zeros<span style="color: #AE81FF;">[</span><span style="color: #66D9EF;">float</span><span style="color: #AE81FF;">](</span>refLowT.size.<span style="color: #66D9EF;">int</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">deltaE </span>= <span style="color: #F92672;">abs</span><span style="color: #AE81FF;">(</span>lineEnergies<span style="color: #66D9EF;">[</span>idx<span style="color: #66D9EF;">]</span> - lineEnergies<span style="color: #66D9EF;">[</span>idx+offset<span style="color: #66D9EF;">]</span><span style="color: #AE81FF;">)</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">walk over each bin and compute linear interpolation between</span>
  <span style="color: #F92672;">for</span> i <span style="color: #F92672;">in</span> <span style="font-style: italic;">0</span> ..&lt; refLowT.size:
    <span style="color: #FD971F;">result</span><span style="color: #AE81FF;">[</span>i<span style="color: #AE81FF;">]</span> = refLowT<span style="color: #AE81FF;">[</span>i<span style="color: #AE81FF;">]</span> * <span style="color: #AE81FF;">(</span><span style="font-style: italic;">1</span> - <span style="color: #66D9EF;">(</span><span style="color: #F92672;">abs</span><span style="color: #A6E22E;">(</span>lineEnergies<span style="color: #E6DB74;">[</span>idx<span style="color: #E6DB74;">]</span> - <span style="color: #66D9EF;">E</span><span style="color: #A6E22E;">)</span><span style="color: #66D9EF;">)</span> / deltaE<span style="color: #AE81FF;">)</span> +
      refHighT<span style="color: #AE81FF;">[</span>i<span style="color: #AE81FF;">]</span> * <span style="color: #AE81FF;">(</span><span style="font-style: italic;">1</span> - <span style="color: #66D9EF;">(</span><span style="color: #F92672;">abs</span><span style="color: #A6E22E;">(</span>lineEnergies<span style="color: #E6DB74;">[</span>idx+offset<span style="color: #E6DB74;">]</span> - <span style="color: #66D9EF;">E</span><span style="color: #A6E22E;">)</span><span style="color: #66D9EF;">)</span> / deltaE<span style="color: #AE81FF;">)</span>
</pre>
</div>

<p>
Since doing this for a point between two lines is not particularly helpful,
because we do not <i>know</i> what the distribution in between does actually look
like. Instead for validation we will now try to compute the <code>Cu-EPIC-0.9kV</code>
distribution (corresponding to the \(\text{O K}_{α}\) line at
\(\SI{0.525}{\kilo \electronvolt}\)) based on the <code>C-EPIC-0.6kV</code> and <code>Cu-EPIC-2kV</code>
distributions.
That means the interpolate the second ridge from the first and third in the
CDL ridgeline plots.
</p>

<p>
This is shown in fig. <a href="linear_interpolation_morph_eccentricity">15</a>,
<a href="linear_interpolation_morph_lengthDivRmsTrans">16</a> and
<a href="linear_interpolation_morph_fracRmsTrans">17</a>. The real data for each distribution is
shown in red and the morphed linear bin-wise interpolation for the second ridge
is shown in red.
</p>



<figure id="linear_interpolation_morph_eccentricity">
<img src="./figs/home/basti/phd/Figs/CDL/cdlMorphing/eccentricity_ridgeline_XrayReferenceFile2018.h5_2018.svg" class="org-svg" alt="eccentricity_ridgeline_XrayReferenceFile2018.h5_2018.svg" />

<figcaption>Figure 15: <span class="figure-number">Figure 153: </span>Interpolation of the <code>Cu-EPIC-0.9kV</code> distribution for the eccentricity logL variable using bin wise linear interpolation based on the <code>C-EPIC-0.6kV</code> and <code>Cu-EPIC-2kV</code> distributions. The real data is shown in the second ridge in red and the morphed interpolation is is shown in blue. The agreement is remarkable for the simplicity of the method.</figcaption>
</figure>




<figure id="linear_interpolation_morph_lengthDivRmsTrans">
<img src="./figs/home/basti/phd/Figs/CDL/cdlMorphing/lengthDivRmsTrans_ridgeline_XrayReferenceFile2018.h5_2018.svg" class="org-svg" alt="lengthDivRmsTrans_ridgeline_XrayReferenceFile2018.h5_2018.svg" />

<figcaption>Figure 16: <span class="figure-number">Figure 154: </span>Interpolation of the <code>Cu-EPIC-0.9kV</code> distribution for the length / transverse RMS logL variable using bin wise linear interpolation based on the <code>C-EPIC-0.6kV</code> and <code>Cu-EPIC-2kV</code> distributions. The real data is shown in the second ridge in red and the morphed interpolation is is shown in blue. The agreement is remarkable for the simplicity of the method.</figcaption>
</figure>




<figure id="linear_interpolation_morph_fracRmsTrans">
<img src="./figs/home/basti/phd/Figs/CDL/cdlMorphing/fractionInTransverseRms_ridgeline_XrayReferenceFile2018.h5_2018.svg" class="org-svg" alt="fractionInTransverseRms_ridgeline_XrayReferenceFile2018.h5_2018.svg" />

<figcaption>Figure 17: <span class="figure-number">Figure 155: </span>Interpolation of the <code>Cu-EPIC-0.9kV</code> distribution for the fraction in transverse RMS logL variable using bin wise linear interpolation based on the <code>C-EPIC-0.6kV</code> and <code>Cu-EPIC-2kV</code> distributions. The real data is shown in the second ridge in red and the morphed interpolation is is shown in blue. This in particular is the problematic variable, due to the integer nature of the data at low energies. However, even here the interpolation works extremely well.</figcaption>
</figure>
</div>
</div>


<div class="outline-5" id="outline-container-org7065f6c">
<h5 id="org7065f6c"><span class="section-number-5">28.6.1.3.</span> <span class="done DONE">DONE</span> Compute all reference spectra from neighbors</h5>
<div class="outline-text-5" id="text-28-6-1-3">
<p>
Similar to the plots in the previous section we can now compute all
reference spectra based on the next neighboring spectras.
</p>

<p>
This is done in fig. <a href="linear_interpolation_morph_eccentricity_all">18</a>,
<a href="linear_interpolation_morph_lengthDivRmsTrans_all">19</a>, <a href="linear_interpolation_morph_fracRmsTrans_all">20</a>.
</p>



<figure id="linear_interpolation_morph_eccentricity_all">
<img src="./figs/home/basti/phd/Figs/CDL/cdlMorphing/eccentricity_ridgeline_morph_all_XrayReferenceFile2018.h5_2018.svg" class="org-svg" alt="eccentricity_ridgeline_morph_all_XrayReferenceFile2018.h5_2018.svg" />

<figcaption>Figure 18: <span class="figure-number">Figure 156: </span>Interpolation of all reference distribution for the eccentricity logL variable using bin wise linear interpolation based on the neighboring distributions. The real data is shown in red while the morphed data is shown in cyan. In most ridges the agreement is very good.</figcaption>
</figure>




<figure id="linear_interpolation_morph_lengthDivRmsTrans_all">
<img src="./figs/home/basti/phd/Figs/CDL/cdlMorphing/lengthDivRmsTrans_ridgeline_morph_all_XrayReferenceFile2018.h5_2018.svg" class="org-svg" alt="lengthDivRmsTrans_ridgeline_morph_all_XrayReferenceFile2018.h5_2018.svg" />

<figcaption>Figure 19: <span class="figure-number">Figure 157: </span>Interpolation of all reference distribution for the length / transverse RMS logL variable using bin wise linear interpolation based on the neighboring distributions. The real data is shown in red while the morphed data is shown in cyan. In most ridges the agreement is very good.</figcaption>
</figure>




<figure id="linear_interpolation_morph_fracRmsTrans_all">
<img src="./figs/home/basti/phd/Figs/CDL/cdlMorphing/fractionInTransverseRms_ridgeline_morph_all_XrayReferenceFile2018.h5_2018.svg" class="org-svg" alt="fractionInTransverseRms_ridgeline_morph_all_XrayReferenceFile2018.h5_2018.svg" />

<figcaption>Figure 20: <span class="figure-number">Figure 158: </span>Interpolation of all reference distribution for the fraction in transverse RMS logL variable using bin wise linear interpolation based on the neighboring distributions. The real data is shown in red while the morphed data is shown in cyan. In most ridges the agreement is very good.</figcaption>
</figure>
</div>
</div>


<div class="outline-5" id="outline-container-orgc029699">
<h5 id="orgc029699"><span class="section-number-5">28.6.1.4.</span> <span class="done DONE">DONE</span> Compute full linear interpolation between fluorescence lines</h5>
<div class="outline-text-5" id="text-28-6-1-4">
<p>
We can now apply the lessons from the last section to compute
arbitrary reference spectra. We will use this to compute a heatmap of
all possible energies in between the first and last fluorescence line.
</p>

<p>
For all three logL variables, these are shown in fig.
</p>



<figure id="linear_interpolation_raster_eccentricity">
<img src="./figs/home/basti/phd/Figs/CDL/cdlMorphing/cdl_as_raster_interpolated_eccentricity.svg" class="org-svg" alt="cdl_as_raster_interpolated_eccentricity.svg" />

<figcaption>Figure 21: <span class="figure-number">Figure 159: </span>Heatmap of a fully linear interpolated view of the energy / eccentricity phase space in between the first and last fluorescence line.</figcaption>
</figure>




<figure id="linear_interpolation_raster_lengthDivRmsTrans">
<img src="./figs/home/basti/phd/Figs/CDL/cdlMorphing/cdl_as_raster_interpolated_lengthDivRmsTrans.svg" class="org-svg" alt="cdl_as_raster_interpolated_lengthDivRmsTrans.svg" />

<figcaption>Figure 22: <span class="figure-number">Figure 160: </span>Heatmap of a fully linear interpolated view of the energy / lenthDivRmsTrans phase space in between the first and last fluorescence line.</figcaption>
</figure>




<figure id="linear_interpolation_raster_fracRmsTrans">
<img src="./figs/home/basti/phd/Figs/CDL/cdlMorphing/cdl_as_raster_interpolated_fractionInTransverseRms.svg" class="org-svg" alt="cdl_as_raster_interpolated_fractionInTransverseRms.svg" />

<figcaption>Figure 23: <span class="figure-number">Figure 161: </span>Heatmap of a fully linear interpolated view of the energy / fracRmsTrans phase space in between the first and last fluorescence line.</figcaption>
</figure>
</div>
</div>
</div>


<div class="outline-4" id="outline-container-org5ab99af">
<h4 id="org5ab99af"><span class="section-number-4">28.6.2.</span> KDE approach   <span class="tag">  <span class="extended">extended</span></span></h4>
<div class="outline-text-4" id="text-28-6-2">
<p>
Using a KDE is problematic, because our data is already pre-binned of
course. This leads to a very sparse phase space, which either makes
the local prediction around a known distribution good, but fails
miserably in between them (small bandwidth) or gives decent
predictions in between, but pretty bad reconstruction of the known
distributions (larger bandwidth).
</p>

<p>
There is also a strong conflict in bandwidth selection, due to the
non-linear steps in energy between the different CDL
distributions. This leads to a too large / too small bandwidth at
either end of the energy range.
</p>

<p>
Fig. <a href="eccentricity_ridgeline_morph_kde">24</a>,
<a href="fracTransRms_ridgeline_morph_kde">25</a>,
<a href="lengthDivRmsTrans_ridgeline_morph_kde">26</a> show the default bandwidth
(Silverman&apos;s rule of thumb). In comparison Fig. <a href="eccentricity_ridgeline_morph_kde_small_bw">27</a>,
<a href="fracTransRms_ridgeline_morph_kde_small_bw">28</a>,
<a href="lengthDivRmsTrans_ridgeline_morph_kde_small_bw">29</a> show the same plot
using a much smaller custom bandwidth of 0.3 keV. The agreement is
much better, but the actual prediction between the different
distributions becomes much worse. Compare
fig. <a href="eccentricity_raster_morph_kde">30</a> (default bandwidth) to
fig. <a href="eccentricity_raster_morph_kde_small_bw">31</a>. The latter has regions of
almost no counts, which is obviously wrong.
</p>

<p>
Note that also the fig. <a href="eccentricity_raster_morph_kde">30</a> is
problematic. An effect of a bad KDE input is visible, namely that the
bandwidth vs. number of datapoints is such that the center region (in
energy) has higher values than the edges, due to the fact that
predictions near the boundaries see no signal (this boundary effect
could be corrected for by assuming a suitable boundary conditions,
e.g. just extending the first/last distributions in the respective
ranges. It is not clear however in what spacing such a distribution
should be placed etc.
</p>



<figure id="eccentricity_ridgeline_morph_kde">
<img src="./figs/home/basti/phd/Figs/CDL/cdlMorphing/eccentricity_ridgeline_morph_kde.svg" class="org-svg" alt="eccentricity_ridgeline_morph_kde.svg" />

<figcaption>Figure 24: <span class="figure-number">Figure 162: </span>Reconstruction of the different eccentricity CDL distributions using a KDE with the bin counts as weights with the automatically computed bandwidth using Silverman&apos;s rule of thumb (about 1.6 keV in this case). Bad match with real data for low energies (top ridges).</figcaption>
</figure>




<figure id="fracTransRms_ridgeline_morph_kde">
<img src="./figs/home/basti/phd/Figs/CDL/cdlMorphing/fractionInTransverseRms_ridgeline_morph_kde.svg" class="org-svg" alt="fractionInTransverseRms_ridgeline_morph_kde.svg" />

<figcaption>Figure 25: <span class="figure-number">Figure 163: </span>Reconstruction of the different fraction in transverse RMS CDL distributions using a KDE with the bin counts as weights with the automatically computed bandwidth using Silverman&apos;s rule of thumb (about 1.6 keV in this case). Bad match with real data for low energies (top ridges).</figcaption>
</figure>




<figure id="lengthDivRmsTrans_ridgeline_morph_kde">
<img src="./figs/home/basti/phd/Figs/CDL/cdlMorphing/lengthDivRmsTrans_ridgeline_morph_kde.svg" class="org-svg" alt="lengthDivRmsTrans_ridgeline_morph_kde.svg" />

<figcaption>Figure 26: <span class="figure-number">Figure 164: </span>Reconstruction of the different length / transverse RMS CDL distributions using a KDE with the bin counts as weights with the automatically computed bandwidth using Silverman&apos;s rule of thumb (about 1.6 keV in this case). Bad match with real data for low energies (top ridges).</figcaption>
</figure>


<p>
\clearpage
</p>



<figure id="eccentricity_ridgeline_morph_kde_small_bw">
<img src="./figs/home/basti/phd/Figs/CDL/cdlMorphing/eccentricity_ridgeline_morph_kde_small_bw.svg" class="org-svg" alt="eccentricity_ridgeline_morph_kde_small_bw.svg" />

<figcaption>Figure 27: <span class="figure-number">Figure 165: </span>Reconstruction of the different eccentricity CDL distributions using a KDE with the bin counts as weights with a custom bandwidth of 0.3 keV. Bad match with real data for low energies (top ridges).</figcaption>
</figure>




<figure id="fracTransRms_ridgeline_morph_kde_small_bw">
<img src="./figs/home/basti/phd/Figs/CDL/cdlMorphing/fractionInTransverseRms_ridgeline_morph_kde_small_bw.svg" class="org-svg" alt="fractionInTransverseRms_ridgeline_morph_kde_small_bw.svg" />

<figcaption>Figure 28: <span class="figure-number">Figure 166: </span>Reconstruction of the different fraction in transverse RMS CDL distributions using a KDE with the bin counts as weights with a custom bandwidth of 0.3 keV. Bad match with real data for low energies (top ridges).</figcaption>
</figure>




<figure id="lengthDivRmsTrans_ridgeline_morph_kde_small_bw">
<img src="./figs/home/basti/phd/Figs/CDL/cdlMorphing/lengthDivRmsTrans_ridgeline_morph_kde_small_bw.svg" class="org-svg" alt="lengthDivRmsTrans_ridgeline_morph_kde_small_bw.svg" />

<figcaption>Figure 29: <span class="figure-number">Figure 167: </span>Reconstruction of the different length / transverse RMS CDL distributions using a KDE with the bin counts as weights with a custom bandwidth of 0.3 keV. Bad match with real data for low energies (top ridges).</figcaption>
</figure>


<p>
\clearpage
</p>



<figure id="eccentricity_raster_morph_kde">
<img src="./figs/home/basti/phd/Figs/CDL/cdlMorphing/eccentricity_raster_kde.svg" class="org-svg" alt="eccentricity_raster_kde.svg" />

<figcaption>Figure 30: <span class="figure-number">Figure 168: </span>Raster of the KDE interpolation for the eccentricity using the automatically determined bandwidth based on Silverman&apos;s rule of thumb (about 1.6 keV in this case). Boundary effects are visible due to apparent more activity near the center energies.</figcaption>
</figure>




<figure id="eccentricity_raster_morph_kde_small_bw">
<img src="./figs/home/basti/phd/Figs/CDL/cdlMorphing/eccentricity_raster_kde_small_bw.svg" class="org-svg" alt="eccentricity_raster_kde_small_bw.svg" />

<figcaption>Figure 31: <span class="figure-number">Figure 169: </span>Raster of the KDE interpolation for the eccentricity using a custom bandwidth of 0.3 keV. Better agreement at the different CDL target energies at the expense of a reasonable prediction between the different regions.</figcaption>
</figure>
</div>
</div>


<div class="outline-4" id="outline-container-orga981db8">
<h4 id="orga981db8"><span class="section-number-4">28.6.3.</span> Spline approach</h4>
<div class="outline-text-4" id="text-28-6-3">
<p>
Another idea is to use a spline interpolation. This has the advantage
that the existing distributions will be correctly predicted (as for
the linear interpolation), but possibly yields better results between
distributions (or in the case of predicting a known distributions.
</p>

<p>
Fig. <a href="eccentricity_ridgeline_morph_spline">32</a>,
<a href="fracTransRms_ridgeline_morph_spline">33</a>,
<a href="lengthDivRmsTrans_ridgeline_morph_spline">34</a> show the prediction using a
spline. Same as for the linear interpolation each morphed distribution
was computed by excluding that distribution from the spline definition
and then predicting the energy of the respective fluorescence line.
</p>

<p>
The result looks somewhat better in certain areas than the linear
interpolation, but has unphysical artifacts in other areas (negative
values) while also deviating quite a bit. For that reason it seems
like simpler is better in case of CDL morphing (at least if it&apos;s done
bin-wise).
</p>



<figure id="eccentricity_ridgeline_morph_spline">
<img src="./figs/home/basti/phd/Figs/CDL/cdlMorphing/eccentricity_ridgeline_morph_spline.svg" class="org-svg" alt="eccentricity_ridgeline_morph_spline.svg" />

<figcaption>Figure 32: <span class="figure-number">Figure 170: </span>Reconstruction of the different eccentricity CDL distributions using a spline interpolation (by excluding each distribution that is being predicted). Prediction sometimes even yields negative values, highlighting the problems of a spline in certain use cases (unphysical results).</figcaption>
</figure>




<figure id="fracTransRms_ridgeline_morph_spline">
<img src="./figs/home/basti/phd/Figs/CDL/cdlMorphing/fractionInTransverseRms_ridgeline_morph_spline.svg" class="org-svg" alt="fractionInTransverseRms_ridgeline_morph_spline.svg" />

<figcaption>Figure 33: <span class="figure-number">Figure 171: </span>Reconstruction of the different fraction in transverse RMS CDL distributions using a spline interpolation (by excluding each distribution that is being predicted). Prediction sometimes even yields negative values, highlighting the problems of a spline in certain use cases (unphysical results).</figcaption>
</figure>




<figure id="lengthDivRmsTrans_ridgeline_morph_spline">
<img src="./figs/home/basti/phd/Figs/CDL/cdlMorphing/lengthDivRmsTrans_ridgeline_morph_spline.svg" class="org-svg" alt="lengthDivRmsTrans_ridgeline_morph_spline.svg" />

<figcaption>Figure 34: <span class="figure-number">Figure 172: </span>Reconstruction of the different length / transverse RMS CDL distributions using a spline interpolation (by excluding each distribution that is being predicted). Prediction sometimes even yields negative values, highlighting the problems of a spline in certain use cases (unphysical results).</figcaption>
</figure>


<p>
\clearpage
</p>
</div>
</div>

<div class="outline-4" id="outline-container-org367e39d">
<h4 id="org367e39d"><span class="section-number-4">28.6.4.</span> Summary</h4>
<div class="outline-text-4" id="text-28-6-4">
<p>
For the time being we will use the linear interpolation method and see
where this leads us. Should definitely be a big improvement over the
current interval based option.
</p>

<p>
For the results of applying linear interpolation based morphing to the
likelihood analysis see section [BROKEN LINK: Effects of Morphing on background rate].
</p>
</div>
</div>

<div class="outline-4" id="outline-container-orgd569208">
<h4 id="orgd569208"><span class="section-number-4">28.6.5.</span> Implementation in <code>likelihood.nim</code></h4>
<div class="outline-text-4" id="text-28-6-5">
<p>
Thoughts on the implememntition in <code>likelihood.nim</code> or CDL morphing.
</p>

<ol class="org-ol">
<li>Add interpolation code from <code>cdlMorphing.nim</code> in
<code>private/cdl_cuts.nim</code>.</li>
<li>Add a field to <code>config.nim</code> that describes the morphing technique
to be used.</li>
<li>Add an enum for the possible morphing techniques, <code>MorphingKind</code>
with fields <code>mkNone</code>, <code>mkLinear</code></li>
<li>In <code>calcCutValueTab</code> we currently return a <code>Table[string, float]</code>
mapping target/filter combinations to cut values. This needs to be
modified such that we have something that hides away input -&gt;
output and yields what we need.
Define an <code>CutValueInterpolator</code> type, which is returned
instead. It will be a variant object with case <code>kind:
   MorphingKind</code>.
This object will allow access to cut values based on:
<ul class="org-ul">
<li><code>string</code>: a target/filter combination.
<ul class="org-ul">
<li><code>mkNone</code>: access internal <code>Table[string, float]</code> as done
currently</li>
<li><code>mkLinear</code>: raise exception, since does not make sense</li>
</ul></li>
<li><code>float</code>: an energy in keV:
<ul class="org-ul">
<li><code>mkNone</code>: convert energy to a target/filter combination and
access internal <code>Table</code></li>
<li><code>mkLinear</code>: access the closest energy distribution and return
its cut value</li>
</ul></li>
</ul></li>
<li>in <code>filterClustersByLogL</code> replace <code>cutTab</code> name and access by
energy of cluster instead of converted to target/filter dataset</li>
</ol>

<p>
With these steps we should have a working interpolation routine. The
code used in the <code>cdlMorphing.nim</code> test script needs to be added of
course to provide the linearly interpolated logic (see step 0).
</p>
</div>

<div class="outline-5" id="outline-container-orgdd57d77">
<h5 id="orgdd57d77"><span class="section-number-5">28.6.5.1.</span> Bizarre Al-Al 4kV behavior with <code>mkLinear</code></h5>
<div class="outline-text-5" id="text-28-6-5-1">
<p>
After the first implementation we see some very bizarre behavior in
the case of linear interpolation for the logL distributions.
</p>

<p>
This is both visible with the <code>plotCdl.nim</code> as well as plotting code
in <code>likelihood.nim</code>.
</p>

<p>
See fig. <a href="cdl_logL_linear_bizarre_Al_Al_4kV">35</a>.
</p>



<figure id="cdl_logL_linear_bizarre_Al_Al_4kV">
<img src="./figs/home/basti/phd/Figs/CDL/cdlMorphing/cdl_logl_linear_bizarre_Al_Al_4kV.svg" class="org-svg" alt="cdl_logl_linear_bizarre_Al_Al_4kV.svg" />

<figcaption>Figure 35: <span class="figure-number">Figure 173: </span>LogL distribitions after implementing linear interpolation and running with <code>mkLinear</code>. The Al-Al 4kV line is noweher near where we expect it. The code currently recomputes the logL values by default, in which the <code>mkLinear</code> plays a role. The bug has to be somewhere in that part of the interpolation.</figcaption>
</figure>


<p>
<b>UPDATE</b>: The issue was a couple of bugs &amp; design choices in the
implementation of the linear interpolation in
<code>likelihood_utils.nim</code>. In particular about the design of the DF
returned from <code>getInterpolatedWideDf</code> and a bug accessing not the sub
DF, but the actual DF in the loop.
</p>

<p>
The fixed result is shown in fig. <a href="cdl_logL_linear_fixed">36</a> and in
comparison the result using no interpolation (the reference in a way)
in fig. <a href="cdl_logL_no_interp">37</a>.
</p>



<figure id="cdl_logL_linear_fixed">
<img src="./figs/home/basti/phd/Figs/CDL/cdlMorphing/cdl_logl_linear_fixed.svg" class="org-svg" alt="cdl_logl_linear_fixed.svg" />

<figcaption>Figure 36: <span class="figure-number">Figure 174: </span>LogL distribitions after implementing linear interpolation and running with <code>mkLinear</code> and after the above mentioned bug has been fixed. This is the same result as for <code>mkNone</code>, see fig. <a href="cdl_logL_no_interp">37</a>.</figcaption>
</figure>




<figure id="cdl_logL_no_interp">
<img src="./figs/home/basti/phd/Figs/CDL/cdlMorphing/cdl_logl_no_interp.svg" class="org-svg" alt="cdl_logl_no_interp.svg" />

<figcaption>Figure 37: <span class="figure-number">Figure 175: </span>LogL distribitions after implementing linear interpolation and running with <code>mkLinear</code> and after the above mentioned bug has been fixed. This is the same result as for <code>mkNone</code>, see fig. <a href="cdl_logL_no_interp">37</a>.</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>


<div class="hint-message">Click on any heading marked '<span class="extended">extended</span>' to open it</div>
</div>
</body>
</html>
