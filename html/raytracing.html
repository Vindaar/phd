<!DOCTYPE html>
<html lang="en">
<head>
<!--  2024-06-18 Tue 23:44  -->
<meta charset="utf-8" />
<meta content="width=device-width, initial-scale=1" name="viewport" />
<title>‎</title>
<meta content="Vindaar" name="author" />
<meta content="Org Mode" name="generator" />

<link type="text/css" rel="stylesheet" href="org_html_export.css" />
<script type="text/javascript">

document.addEventListener('DOMContentLoaded', function() {
    // Set the initial width for subfigures and their images
    document.querySelectorAll('figure.subfigure[data-width]').forEach(function(subfigure) {
        subfigure.style.width = subfigure.getAttribute('data-width');
    });

    document.querySelectorAll('figure.subfigure img[data-width]').forEach(function(img) {
        img.style.width = img.getAttribute('data-width');
    });

    // Event listener for images within subfigures
    document.querySelectorAll('figure.subfigure img[data-width]').forEach(function(img) {
        img.addEventListener('click', function() {
            // Determine the .figure-wrapper that contains the clicked image
            let wrapper = this.closest('.figure-wrapper');

            // If found, adjust the sizes of its subfigures
            if (wrapper) {
                let subfigures = wrapper.querySelectorAll('figure.subfigure');
                subfigures.forEach(subfigure => {
                    let width = parseFloat(subfigure.getAttribute('data-width'));
                    if (width < 50) { // Double size if less than 50%
                        subfigure.setAttribute('data-width', (width * 2) + '%');
                        subfigure.style.width = (width * 2) + '%';
                    } else { // Halve size otherwise
                        subfigure.setAttribute('data-width', (width / 2) + '%');
                        subfigure.style.width = (width / 2) + '%';
                    }
                });
            }
        });
    });
});

document.addEventListener('DOMContentLoaded', function () {
    var headers = document.querySelectorAll('h1 .extended, h2 .extended, h3 .extended, h4 .extended, h5 .extended, h6 .extended');

    headers.forEach(function (header) {
        var foldableHeader = header.closest('h1, h2, h3, h4, h5, h6');
        if (foldableHeader) {
            foldableHeader.classList.add('foldable-header');
            var nextElement = foldableHeader.nextElementSibling;
            var contentToFold = [];
            while (nextElement && !nextElement.matches('h1, h2, h3, h4, h5, h6')) {
                contentToFold.push(nextElement);
                nextElement = nextElement.nextElementSibling;
            }
            contentToFold.forEach(function (element) {
                element.classList.add('folded-content');
            });

            foldableHeader.addEventListener('click', function () {
                contentToFold.forEach(function (element) {
                    if (element.style.display === 'none' || element.style.display == '') {
                        element.style.display = 'block';
                    } else {
                        element.style.display = 'none';
                    }
                });
            });
        }
    });
});

</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript"></script>
<script type="text/x-mathjax-config">
<!-- /* --><![CDATA[/*><!--*/
    MathJax.Hub.Config({
        jax: ["input/TeX", "output/HTML-CSS"],
        extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js",
                     "TeX/noUndefined.js", "[Contrib]/siunitx/siunitx.js", "[Contrib]/mhchem/mhchem.js"],
        tex2jax: {
            inlineMath: [ ["\\(","\\)"], ['$', '$'], ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"], ["\\begin{displaymath}","\\end{displaymath}"] ],
            skipTags: ["script","noscript","style","textarea","pre","code"],
            ignoreClass: "tex2jax_ignore",
            processEscapes: false,
            processEnvironments: true,
            preview: "TeX"
        },
        showProcessingMessages: true,
        displayAlign: "center",
        displayIndent: "2em",

        "HTML-CSS": {
             scale: 1.0,
             availableFonts: ["STIX","TeX"],
             preferredFont: "TeX",
             webFont: "TeX",
             imageFont: "TeX",
             showMathMenu: true,
        },
        MMLorHTML: {
             prefer: {
                 MSIE:    "MML",
                 Firefox: "MML",
                 Opera:   "HTML",
                 other:   "HTML"
             }
        },
        TeX: {
              equationNumbers: { autoNumber: 'AMS' },
              Macros: {
                  ccsini: '{\\mathrm{Si}₃\\mathrm{N}₄}',
                  cefe: '{\\ce{^{55}Fe}}',
                  vektor: ['{\\begin{pmatrix}#1\\end{pmatrix}}', 1],
                  mtrix: ['{\\begin{pmatrix}#1\\end{pmatrix}}', 1],
                  cp: '{\\mathrm{CP}}',
                  cpt: '{\\mathrm{CPT}}',
                  dd: '{\\mathop{}\\!{\\mathrm{d}}}',
                  sinc: '{\\mathrm{sinc}}'
              }
        }
    });
/*]]>*///--&gt;
</script>
</head>
<body>
<div id="content" class="content">
<nav role="doc-toc" id="table-of-contents">
<h2>Table of Contents</h2>
<div role="doc-toc" id="text-table-of-contents">
<ul>
<li>  <a href="./errata.html#sec:errata">1. Errata   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./introduction.html#sec:introduction">2. Introduction   <span class="tag">    <span class="Intro">Intro</span>  </span></a></li>
<li><a href="./about_thesis.html#sec:about_thesis">3. About this thesis   <span class="tag">  <span class="Intro">Intro</span></span></a>
<ul>
<li>  <a href="./about_thesis.html#orgc36e3ba">3.1. Extended notes for the extended thesis <code>[/]</code>   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./about_thesis.html#org976c329">3.2. Why Org mode   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./about_thesis.html#orga7aaacb">3.3. Notes for future PhD students and IAXO analyses   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li><a href="./theory.html#sec:theory">4. Theory of axions   <span class="tag">  <span class="Theory">Theory</span></span></a>
<ul>
<li>  <a href="./theory.html#sec:theory:useful_reading_material">4.1. Useful reading material   <span class="tag">    <span class="optional">optional</span>  </span></a></li>
<li>  <a href="./theory.html#sec:theory:illustration_cpt">4.2. Illustration of the \cpt symmetry <code>[/]</code>   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./theory.html#sec:theory:invisible_axion_models">4.3. Invisible axion models and axion couplings</a></li>
<li>  <a href="./theory.html#sec:theory:axion_interactions">4.4. Implications for axion interactions - conversion probability</a></li>
<li>  <a href="./theory.html#sec:theory:solar_axion_flux">4.5. Solar axion flux</a></li>
<li>  <a href="./theory.html#sec:theory:chameleon">4.6. Chameleons</a></li>
<li>  <a href="./theory.html#sec:theory:current_bounds">4.7. Current bounds on coupling constants</a></li>
</ul>
</li>
<li><a href="./helioscopes.html#sec:helioscopes">5. Axion helioscopes   <span class="tag">  <span class="Theory">Theory</span></span></a>
<ul>
<li>  <a href="./helioscopes.html#sec:helioscopes:cast">5.1. CERN Axion Solar Telescope (CAST)</a></li>
<li>  <a href="./helioscopes.html#sec:helioscopes:iaxo">5.2. International AXion Observatory (IAXO)</a></li>
</ul>
</li>
<li><a href="./theory_detector.html#sec:theory_detector">6. X-rays, cosmic muons and gaseous detectors   <span class="tag">  <span class="Theory">Theory</span></span></a>
<ul>
<li>  <a href="./theory_detector.html#sec:theory:particle_int">6.1. Particle interactions with matter</a></li>
<li>  <a href="./theory_detector.html#sec:theory:cosmic_radiation">6.2. Cosmic rays</a></li>
<li>  <a href="./theory_detector.html#sec:theory:gas_fundamentals">6.3. Gaseous detector fundamentals</a></li>
</ul>
</li>
<li><a href="./septemboard.html#sec:septemboard">7. Septemboard detector   <span class="tag">  <span class="Detector">Detector</span></span></a>
<ul>
<li>  <a href="./septemboard.html#sec:detector:micromegas">7.1. Micromegas working principle</a></li>
<li>  <a href="./septemboard.html#sec:detector:timepix">7.2. Timepix ASIC</a></li>
<li>  <a href="./septemboard.html#sec:detector:gridpix">7.3. GridPix</a></li>
<li>  <a href="./septemboard.html#sec:detector:detector_2014_15">7.4. 2014 / 2015 GridPix detector for CAST</a></li>
<li>  <a href="./septemboard.html#sec:detector:detector_overview">7.5. Septemboard detector overview</a></li>
<li>  <a href="./septemboard.html#orgc654d28">7.6. Detector readout system</a></li>
<li>  <a href="./septemboard.html#sec:detector:scintillators">7.7. Scintillator vetoes</a></li>
<li>  <a href="./septemboard.html#sec:detector:fadc">7.8. FADC</a></li>
<li>  <a href="./septemboard.html#sec:detector:sin_window">7.9. SiN window</a></li>
<li>  <a href="./septemboard.html#sec:detector:septemboard">7.10. Septemboard - 6 GridPixes around a center one</a></li>
<li>  <a href="./septemboard.html#sec:detector:water_cooling">7.11. Water cooling and temperature readout for the septemboard</a></li>
<li>  <a href="./septemboard.html#sec:septem:efficiency">7.12. Detector efficiency</a></li>
<li>  <a href="./septemboard.html#sec:detector:daq">7.13. Data acquisition and detector monitoring</a></li>
</ul>
</li>
<li><a href="./operation_calibration.html#sec:operation_calibration">8. Detector calibration for operation   <span class="tag">  <span class="Detector">Detector</span></span></a>
<ul>
<li>  <a href="./operation_calibration.html#sec:operation_calibration:timepix">8.1. Timepix calibrations</a></li>
<li>  <a href="./operation_calibration.html#sec:operation_calibration:fadc">8.2. FADC calibration</a></li>
<li>  <a href="./operation_calibration.html#sec:operation_calibration:scintillators">8.3. Scintillator calibration</a></li>
</ul>
</li>
<li><a href="./reconstruction.html#sec:reconstruction">9. Data reconstruction   <span class="tag">  <span class="Reconstruction">Reconstruction</span></span></a>
<ul>
<li>  <a href="./reconstruction.html#sec:reco:tpa">9.1. <code>TimepixAnalysis</code> and Nim</a></li>
<li>  <a href="./reconstruction.html#sec:reco:tos_data_parsing">9.2. TOS data parsing</a></li>
<li>  <a href="./reconstruction.html#sec:reco:event_shape">9.3. Expectation of event shapes</a></li>
<li>  <a href="./reconstruction.html#sec:reco:data_reconstruction">9.4. Data reconstruction</a></li>
<li>  <a href="./reconstruction.html#sec:reco:fadc_data">9.5. FADC reconstruction</a></li>
<li>  <a href="./reconstruction.html#sec:reco:scintillator_data">9.6. Scintillator data</a></li>
</ul>
</li>
<li><a href="./cast.html#sec:cast">10. Detector installation &amp; data taking at CAST   <span class="tag">  <span class="CAST">CAST</span></span></a>
<ul>
<li>  <a href="./cast.html#sec:cast:timeline">10.1. Timeline</a></li>
<li>  <a href="./cast.html#sec:cast:alignment">10.2. Alignment</a></li>
<li>  <a href="./cast.html#sec:cast:detector_setup">10.3. Detector setup at CAST</a></li>
<li>  <a href="./cast.html#sec:cast:window_accident">10.4. Window accident</a></li>
<li>  <a href="./cast.html#sec:cast:data_taking_woes">10.5. Data taking woes</a></li>
<li>  <a href="./cast.html#sec:cast:data_taking_campaigns">10.6. Summary of CAST data taking</a></li>
</ul>
</li>
<li><a href="./calibration.html#sec:calibration">11. Data calibration   <span class="tag">  <span class="Calibration">Calibration</span></span></a>
<ul>
<li>  <a href="./calibration.html#sec:calibration:energy">11.1. Energy calibration - in principle</a></li>
<li>  <a href="./calibration.html#sec:calib:detector_behavior_over_time">11.2. Detector behavior over time</a></li>
<li>  <a href="./calibration.html#sec:calib:final_energy_calibration">11.3. Energy calibration dependence on the gas gain</a></li>
<li>  <a href="./calibration.html#sec:calib:fadc">11.4. FADC</a></li>
</ul>
</li>
<li><a href="./background.html#sec:background">12. Finding signal and defining background | Background rate computation   <span class="tag">  <span class="Analysis">Analysis</span></span></a>
<ul>
<li>  <a href="./background.html#sec:background:likelihood_method">12.1. Likelihood method</a></li>
<li>  <a href="./background.html#sec:cdl">12.2. CAST Detector Lab</a></li>
<li>  <a href="./background.html#sec:background:likelihood_cut">12.3. Application of likelihood cut for background rate</a></li>
<li>  <a href="./background.html#sec:background:mlp">12.4. Artificial neural networks as cluster classifiers</a></li>
<li>  <a href="./background.html#sec:background:additional_vetoes">12.5. Additional detector features as vetoes</a></li>
<li>  <a href="./background.html#sec:background:all_vetoes_combined">12.6. Background rates of combined vetoes and efficiencies</a></li>
</ul>
</li>
<li><a href="./limit.html#sec:limit">13. Limit calculation   <span class="tag">  <span class="Limit">Limit</span></span></a>
<ul>
<li>  <a href="./limit.html#sec:limit:method_introduction">13.1. Limit method - introduction</a></li>
<li>  <a href="./limit.html#sec:limit:method_likelihood">13.2. Limit method - likelihood function \(\mathcal{L}\)</a></li>
<li>  <a href="./limit.html#sec:limit:method_computing_L">13.3. Limit method - computing \(\mathcal{L}\)</a></li>
<li>  <a href="./limit.html#sec:limit:method_computing_a_limit">13.4. Limit method - computing a limit</a></li>
<li>  <a href="./limit.html#sec:limit:method_expected_limit">13.5. Limit method - toy candidate sets and expected limits</a></li>
<li>  <a href="./limit.html#sec:limit:method_systematics">13.6. Limit method - extending \(\mathcal{L}\) for systematics</a></li>
<li>  <a href="./limit.html#sec:limit:method_mcmc">13.7. Limit method - evaluating \(\mathcal{L}\) with nuisance parameters</a></li>
<li>  <a href="./limit.html#org5e81b6c">13.8. Note about likelihood integral   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./limit.html#orge06cfa1">13.9. Derivation of short form of \(\mathcal{L}\) <code>[/]</code>   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./limit.html#sec:limit:ingredients">13.10. Likelihood ingredients in detail</a></li>
<li>  <a href="./limit.html#sec:limit:systematics">13.11. Systematics</a></li>
<li>  <a href="./limit.html#sec:limit:mcmc_calc_limit">13.12. MCMC to sample the distribution and compute a limit</a></li>
<li>  <a href="./limit.html#sec:limit:expected_limits">13.13. Expected limits of different setups</a></li>
<li>  <a href="./limit.html#sec:limit:candidates">13.14. Solar tracking candidates</a></li>
<li>  <a href="./limit.html#sec:limit:observed_limit">13.15. Observed limit - \(g_{ae}\)</a></li>
<li>  <a href="./limit.html#sec:limit:other_couplings">13.16. Other coupling constants</a></li>
<li>  <a href="./limit.html#orgc627f43">13.17. Comparison to 2013 limit (using their method)   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./limit.html#orgda19ced">13.18. Observed limit for different axion masses   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li>  <a href="./outlook.html#sec:outlook">14. Outlook</a></li>
<li>  <a href="./summary.html#sec:summary">15. Summary &amp; conclusion</a></li>
<li>  <a href="./bibliography.html#sec:bibliography">16. Bibliography   <span class="tag">    <span class="html">html</span>  </span></a></li>
<li><a href="./daq.html#sec:daq">17. Data acquisition and detector monitoring   <span class="tag"><span class="Appendix">Appendix</span> <span class="Detector">Detector</span></span></a>
<ul>
<li>  <a href="./daq.html#sec:daq:tof">17.1. Timepix Operating Firmware - TOF</a></li>
<li>  <a href="./daq.html#sec:daq:tos">17.2. Timepix Operating Software - TOS</a></li>
<li>  <a href="./daq.html#sec:daq:septemboard_event_display">17.3. Septemboard event display</a></li>
</ul>
</li>
<li><a href="./configuration.html#sec:appendix:configuration">18. Configuration and TOS / TOF versions   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./configuration.html#sec:appendix:configuration:tos_config">18.1. TOS configuration file</a></li>
<li>  <a href="./configuration.html#sec:appendix:configuration:tos_tof_versions">18.2. TOS and TOF versions used at CAST</a></li>
</ul>
</li>
<li><a href="./calibration.html#sec:appendix:calibration">19. Calibrations   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./calibration.html#sec:appendix:calibration:timepix">19.1. Timepix calibrations</a></li>
<li>  <a href="./calibration.html#sec:appendix:septemboard_calibrations">19.2. Septemboard calibration</a></li>
<li>  <a href="./calibration.html#sec:appendix:scintillator_calibration_notes">19.3. Calibration measurements of the veto scintillator paddle   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li><a href="./cast_operations.html#sec:appendix:cast_operations">20. CAST operation procedures   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./cast_operations.html#sec:appendix:cast_operations:terminology">20.1. CAST terminology</a></li>
<li>  <a href="./cast_operations.html#sec:cast:high_voltage">20.2. High voltage supply</a></li>
<li>  <a href="./cast_operations.html#sec:cast:vacuum_system">20.3. Vacuum system</a></li>
<li>  <a href="./cast_operations.html#sec:cast:watercooling_gas">20.4. Watercooling system &amp; gas supply</a></li>
<li>  <a href="./cast_operations.html#sec:cast:interlock_systems">20.5. Interlock systems</a></li>
<li>  <a href="./cast_operations.html#sec:appendix:cast_log_files">20.6. CAST log files</a></li>
</ul>
</li>
<li><a href="./cast_run_list.html#sec:appendix:cast_run_list">21. CAST data taking run list   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./cast_run_list.html#orgd304089">21.1. Full version   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li><a href="./cast_data_taking_notes.html#sec:appendix:cast_data_taking_notes">22. CAST data taking notes <code>[0/1]</code>   <span class="tag"><span class="Appendix">Appendix</span> <span class="extended">extended</span></span></a>
<ul>
<li>  <a href="./cast_data_taking_notes.html#orge4011be">22.1. Run table</a></li>
<li>  <a href="./cast_data_taking_notes.html#orgeba5174">22.2. Data runs</a></li>
<li>  <a href="./cast_data_taking_notes.html#orgd62eab2">22.3. Calibration runs</a></li>
<li>  <a href="./cast_data_taking_notes.html#org0271f47">22.4. Automatically generated run list</a></li>
<li>  <a href="./cast_data_taking_notes.html#orgb34c028">22.5. Automatically calculated total run times</a></li>
<li>  <a href="./cast_data_taking_notes.html#org338e161">22.6. InGrid temperature from shift forms</a></li>
</ul>
</li>
<li><a href="./cabling_and_softwar_setup.html#sec:appendix:cabling_and_softwar_setup">23. Cabling &amp; software setup <code>[/]</code>   <span class="tag"><span class="Appendix">Appendix</span> <span class="extended">extended</span></span></a>
<ul>
<li>  <a href="./cabling_and_softwar_setup.html#org7cb11ec">23.1. Virtex V6 cabling</a></li>
<li>  <a href="./cabling_and_softwar_setup.html#org3244c1a">23.2. Detector cabling</a></li>
<li>  <a href="./cabling_and_softwar_setup.html#org7c3b445">23.3. Vivado / ISE on void linux &amp; flashing Virtex V6</a></li>
<li>  <a href="./cabling_and_softwar_setup.html#orgda4f123">23.4. Setting up the chips in TOS</a></li>
</ul>
</li>
<li><a href="./vacuum_contamination.html#sec:appendix:vacuum_contamination">24. Window rupture and vacuum contamination   <span class="tag"><span class="Appendix">Appendix</span> <span class="extended">extended</span></span></a>
<ul>
<li>  <a href="./vacuum_contamination.html#org35e49a4">24.1. Calculation of vacuum volume</a></li>
<li>  <a href="./vacuum_contamination.html#orgdf125cb">24.2. Calculation of potential influx of gas</a></li>
<li>  <a href="./vacuum_contamination.html#orgf5a7285">24.3. Consider pumping of pumps</a></li>
<li>  <a href="./vacuum_contamination.html#orgeeae0bd">24.4. Calculation of possible contamination</a></li>
</ul>
</li>
<li><a href="./detector_time_behavior.html#sec:appendix:detector_time_behavior">25. Detector behavior over time   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./detector_time_behavior.html#sec:appendix:choice_gas_gain_binning">25.1. Choice of gas gain binning time interval</a></li>
<li>  <a href="./detector_time_behavior.html#sec:appendix:correlation_gas_gain_ambient_temp">25.2. Correlation of gas gain and ambient CAST temperature</a></li>
</ul>
</li>
<li><a href="./cast_detector_lab.html#sec:appendix:cast_detector_lab">26. CAST Detector Lab data   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./cast_detector_lab.html#orgfed071e">26.1. Generate all spectrum plots split by run   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./cast_detector_lab.html#sec:appendix:cdl_spectra_by_run">26.2. All spectra split by run</a></li>
<li>  <a href="./cast_detector_lab.html#sec:appendix:cdl:all_spectra_fits">26.3. All CDL spectra with line fits   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./cast_detector_lab.html#sec:appendix:cdl:all_spectra_fits_by_run">26.4. All CDL spectra with line fits by run</a></li>
</ul>
</li>
<li><a href="./fit_by_run_justification.html#sec:appendix:fit_by_run_justification">27. CAST Detector Lab variations and fitting by run   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./fit_by_run_justification.html#sec:appendix:fit_by_run:gas_gain_var_cluster_prop">27.1. Influence of gas gain variations on cluster properties</a></li>
</ul>
</li>
<li><a href="./morphing_cdl_spectra.html#sec:appendix:morphing_cdl_spectra">28. Morphing of CDL reference spectra   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./morphing_cdl_spectra.html#orgabd5f0e">28.1. Generate all morphing / tile related plots   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./morphing_cdl_spectra.html#orga5d9c5b">28.2. Generate plot comparing likelihood behavior   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./morphing_cdl_spectra.html#sec:appendix:morphing_cdl_spectra:tilemaps">28.3. Tilemap of each likelihood dataset</a></li>
<li>  <a href="./morphing_cdl_spectra.html#sec:appendix:morphing_cdl_spectra:interpolation_raster">28.4. Interpolation of each likelihood dataset</a></li>
<li>  <a href="./morphing_cdl_spectra.html#sec:appendix:morphing_cdl_spectra:binwise_linear">28.5. Binwise linear interpolations for each likelihood dataset</a></li>
<li>  <a href="./morphing_cdl_spectra.html#org218c56a">28.6. Notes on CDL morphing development   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li><a href="./occupancy.html#sec:appendix:occupancy">29. Occupancy maps   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./occupancy.html#orgdce408e">29.1. Run-2</a></li>
<li>  <a href="./occupancy.html#orge5d3863">29.2. Run-3</a></li>
<li>  <a href="./occupancy.html#org971382a">29.3. Generate occupancy map plots   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li><a href="./fadc.html#sec:appendix:fadc">30. FADC   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./fadc.html#sec:appendix:fadc:rise_fall">30.1. FADC rise and fall time</a></li>
<li>  <a href="./fadc.html#sec:appendix:background:fadc">30.2. FADC veto</a></li>
<li>  <a href="./fadc.html#org517ef50">30.3. Generate plot of rise time vs skewness   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./fadc.html#sec:appendix:fadc_veto_empirical_cluster_length">30.4. Expected cluster size</a></li>
</ul>
</li>
<li><a href="./background_rates.html#sec:appendix:background_rates">31. Raw data and background rates   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./background_rates.html#sec:appendix:background_rates:full_chip">31.1. Background rates over full chip</a></li>
<li>  <a href="./background_rates.html#org01e8b4b">31.2. Generate rate without any vetoes over full chip   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./background_rates.html#org2774ce8">31.3. Generate background rates over full chip   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./background_rates.html#orgd0f5dfb">31.4. Generate table of background rates for all setups   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li>  <a href="./background_interpolation_chip_area.html#sec:appendix:background_interpolation_chip_area">32. Background interpolation chip cutout correction   <span class="tag">    <span class="Appendix">Appendix</span>  </span></a></li>
<li><a href="./limit_additional.html#sec:appendix:limit_additional">33. Additional limit information   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./limit_additional.html#sec:appendix:conversion_probability">33.1. Conversion probability as a function of mass   <span class="tag">    <span class="Appendix">Appendix</span>  </span></a></li>
<li>  <a href="./limit_additional.html#sec:appendix:exp_limit_percentiles">33.2. Expected limit table with percentiles</a></li>
<li>  <a href="./limit_additional.html#sec:appendix:limit_additional:axion_photon">33.3. Observed limit - axion photon \(g_{aγ}\)</a></li>
<li>  <a href="./limit_additional.html#sec:appendix:limit_additional:chameleon">33.4. Observed limit - chameleon \(β_γ\)</a></li>
</ul>
</li>
<li><a href="./software.html#sec:appendix:software">34. Software   <span class="tag"><span class="Software">Software</span> <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./software.html#orgbae2c69">34.1. Why did I start writing my own analysis framework?   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./software.html#org13d471b">34.2. Nim   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./software.html#sec:appendix:timepix_analysis">34.3. TimepixAnalysis</a></li>
<li>  <a href="./software.html#orgb88ee40">34.4. Other libraries relevant for TimepixAnalysis</a></li>
</ul>
</li>
<li><a href="./full_data_reconstruction.html#sec:appendix:full_data_reconstruction">35. Full data reconstruction   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./full_data_reconstruction.html#org39ad6bd">35.1. Raw data parsing and reconstruction</a></li>
<li>  <a href="./full_data_reconstruction.html#org1eac87c">35.2. Parse and reconstruct the CDL data</a></li>
<li>  <a href="./full_data_reconstruction.html#org09b2461">35.3. Add tracking information to background files</a></li>
<li>  <a href="./full_data_reconstruction.html#org3344338">35.4. Using <code>runAnalysisChain</code></a></li>
<li>  <a href="./full_data_reconstruction.html#org18a2de7">35.5. Applying a classifier</a></li>
<li>  <a href="./full_data_reconstruction.html#org17bde80">35.6. Computing limits</a></li>
</ul>
</li>
<li><a href="./average_depth_xrays_argon.html#sec:appendix:average_depth_xrays_argon">36. Average distance X-rays travel in argon at CAST conditions   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./average_depth_xrays_argon.html#org2d84fd5">36.1. Reference to original document   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./average_depth_xrays_argon.html#org11eec4e">36.2. Calculate conversion point numerically</a></li>
<li>  <a href="./average_depth_xrays_argon.html#org28b81a5">36.3. Compiling and running the code   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li><a href="./raytracing.html#sec:appendix:raytracing">37. Raytracing   <span class="tag"><span class="Software">Software</span> <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./raytracing.html#sec:appendix:raytracing:traxer">37.1. TrAXer - An interactive axion raytracer</a></li>
<li>  <a href="./raytracing.html#sec:appendix:raytracing:llnl_telescope">37.2. A few more details about the LLNL telescope</a></li>
<li>  <a href="./raytracing.html#sec:appendix:raytracing:panter">37.3. Comparison of TrAXer results with PANTER measurements</a></li>
<li>  <a href="./raytracing.html#sec:appendix:raytracing:axion_image">37.4. Computing an axion image with TrAXer</a></li>
<li>  <a href="./raytracing.html#org7d687b6">37.5. Reproducing an X-ray finger run with TrAXer   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./raytracing.html#orgc4745d9">37.6. Figure error development notes   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li>  <a href="./acknowledgments.html#sec:appendix:acknowledgments">38. Acknowledgments   <span class="tag">    <span class="Part5">Part5</span>  </span></a></li>
</ul>
</div>
</nav>
<div class="outline-2" id="outline-container-sec:appendix:raytracing">
<h2 id="sec:appendix:raytracing"><span class="section-number-2">37.</span> Raytracing   <span class="tag"><span class="Software">Software</span> <span class="Appendix">Appendix</span></span></h2>
<div class="outline-text-2" id="text-sec:appendix:raytracing">
<p>
In this appendix we will introduce the concept of raytracing, present
our raytracer in sec. <a href="./raytracing.html#sec:appendix:raytracing:traxer">37.1</a>, give a more
technical overview of the LLNL telescope in
sec. <a href="./raytracing.html#sec:appendix:raytracing:llnl_telescope">37.2</a>, show comparisons of our
raytracer to PANTER measurements, sec. <a href="./raytracing.html#sec:appendix:raytracing:panter">37.3</a>
and finally compute the axion image expected for CAST behind the LLNL
telescope, sec. <a href="./raytracing.html#sec:appendix:raytracing:axion_image">37.4</a>.
</p>

<p>
Raytracing is a technique for the rendering of computer-generated
images <sup>  <a role="doc-backlink" class="footref" id="fnr.1" href="#fn.1">1</a></sup>. The classical raytracing algorithm goes back to a
paper by Turner Whitted in 1979 (<a href="./bibliography.html#citeproc_bib_item_232">Whitted 1979</a>). It is essentially a
recursive algorithm, which shoots rays (&quot;photons&quot;) from a camera into
a scene of 3D objects. Interactions with the objects follows
geometrical optics. The ray equation
</p>

<p>
\[
\vec{r}(t) = \vec{o} + t \vec{d},
\]
</p>

<p>
describes the ray vector \(\vec{r}\), how it propagates from its origin
\(\vec{o}\) along the direction \(\vec{d}\) as a function of the parameter
\(t\) (it is no coincidence that \(t\) evokes the notion of
time). Ray-object intersections tests are performed based on the ray
equation and parametrizations of scene objects (either analytical
parametrizations for geometric primitives like spheres, cones and the
like, or complex objects made up of a large number of triangles). Each
ray is traced until a certain &apos;depth&apos;, defined by the maximum number
of reflections a ray may undergo, is reached and the recursion is
stopped.
</p>

<p>
Building on this more sophisticated methods were invented, in
particular the &apos;path tracing&apos; algorithm and the introduction of the
&apos;rendering equation&apos; (<a href="./bibliography.html#citeproc_bib_item_128">Kajiya 1986</a>; <a href="./bibliography.html#citeproc_bib_item_118">Immel, Cohen, and Greenberg 1986</a>). Here the geometrical
optics approximation is replaced by the concepts of radiometry (power,
irradiance, radiance, spectral radiance and so on) embedding the
concept in more robust physical terms. At the heart of it, the
rendering equation is a statement of conservation of energy. To
generate images of a scene, the most interesting quantity is the
exitant radiance \(L_o\) at a point on a surface. It is the sum of the
emitted radiance \(L_e\) and the scattered radiance \(L_{o,s}\),
</p>

<p>
\[
L_o = L_e + L_{o,s}.
\]
</p>

<p>
In the context of rendering, the emitted radiance \(L_e\) is commonly a
property of the materials in the scene. \(L_{o,s}\) needs to be computed
via the scattering equation
</p>

<p>
\[
L_{o,s}(\vec{x}, ω_o) = ∫_{S²} L_i(\vec{x}, ω_i) f_s(\vec{x}, ω_i ↦
ω_o) \sin ϑ \: \mathrm{d}\sin ϑ \, \mathrm{d}ϕ.
\]
</p>

<p>
\(L_i\) is the incident radiance at point \(\vec{x}\) and direction \(ω_i\)
(do not confuse it with an energy). \(f_s\) is the bidirectional
scattering distribution function (BSDF) and describes the scattering
properties of a material surface. In the context of an equilibrium in
radiance (the light description does not change over time in the
scene) the incident radiance can be expressed as
</p>

<p>
\[
L_i(\vec{x}, ω) = L_o(\mathbf{x}_{\mathcal{M}}(\vec{x}, ω), -ω).
\]
</p>

<p>
Here \(\mathbf{x}_{\mathcal{M}}(\vec{x}, ω)\) is the &apos;ray-casting
function&apos;, which yields the closest point on the set of surfaces
\(\mathcal{M}\) of the scene visible from \(\vec{x}\) in direction \(ω\).
These expressions can be combined into a form independent of \(L_i\) to 
</p>

<p>
\[
L_o(\vec{x}, ω_o) = L_e(\vec{x}, ω_o) +
  ∫_{S²} L_o(\mathbf{x}_{\mathcal{M}}(\vec{x}, ω_i), -ω_i)
    f_s(\vec{x}, ω_i ↦ ω_o) \sin ϑ \: \mathrm{d}\sin ϑ \, \mathrm{d}ϕ,
\]
</p>

<p>
which is the &apos;light transport equation&apos;, commonly used nowadays in
path tracing based computer graphics.
</p>

<p>
The fundamental problem with raytracing, and path tracing based on the
light transport equation in particular, is the extreme computational
cost. Monte Carlo based approaches to sample only relevant directions
and space partitioning data structures are employed to reduce this
cost. One of the seminal documents of modern Monte Carlo based
rendering is Eric Veach&apos;s PhD thesis (<a href="./bibliography.html#citeproc_bib_item_223">Veach 1998</a>), which the
notation used above is based on. If you are interested in the topic I
highly recommend at least a cursory look at it.
</p>

<p>
Movies have made the transition from rasterization based computer
graphics in <i>Toy Story</i> (1995) over the course of 15 to 20
years <sup>  <a role="doc-backlink" class="footref" id="fnr.2" href="#fn.2">2</a></sup> to full path tracing graphics commonly used
today. The use of offline rendering utilizing many compute hours per
frame of the final movie allowed movies to introduce path tracing at
the end of the 90s (<i>Bunny</i>, an animated short released in 1998). In
recent years the idea of real time path tracing has become tangible,
in big parts due to the – at the time bold – bet by Nvidia. They
dedicated specific parts of their &apos;Turing&apos; architecture of graphics
processing units (GPUs) in 2018 to accelerate raytracing. Starting
with path traced versions of old video games, like <i>Quake II RTX</i>
running in real time on &apos;Turing&apos; GPUs, in 2023 we have path traced
versions of modern high budget (&quot;AAA&quot;) video games like <i>Cyberpunk
2077</i> and <i>Alan Wake 2</i> <sup>  <a role="doc-backlink" class="footref" id="fnr.3" href="#fn.3">3</a></sup>. This is in parts due to the general increase
in compute performance, partially due to specific hardware features
and a large part due to usage of machine learning (to denoise and
upsample images and further reconstruct missing rays using ML). For an
overview of the developments in the movie industry to its adoption of
path tracing, have a look at (<a href="./bibliography.html#citeproc_bib_item_63">Christensen and Jarosz 2016</a>). To understand
how path tracing is implemented in video games on modern GPUs, see the
&apos;Raytracing Gems&apos; series
(<a href="./bibliography.html#citeproc_bib_item_102">Haines and Akenine-Möller 2019</a>; <a href="./bibliography.html#citeproc_bib_item_3">Adam Marrs and Wald 2021</a>).
</p>
</div>

<div class="outline-3" id="outline-container-sec:appendix:raytracing:traxer">
<h3 id="sec:appendix:raytracing:traxer"><span class="section-number-3">37.1.</span> TrAXer - An interactive axion raytracer</h3>
<div class="outline-text-3" id="text-sec:appendix:raytracing:traxer">
<figure class="figure-wrapper" id="fig:appendix:raytracing:example_screenshots">
<figure class="subfigure" id="fig:appendix:raytracing:riow_example" data-width="51%">  <img src="./figs/home/basti/phd/Figs/raytracing/raytracing_in_one_weekend.png" data-width="99%" />  <figcaption>Figure 1(a): RTOW spheres example</figcaption></figure> <figure class="subfigure" id="fig:appendix:raytracing:cast_setup_example" data-width="46%">  <img src="./figs/home/basti/phd/Figs/raytracing/traxer_cast_llnl_setup_sun.png" data-width="99%" />  <figcaption>Figure 1(b): CAST setup</figcaption></figure>
<figcaption>Figure 1: <a href="#fig:appendix:raytracing:riow_example">1(a)</a> is the reproduction of the final result of the book &apos;Ray Tracing in One Weekend&apos; (RTOW) (<a href="./bibliography.html#citeproc_bib_item_212">Shirley 2020</a>) I originally followed. <a href="#fig:appendix:raytracing:cast_setup_example">1(b)</a> is a very narrow angle of view on the CAST setup. In the bottom left is the image sensor
          with the size of a GridPix. In the middle with a reddish color is the LLNL telescope sitting
          in front of the CAST magnet bore. On the right is the Sun.
          Note that only the essential parts are simulated floating in the air. The angle and view from
          above makes the image sensor look a bit odd.</figcaption>
</figure>


<p>
The simulation of light based on physical principles as done in path
tracing algorithms combined with the performance of modern computers
make it an interesting solution to light propagation problems, which
are difficult if not impossible to solve numerically. Calculation of
the expected image produced by the X-ray telescope for a realistic
X-ray telescope and solar axion emission is one such problem. In
(<a href="./bibliography.html#citeproc_bib_item_137">Krieger 2018</a>) Christoph Krieger already wrote a basic
hardcoded <sup>  <a role="doc-backlink" class="footref" id="fnr.4" href="#fn.4">4</a></sup> raytracer for the 2014/15 data taking behind
the ABRIXAS telescope. He approximated the ABRIXAS telescope as a
simple lens.
</p>

<p>
For the data taking with the detector of this thesis behind the LLNL
telescope, a more precise solution was desired. As such Johanna von Oy
wrote a new raytracer for this purpose as part of her master thesis
(<a href="./bibliography.html#citeproc_bib_item_162">Von Oy 2020</a>). However, although this code (<a href="./bibliography.html#citeproc_bib_item_163">Von Oy 2023</a>)
correctly simulates the LLNL (and as a matter of fact also other
telescopes) based on their correct layer descriptions, it still uses a
similar hardcoded <sup>  <a role="doc-backlink" class="footref" id="fnr.4" href="#fn.4">4</a></sup> approach, making it inflexible for
different scenes. More importantly it makes understanding and
verifying the code for correctness very difficult. 
</p>

<p>
What started mainly as a toy project I wrote out of curiosity
following the popular &apos;Ray Tracing in One Weekend&apos; (RTOW)
(<a href="./bibliography.html#citeproc_bib_item_212">Shirley 2020</a>) book <sup>  <a role="doc-backlink" class="footref" id="fnr.5" href="#fn.5">5</a></sup>, anyhow made me
appreciate the advantage of a generic raytracer (see
fig. <a href="#fig:appendix:raytracing:riow_example">1(a)</a> for the final result of
that book, created by this project). Generic meaning that the scene to
be rendered is described by objects placed in simulated 3D world
space. This reduces the amount of code that needs to be checked for
correctness by orders of magnitude (reflection for one material type
is a few line function, instead of having lines of code for every
single reflection in a hardcoded raytracer). It also makes the program
much more flexible to support different setups. In particular though,
the concept of a camera independent of the scene geometry allows to
visualize the scene (obviously the entire purpose of a normal
raytracer!).
</p>

<p>
As a personal addition to the RTOW project, I implemented rendering to
an SDL2 (<a href="./bibliography.html#citeproc_bib_item_200">Schmidt 2022b</a>) window and handling mouse and keyboard inputs to
produce an interactive real-time raytracer (this was early 2021). This
sparked the idea to use the same approach for our axion raytracer. I
pitched the idea to Johanna, but did not manage to convince
her <sup>  <a role="doc-backlink" class="footref" id="fnr.6" href="#fn.6">6</a></sup>. While working on finalizing the axion image
and X-ray finger simulations for this thesis, several big
discrepancies between our raytracing results and those used for the
CAST Nature paper in 2017 (<a href="./bibliography.html#citeproc_bib_item_66">Collaboration and others 2017</a>) were noticed. The latter
were done by Michael Pivovaroff at LLNL using a private in-house
raytracer <sup>  <a role="doc-backlink" class="footref" id="fnr.7" href="#fn.7">7</a></sup>. The need to better verify the correctness of
our own raytracing simulation lead me down the path of finishing the
project of turning the RTOW based raytracer into an axion X-ray
raytracer. This way verifying correctness was easier. Some additional
features of the second book of the ROTW series were added (light
sources among others) and other aspects were inspired by Physically
Based Rendering (<a href="./bibliography.html#citeproc_bib_item_175">Pharr, Jakob, and Humphreys 2016</a>) (in particular the idea of
propagating multiple energies in each ray).
</p>

<p>
The result is <code>TrAXer</code> (<a href="./bibliography.html#citeproc_bib_item_197">Schmidt 2023</a>), an interactive real-time visible
light and X-ray raytracer. In essence it is two raytracers in
one. First, a &apos;normal&apos; visible light raytracer, which the camera
uses. Secondly, an X-ray raytracer. Both use the same raytracing
logic, but they differ in sampling. For visible light we emit rays
from the camera into the scene, while for X-rays we emit from an X-ray
source (an object placed in the scene, for example the Sun). Both of
these run in parallel. Scenes are defined by placing geometric
primitives with different materials (glass, metal etc.) into the
scene.
</p>

<p>
The X-ray raytracer is used by choosing X-ray emitting materials and
adding another object as an X-ray target (another material), which the
X-ray sampling will be biased towards. There is further a specific
X-ray material an object can be made of, which behaves as expected
when hit by an X-ray, calculated using
(<a href="./bibliography.html#citeproc_bib_item_203">Schmidt and SciNim contributors 2022</a>). Behavior is described by the
reflectivity computed via the Fresnel equations as discussed in
sec. <a href="./theory_detector.html#sec:theory:xray_reflectivity">6.1.2</a>. To simulate reflectivity of the
LLNL telescope, the depth graded multilayers of the different layers
are taken into account. X-ray transmission is currently not
implemented, but only because there is no need for us. The addition
would be easy based on mass attenuation coefficients and the Fresnel
equations for transmission.
</p>

<p>
In order to detect and read out results from the X-ray raytracing, we
place &quot;image sensors&quot; into the scene. They use a special material,
which accumulates X-rays hitting them, split into spatial pixels. For
visible light they simply emit the current values stored in each pixel
of the image sensor, mapped to the Viridis color scale.
</p>

<p>
These things are visible in the example screenshot showing the &quot;CAST&quot;
scene in fig. <a href="#fig:appendix:raytracing:cast_setup_example">1(b)</a>. The view is
seen from behind and above the setup with a narrow field of view
(like a telephoto lens). Only relevant pieces of the setup are placed
into the scene (partially for performance, although bounding volume
hierarchies help there, mostly for simplicity). The Sun is visible on
the right side, emitting a yellow hue for the visible rays and an
invisible X-ray spectrum following the expected solar axion flux
(with correct radial emission). The long blueish tube is the inner
bore of the CAST magnet. Then, with red hues (in visible light) we
have the LLNL telescope. In the bottom left is the image sensor, which
has the same physical size as the center GridPix of the Septemboard
detector and is placed in the focal point of the telescope. As every
object of the scene is floating above the earth, combined with the
telephoto like view, the sensor looks a bit odd. <sup>  <a role="doc-backlink" class="footref" id="fnr.8" href="#fn.8">8</a></sup>
</p>
</div>

<div class="outline-4" id="outline-container-org2a56767">
<h4 id="org2a56767"><span class="section-number-4">37.1.1.</span> Discrepancies raytracer and LLNL raytracer   <span class="tag">  <span class="extended">extended</span></span></h4>
<div class="outline-text-4" id="text-37-1-1">
<ul class="org-ul">
<li class="off"><code>[ ]</code> LINK TO DOCUMENT ANSWER TO IGOR!
-&gt; For that we need to host the document somewhere first!</li>
</ul>
</div>
</div>

<div class="outline-4" id="outline-container-orgc38c05d">
<h4 id="orgc38c05d"><span class="section-number-4">37.1.2.</span> Produce screenshots of TrAXer   <span class="tag">  <span class="extended">extended</span></span></h4>
<div class="outline-text-4" id="text-37-1-2">
<p>
This is simply a manual matter of running <code>TrAXer</code> with the desired
scene and taking screenshots manually. In theory we can save the frame
buffers using <code>F5</code> and then produce an image from the raw data, but
there&apos;s not much point really.
</p>

<p>
The main question is what we really want to showcase.
</p>

<p>
For example to produce an example screenshot showcasing the original
&apos;Raytracing in One Weekend&apos; final image, we can do:
</p>
<div class="org-src-container">
<pre class="src src-sh">./raytracer --width 1200 --speed 10.0 --nJobs 32 --maxDepth 10 --spheres
</pre>
</div>
<p>
and take a screenshot from:
</p>
<pre class="example">
Now looking at: (Point: [-4.278876423185614, 1.499472514352247, -5.283379080542512])
from : (Point: [-4.825481106391748, 1.938486638958975, -5.996463871218145]), yaw = 5.366388980384832, pitch = -0.4545011087932843
</pre>

<p>
(we currently don&apos;t have a way to specify the starting location and
point we look at. You see the current values printed to the
terminal. Note that the movement speed can be adjusted using page up /
page down).
</p>

<ul class="org-ul">
<li class="off"><code>[ ]</code> Or use the original raytracing in one weekend screenshot we
created? We are not using any depth of field in the current camera
setup.
-&gt; I also get the impression that something about our image
integration is not entirely working in the current raytracing
code. The code has been running quite a while now (given that it&apos;s
28 threads), but the noise does not really get better.
-&gt; Well, our color code was simpler in the past. Just adding colors
then dividing by num samples &amp; gamma correcting. But it did not
include yet how to integrate.</li>
</ul>

<p>
This way we took:
</p>

<p>
<a id="INSERT"> </a>
</p>

<p>
Let&apos;s place this screenshot next to one that showcases something more
CAST related?
</p>

<ul class="org-ul">
<li class="off"><code>[ ]</code> CAST screenshot. Maybe image sensor, magnet, telescope sun?</li>
</ul>

<p>
For example to simulate the &apos;realistic&apos;
</p>
<div class="org-src-container">
<pre class="src src-sh">./raytracer <span style="color: #E6DB74; font-weight: bold;">\</span>
    --width 1200 --speed 10.0 --nJobs 32 --vfov 15 --maxDepth 5 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --llnl --focalPoint --sourceKind skSun <span style="color: #E6DB74; font-weight: bold;">\</span>
    --solarModelFile ~/CastData/ExternCode/AxionElectronLimit/resources/solar_model_dataframe.csv <span style="color: #E6DB74; font-weight: bold;">\</span>
    --rayAt 1.0 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sensorKind sSum <span style="color: #E6DB74; font-weight: bold;">\</span>
    --usePerfectMirror=false <span style="color: #E6DB74; font-weight: bold;">\</span>
    --ignoreWindow
</pre>
</div>

<p>
from
</p>
<blockquote>
<p>
[INFO] Current position (lookFrom) = (Point: [-207.533615402934, 75.77234678496751, -2003.522751711818])
at (lookAt) (Point: [-207.4532559830788, 75.71290478850352, -2002.527759745671])
</p>
</blockquote>


<figure id="orgca2158d">
<img src="./figs/home/basti/phd/Figs/raytracing/traxer_cast_llnl_setup_sun.png" alt="traxer_cast_llnl_setup_sun.png" />

</figure>
</div>
</div>
</div>

<div class="outline-3" id="outline-container-sec:appendix:raytracing:llnl_telescope">
<h3 id="sec:appendix:raytracing:llnl_telescope"><span class="section-number-3">37.2.</span> A few more details about the LLNL telescope</h3>
<div class="outline-text-3" id="text-sec:appendix:raytracing:llnl_telescope">
<p>
The Lawrence Livermore National Laboratory, introduced in
sec. <a href="./helioscopes.html#sec:helioscopes:llnl_telescope">5.1.4</a>, is the X-ray telescope of
interest for us. Let us now first get an overview of the telescope and
its construction itself, before we move on to comparing the TrAXer
simulations with PANTER measurements and raytracing simulations from
Michael Pivovaroff from LLNL.
</p>

<p>
Its design follows the technology developed for the NuSTAR mission
(<a href="./bibliography.html#citeproc_bib_item_104">Harrison et al. 2013</a>, <a href="./bibliography.html#citeproc_bib_item_103">2006</a>; <a href="./bibliography.html#citeproc_bib_item_135">Koglin et al. 2009</a>; <a href="./bibliography.html#citeproc_bib_item_69">Craig et al. 2011</a>; <a href="./bibliography.html#citeproc_bib_item_101">Hailey et al. 2010</a>).
This means it is not a true Wolter optic (meaning parabolic and
hyperbolic mirrors), but instead uses a cone approximation
(<a href="./bibliography.html#citeproc_bib_item_174">Petre and Serlemitsos 1985</a>), which are easier to produce and in particular for CAST
provide more than enough angular resolution.
</p>

<p>
It consists of two sets of 13 layers. Each mirror has a physical
length of \(\SI{225}{mm}\) and thickness of \(d_{\text{glass}} =
\SI{0.21}{mm}\). These mirrors are made of glass, which are
thermally-formed (&quot;slumped&quot;) into the conical shapes. Production of
the mirrors happened at the National Space Institute at the Technical
University of Denmark (DTU Space) as part of the PhD thesis of Anders
Jakobsen (<a href="./bibliography.html#citeproc_bib_item_123">Jakobsen 2015</a>). The first sets of layers \(i\) describe
truncated coni with a remaining height of \(\SI{225}{mm}\), an arc angle
of \(\SI{30}{°}\), a radius on the opening end <sup>  <a role="doc-backlink" class="footref" id="fnr.9" href="#fn.9">9</a></sup> of
\(R_{1,i}\) and a cone angle of \(α_i\). That is for each layer a
non-truncated cone would have a total height of \(h = R_{1,i} /
\tan{α_i}\). The second set of 13 layers only differs by their radii,
\(R_{4,i}\) on the opening end and an angle of \(3 α_i\). In the
horizontal direction along the optical axis of the telescope, there is
a spacing of \(x_{\text{sep}} = \SI{4}{mm}\) between each set of
layers. Due to the tilted angle the physical distance between each set
is minutely larger. Combined the telescope thus has a length of
roughly \(\SI{454}{mm}\).
</p>

<p>
One can define additional helpful radii, \(R_{2,i}\) the minimum radius
of the first set of cones, \(R_{4,i}\) the maximum radii of the opening
end of the second set of mirrors and finally \(R_{3,i}\), the radius at
the mid point where the hypothetical extension of the first layer and
last layer would touch at \(x = \SI{2}{mm}\) from each set of
mirrors. Equations \eqref{eq:llnl_rest:radii_eqs} specify how these numbers
are related with \(l\) the length of the mirrors. 
</p>

\begin{align}
\label{eq:llnl_rest:radii_eqs}
R_{2,i} &amp;= R_{3,i} + 0.5 x_{\text{sep}} \tan(α_i) \\
R_{1,i} &amp;= R_{2,i} + l \sin(α_i) \\
R_{4,i} &amp;= R_{3,i} - 0.5 x_{\text{sep}} \tan(3α_i) \\
R_{5,i} &amp;= R_{4,i} - l \sin(3α_i) 
\end{align}
<p>
which we can rewrite to compute everything from \(R_{1,i}\) by:
</p>
\begin{align*}
R_{2,i} &amp;= R_{1,i} - l \sin(α_i) \\
R_{3,i} &amp;= R_{2,i} - 0.5 x_{\text{sep}} \tan(α_i) \\
R_{4,i} &amp;= R_{3,i} - 0.5 x_{\text{sep}} \tan(3α_i) \\
R_{5,i} &amp;= R_{4,i} - l \sin(3α_i) 
\end{align*}

<p>
I emphasize this, because this conical nature describes the <i>entire
telescope</i> as long as the radii \(R_{1,i}\), \(R_{4,i}\) and angle \(α_i\)
are known. <sup>  <a role="doc-backlink" class="footref" id="fnr.10" href="#fn.10">10</a></sup>
</p>

<p>
Alternatively, this can also be used to <i>construct</i> an optimal conical
telescope from a starting radius \(R_{1,0}\) (typically called the
&quot;mandrel&quot;), if the iterative condition \(R_{3,i+1} = R_{1,i} +
d_{\text{glass}}\) is employed (in this case some target parameters are
needed of course, like focal length, \(x_{\text{sep}}\) and a few more).
</p>

<p>
To calculate the focal length \(f\) of an X-ray telescope of the Wolter
type, we can use the Wolter equation,
</p>

<p>
\[
\tan(4α_i) = \frac{R_{3,i,\text{virtual}}}{f} 
\]
</p>

<p>
where \(α_i\) is the angle of the \(i^{\text{th}}\) layer and
\(R_{3,i,\text{virtual}}\) is the radius corresponding to the virtual
reflection point. Due to the double reflection inherent to a
Wolter telescope, the incoming ray picks up a total angle of \(4α\) (\(0\)
to \(2α\) after first reflection of the shell with angle \(α\), then \(2α\) to \(4α\) after reflecting from
second shell of angle \(3α\)). The virtual radius is the radius at the
point if one extends the incoming ray through the first set of mirrors
and reflects at a single virtual mirror of an angle \(4α\) precisely at
the midpoint of the telescope. This is illustrated in
fig. <a href="#fig:appendix:llnl_schematic_explanation">3</a>, which is an adapted
version of fig. 4.6 from A. Jakobsen&apos;s PhD thesis (<a href="./bibliography.html#citeproc_bib_item_123">Jakobsen 2015</a>) to
better illustrate this.
</p>

<p>
In addition to the PhD thesis mentioned, there is a paper
(<a href="./bibliography.html#citeproc_bib_item_28">Aznar et al. 2015</a>) about the telescope for CAST
and initial results. <b>Note though</b>, that <i>both</i> the PhD thesis and the
paper contain contradicting and wrong information about the details of
the telescope design. Neither (nor combined do they) describe the real
telescope. <sup>  <a role="doc-backlink" class="footref" id="fnr.11" href="#fn.11">11</a></sup> <sup>, </sup><sup>  <a role="doc-backlink" class="footref" id="fnr.12" href="#fn.12">12</a></sup> Thanks to the help of and personal
communication with Jaime Ruz and Julia Vogel we were able to both
clear up confusions and find the original numbers of the telescope
that were actually built. Table <a href="#tab:appendix:llnl_overview">34</a> gives an
overview of the telescope design. It is adapted from
(<a href="./bibliography.html#citeproc_bib_item_28">Aznar et al. 2015</a>), but modified to use the
correct numbers. Then in tab. <a href="#tab:appendix:llnl_as_built">35</a> is the list
of all layers and their corresponding radii in detail as given to me
by Jaime Ruz. 
</p>

<table id="tab:appendix:llnl_overview">
<caption class="t-above"><span class="table-number">Table 34:</span> Properties of the LLNL telescope. Adapted from <a href="&amp;llnl_telescope_first_cast_results">&amp;llnl_telescope_first_cast_results</a> and modified to match the numbers actually built.</caption>

<colgroup>
<col class="org-left" />

<col class="org-left" />
</colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Property</th>
<th class="org-left" scope="col">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Mirror substrates</td>
<td class="org-left">glass, Schott D263</td>
</tr>

<tr>
<td class="org-left">Substrate thickness</td>
<td class="org-left">\(\SI{0.21}{mm}\)</td>
</tr>

<tr>
<td class="org-left">\(l\), length of upper and lower mirrors</td>
<td class="org-left">\(\SI{225}{mm}\)</td>
</tr>

<tr>
<td class="org-left">Overall telescope length</td>
<td class="org-left">\(\sim\SI{454}{mm}\)</td>
</tr>

<tr>
<td class="org-left">\(f\) , focal length</td>
<td class="org-left">\(\SI{1500}{mm}\)</td>
</tr>

<tr>
<td class="org-left">Layers</td>
<td class="org-left">13</td>
</tr>

<tr>
<td class="org-left">Total number of individual mirrors in optic</td>
<td class="org-left">26</td>
</tr>

<tr>
<td class="org-left">\(R_{1,i}\) , range of maximum radii</td>
<td class="org-left">\(\SIrange{63.24}{102.38}{mm}\)</td>
</tr>

<tr>
<td class="org-left">\(R_{3,i}\) , range of mid-point radii</td>
<td class="org-left">\(\SIrange{62.07}{100.5}{mm}\)</td>
</tr>

<tr>
<td class="org-left">\(R_{5,i}\) , range of minimum radii</td>
<td class="org-left">\(\SIrange{53.88}{87.19}{mm}\)</td>
</tr>

<tr>
<td class="org-left">\(α\), range of graze angles</td>
<td class="org-left">\(\SIrange{0.592}{0.958}{°}\)</td>
</tr>

<tr>
<td class="org-left">Azimuthal extent</td>
<td class="org-left">\(\sim\SI{30}{°}\)</td>
</tr>
</tbody>
</table>

<table id="tab:appendix:llnl_as_built">
<caption class="t-above"><span class="table-number">Table 35:</span> Overview of the relevant numbers as the telescope was actually built. Based on a data file sent to me by Jaime Ruz. The values for \(R_3\) and the angles \(α\), \(3α\) were calculated from the values for \(R_1, R_2\) and \(R_4, R_5\) based on equations \eqref{eq:llnl_rest:radii_eqs}.</caption>

<colgroup>
<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />
</colgroup>
<thead>
<tr>
<th class="org-right" scope="col">i</th>
<th class="org-right" scope="col">\(R_1\) [\(\si{mm}\)]</th>
<th class="org-right" scope="col">\(R_2\) [\(\si{mm}\)]</th>
<th class="org-right" scope="col">\(R_3\) [\(\si{mm}\)]</th>
<th class="org-right" scope="col">\(R_4\) [\(\si{mm}\)]</th>
<th class="org-right" scope="col">\(R_5\) [\(\si{mm}\)]</th>
<th class="org-right" scope="col">α [\(\si{°}\)]</th>
<th class="org-right" scope="col">3α [\(\si{°}\)]</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">63.2384</td>
<td class="org-right">60.9121</td>
<td class="org-right">60.8914</td>
<td class="org-right">60.8632</td>
<td class="org-right">53.8823</td>
<td class="org-right">0.5924</td>
<td class="org-right">1.7780</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-right">65.8700</td>
<td class="org-right">63.4470</td>
<td class="org-right">63.4255</td>
<td class="org-right">63.3197</td>
<td class="org-right">56.0483</td>
<td class="org-right">0.6170</td>
<td class="org-right">1.8520</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-right">68.6059</td>
<td class="org-right">66.0824</td>
<td class="org-right">66.0600</td>
<td class="org-right">65.9637</td>
<td class="org-right">58.3908</td>
<td class="org-right">0.6426</td>
<td class="org-right">1.9288</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-right">71.4175</td>
<td class="org-right">68.7898</td>
<td class="org-right">68.7664</td>
<td class="org-right">68.6794</td>
<td class="org-right">60.7934</td>
<td class="org-right">0.6692</td>
<td class="org-right">2.0086</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-right">74.4006</td>
<td class="org-right">71.6647</td>
<td class="org-right">71.6404</td>
<td class="org-right">71.5582</td>
<td class="org-right">63.3473</td>
<td class="org-right">0.6967</td>
<td class="org-right">2.0913</td>
</tr>

<tr>
<td class="org-right">6</td>
<td class="org-right">77.4496</td>
<td class="org-right">74.6014</td>
<td class="org-right">74.5761</td>
<td class="org-right">74.4997</td>
<td class="org-right">65.9515</td>
<td class="org-right">0.7253</td>
<td class="org-right">2.1773</td>
</tr>

<tr>
<td class="org-right">7</td>
<td class="org-right">80.6099</td>
<td class="org-right">77.6452</td>
<td class="org-right">77.6188</td>
<td class="org-right">77.5496</td>
<td class="org-right">68.6513</td>
<td class="org-right">0.7550</td>
<td class="org-right">2.2665</td>
</tr>

<tr>
<td class="org-right">8</td>
<td class="org-right">83.9198</td>
<td class="org-right">80.8341</td>
<td class="org-right">80.8067</td>
<td class="org-right">80.7305</td>
<td class="org-right">71.4688</td>
<td class="org-right">0.7858</td>
<td class="org-right">2.3591</td>
</tr>

<tr>
<td class="org-right">9</td>
<td class="org-right">87.3402</td>
<td class="org-right">84.1290</td>
<td class="org-right">84.1005</td>
<td class="org-right">84.0137</td>
<td class="org-right">74.3748</td>
<td class="org-right">0.8178</td>
<td class="org-right">2.4553</td>
</tr>

<tr>
<td class="org-right">10</td>
<td class="org-right">90.8910</td>
<td class="org-right">87.5495</td>
<td class="org-right">87.5198</td>
<td class="org-right">87.4316</td>
<td class="org-right">77.4012</td>
<td class="org-right">0.8510</td>
<td class="org-right">2.5551</td>
</tr>

<tr>
<td class="org-right">11</td>
<td class="org-right">94.5780</td>
<td class="org-right">91.1013</td>
<td class="org-right">91.0704</td>
<td class="org-right">90.9865</td>
<td class="org-right">80.5497</td>
<td class="org-right">0.8850</td>
<td class="org-right">2.6587</td>
</tr>

<tr>
<td class="org-right">12</td>
<td class="org-right">98.3908</td>
<td class="org-right">94.7737</td>
<td class="org-right">94.7415</td>
<td class="org-right">94.6549</td>
<td class="org-right">83.7962</td>
<td class="org-right">0.9211</td>
<td class="org-right">2.7662</td>
</tr>

<tr>
<td class="org-right">13</td>
<td class="org-right">102.381</td>
<td class="org-right">98.6187</td>
<td class="org-right">98.5853</td>
<td class="org-right">98.4879</td>
<td class="org-right">87.1914</td>
<td class="org-right">0.9581</td>
<td class="org-right">2.8778</td>
</tr>
</tbody>
</table>


<figure id="fig:appendix:llnl_schematic_explanation">
<img src="./figs/home/basti/org/Figs/llnlExplanation/llnl_layers_explanation.svg" class="org-svg" alt="llnl_layers_explanation.svg" />

<figcaption>Figure 3: <span class="figure-number">Figure 202: </span>Schematic of the reflection of an X-ray on a single layer of the telescope. Angles are exaggerated (\(α = \SI{5}{°}\) here). The virtual reflection point is the relevant point to consider when calculating the focal length.</figcaption>
</figure>

<p>
Having discussed the physical <i>layout</i> of the telescope, let us
quickly talk about the telescope coatings. In contrast to telescope
like the ABRIXAS or XMM-Newton optics, which use a single layer gold
coating, the NuSTAR design uses a depth graded multilayer coating as
introduced in sec. <a href="./theory_detector.html#sec:theory:xray_reflectivity">6.1.2</a>. There are four
different &apos;recipes&apos;, used for different layers. All recipes are a
depth graded multilayer of different number of Pt/C layers.
</p>

<blockquote>
<p>
Note that in this terminology the high \(Z\) material (platinum) is
actually <i>below</i> the low \(Z\) material (carbon) contrary to what Pt/C
might imply!
</p>
</blockquote>

<p>
Table <a href="#tab:appendix:llnl_recipes">36</a> gives an overview of which recipes are
used for which layer and how they differ. \(d_{\text{min}}\) is the
minimum thickness of one multilayer and \(d_{\text{max}}\) the maximum
thickness. The top most multilayer is the thickest. \(Γ\) is the ratio
of the top to bottom material in each multilayer.
</p>

<p>
For example recipe 1 has a top multilayer of carbon of a thickness \(Γ
· d_{\text{max}} = \SI{10.125}{nm}\) on top of \((1 - Γ) ·
d_{\text{max}} = \SI{12.375}{nm}\) of platinum. Because recipe 1 only
has 2 such multilayers, the bottom Pt/C layer has a combined thickness
of \(d_{\text{min}}\).
</p>

<p>
To reiterate the equations that describe the layer thicknesses for \(N\)
layers as given in sec. <a href="./theory_detector.html#sec:theory:xray_reflectivity">6.1.2</a>, a depth-graded
multilayer is described by the equation:
</p>

\begin{equation}
\label{eq:appendix:depth_graded_multilayer}
d_i = \frac{a}{(b + i)^c}
\end{equation}

<p>
where \(d_i\) is the depth of layer \(i\) (out of \(N\) layers),
</p>

<p>
\[
a = d_{\text{min}} (b + N)^c
\]
</p>

<p>
and
</p>

<p>
\[
b = \frac{1 - N k}{k - 1}
\]
</p>

<p>
with
</p>

<p>
\[
k = \left(\frac{d_{\text{min}}}{d_{\text{max}}}\right)^{\frac{1}{c}}.
\]
</p>

<p>
In all four recipes used for the LLNL telescope the parameter \(c\) is
set to 1.
</p>

<table id="tab:appendix:llnl_recipes">
<caption class="t-above"><span class="table-number">Table 36:</span> Overview of the different depth graded multilayer coatings used for the table. Adapted from fig. 4.11 of <a href="&amp;anders_phd">&amp;anders_phd</a> with the correct numbers finally built. Parameter \(c\) of equation \eqref{eq:appendix:depth_graded_multilayer} is set to 1 in all layers.</caption>

<colgroup>
<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />
</colgroup>
<thead>
<tr>
<th class="org-right" scope="col">Recipe</th>
<th class="org-right" scope="col"># of layers</th>
<th class="org-right" scope="col">\(d_{\text{min}}\) [\(\si{nm}\)]</th>
<th class="org-right" scope="col">\(d_{\text{max}}\)  [\(\si{nm}\)]</th>
<th class="org-right" scope="col">Γ</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">2</td>
<td class="org-right">11.5</td>
<td class="org-right">22.5</td>
<td class="org-right">0.45</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-right">4</td>
<td class="org-right">7.0</td>
<td class="org-right">19.0</td>
<td class="org-right">0.45</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-right">4</td>
<td class="org-right">5.5</td>
<td class="org-right">16.0</td>
<td class="org-right">0.4</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-right">2</td>
<td class="org-right">5.0</td>
<td class="org-right">14.0</td>
<td class="org-right">0.4</td>
</tr>
</tbody>
</table>

<p>
Calculation of the reflectivity follows the equations also mentioned
in the theory section. The reflectivities of each layer are calculated
with (<a href="./bibliography.html#citeproc_bib_item_203">Schmidt and SciNim contributors 2022</a>), which is used as part of the
material description in <code>TrAXer</code>.
</p>
</div>

<div class="outline-4" id="outline-container-orge91be2e">
<h4 id="orge91be2e"><span class="section-number-4">37.2.1.</span> Calculate angles and focal length based on Wolter equation for telescope data files   <span class="tag">  <span class="extended">extended</span></span></h4>
<div class="outline-text-4" id="text-37-2-1">
<p>
The following, initially adapted from
<a href="./../org/Mails/llnlAxionImage/llnl_axion_image.html">./../org/Mails/llnlAxionImage/llnl_axion_image.html</a>
and found in
<a href="./../org/Doc/LLNL_TrAXer_comparison/llnl_traxer_raytracing_comparison.html">./../org/Doc/LLNL_TrAXer_comparison/llnl_traxer_raytracing_comparison.html</a>
and <a href="./../org/journal.html">./../org/journal.html</a> 
computes the expected focal length based on the Wolter equation:
</p>

<p>
\[
\tanh(4α) = \frac{R}{f}
\]
</p>

<p>
where the radius \(R\) is the radius of the virtual reflection point of
the combined telescope system.
</p>

<p>
The data files are
<a href="./../org/resources/LLNL_telescope/cast20l4_f1500mm_asBuilt.txt">./../org/resources/LLNL_telescope/cast20l4_f1500mm_asBuilt.txt</a> and
<a href="./../org/resources/LLNL_telescope/cast20l4_f1500mm_asDesigned.txt">./../org/resources/LLNL_telescope/cast20l4_f1500mm_asDesigned.txt</a>.
</p>

<p>
What we can see below is that the numbers from Anders&apos; PhD thesis
yield a telescope with focal length of \(\SI{1530}{mm}\) instead of the
target. Also it computes the angles for all layers based on the radii.
</p>

<p>
The data file &apos;as built&apos; is the one of main interest! The angles
printed in the table below for that case are the ones shown in the
main section above.
</p>

<div class="org-src-container">
<pre class="src src-nim"><span style="color: #F92672;">import</span> math, sequtils, datamancer
<span style="color: #F92672;">const</span> <span style="color: #FD971F;">lMirror </span>= <span style="font-style: italic;">225</span>.<span style="font-style: italic;">0</span>
<span style="color: #F92672;">const</span> <span style="color: #FD971F;">xSep </span>= <span style="font-style: italic;">4</span>.<span style="font-style: italic;">0</span>

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">calcAngle</span><span style="color: #AE81FF;">(</span>r1, r2: <span style="color: #66D9EF;">float</span><span style="color: #AE81FF;">)</span>: <span style="color: #66D9EF;">float</span> =
  <span style="color: #FD971F;">result</span> = arcsin<span style="color: #AE81FF;">(</span><span style="color: #F92672;">abs</span><span style="color: #66D9EF;">(</span>r1 - r2<span style="color: #66D9EF;">)</span> / lMirror<span style="color: #AE81FF;">)</span>

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">calcR3</span><span style="color: #AE81FF;">(</span>r1, lMirror: <span style="color: #66D9EF;">float</span>, α: <span style="color: #66D9EF;">float</span><span style="color: #AE81FF;">)</span>: <span style="color: #66D9EF;">float</span> =
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">r2 </span>= r1 - lMirror * sin<span style="color: #AE81FF;">(</span>α<span style="color: #AE81FF;">)</span>
  <span style="color: #FD971F;">result</span> = r2 - <span style="font-style: italic;">0</span>.<span style="font-style: italic;">5</span> * xSep * tan<span style="color: #AE81FF;">(</span>α<span style="color: #AE81FF;">)</span>

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">printTab</span><span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">R1s</span>, <span style="color: #66D9EF;">R2s</span>, <span style="color: #66D9EF;">R4s</span>, <span style="color: #66D9EF;">R5s</span>: <span style="color: #66D9EF;">openArray</span><span style="color: #66D9EF;">[</span><span style="color: #66D9EF;">float</span><span style="color: #66D9EF;">]</span><span style="color: #AE81FF;">)</span> =
  <span style="color: #F92672;">var</span> <span style="color: #FD971F;">df </span>= newDataFrame<span style="color: #AE81FF;">()</span>
  <span style="color: #F92672;">for</span> i <span style="color: #F92672;">in</span> <span style="font-style: italic;">0</span> ..&lt; <span style="color: #66D9EF;">R1s</span>.<span style="color: #F92672;">len</span>:
    <span style="color: #F92672;">let</span> <span style="color: #FD971F;">r1 </span>= <span style="color: #66D9EF;">R1s</span><span style="color: #AE81FF;">[</span>i<span style="color: #AE81FF;">]</span>
    <span style="color: #F92672;">let</span> <span style="color: #FD971F;">r2 </span>= <span style="color: #66D9EF;">R2s</span><span style="color: #AE81FF;">[</span>i<span style="color: #AE81FF;">]</span>
    <span style="color: #F92672;">let</span> <span style="color: #FD971F;">α </span>= calcAngle<span style="color: #AE81FF;">(</span>r1, r2<span style="color: #AE81FF;">)</span>
    <span style="color: #F92672;">let</span> <span style="color: #FD971F;">r3 </span>= calcR3<span style="color: #AE81FF;">(</span>r1, lMirror, α<span style="color: #AE81FF;">)</span>
    <span style="color: #F92672;">let</span> <span style="color: #FD971F;">r1minus </span>= r1 - sin<span style="color: #AE81FF;">(</span>α<span style="color: #AE81FF;">)</span> * lMirror/<span style="font-style: italic;">2</span>
    <span style="color: #F92672;">let</span> <span style="color: #FD971F;">fr3 </span>= r3 / tan<span style="color: #AE81FF;">(</span><span style="font-style: italic;">4</span> * α<span style="color: #AE81FF;">)</span>
    <span style="color: #F92672;">let</span> <span style="color: #FD971F;">fr1m </span>= r1minus / tan<span style="color: #AE81FF;">(</span><span style="font-style: italic;">4</span> * α<span style="color: #AE81FF;">)</span>
    df.<span style="color: #F92672;">add</span> <span style="color: #AE81FF;">(</span>i: i+<span style="font-style: italic;">1</span>, f_R3: fr3.<span style="color: #66D9EF;">float</span>, f_R1m: fr1m.<span style="color: #66D9EF;">float</span>, α: α.radToDeg, <span style="color: #66D9EF;">R3</span>: r3<span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">echo</span> df.toOrgTable

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">printBuiltTab</span><span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">R1s</span>, <span style="color: #66D9EF;">R2s</span>, <span style="color: #66D9EF;">R4s</span>, <span style="color: #66D9EF;">R5s</span>: <span style="color: #66D9EF;">openArray</span><span style="color: #66D9EF;">[</span><span style="color: #66D9EF;">float</span><span style="color: #66D9EF;">]</span><span style="color: #AE81FF;">)</span> =
  <span style="color: #F92672;">var</span> <span style="color: #FD971F;">df </span>= newDataFrame<span style="color: #AE81FF;">()</span>
  <span style="color: #F92672;">for</span> i <span style="color: #F92672;">in</span> <span style="font-style: italic;">0</span> ..&lt; <span style="color: #66D9EF;">R1s</span>.<span style="color: #F92672;">len</span>:
    <span style="color: #F92672;">let</span> <span style="color: #FD971F;">r1 </span>= <span style="color: #66D9EF;">R1s</span><span style="color: #AE81FF;">[</span>i<span style="color: #AE81FF;">]</span>
    <span style="color: #F92672;">let</span> <span style="color: #FD971F;">r2 </span>= <span style="color: #66D9EF;">R2s</span><span style="color: #AE81FF;">[</span>i<span style="color: #AE81FF;">]</span>
    <span style="color: #F92672;">let</span> <span style="color: #FD971F;">r4 </span>= <span style="color: #66D9EF;">R4s</span><span style="color: #AE81FF;">[</span>i<span style="color: #AE81FF;">]</span>
    <span style="color: #F92672;">let</span> <span style="color: #FD971F;">r5 </span>= <span style="color: #66D9EF;">R5s</span><span style="color: #AE81FF;">[</span>i<span style="color: #AE81FF;">]</span>
    <span style="color: #F92672;">let</span> <span style="color: #FD971F;">α </span>= calcAngle<span style="color: #AE81FF;">(</span>r1, r2<span style="color: #AE81FF;">)</span>
    <span style="color: #F92672;">let</span> <span style="color: #FD971F;">α3 </span>= calcAngle<span style="color: #AE81FF;">(</span>r4, r5<span style="color: #AE81FF;">)</span>    
    <span style="color: #F92672;">let</span> <span style="color: #FD971F;">r3 </span>= calcR3<span style="color: #AE81FF;">(</span>r1, lMirror, α<span style="color: #AE81FF;">)</span>
    df.<span style="color: #F92672;">add</span> <span style="color: #AE81FF;">(</span>i: i+<span style="font-style: italic;">1</span>, <span style="color: #66D9EF;">R1</span>: r1, <span style="color: #66D9EF;">R2</span>: r2, <span style="color: #66D9EF;">R3</span>: r3, <span style="color: #66D9EF;">R4</span>: r4, <span style="color: #66D9EF;">R5</span>: r5, α: α.radToDeg, α3: α3.radToDeg<span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">echo</span> df.rename<span style="color: #AE81FF;">(</span>f<span style="color: #66D9EF;">{</span><span style="color: #E6DB74;">&quot;3α&quot;</span> &lt;- <span style="color: #E6DB74;">&quot;α3&quot;</span><span style="color: #66D9EF;">}</span><span style="color: #AE81FF;">)</span>.toOrgTable<span style="color: #AE81FF;">(</span>precision = <span style="font-style: italic;">6</span><span style="color: #AE81FF;">)</span>

<span style="color: #F92672;">block</span> <span style="color: #66D9EF;">AndersPhD</span>:
  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">R1s</span> = @<span style="color: #AE81FF;">[</span><span style="font-style: italic;">63</span>.<span style="font-style: italic;">006</span>, <span style="font-style: italic;">65</span>.<span style="font-style: italic;">606</span>, <span style="font-style: italic;">68</span>.<span style="font-style: italic;">305</span>, <span style="font-style: italic;">71</span>.<span style="font-style: italic;">105</span>, <span style="font-style: italic;">74</span>.<span style="font-style: italic;">011</span>, <span style="font-style: italic;">77</span>.<span style="font-style: italic;">027</span>, <span style="font-style: italic;">80</span>.<span style="font-style: italic;">157</span>,
              <span style="font-style: italic;">83</span>.<span style="font-style: italic;">405</span>, <span style="font-style: italic;">86</span>.<span style="font-style: italic;">775</span>, <span style="font-style: italic;">90</span>.<span style="font-style: italic;">272</span>, <span style="font-style: italic;">93</span>.<span style="font-style: italic;">902</span>, <span style="font-style: italic;">97</span>.<span style="font-style: italic;">668</span>, <span style="font-style: italic;">101</span>.<span style="font-style: italic;">576</span>, <span style="font-style: italic;">105</span>.<span style="font-style: italic;">632</span><span style="color: #AE81FF;">]</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">αs </span>= @<span style="color: #AE81FF;">[</span><span style="font-style: italic;">0</span>.<span style="font-style: italic;">579</span>, <span style="font-style: italic;">0</span>.<span style="font-style: italic;">603</span>, <span style="font-style: italic;">0</span>.<span style="font-style: italic;">628</span>, <span style="font-style: italic;">0</span>.<span style="font-style: italic;">654</span>, <span style="font-style: italic;">0</span>.<span style="font-style: italic;">680</span>, <span style="font-style: italic;">0</span>.<span style="font-style: italic;">708</span>, <span style="font-style: italic;">0</span>.<span style="font-style: italic;">737</span>, <span style="font-style: italic;">0</span>.<span style="font-style: italic;">767</span>,
             <span style="font-style: italic;">0</span>.<span style="font-style: italic;">798</span>, <span style="font-style: italic;">0</span>.<span style="font-style: italic;">830</span>, <span style="font-style: italic;">0</span>.<span style="font-style: italic;">863</span>, <span style="font-style: italic;">0</span>.<span style="font-style: italic;">898</span>, <span style="font-style: italic;">0</span>.<span style="font-style: italic;">933</span>, <span style="font-style: italic;">0</span>.<span style="font-style: italic;">970</span><span style="color: #AE81FF;">]</span>
  <span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">calcR2</span><span style="color: #AE81FF;">(</span>r1, α: <span style="color: #66D9EF;">float</span><span style="color: #AE81FF;">)</span>: <span style="color: #66D9EF;">float</span> = r1 - sin<span style="color: #AE81FF;">(</span>α.degToRad<span style="color: #AE81FF;">)</span> * lMirror
  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">R2s</span> = toSeq<span style="color: #AE81FF;">(</span><span style="font-style: italic;">0</span> ..&lt; <span style="color: #66D9EF;">R1s</span>.<span style="color: #F92672;">len</span><span style="color: #AE81FF;">)</span>.mapIt<span style="color: #AE81FF;">(</span>calcR2<span style="color: #66D9EF;">(</span><span style="color: #66D9EF;">R1s</span><span style="color: #A6E22E;">[</span>it<span style="color: #A6E22E;">]</span>, αs<span style="color: #A6E22E;">[</span>it<span style="color: #A6E22E;">]</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">echo</span> <span style="color: #E6DB74;">&quot;Using values from Anders PhD thesis&quot;</span>
  printTab<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">R1s</span>, <span style="color: #66D9EF;">R2s</span>, <span style="color: #66D9EF;">[]</span>, <span style="color: #66D9EF;">[]</span><span style="color: #AE81FF;">)</span>
  
<span style="color: #F92672;">block</span> <span style="color: #66D9EF;">AsDesigned</span>: <span style="color: #75715E;"># </span><span style="color: #75715E;">`</span><span style="color: #AE81FF;">cast20l4_f1500mm_asDesigned.txt</span><span style="color: #75715E;">`</span>
  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">R1s</span> = <span style="color: #AE81FF;">[</span> <span style="font-style: italic;">63</span>.<span style="font-style: italic;">2412</span>, <span style="font-style: italic;">65</span>.<span style="font-style: italic;">8741</span>, <span style="font-style: italic;">68</span>.<span style="font-style: italic;">6075</span>, <span style="font-style: italic;">71</span>.<span style="font-style: italic;">4450</span>, <span style="font-style: italic;">74</span>.<span style="font-style: italic;">3908</span>, <span style="font-style: italic;">77</span>.<span style="font-style: italic;">4488</span>, <span style="font-style: italic;">80</span>.<span style="font-style: italic;">6233</span>,
              <span style="font-style: italic;">83</span>.<span style="font-style: italic;">9188</span>, <span style="font-style: italic;">87</span>.<span style="font-style: italic;">3398</span>, <span style="font-style: italic;">90</span>.<span style="font-style: italic;">8911</span>, <span style="font-style: italic;">94</span>.<span style="font-style: italic;">5775</span>, <span style="font-style: italic;">98</span>.<span style="font-style: italic;">4043</span>, <span style="font-style: italic;">102</span>.<span style="font-style: italic;">377</span> <span style="color: #AE81FF;">]</span>
  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">R2s</span> = <span style="color: #AE81FF;">[</span> <span style="font-style: italic;">60</span>.<span style="font-style: italic;">9149</span>, <span style="font-style: italic;">63</span>.<span style="font-style: italic;">4511</span>, <span style="font-style: italic;">66</span>.<span style="font-style: italic;">0840</span>, <span style="font-style: italic;">68</span>.<span style="font-style: italic;">8173</span>, <span style="font-style: italic;">71</span>.<span style="font-style: italic;">6549</span>, <span style="font-style: italic;">74</span>.<span style="font-style: italic;">6006</span>, <span style="font-style: italic;">77</span>.<span style="font-style: italic;">6586</span>,
              <span style="font-style: italic;">80</span>.<span style="font-style: italic;">8331</span>, <span style="font-style: italic;">84</span>.<span style="font-style: italic;">1286</span>, <span style="font-style: italic;">87</span>.<span style="font-style: italic;">5496</span>, <span style="font-style: italic;">91</span>.<span style="font-style: italic;">1008</span>, <span style="font-style: italic;">94</span>.<span style="font-style: italic;">7872</span>, <span style="font-style: italic;">98</span>.<span style="font-style: italic;">6139</span> <span style="color: #AE81FF;">]</span>
  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">R4s</span> = <span style="color: #AE81FF;">[</span> <span style="font-style: italic;">60</span>.<span style="font-style: italic;">8322</span>, <span style="font-style: italic;">63</span>.<span style="font-style: italic;">3650</span>, <span style="font-style: italic;">65</span>.<span style="font-style: italic;">9942</span>, <span style="font-style: italic;">68</span>.<span style="font-style: italic;">7239</span>, <span style="font-style: italic;">71</span>.<span style="font-style: italic;">5576</span>, <span style="font-style: italic;">74</span>.<span style="font-style: italic;">4993</span>, <span style="font-style: italic;">77</span>.<span style="font-style: italic;">5532</span>,
              <span style="font-style: italic;">80</span>.<span style="font-style: italic;">7234</span>, <span style="font-style: italic;">84</span>.<span style="font-style: italic;">0144</span>, <span style="font-style: italic;">87</span>.<span style="font-style: italic;">4307</span>, <span style="font-style: italic;">90</span>.<span style="font-style: italic;">9771</span>, <span style="font-style: italic;">94</span>.<span style="font-style: italic;">6586</span>, <span style="font-style: italic;">98</span>.<span style="font-style: italic;">4801</span> <span style="color: #AE81FF;">]</span>
  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">R5s</span> = <span style="color: #AE81FF;">[</span> <span style="font-style: italic;">53</span>.<span style="font-style: italic;">8513</span>, <span style="font-style: italic;">56</span>.<span style="font-style: italic;">0936</span>, <span style="font-style: italic;">58</span>.<span style="font-style: italic;">4213</span>, <span style="font-style: italic;">60</span>.<span style="font-style: italic;">8379</span>, <span style="font-style: italic;">63</span>.<span style="font-style: italic;">3467</span>, <span style="font-style: italic;">65</span>.<span style="font-style: italic;">9511</span>, <span style="font-style: italic;">68</span>.<span style="font-style: italic;">6549</span>,
              <span style="font-style: italic;">71</span>.<span style="font-style: italic;">4617</span>, <span style="font-style: italic;">74</span>.<span style="font-style: italic;">3755</span>, <span style="font-style: italic;">77</span>.<span style="font-style: italic;">4003</span>, <span style="font-style: italic;">80</span>.<span style="font-style: italic;">5403</span>, <span style="font-style: italic;">83</span>.<span style="font-style: italic;">7999</span>, <span style="font-style: italic;">87</span>.<span style="font-style: italic;">1836</span> <span style="color: #AE81FF;">]</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">diffs </span>= <span style="color: #AE81FF;">[</span> <span style="font-style: italic;">10</span>.<span style="font-style: italic;">3390</span>, <span style="font-style: italic;">10</span>.<span style="font-style: italic;">7690</span>, <span style="font-style: italic;">11</span>.<span style="font-style: italic;">2150</span>, <span style="font-style: italic;">11</span>.<span style="font-style: italic;">6780</span>, <span style="font-style: italic;">12</span>.<span style="font-style: italic;">1590</span>, <span style="font-style: italic;">12</span>.<span style="font-style: italic;">6580</span>, <span style="font-style: italic;">13</span>.<span style="font-style: italic;">1760</span>,
                <span style="font-style: italic;">13</span>.<span style="font-style: italic;">7130</span>, <span style="font-style: italic;">14</span>.<span style="font-style: italic;">2710</span>, <span style="font-style: italic;">14</span>.<span style="font-style: italic;">8500</span>, <span style="font-style: italic;">15</span>.<span style="font-style: italic;">4510</span>, <span style="font-style: italic;">16</span>.<span style="font-style: italic;">0740</span>, <span style="font-style: italic;">16</span>.<span style="font-style: italic;">7210</span> <span style="color: #AE81FF;">]</span>
  <span style="color: #F92672;">echo</span> <span style="color: #E6DB74;">&quot;Using values from .txt file &apos;as designed&apos;&quot;</span>
  printTab<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">R1s</span>, <span style="color: #66D9EF;">R2s</span>, <span style="color: #66D9EF;">R4s</span>, <span style="color: #66D9EF;">R5s</span><span style="color: #AE81FF;">)</span>

<span style="color: #F92672;">block</span> <span style="color: #66D9EF;">AsBuilt</span>: <span style="color: #75715E;"># </span><span style="color: #75715E;">`</span><span style="color: #AE81FF;">cast20l4_f1500mm_asBuilt.txt</span><span style="color: #75715E;">`</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">These are the numbers from the &quot;as built&quot; text file</span>
  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">R1s</span> = <span style="color: #AE81FF;">[</span> <span style="font-style: italic;">63</span>.<span style="font-style: italic;">2384</span>, <span style="font-style: italic;">65</span>.<span style="font-style: italic;">8700</span>, <span style="font-style: italic;">68</span>.<span style="font-style: italic;">6059</span>, <span style="font-style: italic;">71</span>.<span style="font-style: italic;">4175</span>, <span style="font-style: italic;">74</span>.<span style="font-style: italic;">4006</span>, <span style="font-style: italic;">77</span>.<span style="font-style: italic;">4496</span>, <span style="font-style: italic;">80</span>.<span style="font-style: italic;">6099</span>, 
              <span style="font-style: italic;">83</span>.<span style="font-style: italic;">9198</span>, <span style="font-style: italic;">87</span>.<span style="font-style: italic;">3402</span>, <span style="font-style: italic;">90</span>.<span style="font-style: italic;">8910</span>, <span style="font-style: italic;">94</span>.<span style="font-style: italic;">5780</span>, <span style="font-style: italic;">98</span>.<span style="font-style: italic;">3908</span>, <span style="font-style: italic;">102</span>.<span style="font-style: italic;">381</span> <span style="color: #AE81FF;">]</span>
  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">R2s</span> = <span style="color: #AE81FF;">[</span> <span style="font-style: italic;">60</span>.<span style="font-style: italic;">9121</span>, <span style="font-style: italic;">63</span>.<span style="font-style: italic;">4470</span>, <span style="font-style: italic;">66</span>.<span style="font-style: italic;">0824</span>, <span style="font-style: italic;">68</span>.<span style="font-style: italic;">7898</span>, <span style="font-style: italic;">71</span>.<span style="font-style: italic;">6647</span>, <span style="font-style: italic;">74</span>.<span style="font-style: italic;">6014</span>, <span style="font-style: italic;">77</span>.<span style="font-style: italic;">6452</span>,
              <span style="font-style: italic;">80</span>.<span style="font-style: italic;">8341</span>, <span style="font-style: italic;">84</span>.<span style="font-style: italic;">1290</span>, <span style="font-style: italic;">87</span>.<span style="font-style: italic;">5495</span>, <span style="font-style: italic;">91</span>.<span style="font-style: italic;">1013</span>, <span style="font-style: italic;">94</span>.<span style="font-style: italic;">7737</span>, <span style="font-style: italic;">98</span>.<span style="font-style: italic;">6187</span> <span style="color: #AE81FF;">]</span>
  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">R4s</span> = <span style="color: #AE81FF;">[</span> <span style="font-style: italic;">60</span>.<span style="font-style: italic;">8632</span>, <span style="font-style: italic;">63</span>.<span style="font-style: italic;">3197</span>, <span style="font-style: italic;">65</span>.<span style="font-style: italic;">9637</span>, <span style="font-style: italic;">68</span>.<span style="font-style: italic;">6794</span>, <span style="font-style: italic;">71</span>.<span style="font-style: italic;">5582</span>, <span style="font-style: italic;">74</span>.<span style="font-style: italic;">4997</span>, <span style="font-style: italic;">77</span>.<span style="font-style: italic;">5496</span>,
              <span style="font-style: italic;">80</span>.<span style="font-style: italic;">7305</span>, <span style="font-style: italic;">84</span>.<span style="font-style: italic;">0137</span>, <span style="font-style: italic;">87</span>.<span style="font-style: italic;">4316</span>, <span style="font-style: italic;">90</span>.<span style="font-style: italic;">9865</span>, <span style="font-style: italic;">94</span>.<span style="font-style: italic;">6549</span>, <span style="font-style: italic;">98</span>.<span style="font-style: italic;">4879</span> <span style="color: #AE81FF;">]</span>
  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">R5s</span> = <span style="color: #AE81FF;">[</span> <span style="font-style: italic;">53</span>.<span style="font-style: italic;">8823</span>, <span style="font-style: italic;">56</span>.<span style="font-style: italic;">0483</span>, <span style="font-style: italic;">58</span>.<span style="font-style: italic;">3908</span>, <span style="font-style: italic;">60</span>.<span style="font-style: italic;">7934</span>, <span style="font-style: italic;">63</span>.<span style="font-style: italic;">3473</span>, <span style="font-style: italic;">65</span>.<span style="font-style: italic;">9515</span>, <span style="font-style: italic;">68</span>.<span style="font-style: italic;">6513</span>,
              <span style="font-style: italic;">71</span>.<span style="font-style: italic;">4688</span>, <span style="font-style: italic;">74</span>.<span style="font-style: italic;">3748</span>, <span style="font-style: italic;">77</span>.<span style="font-style: italic;">4012</span>, <span style="font-style: italic;">80</span>.<span style="font-style: italic;">5497</span>, <span style="font-style: italic;">83</span>.<span style="font-style: italic;">7962</span>, <span style="font-style: italic;">87</span>.<span style="font-style: italic;">1914</span> <span style="color: #AE81FF;">]</span>
              <span style="color: #75715E;"># </span><span style="color: #75715E;">this last one should be the difference between R5 and R1</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">diffs </span>= <span style="color: #AE81FF;">[</span> <span style="font-style: italic;">10</span>.<span style="font-style: italic;">339</span>, <span style="font-style: italic;">10</span>.<span style="font-style: italic;">769</span>, <span style="font-style: italic;">11</span>.<span style="font-style: italic;">216</span>, <span style="font-style: italic;">11</span>.<span style="font-style: italic;">679</span>, <span style="font-style: italic;">12</span>.<span style="font-style: italic;">160</span>, <span style="font-style: italic;">12</span>.<span style="font-style: italic;">659</span>, <span style="font-style: italic;">13</span>.<span style="font-style: italic;">176</span>,
                <span style="font-style: italic;">13</span>.<span style="font-style: italic;">714</span>, <span style="font-style: italic;">14</span>.<span style="font-style: italic;">272</span>, <span style="font-style: italic;">14</span>.<span style="font-style: italic;">851</span>, <span style="font-style: italic;">15</span>.<span style="font-style: italic;">452</span>, <span style="font-style: italic;">16</span>.<span style="font-style: italic;">076</span>, <span style="font-style: italic;">16</span>.<span style="font-style: italic;">725</span>  <span style="color: #AE81FF;">]</span>
  <span style="color: #F92672;">echo</span> <span style="color: #E6DB74;">&quot;Using values from .txt file &apos;as built&apos;&quot;</span>
  printTab<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">R1s</span>, <span style="color: #66D9EF;">R2s</span>, <span style="color: #66D9EF;">R4s</span>, <span style="color: #66D9EF;">R5s</span><span style="color: #AE81FF;">)</span>

  <span style="color: #75715E;"># </span><span style="color: #75715E;">And now print the table to use in thesis</span>
  <span style="color: #F92672;">echo</span> <span style="color: #E6DB74;">&quot;Overview of radii and angles of telescope was built:&quot;</span>
  printBuiltTab<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">R1s</span>, <span style="color: #66D9EF;">R2s</span>, <span style="color: #66D9EF;">R4s</span>, <span style="color: #66D9EF;">R5s</span><span style="color: #AE81FF;">)</span>
</pre>
</div>
<p>
Using values from Anders PhD thesis
</p>
<table>


<colgroup>
<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />
</colgroup>
<thead>
<tr>
<th class="org-right" scope="col">i</th>
<th class="org-right" scope="col">f<sub>R3</sub></th>
<th class="org-right" scope="col">f<sub>R1m</sub></th>
<th class="org-right" scope="col">α</th>
<th class="org-right" scope="col">R3</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">1501.1452</td>
<td class="org-right">1529.7542</td>
<td class="org-right">0.579</td>
<td class="org-right">60.712099</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-right">1500.7995</td>
<td class="org-right">1529.4071</td>
<td class="org-right">0.603</td>
<td class="org-right">63.217019</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-right">1500.2462</td>
<td class="org-right">1528.8523</td>
<td class="org-right">0.628</td>
<td class="org-right">65.816977</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-right">1499.554</td>
<td class="org-right">1528.1586</td>
<td class="org-right">0.654</td>
<td class="org-right">68.513974</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-right">1501.1365</td>
<td class="org-right">1529.7394</td>
<td class="org-right">0.68</td>
<td class="org-right">71.316971</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-right">1500.4047</td>
<td class="org-right">1529.0057</td>
<td class="org-right">0.708</td>
<td class="org-right">74.222046</td>
</tr>

<tr>
<td class="org-right">6</td>
<td class="org-right">1499.816</td>
<td class="org-right">1528.4149</td>
<td class="org-right">0.737</td>
<td class="org-right">77.23716</td>
</tr>

<tr>
<td class="org-right">7</td>
<td class="org-right">1499.4292</td>
<td class="org-right">1528.026</td>
<td class="org-right">0.767</td>
<td class="org-right">80.366313</td>
</tr>

<tr>
<td class="org-right">8</td>
<td class="org-right">1499.2931</td>
<td class="org-right">1527.8876</td>
<td class="org-right">0.798</td>
<td class="org-right">83.613505</td>
</tr>

<tr>
<td class="org-right">9</td>
<td class="org-right">1499.4644</td>
<td class="org-right">1528.0564</td>
<td class="org-right">0.83</td>
<td class="org-right">86.983737</td>
</tr>

<tr>
<td class="org-right">10</td>
<td class="org-right">1500.0058</td>
<td class="org-right">1528.5952</td>
<td class="org-right">0.863</td>
<td class="org-right">90.483008</td>
</tr>

<tr>
<td class="org-right">11</td>
<td class="org-right">1499.1816</td>
<td class="org-right">1527.768</td>
<td class="org-right">0.898</td>
<td class="org-right">94.110358</td>
</tr>

<tr>
<td class="org-right">12</td>
<td class="org-right">1500.579</td>
<td class="org-right">1529.1623</td>
<td class="org-right">0.933</td>
<td class="org-right">97.879709</td>
</tr>

<tr>
<td class="org-right">13</td>
<td class="org-right">1500.8171</td>
<td class="org-right">1529.397</td>
<td class="org-right">0.97</td>
<td class="org-right">101.78914</td>
</tr>
</tbody>
</table>

<p>
Using values from .txt file &apos;as designed&apos;
</p>
<table>


<colgroup>
<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />
</colgroup>
<thead>
<tr>
<th class="org-right" scope="col">i</th>
<th class="org-right" scope="col">f<sub>R3</sub></th>
<th class="org-right" scope="col">f<sub>R1m</sub></th>
<th class="org-right" scope="col">α</th>
<th class="org-right" scope="col">R3</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">1471.5582</td>
<td class="org-right">1500.1664</td>
<td class="org-right">0.59239799</td>
<td class="org-right">60.894221</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-right">1471.5794</td>
<td class="org-right">1500.1861</td>
<td class="org-right">0.61702381</td>
<td class="org-right">63.429561</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-right">1471.5244</td>
<td class="org-right">1500.1297</td>
<td class="org-right">0.64261747</td>
<td class="org-right">66.061567</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-right">1471.5363</td>
<td class="org-right">1500.1398</td>
<td class="org-right">0.66915352</td>
<td class="org-right">68.793941</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-right">1471.5242</td>
<td class="org-right">1500.1259</td>
<td class="org-right">0.69670838</td>
<td class="org-right">71.630579</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-right">1471.5125</td>
<td class="org-right">1500.1123</td>
<td class="org-right">0.72530755</td>
<td class="org-right">74.575281</td>
</tr>

<tr>
<td class="org-right">6</td>
<td class="org-right">1471.5293</td>
<td class="org-right">1500.127</td>
<td class="org-right">0.7549765</td>
<td class="org-right">77.632245</td>
</tr>

<tr>
<td class="org-right">7</td>
<td class="org-right">1471.5027</td>
<td class="org-right">1500.0982</td>
<td class="org-right">0.78579169</td>
<td class="org-right">80.805669</td>
</tr>

<tr>
<td class="org-right">8</td>
<td class="org-right">1471.5144</td>
<td class="org-right">1500.1074</td>
<td class="org-right">0.81775313</td>
<td class="org-right">84.100053</td>
</tr>

<tr>
<td class="org-right">9</td>
<td class="org-right">1471.501</td>
<td class="org-right">1500.0913</td>
<td class="org-right">0.85093727</td>
<td class="org-right">87.519895</td>
</tr>

<tr>
<td class="org-right">10</td>
<td class="org-right">1471.4966</td>
<td class="org-right">1500.0841</td>
<td class="org-right">0.88536962</td>
<td class="org-right">91.069892</td>
</tr>

<tr>
<td class="org-right">11</td>
<td class="org-right">1471.453</td>
<td class="org-right">1500.0374</td>
<td class="org-right">0.92112663</td>
<td class="org-right">94.755044</td>
</tr>

<tr>
<td class="org-right">12</td>
<td class="org-right">1471.2913</td>
<td class="org-right">1499.8723</td>
<td class="org-right">0.95831023</td>
<td class="org-right">98.580446</td>
</tr>
</tbody>
</table>

<p>
Using values from .txt file &apos;as built&apos;
</p>
<table>


<colgroup>
<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />
</colgroup>
<thead>
<tr>
<th class="org-right" scope="col">i</th>
<th class="org-right" scope="col">f<sub>R3</sub></th>
<th class="org-right" scope="col">f<sub>R1m</sub></th>
<th class="org-right" scope="col">α</th>
<th class="org-right" scope="col">R3</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">1471.4905</td>
<td class="org-right">1500.0987</td>
<td class="org-right">0.59239799</td>
<td class="org-right">60.891421</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-right">1471.4842</td>
<td class="org-right">1500.091</td>
<td class="org-right">0.61702381</td>
<td class="org-right">63.425461</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-right">1471.4888</td>
<td class="org-right">1500.094</td>
<td class="org-right">0.64261747</td>
<td class="org-right">66.059967</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-right">1470.948</td>
<td class="org-right">1499.5516</td>
<td class="org-right">0.66915352</td>
<td class="org-right">68.766441</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-right">1471.7255</td>
<td class="org-right">1500.3272</td>
<td class="org-right">0.69670838</td>
<td class="org-right">71.640379</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-right">1471.5282</td>
<td class="org-right">1500.128</td>
<td class="org-right">0.72530755</td>
<td class="org-right">74.576081</td>
</tr>

<tr>
<td class="org-right">6</td>
<td class="org-right">1471.2753</td>
<td class="org-right">1499.873</td>
<td class="org-right">0.7549765</td>
<td class="org-right">77.618845</td>
</tr>

<tr>
<td class="org-right">7</td>
<td class="org-right">1471.5209</td>
<td class="org-right">1500.1164</td>
<td class="org-right">0.78579169</td>
<td class="org-right">80.806669</td>
</tr>

<tr>
<td class="org-right">8</td>
<td class="org-right">1471.5214</td>
<td class="org-right">1500.1144</td>
<td class="org-right">0.81775313</td>
<td class="org-right">84.100453</td>
</tr>

<tr>
<td class="org-right">9</td>
<td class="org-right">1471.4993</td>
<td class="org-right">1500.0896</td>
<td class="org-right">0.85093727</td>
<td class="org-right">87.519795</td>
</tr>

<tr>
<td class="org-right">10</td>
<td class="org-right">1471.5047</td>
<td class="org-right">1500.0922</td>
<td class="org-right">0.88536962</td>
<td class="org-right">91.070392</td>
</tr>

<tr>
<td class="org-right">11</td>
<td class="org-right">1471.2434</td>
<td class="org-right">1499.8278</td>
<td class="org-right">0.92112663</td>
<td class="org-right">94.741544</td>
</tr>

<tr>
<td class="org-right">12</td>
<td class="org-right">1471.6768</td>
<td class="org-right">1500.2579</td>
<td class="org-right">0.95810648</td>
<td class="org-right">98.585253</td>
</tr>
</tbody>
</table>

<p>
Overview of radii and angles of telescope was built:
</p>
<table>


<colgroup>
<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />
</colgroup>
<thead>
<tr>
<th class="org-right" scope="col">i</th>
<th class="org-right" scope="col">R1</th>
<th class="org-right" scope="col">R2</th>
<th class="org-right" scope="col">R3</th>
<th class="org-right" scope="col">R4</th>
<th class="org-right" scope="col">R5</th>
<th class="org-right" scope="col">α</th>
<th class="org-right" scope="col">3α</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-right">63.2384</td>
<td class="org-right">60.9121</td>
<td class="org-right">60.8914</td>
<td class="org-right">60.8632</td>
<td class="org-right">53.8823</td>
<td class="org-right">0.592398</td>
<td class="org-right">1.77796</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-right">65.87</td>
<td class="org-right">63.447</td>
<td class="org-right">63.4255</td>
<td class="org-right">63.3197</td>
<td class="org-right">56.0483</td>
<td class="org-right">0.617024</td>
<td class="org-right">1.85197</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-right">68.6059</td>
<td class="org-right">66.0824</td>
<td class="org-right">66.06</td>
<td class="org-right">65.9637</td>
<td class="org-right">58.3908</td>
<td class="org-right">0.642617</td>
<td class="org-right">1.92879</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-right">71.4175</td>
<td class="org-right">68.7898</td>
<td class="org-right">68.7664</td>
<td class="org-right">68.6794</td>
<td class="org-right">60.7934</td>
<td class="org-right">0.669154</td>
<td class="org-right">2.00856</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-right">74.4006</td>
<td class="org-right">71.6647</td>
<td class="org-right">71.6404</td>
<td class="org-right">71.5582</td>
<td class="org-right">63.3473</td>
<td class="org-right">0.696708</td>
<td class="org-right">2.09135</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-right">77.4496</td>
<td class="org-right">74.6014</td>
<td class="org-right">74.5761</td>
<td class="org-right">74.4997</td>
<td class="org-right">65.9515</td>
<td class="org-right">0.725308</td>
<td class="org-right">2.17731</td>
</tr>

<tr>
<td class="org-right">6</td>
<td class="org-right">80.6099</td>
<td class="org-right">77.6452</td>
<td class="org-right">77.6188</td>
<td class="org-right">77.5496</td>
<td class="org-right">68.6513</td>
<td class="org-right">0.754977</td>
<td class="org-right">2.26652</td>
</tr>

<tr>
<td class="org-right">7</td>
<td class="org-right">83.9198</td>
<td class="org-right">80.8341</td>
<td class="org-right">80.8067</td>
<td class="org-right">80.7305</td>
<td class="org-right">71.4688</td>
<td class="org-right">0.785792</td>
<td class="org-right">2.35914</td>
</tr>

<tr>
<td class="org-right">8</td>
<td class="org-right">87.3402</td>
<td class="org-right">84.129</td>
<td class="org-right">84.1005</td>
<td class="org-right">84.0137</td>
<td class="org-right">74.3748</td>
<td class="org-right">0.817753</td>
<td class="org-right">2.45528</td>
</tr>

<tr>
<td class="org-right">9</td>
<td class="org-right">90.891</td>
<td class="org-right">87.5495</td>
<td class="org-right">87.5198</td>
<td class="org-right">87.4316</td>
<td class="org-right">77.4012</td>
<td class="org-right">0.850937</td>
<td class="org-right">2.55507</td>
</tr>

<tr>
<td class="org-right">10</td>
<td class="org-right">94.578</td>
<td class="org-right">91.1013</td>
<td class="org-right">91.0704</td>
<td class="org-right">90.9865</td>
<td class="org-right">80.5497</td>
<td class="org-right">0.88537</td>
<td class="org-right">2.65866</td>
</tr>

<tr>
<td class="org-right">11</td>
<td class="org-right">98.3908</td>
<td class="org-right">94.7737</td>
<td class="org-right">94.7415</td>
<td class="org-right">94.6549</td>
<td class="org-right">83.7962</td>
<td class="org-right">0.921127</td>
<td class="org-right">2.76622</td>
</tr>

<tr>
<td class="org-right">12</td>
<td class="org-right">102.381</td>
<td class="org-right">98.6187</td>
<td class="org-right">98.5853</td>
<td class="org-right">98.4879</td>
<td class="org-right">87.1914</td>
<td class="org-right">0.958106</td>
<td class="org-right">2.87784</td>
</tr>
</tbody>
</table>

<p>
:shocked<sub>face</sub>: :exploding<sub>head</sub>:
</p>
</div>
</div>
</div>

<div class="outline-3" id="outline-container-sec:appendix:raytracing:panter">
<h3 id="sec:appendix:raytracing:panter"><span class="section-number-3">37.3.</span> Comparison of TrAXer results with PANTER measurements</h3>
<div class="outline-text-3" id="text-sec:appendix:raytracing:panter">
<p>
The LLNL telescope was tested and characterized at the PANTER X-ray test facility in
Munich in July 2016. It was reported on these tests during the
\(62^{\text{nd}}\) CAST collaboration meeting (CCM) on <span class="timestamp-wrapper">  <span class="timestamp">&lt;2016-09-26 Mon&gt; </span></span> and
again in the CCM on <span class="timestamp-wrapper">  <span class="timestamp">&lt;2017-01-23 Mon&gt;</span></span>. <sup>  <a role="doc-backlink" class="footref" id="fnr.13" href="#fn.13">13</a></sup> These results are
valuable to us, because they can be used as a cross-check to verify
our <code>TrAXer</code> based raytracing simulations.
</p>

<p>
At the PANTER facility the X-ray source sits \(\SI{130.297}{m}\) away
from the center of the telescope (the plane of the virtual
reflection). It can be approximated as a source of radius
\(\SI{0.42}{mm}\). The detector used to measure at PANTER is installed
on the optical axis (i.e. directly &apos;in front of&apos; the source). The
telescope itself is offset by the radius of its shells, such that its
optical axis aligns with the optical axis defined by the X-ray beam
(instead of aligning the telescope entrance with the beam axis and the
detector offset from it!). In this way the light entering the
telescope does not enter perpendicular to the opening, but under an
angle. 
</p>

<p>
The setup of having such an effective point source implies that the
best focal point will not be in the physical focal spot defined by the
focal length, but slightly behind. At PANTER this was measured to be
at \(\SI{1519}{mm}\) instead of \(\SI{1500}{mm}\) and provides a first
check of our raytracer. When reproducing the same setup in TrAXer we
find the smallest, most symmetric spot around the
\(\SIrange{1519}{1520}{mm}\) mark as well. <sup>  <a role="doc-backlink" class="footref" id="fnr.14" href="#fn.14">14</a></sup>
</p>

<p>
In this setup three different X-ray fluorescence lines were
measured. \(\ce{Al}\) Kα (\(\SI{1.49}{keV}\)), \(\ce{Ti}\) Kα
(\(\SI{4.51}{keV}\)) and \(\ce{Fe}\) Kα (\(\SI{6.41}{keV}\)). We can compare
the images between measurements and simulations as well as compute the
&apos;half power diameter&apos; (HPD). The HPD is the radius around the image
center (based on the weighted mean center) in which \(\SI{50}{\%}\) of
the flux is contained. This is computed based on the encircled energy
function (EEF): integrate the flux in radial slices around the center,
compute a radial cumulative distribution function and find the radius
corresponding to \(\SI{50}{\%}\).
</p>

<p>
Let&apos;s consider the aluminum Kα
lines. Fig. <a href="#fig:appendix:raytracing:comparison_alKalpha">4</a> compares
the PANTER data, with the LLNL raytracing result and our raytracing
result. <sup>  <a role="doc-backlink" class="footref" id="fnr.15" href="#fn.15">15</a></sup> All three plots show the inner
\(\num{3}·\SI{3}{mm²}\) of the image. Generally, the agreement is very
good. The &quot;bow tie&quot; shape can be seen in all three figures.
</p>


<figure class="figure-wrapper" id="fig:appendix:raytracing:comparison_alKalpha">
<figure class="subfigure" id="fig:appendix:raytracing:panter_data_alK" data-width="29%">  <img src="./figs/home/basti/phd/Figs/raytracing/llnlPanter/PANTER_LLNL_CCM_slide_11_cropped_panter_data.svg" data-width="94%" />  <figcaption>Figure 4(a): PANTER data</figcaption></figure> <figure class="subfigure" id="fig:appendix:raytracing:simulation_alK" data-width="29%">  <img src="./figs/home/basti/phd/Figs/raytracing/llnlPanter/PANTER_LLNL_CCM_slide_11_cropped_simulation.svg" data-width="94%" />  <figcaption>Figure 4(b): LLNL simulation</figcaption></figure> <figure class="subfigure" id="fig:appendix:raytracing:traxer_sim_alK" data-width="38%">  <img src="./figs/~/phd/Figs/raytracing/llnlPanter/panter_source_Al_Kalpha_imperfect_mirrors_3x3mm_fWidth0.3.svg" data-width="99%" />  <figcaption>Figure 4(c): TrAXer</figcaption></figure>
<figcaption>Figure 4: <a href="#fig:appendix:raytracing:panter_data_alK">4(a)</a>: Data of the telescope taken at PANTER. <a href="#fig:appendix:raytracing:simulation_alK">4(b)</a>: Raytracing simulation performed by M. Pivovaroff at LLNL. Both of these are taken from
          the CCM in Jan 2017, slide 11. <a href="#fig:appendix:raytracing:traxer_sim_alK">4(c)</a>: Simulation performed with TrAXer. All three plots show the inner $\num{3}·\SI{3}{mm²}$ of the image.</figcaption>
</figure>


<p>
Computing the encircled energy function yields a figure as shown in
fig. <a href="#fig:appendix:raytracing:traxer_encircled_energy_function">5</a>. We see
the HPD shown as the red line at a radius of \(r_{\text{HPD}} \approx \SI{0.79}{mm}\). This
is converted to an HPD in arc seconds via
</p>

<p>
\[
α_{\text{HPD}} = \arctan\left( \frac{r_{\text{HPD}}}{f} \right)
\]
</p>

<p>
where \(f\) is the focal length of the optic. This leads to an HPD of
\(\SI{216.38}{\arcsecond}\), which is slightly above both the LLNL
raytracing simulation (PANTER model) and the PANTER data. Doing this
for all three fluorescence lines, we get the numbers shown in
tab. <a href="#tab:appendix:llnl_panter_eef_hpd_measurements">37</a>, where the
differences are even smaller. Therefore, our implementation of the
raytracer including figure errors yields very compatible results to
the LLNL model developed for PANTER. The usage of TrAXer as the tool
of choice for the calculation of the axion image seems justified.
</p>

<p>
See sec. <a href="./raytracing.html#sec:appendix:raytracing:figure_error_model">37.3.1</a> below for more
details on how the figure error is introduced and its parameters
determined.
</p>


<figure id="fig:appendix:raytracing:traxer_encircled_energy_function">
<img src="./figs/home/basti/phd/Figs/raytracing/llnlPanter/panter_source_Al_Kalpha_imperfect_mirrors_3x3mm_hpd_via_eef_50.svg" class="org-svg" alt="panter_source_Al_Kalpha_imperfect_mirrors_3x3mm_hpd_via_eef_50.svg" />

<figcaption>Figure 5: <span class="figure-number">Figure 203: </span>Encircled energy function of the aluminum Kα line, corresponding to the data of fig. <a href="#fig:appendix:raytracing:traxer_sim_alK">4(c)</a>. The HPD comes out to \(\SI{186.45}{\arcsecond}\).</figcaption>
</figure>

<table id="tab:appendix:llnl_panter_eef_hpd_measurements">
<caption class="t-above"><span class="table-number">Table 37:</span> Measurements and simulation results given on slides 18-20 of the CCM slides Jan 2017. &apos;Point source&apos; refers to LLNL raytracing simulations. PANTER model is an LLNL raytracing model adjusted to best match the PANTER data. Our raytracing results are the TrAXer rows. TrAXer generally overestimates the HPD by about \(\SI{20}{\arcsecond}\) compared to the perfectc mirror LLNL raytracing results.</caption>

<colgroup>
<col class="org-left" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />
</colgroup>
<thead>
<tr>
<th class="org-left" scope="col">Al Kα (1.49 keV)</th>
<th class="org-right" scope="col"> </th>
<th class="org-right" scope="col"> </th>
<th class="org-right" scope="col"> </th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"> </td>
<td class="org-right">50% (HPD)</td>
<td class="org-right">80% circle</td>
<td class="org-right">90% circle</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">Point source (perfect mirrors)</td>
<td class="org-right">168 arcsec</td>
<td class="org-right">270 arcsec</td>
<td class="org-right">313 arcsec</td>
</tr>

<tr>
<td class="org-left">Point source (figure errors)</td>
<td class="org-right">206</td>
<td class="org-right">387</td>
<td class="org-right">568</td>
</tr>

<tr>
<td class="org-left">PANTER data</td>
<td class="org-right">206</td>
<td class="org-right">397</td>
<td class="org-right">549</td>
</tr>

<tr>
<td class="org-left">PANTER model</td>
<td class="org-right">211</td>
<td class="org-right">391</td>
<td class="org-right">559</td>
</tr>

<tr>
<td class="org-left">TrAXer (perfect mirrors)</td>
<td class="org-right">183.19</td>
<td class="org-right">304.61</td>
<td class="org-right">351.54</td>
</tr>

<tr>
<td class="org-left">TrAXer (figure errors)</td>
<td class="org-right">216.38</td>
<td class="org-right">389.72</td>
<td class="org-right">559.79</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">Ti Kα (4.51 keV)</td>
<td class="org-right"> </td>
<td class="org-right"> </td>
<td class="org-right"> </td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left"> </td>
<td class="org-right">50% (HPD)</td>
<td class="org-right">80% circle</td>
<td class="org-right">90% circle</td>
</tr>

<tr>
<td class="org-left">Point source (perfect mirrors)</td>
<td class="org-right">161</td>
<td class="org-right">259</td>
<td class="org-right">301</td>
</tr>

<tr>
<td class="org-left">Point source (figure errors)</td>
<td class="org-right">202</td>
<td class="org-right">382</td>
<td class="org-right">566</td>
</tr>

<tr>
<td class="org-left">PANTER data</td>
<td class="org-right">196</td>
<td class="org-right">380</td>
<td class="org-right">511</td>
</tr>

<tr>
<td class="org-left">PANTER model</td>
<td class="org-right">206</td>
<td class="org-right">380</td>
<td class="org-right">559</td>
</tr>

<tr>
<td class="org-left">TrAXer (perfect mirrors)</td>
<td class="org-right">174.84</td>
<td class="org-right">288.54</td>
<td class="org-right">333.75</td>
</tr>

<tr>
<td class="org-left">TrAXer (figure errors)</td>
<td class="org-right">207.43</td>
<td class="org-right">378.16</td>
<td class="org-right">552.55</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">Fe Kα (6.41 keV)</td>
<td class="org-right"> </td>
<td class="org-right"> </td>
<td class="org-right"> </td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left"> </td>
<td class="org-right">50% (HPD)</td>
<td class="org-right">80% circle</td>
<td class="org-right">90% circle</td>
</tr>

<tr>
<td class="org-left">Point source (perfect mirrors)</td>
<td class="org-right">144</td>
<td class="org-right">233</td>
<td class="org-right">265</td>
</tr>

<tr>
<td class="org-left">Point source (figure errors)</td>
<td class="org-right">184</td>
<td class="org-right">350</td>
<td class="org-right">541</td>
</tr>

<tr>
<td class="org-left">PANTER data</td>
<td class="org-right">196</td>
<td class="org-right">364</td>
<td class="org-right">483</td>
</tr>

<tr>
<td class="org-left">PANTER model</td>
<td class="org-right">185</td>
<td class="org-right">348</td>
<td class="org-right">516</td>
</tr>

<tr>
<td class="org-left">TrAXer (perfect mirrors)</td>
<td class="org-right">160.38</td>
<td class="org-right">257.79</td>
<td class="org-right">296.79</td>
</tr>

<tr>
<td class="org-left">TrAXer (figure errors)</td>
<td class="org-right">189.75</td>
<td class="org-right">345.20</td>
<td class="org-right">518.51</td>
</tr>
</tbody>
</table>
</div>

<div class="outline-4" id="outline-container-sec:appendix:raytracing:figure_error_model">
<h4 id="sec:appendix:raytracing:figure_error_model"><span class="section-number-4">37.3.1.</span> Definition of the figure error and parameter determination</h4>
<div class="outline-text-4" id="text-sec:appendix:raytracing:figure_error_model">
<p>
The figure error implementation has multiple free
parameters. Generally speaking upon reflection on a mirror surface,
the reflected direction is slightly modified. Let \(\vec{r}_i\) be the
incoming ray, \(\vec{n}\) the surface normal on which the ray reflects
and \(\vec{r}_r\) the reflected ray. Reflection happens in the plane
defined by \(\vec{n}\) and \(\vec{r}_{i,r}\). For a realistic figure error
we wish to mainly vary the reflected direction in this plane around
\(\vec{r}_r\), but still allow for smaller amounts in directions
orthogonal. The vector orthogonal to this plane is
</p>

<p>
\[
\vec{n}_{\perp} = \vec{n} \times \vec{r}_r.
\]
</p>

<p>
This orthogonal vector \(\vec{n}_{\perp}\) allow us further to construct
a vector that is orthogonal to \(\vec{r}_r\) but in the plane of the
incoming and outgoing ray,
</p>


<p>
\[
\vec{s} = \vec{n}_{\perp} \times \vec{r}_r.
\]
</p>

<p>
Based on two fuzzing parameters \(f_{\parallel}\) and \(f_{\perp}\) we can
then define the real reflected ray to be:
</p>

<p>
\[
\vec{r}_{\text{fuzzed}} = \vec{p}_{\text{hit}} + \vec{r}_r + f_{\parallel} · \vec{s} + f_{\perp} · \vec{n}_{\perp}
\]
</p>

<p>
where \(\vec{p}_{\text{hit}}\) is the point at which the ray hit a
mirror shell. Generally \(f_{\parallel}\) and \(f_{\perp}\)  are
parameters sampled from a normal distribution. In practice only
\(f_{\perp}\) is directly sampled from a single normal distribution,
while \(f_{\parallel}\) is – effectively – a mix of a narrow and a
wide normal distribution. In total there are \(\num{5}\) input
parameters, which define the final figure error model.
</p>

<p>
In order to find the best matching parameters, we perform non-linear
optimization using a global derivative-free algorithm <sup>  <a role="doc-backlink" class="footref" id="fnr.16" href="#fn.16">16</a></sup>. This
optimization calls the raytracer with a set of parameters in batch
mode <sup>  <a role="doc-backlink" class="footref" id="fnr.17" href="#fn.17">17</a></sup> up to a fixed set of rays, computes the HPD and radii containing
\(\SI{80}{\%}\) and \(\SI{90}{\%}\) of the flux and finally computes the
mean squared error of the target parameters given and the current
values.
</p>

<p>
Ideally of course, one would use a map of the real surface roughness
of each mirror shell (as done in (<a href="./bibliography.html#citeproc_bib_item_54">Brejnholt 2012</a>) for the NuSTAR
telescope using <code>MT_RAYOR</code>) and use that as the basis for more
accurate reflection on the surface.
</p>

<p>
See
fig. <a href="#fig:appendix:raytracing:comparison_traxer_perfect_imperfect">6</a>
for a comparison of the image without any figure error (assuming
perfect mirrors) and the final figure errors (which are the ones used
in the table and plots of the previous section). The right plot shows
the same data as seen in
fig. <a href="#fig:appendix:raytracing:traxer_sim_alK">4(c)</a> above. The difference
is massive in the sharpness of the data.
</p>


<figure class="figure-wrapper" id="fig:appendix:raytracing:comparison_traxer_perfect_imperfect">
<figure class="subfigure" id="fig:appendix:raytracing:traxer_alK_perfect" data-width="49%">  <img src="./figs/~/phd/Figs/raytracing/llnlPanter/panter_source_Al_Kalpha_perfect_mirrors_3x3mm_fWidth0.5.svg" data-width="99%" />  <figcaption>Figure 6(a): Perfect mirrors</figcaption></figure> <figure class="subfigure" id="fig:appendix:raytracing:traxer_alK_imperfect" data-width="49%">  <img src="./figs/~/phd/Figs/raytracing/llnlPanter/panter_source_Al_Kalpha_imperfect_mirrors_3x3mm_fWidth0.5.svg" data-width="99%" />  <figcaption>Figure 6(b): Imperfect mirrors</figcaption></figure>
<figcaption>Figure 6: <a href="#fig:appendix:raytracing:traxer_alK_perfect">6(a)</a>: TrAXer simulation for Al Kα without any figure error. The resulting image is
          extremely well defined. <a href="#fig:appendix:raytracing:traxer_alK_imperfect">6(b)</a>: TrAXer simulation of Al Kα including a figure error. This is the same image as shown in <a href="#fig:appendix:raytracing:traxer_sim_alK">4(c)</a>.</figcaption>
</figure>
</div>

<div class="outline-5" id="outline-container-org0077868">
<h5 id="org0077868"><span class="section-number-5">37.3.1.1.</span> Determining the optimal parameters   <span class="tag">  <span class="extended">extended</span></span></h5>
<div class="outline-text-5" id="text-37-3-1-1">
<p>
The optimal parameters that we use nowadays, are determined by
starting with the Al Kα line.
</p>

<p>
The program performing the optimization is <code>optimize_figure_error.nim</code>
in the TrAXer repository (<a href="./bibliography.html#citeproc_bib_item_197">Schmidt 2023</a>).
</p>

<div class="org-src-container">
<pre class="src src-sh">./optimize_figure_error <span style="color: #E6DB74; font-weight: bold;">\</span>
    --hpd 206 --c80 397 --c90 568 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --bufOutdir out_GN_DIRECT_L <span style="color: #E6DB74; font-weight: bold;">\</span>
    --shmFile /dev/shm/image_sensor_GN_DIRECT_L.dat
</pre>
</div>
<p>
which calls the raytracer with a set of fuzzing parameters, computes
the EEF for the HPD, c80 and c90 radii and comparing them to the given
arguments (these are the target values for the PANTER data of the Al
Kα line, see tab. <a href="#tab:appendix:llnl_panter_eef_hpd_measurements">37</a>).
</p>

<p>
See the NLopt documentation about the algorithm here:
<a href="https://nlopt.readthedocs.io/en/latest/NLopt_Algorithms/#direct-and-direct-l">https://nlopt.readthedocs.io/en/latest/NLopt_Algorithms/#direct-and-direct-l</a>
</p>

<p>
To run the program you need to first compile the raytracer,
</p>
<div class="org-src-container">
<pre class="src src-sh">nim c -d:<span style="color: #FD971F;">ThreadPoolSize</span>=32 -d:danger raytracer.nim
</pre>
</div>
<p>
and the <code>calc_eef</code> helper:
</p>
<div class="org-src-container">
<pre class="src src-sh">nim c -d:danger calc_eef.nim
</pre>
</div>
<p>
after checking out the repository.
</p>
</div>
</div>
</div>

<div class="outline-4" id="outline-container-org5e5c625">
<h4 id="org5e5c625"><span class="section-number-4">37.3.2.</span> More notes   <span class="tag">  <span class="extended">extended</span></span></h4>
<div class="outline-text-4" id="text-37-3-2">
<p>
See the following documents for more information about the LLNL
telescope and the raytracer. It includes a lot of understanding
various confusions mentioned above (and more), the reasoning as to how
I ended up finishing <code>TrAXer</code> in the first place (reply to Igor),
development notes of it and further questions and finally lots more
about these PANTER / TrAXer comparisons.
</p>

<ul class="org-ul">
<li>  <a href="./../org/Doc/LLNL_def_REST_format/llnl_def_rest_format.html">./../org/Doc/LLNL_def_REST_format/llnl_def_rest_format.html</a></li>
<li>  <a href="./../org/Mails/igorReplyLLNL/igor_reply_llnl_axion_image.html">./../org/Mails/igorReplyLLNL/igor_reply_llnl_axion_image.html</a></li>
<li><img src="./figs/home/basti/org/Doc/interactive_raytracer_development_notes.png" alt="interactive_raytracer_development_notes.png" />
-&gt; These are part of
<a href="./../org/Doc/StatusAndProgress.html">./../org/Doc/StatusAndProgress.html</a>!</li>
<li>  <a href="./../org/Mails/llnlAxionImage/llnl_axion_image.html">./../org/Mails/llnlAxionImage/llnl_axion_image.html</a></li>
<li>  <a href="./../org/Doc/LLNL_TrAXer_comparison/llnl_traxer_raytracing_comparison.html">./../org/Doc/LLNL_TrAXer_comparison/llnl_traxer_raytracing_comparison.html</a></li>
</ul>
</div>
</div>

<div class="outline-4" id="outline-container-org3a809a7">
<h4 id="org3a809a7"><span class="section-number-4">37.3.3.</span> Half-power diameter definition / calculation   <span class="tag">  <span class="extended">extended</span></span></h4>
<div class="outline-text-4" id="text-37-3-3">
<p>
The slides from the \(62^{\text{nd}}\) CCM contain the following
explanation about how the HPD should be calculated on slide 10:
</p>
<blockquote>
<ul class="org-ul">
<li>Actually, more useful to consider the encircled energy function (EEF)
<ul class="org-ul">
<li>Draw a circle around the PSF, integrate the flux, record the value</li>
<li>Repeat process, building up cumulative distribution as a function of radius; normalize to unity
<ul class="org-ul">
<li>It’s the  integral of the PSF</li>
</ul></li>
<li>The half-power diameter (HPD) is just diameter where the EEF = 50%</li>
</ul></li>
</ul>
</blockquote>

<p>
The slide in the CCM from Jan 2017 showing their EEFs is slide 17,
fig. <a href="#fig:appendix:raytracing:lln_traxer_compare:radial_cdfs_eef_slide17">7</a>.
</p>


<figure id="fig:appendix:raytracing:lln_traxer_compare:radial_cdfs_eef_slide17">
<img src="./figs/home/basti/org/Figs/statusAndProgress/LLNL_telescope/PANTER_LLNL_CCM_slide_17.svg" class="org-svg" alt="PANTER_LLNL_CCM_slide_17.svg" />

<figcaption>Figure 7: <span class="figure-number">Figure 204: </span>Radial cumulative distribution functions of the signal, in other words &apos;energy encircled function&apos; (EEF) for the three fluorescence lines.</figcaption>
</figure>
</div>
</div>

<div class="outline-4" id="outline-container-orgdb9436b">
<h4 id="orgdb9436b"><span class="section-number-4">37.3.4.</span> Comparison of slices along short axis   <span class="tag">  <span class="extended">extended</span></span></h4>
<div class="outline-text-4" id="text-37-3-4">
<p>
The CCM presentation from Jan 2017 contains also plots that sum the
signal along each axis in the data. These can be used for a more
precise determination of whether our signal is too wide (due to too
large figure error) or not.
</p>

<p>
See slide 12,
</p>

<p>
<img src="./figs/home/basti/org/Figs/statusAndProgress/LLNL_telescope/PANTER_LLNL_CCM_slide_12.svg" class="org-svg" alt="PANTER_LLNL_CCM_slide_12.svg" />,
</p>

<p>
namely the plot in the bottom right. It is quite hard to get precise
numbers from it, but the 50% amplitude is roughly near the
\(\SI{0.1}{mm}\) mark. Reproducing a similar plot with our data, yields
fig. <a href="#fig:appendix:raytracing:traxer_alKalpha_short_axis_sum">8</a>. We see
that the \(\SI{50}{\%}\) mark here is at \(\SI{0.13}{mm}\). Maybe this is
a slight indication for a somewhat too wide result. But well. The
actual problem with the HPD as mentioned in the main text still remains.
</p>


<figure id="fig:appendix:raytracing:traxer_alKalpha_short_axis_sum">
<img src="./figs/home/basti/phd/Figs/raytracing/llnlPanter/panter_source_Al_Kalpha_imperfect_mirrors_3x3mm_hpd_x.svg" class="org-svg" alt="panter_source_Al_Kalpha_imperfect_mirrors_3x3mm_hpd_x.svg" />

<figcaption>Figure 8: <span class="figure-number">Figure 205: </span>Cut along the short axis, summing the long axis for each bin for aluminium Kα. This yields a \(\SI{50}{\%}\) amplitude width of about \(\SI{0.13}{mm}\).</figcaption>
</figure>
</div>
</div>

<div class="outline-4" id="outline-container-org60d20e5">
<h4 id="org60d20e5"><span class="section-number-4">37.3.5.</span> More on figure errors   <span class="tag">  <span class="extended">extended</span></span></h4>
<div class="outline-text-4" id="text-37-3-5">
<p>
One of the main issues with figure errors – aside from not being very
well defined – is that they are usually quoted as a number for the
entire X-ray optic. This is problematic when implementing it in a
raytracer however, because the figure error is a property of the
material surface. And because an X-ray optic works by a <i>double</i>
reflection, the uncertainty is squared (in a non-trivial
way). Therefore, it is not straightforward to simply compute a correct
number to apply to the uncertainty of the scattering on the mirror
surfaces from a real measurement.
</p>

<p>
(Hey, if you do know how to do it, let me know!)
</p>
</div>
</div>

<div class="outline-4" id="outline-container-orga71265c">
<h4 id="orga71265c"><span class="section-number-4">37.3.6.</span> Produce \(\ce{Al}Kα\) plot from <code>TrAXer</code> data   <span class="tag">  <span class="extended">extended</span></span></h4>
<div class="outline-text-4" id="text-37-3-6">
<p>
(We define a simple helper script to extract the last bits of output
from the raytracing program
</p>
<div class="org-src-container">
<pre class="src src-nim" id="nim-head"><span style="color: #F92672;">import</span> strutils
<span style="color: #F92672;">for</span> l <span style="color: #F92672;">in</span> data.<span style="color: #F92672;">len</span> - <span style="color: #F92672;">lines</span> ..&lt; data.<span style="color: #F92672;">len</span>:
  <span style="color: #F92672;">echo</span> data<span style="color: #AE81FF;">[</span>l<span style="color: #AE81FF;">]</span>.join<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot; &quot;</span><span style="color: #AE81FF;">)</span>
</pre>
</div>
<p>
)
</p>

<p>
In order to generate the data file needed for the HPD calculation and
plot used above, we need to first run the raytracer to produce the
binary data files and then use <code>plotBinary</code> to produce the
plots. Let&apos;s produce all three targets now.
</p>

<p>
The HPD values are extracted from the output of <code>plotBinary</code> or from
the <code>*_hpd_via_eef.pdf</code> plot annotations.
</p>
</div>

<div class="outline-5" id="outline-container-orgb07d002">
<h5 id="orgb07d002"><span class="section-number-5">37.3.6.1.</span> Al Kα</h5>
<div class="outline-text-5" id="text-37-3-6-1">
<p>
Run the <code>raytracer</code>, note the <code>energyMin</code> and <code>energyMax</code>.
</p>
<div class="org-src-container">
<pre class="src src-sh">./raytracer <span style="color: #E6DB74; font-weight: bold;">\</span>
    --width 1200 --speed 10.0 --nJobs 32 --vfov 45 --maxDepth 10 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --llnl --focalPoint <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sourceKind skXrayFinger <span style="color: #E6DB74; font-weight: bold;">\</span>
    --rayAt 1.013 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sensorKind sSum <span style="color: #E6DB74; font-weight: bold;">\</span>
    --energyMin 1.48 --energyMax 1.50 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --usePerfectMirror=false <span style="color: #E6DB74; font-weight: bold;">\</span>
    --ignoreWindow <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sourceDistance 130.297.m <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sourceRadius 0.42.mm <span style="color: #E6DB74; font-weight: bold;">\</span>
    --telescopeRotation 90.0 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sourceOnOpticalAxis <span style="color: #E6DB74; font-weight: bold;">\</span>
    --ignoreMagnet <span style="color: #E6DB74; font-weight: bold;">\</span>
    --targetRadius 40.mm
</pre>
</div>
<p>
[INFO] Writing buffers to binary files.
[INFO] Writing file: out/buffer<sub>2023</sub>-11-12T12:56:26+01:00<sub>type</sub><sub>uint32</sub><sub>len</sub><sub>1440000</sub><sub>width</sub><sub>1200</sub><sub>height</sub><sub>1200.dat</sub>
[INFO] Writing file: out/counts<sub>2023</sub>-11-12T12:56:26+01:00<sub>type</sub><sub>int</sub><sub>len</sub><sub>1440000</sub><sub>width</sub><sub>1200</sub><sub>height</sub><sub>1200.dat</sub>
[INFO] Writing file: out/image<sub>sensor</sub><sub>0</sub><sub>2023</sub>-11-12T12:56:26+01:00_<sub>dx</sub><sub>14.0</sub><sub>dy</sub><sub>14.0</sub><sub>dz</sub><sub>0.1</sub><sub>type</sub><sub>float</sub><sub>len</sub><sub>1000000</sub><sub>width</sub><sub>1000</sub><sub>height</sub><sub>1000.dat</sub>
</p>

<p>
Once you deem that enough statistics has been accumulated, press <code>F5</code>
on your keyboard to save all buffers to binary files. The output
filenames will be printed to the terminal. 
</p>

<p>
And then with the produced binary files we can plot them and compute
the HPDs (note: we produce it such that text matches for the 3 plots
side by side and then with <code>F_WIDTH=0.9</code> for the HPD plot and with
<code>F_WIDTH=0.5</code> for the perfect/imperfect comparison):
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #FD971F;">F_WIDTH</span>=0.3333333 <span style="color: #FD971F;">USE_TEX</span>=true ./plotBinary <span style="color: #E6DB74; font-weight: bold;">\</span>
    --dtype float <span style="color: #E6DB74; font-weight: bold;">\</span>
    -f out/image_sensor_0_2023-11-12T12:56:26+01:00__dx_14.0_dy_14.0_dz_0.1_type_float_len_1000000_width_1000_height_1000.dat <span style="color: #E6DB74; font-weight: bold;">\</span>
    --invertY <span style="color: #E6DB74; font-weight: bold;">\</span>
    --out ~/phd/Figs/raytracing/llnlPanter/panter_source_Al_Kalpha_imperfect_mirrors_3x3mm_fWidth0.3.pdf <span style="color: #E6DB74; font-weight: bold;">\</span>
    --inPixels=false <span style="color: #E6DB74; font-weight: bold;">\</span>
    --title <span style="color: #E6DB74;">&quot;Al Kα, 1.49 keV, 3x3 mm, figure errors, source optical axis&quot;</span> <span style="color: #E6DB74; font-weight: bold;">\</span>
    --xrange 1.5
<span style="color: #FD971F;">F_WIDTH</span>=0.5 <span style="color: #FD971F;">USE_TEX</span>=true ./plotBinary <span style="color: #E6DB74; font-weight: bold;">\</span>
    --dtype float <span style="color: #E6DB74; font-weight: bold;">\</span>
    -f out/image_sensor_0_2023-11-12T12:56:26+01:00__dx_14.0_dy_14.0_dz_0.1_type_float_len_1000000_width_1000_height_1000.dat <span style="color: #E6DB74; font-weight: bold;">\</span>
    --invertY <span style="color: #E6DB74; font-weight: bold;">\</span>
    --out ~/phd/Figs/raytracing/llnlPanter/panter_source_Al_Kalpha_imperfect_mirrors_3x3mm_fWidth0.5.pdf <span style="color: #E6DB74; font-weight: bold;">\</span>
    --inPixels=false <span style="color: #E6DB74; font-weight: bold;">\</span>
    --title <span style="color: #E6DB74;">&quot;Al Kα, 1.49 keV, 3x3 mm, figure errors, source optical axis&quot;</span> <span style="color: #E6DB74; font-weight: bold;">\</span>
    --xrange 1.5
<span style="color: #FD971F;">USE_TEX</span>=true ./plotBinary <span style="color: #E6DB74; font-weight: bold;">\</span>
    --dtype float <span style="color: #E6DB74; font-weight: bold;">\</span>
    -f out/image_sensor_0_2023-11-12T12:56:26+01:00__dx_14.0_dy_14.0_dz_0.1_type_float_len_1000000_width_1000_height_1000.dat <span style="color: #E6DB74; font-weight: bold;">\</span>
    --invertY <span style="color: #E6DB74; font-weight: bold;">\</span>
    --out ~/phd/Figs/raytracing/llnlPanter/panter_source_Al_Kalpha_imperfect_mirrors_3x3mm.pdf <span style="color: #E6DB74; font-weight: bold;">\</span>
    --inPixels=false <span style="color: #E6DB74; font-weight: bold;">\</span>
    --title <span style="color: #E6DB74;">&quot;Al Kα, 1.49 keV, 3x3 mm, figure errors, source optical axis&quot;</span> <span style="color: #E6DB74; font-weight: bold;">\</span>
    --xrange 1.5
</pre>
</div>


<figure id="org323b882">
<img src="./figs/home/basti/phd/Figs/raytracing/llnlPanter/panter_source_Al_Kalpha_imperfect_mirrors_3x3mm.svg" class="org-svg" alt="panter_source_Al_Kalpha_imperfect_mirrors_3x3mm.svg" />

<figcaption>Figure 9: <span class="figure-number">Figure 206: </span>Our result Al Kα as 3x3 mm with imperfect mirrors</figcaption>
</figure>


<figure id="orgb9f0118">
<img src="./figs/home/basti/phd/Figs/raytracing/llnlPanter/panter_source_Al_Kalpha_imperfect_mirrors_3x3mm_log10.svg" class="org-svg" alt="panter_source_Al_Kalpha_imperfect_mirrors_3x3mm_log10.svg" />

<figcaption>Figure 10: <span class="figure-number">Figure 207: </span>Our result Al Kα as 3x3 mm with imperfect mirrors, log10</figcaption>
</figure>


<figure id="org5687546">
<img src="./figs/home/basti/phd/Figs/raytracing/llnlPanter/panter_source_Al_Kalpha_imperfect_mirrors_3x3mm_hpd_x.svg" class="org-svg" alt="panter_source_Al_Kalpha_imperfect_mirrors_3x3mm_hpd_x.svg" />

<figcaption>Figure 11: <span class="figure-number">Figure 208: </span>HPD in X for imperfect mirrors of Al Kα</figcaption>
</figure>


<figure id="orge415ff0">
<img src="./figs/home/basti/phd/Figs/raytracing/llnlPanter/panter_source_Al_Kalpha_imperfect_mirrors_3x3mm_hpd_y.svg" class="org-svg" alt="panter_source_Al_Kalpha_imperfect_mirrors_3x3mm_hpd_y.svg" />

<figcaption>Figure 12: <span class="figure-number">Figure 209: </span>HPD in Y for imperfect mirrors of Al Kα</figcaption>
</figure>


<figure id="orgbd485d9">
<img src="./figs/home/basti/phd/Figs/raytracing/llnlPanter/panter_source_Al_Kalpha_imperfect_mirrors_3x3mm_hpd_via_eef_50.svg" class="org-svg" alt="panter_source_Al_Kalpha_imperfect_mirrors_3x3mm_hpd_via_eef_50.svg" />

<figcaption>Figure 13: <span class="figure-number">Figure 210: </span>HPD of Al Kα computed from the EEF (radial cumulative distribution function, encircled energy)</figcaption>
</figure>
</div>

<ol class="org-ol">
<li><a id="org330ee1b"> </a>Perfect mirrors<br />
<div class="outline-text-6" id="text-37-3-6-1-1">
<p>
Perfect mirror:
</p>
<div class="org-src-container">
<pre class="src src-sh">./raytracer <span style="color: #E6DB74; font-weight: bold;">\</span>
    --width 1200 --speed 10.0 --nJobs 32 --vfov 45 --maxDepth 10 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --llnl --focalPoint <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sourceKind skXrayFinger <span style="color: #E6DB74; font-weight: bold;">\</span>
    --rayAt 1.013 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sensorKind sSum <span style="color: #E6DB74; font-weight: bold;">\</span>
    --energyMin 1.48 --energyMax 1.49 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --usePerfectMirror=true <span style="color: #E6DB74; font-weight: bold;">\</span>
    --ignoreWindow <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sourceDistance 130.297.m <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sourceRadius 0.42.mm <span style="color: #E6DB74; font-weight: bold;">\</span>
    --telescopeRotation 90.0 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sourceOnOpticalAxis <span style="color: #E6DB74; font-weight: bold;">\</span>
    --ignoreMagnet <span style="color: #E6DB74; font-weight: bold;">\</span>
    --targetRadius 40.mm
</pre>
</div>
<p>
[INFO] Writing buffers to binary files.
[INFO] Writing file: out/buffer<sub>2023</sub>-11-11T09:31:09+01:00<sub>type</sub><sub>uint32</sub><sub>len</sub><sub>1440000</sub><sub>width</sub><sub>1200</sub><sub>height</sub><sub>1200.dat</sub>
[INFO] Writing file: out/counts<sub>2023</sub>-11-11T09:31:09+01:00<sub>type</sub><sub>int</sub><sub>len</sub><sub>1440000</sub><sub>width</sub><sub>1200</sub><sub>height</sub><sub>1200.dat</sub>
[INFO] Writing file: out/image<sub>sensor</sub><sub>0</sub><sub>2023</sub>-11-11T09:31:09+01:00_<sub>dx</sub><sub>14.0</sub><sub>dy</sub><sub>14.0</sub><sub>dz</sub><sub>0.1</sub><sub>type</sub><sub>float</sub><sub>len</sub><sub>1000000</sub><sub>width</sub><sub>1000</sub><sub>height</sub><sub>1000.dat</sub>
</p>

<p>
Create the plots (only in 3x3 mm):
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #FD971F;">F_WIDTH</span>=0.5 <span style="color: #FD971F;">USE_TEX</span>=true ./plotBinary <span style="color: #E6DB74; font-weight: bold;">\</span>
    --dtype float <span style="color: #E6DB74; font-weight: bold;">\</span>
    -f out/image_sensor_0_2023-11-11T09:31:09+01:00__dx_14.0_dy_14.0_dz_0.1_type_float_len_1000000_width_1000_height_1000.dat <span style="color: #E6DB74; font-weight: bold;">\</span>
    --invertY <span style="color: #E6DB74; font-weight: bold;">\</span>
    --out ~/phd/Figs/raytracing/llnlPanter/panter_source_Al_Kalpha_perfect_mirrors_3x3mm_fWidth0.5.pdf <span style="color: #E6DB74; font-weight: bold;">\</span>
    --inPixels=false <span style="color: #E6DB74; font-weight: bold;">\</span>
    --title <span style="color: #E6DB74;">&quot;Al Kα, 1.49 keV, 3x3 mm, source optical axis&quot;</span> <span style="color: #E6DB74; font-weight: bold;">\</span>
    --xrange 1.5
</pre>
</div>

<p>
Produces the following figures:
</p>


<figure id="orgbba1b67">
<img src="./figs/home/basti/phd/Figs/raytracing/llnlPanter/panter_source_Al_Kalpha_perfect_mirrors_3x3mm.svg" class="org-svg" alt="panter_source_Al_Kalpha_perfect_mirrors_3x3mm.svg" />

<figcaption>Figure 14: <span class="figure-number">Figure 211: </span>Our result Al Kα as 3x3 mm with perfect mirrors</figcaption>
</figure>


<figure id="org5ee898f">
<img src="./figs/home/basti/phd/Figs/raytracing/llnlPanter/panter_source_Al_Kalpha_perfect_mirrors_3x3mm_log10.svg" class="org-svg" alt="panter_source_Al_Kalpha_perfect_mirrors_3x3mm_log10.svg" />

<figcaption>Figure 15: <span class="figure-number">Figure 212: </span>Our result Al Kα as 3x3 mm with perfect mirrors, log10</figcaption>
</figure>


<figure id="orgeae7ded">
<img src="./figs/home/basti/phd/Figs/raytracing/llnlPanter/panter_source_Al_Kalpha_perfect_mirrors_3x3mm_hpd_x.svg" class="org-svg" alt="panter_source_Al_Kalpha_perfect_mirrors_3x3mm_hpd_x.svg" />

<figcaption>Figure 16: <span class="figure-number">Figure 213: </span>HPD in X for perfect mirrors of Al Kα</figcaption>
</figure>


<figure id="orga71d9ae">
<img src="./figs/home/basti/phd/Figs/raytracing/llnlPanter/panter_source_Al_Kalpha_perfect_mirrors_3x3mm_hpd_y.svg" class="org-svg" alt="panter_source_Al_Kalpha_perfect_mirrors_3x3mm_hpd_y.svg" />

<figcaption>Figure 17: <span class="figure-number">Figure 214: </span>HPD in Y for perfect mirrors of Al Kα</figcaption>
</figure>


<figure id="org089f12c">
<img src="./figs/home/basti/phd/Figs/raytracing/llnlPanter/panter_source_Al_Kalpha_perfect_mirrors_3x3mm_hpd_via_eef_50.svg" class="org-svg" alt="panter_source_Al_Kalpha_perfect_mirrors_3x3mm_hpd_via_eef_50.svg" />

<figcaption>Figure 18: <span class="figure-number">Figure 215: </span>HPD of Al Kα computed from the EEF (radial cumulative distribution function, encircled energy)</figcaption>
</figure>
</div>
</li>
</ol>
</div>

<div class="outline-5" id="outline-container-org435c766">
<h5 id="org435c766"><span class="section-number-5">37.3.6.2.</span> Ti Kα</h5>
<div class="outline-text-5" id="text-37-3-6-2">
<p>
Run the <code>raytracer</code>, note the <code>energyMin</code> and <code>energyMax</code>.
</p>
<div class="org-src-container">
<pre class="src src-sh">./raytracer <span style="color: #E6DB74; font-weight: bold;">\</span>
    --width 1200 --speed 10.0 --nJobs 32 --vfov 45 --maxDepth 10 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --llnl --focalPoint <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sourceKind skXrayFinger <span style="color: #E6DB74; font-weight: bold;">\</span>
    --rayAt 1.013 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sensorKind sSum <span style="color: #E6DB74; font-weight: bold;">\</span>
    --energyMin 4.50 --energyMax 4.52 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --usePerfectMirror=false <span style="color: #E6DB74; font-weight: bold;">\</span>
    --ignoreWindow <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sourceDistance 130.297.m <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sourceRadius 0.42.mm <span style="color: #E6DB74; font-weight: bold;">\</span>
    --telescopeRotation 90.0 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sourceOnOpticalAxis <span style="color: #E6DB74; font-weight: bold;">\</span>
    --ignoreMagnet <span style="color: #E6DB74; font-weight: bold;">\</span>
    --targetRadius 40.mm
</pre>
</div>
<p>
[INFO] Writing buffers to binary files.
[INFO] Writing file: out/buffer<sub>2023</sub>-11-12T12:58:39+01:00<sub>type</sub><sub>uint32</sub><sub>len</sub><sub>1440000</sub><sub>width</sub><sub>1200</sub><sub>height</sub><sub>1200.dat</sub>
[INFO] Writing file: out/counts<sub>2023</sub>-11-12T12:58:39+01:00<sub>type</sub><sub>int</sub><sub>len</sub><sub>1440000</sub><sub>width</sub><sub>1200</sub><sub>height</sub><sub>1200.dat</sub>
[INFO] Writing file: out/image<sub>sensor</sub><sub>0</sub><sub>2023</sub>-11-12T12:58:39+01:00_<sub>dx</sub><sub>14.0</sub><sub>dy</sub><sub>14.0</sub><sub>dz</sub><sub>0.1</sub><sub>type</sub><sub>float</sub><sub>len</sub><sub>1000000</sub><sub>width</sub><sub>1000</sub><sub>height</sub><sub>1000.dat</sub>
</p>


<div class="org-src-container">
<pre class="src src-sh">./plotBinary <span style="color: #E6DB74; font-weight: bold;">\</span>
    --dtype float <span style="color: #E6DB74; font-weight: bold;">\</span>
    -f out/image_sensor_0_2023-11-12T12:58:39+01:00__dx_14.0_dy_14.0_dz_0.1_type_float_len_1000000_width_1000_height_1000.dat <span style="color: #E6DB74; font-weight: bold;">\</span>
    --invertY <span style="color: #E6DB74; font-weight: bold;">\</span>
    --out ~/phd/Figs/raytracing/llnlPanter/panter_source_Ti_Kalpha_imperfect_mirrors_3x3mm.pdf <span style="color: #E6DB74; font-weight: bold;">\</span>
    --inPixels=false <span style="color: #E6DB74; font-weight: bold;">\</span>
    --title <span style="color: #E6DB74;">&quot;Ti Kα, 4.51 keV, 3x3 mm, figure errors, source optical axis&quot;</span> <span style="color: #E6DB74; font-weight: bold;">\</span>
    --xrange 1.5
</pre>
</div>


<figure id="orga620aba">
<img src="./figs/home/basti/phd/Figs/raytracing/llnlPanter/panter_source_Ti_Kalpha_imperfect_mirrors_3x3mm.svg" class="org-svg" alt="panter_source_Ti_Kalpha_imperfect_mirrors_3x3mm.svg" />

<figcaption>Figure 19: <span class="figure-number">Figure 216: </span>Our result Ti Kα as 3x3 mm with imperfect mirrors</figcaption>
</figure>


<figure id="org58d73b0">
<img src="./figs/home/basti/phd/Figs/raytracing/llnlPanter/panter_source_Ti_Kalpha_imperfect_mirrors_3x3mm_log10.svg" class="org-svg" alt="panter_source_Ti_Kalpha_imperfect_mirrors_3x3mm_log10.svg" />

<figcaption>Figure 20: <span class="figure-number">Figure 217: </span>Our result Ti Kα as 3x3 mm with imperfect mirrors, log10</figcaption>
</figure>


<figure id="orgc82415d">
<img src="./figs/home/basti/phd/Figs/raytracing/llnlPanter/panter_source_Ti_Kalpha_imperfect_mirrors_3x3mm_hpd_x.svg" class="org-svg" alt="panter_source_Ti_Kalpha_imperfect_mirrors_3x3mm_hpd_x.svg" />

<figcaption>Figure 21: <span class="figure-number">Figure 218: </span>HPD in X for imperfect mirrors of Ti Kα</figcaption>
</figure>


<figure id="orgdce715f">
<img src="./figs/home/basti/phd/Figs/raytracing/llnlPanter/panter_source_Ti_Kalpha_imperfect_mirrors_3x3mm_hpd_y.svg" class="org-svg" alt="panter_source_Ti_Kalpha_imperfect_mirrors_3x3mm_hpd_y.svg" />

<figcaption>Figure 22: <span class="figure-number">Figure 219: </span>HPD in Y for imperfect mirrors of Ti Kα</figcaption>
</figure>


<figure id="orgb638616">
<img src="./figs/home/basti/phd/Figs/raytracing/llnlPanter/panter_source_Ti_Kalpha_imperfect_mirrors_3x3mm_hpd_via_eef_50.svg" class="org-svg" alt="panter_source_Ti_Kalpha_imperfect_mirrors_3x3mm_hpd_via_eef_50.svg" />

<figcaption>Figure 23: <span class="figure-number">Figure 220: </span>HPD of Ti Kα computed from the EEF (radial cumulative distribution function, encircled energy)</figcaption>
</figure>
</div>


<ol class="org-ol">
<li><a id="org2dc64d3"> </a>Perfect mirrors<br />
<div class="outline-text-6" id="text-37-3-6-2-1">
<p>
Perfect mirror:
</p>
<div class="org-src-container">
<pre class="src src-sh">./raytracer <span style="color: #E6DB74; font-weight: bold;">\</span>
    --width 1200 --speed 10.0 --nJobs 32 --vfov 45 --maxDepth 10 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --llnl --focalPoint <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sourceKind skXrayFinger <span style="color: #E6DB74; font-weight: bold;">\</span>
    --rayAt 1.013 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sensorKind sSum <span style="color: #E6DB74; font-weight: bold;">\</span>
    --energyMin 4.50 --energyMax 4.52 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --usePerfectMirror=true <span style="color: #E6DB74; font-weight: bold;">\</span>
    --ignoreWindow <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sourceDistance 130.297.m <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sourceRadius 0.42.mm <span style="color: #E6DB74; font-weight: bold;">\</span>
    --telescopeRotation 90.0 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sourceOnOpticalAxis <span style="color: #E6DB74; font-weight: bold;">\</span>
    --ignoreMagnet <span style="color: #E6DB74; font-weight: bold;">\</span>
    --targetRadius 40.mm
</pre>
</div>
<p>
[INFO] Writing buffers to binary files.
[INFO] Writing file: out/buffer<sub>2023</sub>-11-11T09:37:15+01:00<sub>type</sub><sub>uint32</sub><sub>len</sub><sub>1440000</sub><sub>width</sub><sub>1200</sub><sub>height</sub><sub>1200.dat</sub>
[INFO] Writing file: out/counts<sub>2023</sub>-11-11T09:37:15+01:00<sub>type</sub><sub>int</sub><sub>len</sub><sub>1440000</sub><sub>width</sub><sub>1200</sub><sub>height</sub><sub>1200.dat</sub>
[INFO] Writing file: out/image<sub>sensor</sub><sub>0</sub><sub>2023</sub>-11-11T09:37:15+01:00_<sub>dx</sub><sub>14.0</sub><sub>dy</sub><sub>14.0</sub><sub>dz</sub><sub>0.1</sub><sub>type</sub><sub>float</sub><sub>len</sub><sub>1000000</sub><sub>width</sub><sub>1000</sub><sub>height</sub><sub>1000.dat</sub>
</p>

<div class="org-src-container">
<pre class="src src-sh">./plotBinary <span style="color: #E6DB74; font-weight: bold;">\</span>
    --dtype float <span style="color: #E6DB74; font-weight: bold;">\</span>
    -f out/image_sensor_0_2023-11-11T09:37:15+01:00__dx_14.0_dy_14.0_dz_0.1_type_float_len_1000000_width_1000_height_1000.dat <span style="color: #E6DB74; font-weight: bold;">\</span>
    --invertY <span style="color: #E6DB74; font-weight: bold;">\</span>
    --out ~/phd/Figs/raytracing/llnlPanter/panter_source_Ti_Kalpha_perfect_mirrors_3x3mm.pdf <span style="color: #E6DB74; font-weight: bold;">\</span>
    --inPixels=false <span style="color: #E6DB74; font-weight: bold;">\</span>
    --title <span style="color: #E6DB74;">&quot;Ti Kα, 4.51 keV, 3x3 mm, source optical axis&quot;</span> <span style="color: #E6DB74; font-weight: bold;">\</span>
    --xrange 1.5
</pre>
</div>


<figure id="orgeefafe1">
<img src="./figs/home/basti/phd/Figs/raytracing/llnlPanter/panter_source_Ti_Kalpha_perfect_mirrors_3x3mm.svg" class="org-svg" alt="panter_source_Ti_Kalpha_perfect_mirrors_3x3mm.svg" />

<figcaption>Figure 24: <span class="figure-number">Figure 221: </span>Our result Ti Kα as 3x3 mm with perfect mirrors</figcaption>
</figure>


<figure id="org7ab4928">
<img src="./figs/home/basti/phd/Figs/raytracing/llnlPanter/panter_source_Ti_Kalpha_perfect_mirrors_3x3mm_log10.svg" class="org-svg" alt="panter_source_Ti_Kalpha_perfect_mirrors_3x3mm_log10.svg" />

<figcaption>Figure 25: <span class="figure-number">Figure 222: </span>Our result Ti Kα as 3x3 mm with perfect mirrors, log10</figcaption>
</figure>


<figure id="orgfc9ee45">
<img src="./figs/home/basti/phd/Figs/raytracing/llnlPanter/panter_source_Ti_Kalpha_perfect_mirrors_3x3mm_hpd_x.svg" class="org-svg" alt="panter_source_Ti_Kalpha_perfect_mirrors_3x3mm_hpd_x.svg" />

<figcaption>Figure 26: <span class="figure-number">Figure 223: </span>HPD in X for perfect mirrors of Ti Kα</figcaption>
</figure>


<figure id="orgd5e2ff3">
<img src="./figs/home/basti/phd/Figs/raytracing/llnlPanter/panter_source_Ti_Kalpha_perfect_mirrors_3x3mm_hpd_y.svg" class="org-svg" alt="panter_source_Ti_Kalpha_perfect_mirrors_3x3mm_hpd_y.svg" />

<figcaption>Figure 27: <span class="figure-number">Figure 224: </span>HPD in Y for perfect mirrors of Ti Kα</figcaption>
</figure>


<figure id="orgc445314">
<img src="./figs/home/basti/phd/Figs/raytracing/llnlPanter/panter_source_Ti_Kalpha_perfect_mirrors_3x3mm_hpd_via_eef_50.svg" class="org-svg" alt="panter_source_Ti_Kalpha_perfect_mirrors_3x3mm_hpd_via_eef_50.svg" />

<figcaption>Figure 28: <span class="figure-number">Figure 225: </span>HPD of Ti Kα computed from the EEF (radial cumulative distribution function, encircled energy)</figcaption>
</figure>
</div>
</li>
</ol>
</div>


<div class="outline-5" id="outline-container-orgcf4607b">
<h5 id="orgcf4607b"><span class="section-number-5">37.3.6.3.</span> Fe Kα</h5>
<div class="outline-text-5" id="text-37-3-6-3">
<p>
Run the <code>raytracer</code>, note the <code>energyMin</code> and <code>energyMax</code>.
</p>
<div class="org-src-container">
<pre class="src src-sh">./raytracer <span style="color: #E6DB74; font-weight: bold;">\</span>
    --width 1200 --speed 10.0 --nJobs 32 --vfov 45 --maxDepth 10 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --llnl --focalPoint <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sourceKind skXrayFinger <span style="color: #E6DB74; font-weight: bold;">\</span>
    --rayAt 1.013 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sensorKind sSum <span style="color: #E6DB74; font-weight: bold;">\</span>
    --energyMin 6.39 --energyMax 6.41 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --usePerfectMirror=false <span style="color: #E6DB74; font-weight: bold;">\</span>
    --ignoreWindow <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sourceDistance 130.297.m <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sourceRadius 0.42.mm <span style="color: #E6DB74; font-weight: bold;">\</span>
    --telescopeRotation 90.0 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sourceOnOpticalAxis <span style="color: #E6DB74; font-weight: bold;">\</span>
    --ignoreMagnet <span style="color: #E6DB74; font-weight: bold;">\</span>
    --targetRadius 40.mm
</pre>
</div>
<p>
[INFO] Writing buffers to binary files.
[INFO] Writing file: out/buffer<sub>2023</sub>-11-12T12:59:52+01:00<sub>type</sub><sub>uint32</sub><sub>len</sub><sub>1440000</sub><sub>width</sub><sub>1200</sub><sub>height</sub><sub>1200.dat</sub>
[INFO] Writing file: out/counts<sub>2023</sub>-11-12T12:59:52+01:00<sub>type</sub><sub>int</sub><sub>len</sub><sub>1440000</sub><sub>width</sub><sub>1200</sub><sub>height</sub><sub>1200.dat</sub>
[INFO] Writing file: out/image<sub>sensor</sub><sub>0</sub><sub>2023</sub>-11-12T12:59:52+01:00_<sub>dx</sub><sub>14.0</sub><sub>dy</sub><sub>14.0</sub><sub>dz</sub><sub>0.1</sub><sub>type</sub><sub>float</sub><sub>len</sub><sub>1000000</sub><sub>width</sub><sub>1000</sub><sub>height</sub><sub>1000.dat</sub>
</p>

<div class="org-src-container">
<pre class="src src-sh">./plotBinary <span style="color: #E6DB74; font-weight: bold;">\</span>
    --dtype float <span style="color: #E6DB74; font-weight: bold;">\</span>
    -f out/image_sensor_0_2023-11-12T12:59:52+01:00__dx_14.0_dy_14.0_dz_0.1_type_float_len_1000000_width_1000_height_1000.dat <span style="color: #E6DB74; font-weight: bold;">\</span>
    --invertY <span style="color: #E6DB74; font-weight: bold;">\</span>
    --out ~/phd/Figs/raytracing/llnlPanter/panter_source_Fe_Kalpha_imperfect_mirrors_3x3mm.pdf <span style="color: #E6DB74; font-weight: bold;">\</span>
    --inPixels=false <span style="color: #E6DB74; font-weight: bold;">\</span>
    --title <span style="color: #E6DB74;">&quot;Fe Kα, 6.41 keV, 3x3 mm, figure errors, source optical axis&quot;</span> <span style="color: #E6DB74; font-weight: bold;">\</span>
    --xrange 1.5
</pre>
</div>


<figure id="org2ea1591">
<img src="./figs/home/basti/phd/Figs/raytracing/llnlPanter/panter_source_Fe_Kalpha_imperfect_mirrors_3x3mm.svg" class="org-svg" alt="panter_source_Fe_Kalpha_imperfect_mirrors_3x3mm.svg" />

<figcaption>Figure 29: <span class="figure-number">Figure 226: </span>Our result Fe Kα as 3x3 mm with imperfect mirrors</figcaption>
</figure>


<figure id="orgc0fcf1d">
<img src="./figs/home/basti/phd/Figs/raytracing/llnlPanter/panter_source_Fe_Kalpha_imperfect_mirrors_3x3mm_log10.svg" class="org-svg" alt="panter_source_Fe_Kalpha_imperfect_mirrors_3x3mm_log10.svg" />

<figcaption>Figure 30: <span class="figure-number">Figure 227: </span>Our result Fe Kα as 3x3 mm with imperfect mirrors, log10</figcaption>
</figure>


<figure id="orgb164cf5">
<img src="./figs/home/basti/phd/Figs/raytracing/llnlPanter/panter_source_Fe_Kalpha_imperfect_mirrors_3x3mm_hpd_x.svg" class="org-svg" alt="panter_source_Fe_Kalpha_imperfect_mirrors_3x3mm_hpd_x.svg" />

<figcaption>Figure 31: <span class="figure-number">Figure 228: </span>HPD in X for imperfect mirrors of Fe Kα</figcaption>
</figure>


<figure id="org7d1a7f8">
<img src="./figs/home/basti/phd/Figs/raytracing/llnlPanter/panter_source_Fe_Kalpha_imperfect_mirrors_3x3mm_hpd_y.svg" class="org-svg" alt="panter_source_Fe_Kalpha_imperfect_mirrors_3x3mm_hpd_y.svg" />

<figcaption>Figure 32: <span class="figure-number">Figure 229: </span>HPD in Y for imperfect mirrors of Fe Kα</figcaption>
</figure>


<figure id="orgd3dcdd6">
<img src="./figs/home/basti/phd/Figs/raytracing/llnlPanter/panter_source_Fe_Kalpha_imperfect_mirrors_3x3mm_hpd_via_eef_50.svg" class="org-svg" alt="panter_source_Fe_Kalpha_imperfect_mirrors_3x3mm_hpd_via_eef_50.svg" />

<figcaption>Figure 33: <span class="figure-number">Figure 230: </span>HPD of Fe Kα computed from the EEF (radial cumulative distribution function, encircled energy)</figcaption>
</figure>
</div>


<ol class="org-ol">
<li><a id="orgfba8069"> </a>Perfect mirrors<br />
<div class="outline-text-6" id="text-37-3-6-3-1">
<p>
Perfect mirror:
</p>
<div class="org-src-container">
<pre class="src src-sh">./raytracer <span style="color: #E6DB74; font-weight: bold;">\</span>
    --width 1200 --speed 10.0 --nJobs 32 --vfov 45 --maxDepth 10 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --llnl --focalPoint <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sourceKind skXrayFinger <span style="color: #E6DB74; font-weight: bold;">\</span>
    --rayAt 1.013 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sensorKind sSum <span style="color: #E6DB74; font-weight: bold;">\</span>
    --energyMin 6.39 --energyMax 6.41 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --usePerfectMirror=true <span style="color: #E6DB74; font-weight: bold;">\</span>
    --ignoreWindow <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sourceDistance 130.297.m <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sourceRadius 0.42.mm <span style="color: #E6DB74; font-weight: bold;">\</span>
    --telescopeRotation 90.0 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sourceOnOpticalAxis <span style="color: #E6DB74; font-weight: bold;">\</span>
    --ignoreMagnet <span style="color: #E6DB74; font-weight: bold;">\</span>
    --targetRadius 40.mm
</pre>
</div>
<p>
[INFO] Writing buffers to binary files.
[INFO] Writing file: out/buffer<sub>2023</sub>-11-11T09:41:47+01:00<sub>type</sub><sub>uint32</sub><sub>len</sub><sub>1440000</sub><sub>width</sub><sub>1200</sub><sub>height</sub><sub>1200.dat</sub>
[INFO] Writing file: out/counts<sub>2023</sub>-11-11T09:41:47+01:00<sub>type</sub><sub>int</sub><sub>len</sub><sub>1440000</sub><sub>width</sub><sub>1200</sub><sub>height</sub><sub>1200.dat</sub>
[INFO] Writing file: out/image<sub>sensor</sub><sub>0</sub><sub>2023</sub>-11-11T09:41:47+01:00_<sub>dx</sub><sub>14.0</sub><sub>dy</sub><sub>14.0</sub><sub>dz</sub><sub>0.1</sub><sub>type</sub><sub>float</sub><sub>len</sub><sub>1000000</sub><sub>width</sub><sub>1000</sub><sub>height</sub><sub>1000.dat</sub>
</p>

<div class="org-src-container">
<pre class="src src-sh">./plotBinary <span style="color: #E6DB74; font-weight: bold;">\</span>
    --dtype float <span style="color: #E6DB74; font-weight: bold;">\</span>
    -f out/image_sensor_0_2023-11-11T09:41:47+01:00__dx_14.0_dy_14.0_dz_0.1_type_float_len_1000000_width_1000_height_1000.dat <span style="color: #E6DB74; font-weight: bold;">\</span>
    --invertY <span style="color: #E6DB74; font-weight: bold;">\</span>
    --out ~/phd/Figs/raytracing/llnlPanter/panter_source_Fe_Kalpha_perfect_mirrors_3x3mm.pdf <span style="color: #E6DB74; font-weight: bold;">\</span>
    --inPixels=false <span style="color: #E6DB74; font-weight: bold;">\</span>
    --title <span style="color: #E6DB74;">&quot;Fe Kα, 6.41 keV, 3x3 mm, source optical axis&quot;</span> <span style="color: #E6DB74; font-weight: bold;">\</span>
    --xrange 1.5
</pre>
</div>


<figure id="orgf3f943b">
<img src="./figs/home/basti/phd/Figs/raytracing/llnlPanter/panter_source_Fe_Kalpha_perfect_mirrors_3x3mm.svg" class="org-svg" alt="panter_source_Fe_Kalpha_perfect_mirrors_3x3mm.svg" />

<figcaption>Figure 34: <span class="figure-number">Figure 231: </span>Our result Fe Kα as 3x3 mm with perfect mirrors</figcaption>
</figure>


<figure id="orgc6c944f">
<img src="./figs/home/basti/phd/Figs/raytracing/llnlPanter/panter_source_Fe_Kalpha_perfect_mirrors_3x3mm_log10.svg" class="org-svg" alt="panter_source_Fe_Kalpha_perfect_mirrors_3x3mm_log10.svg" />

<figcaption>Figure 35: <span class="figure-number">Figure 232: </span>Our result Fe Kα as 3x3 mm with perfect mirrors, log10</figcaption>
</figure>


<figure id="org86cf0ad">
<img src="./figs/home/basti/phd/Figs/raytracing/llnlPanter/panter_source_Fe_Kalpha_perfect_mirrors_3x3mm_hpd_x.svg" class="org-svg" alt="panter_source_Fe_Kalpha_perfect_mirrors_3x3mm_hpd_x.svg" />

<figcaption>Figure 36: <span class="figure-number">Figure 233: </span>HPD in X for perfect mirrors of Fe Kα</figcaption>
</figure>


<figure id="org726c261">
<img src="./figs/home/basti/phd/Figs/raytracing/llnlPanter/panter_source_Fe_Kalpha_perfect_mirrors_3x3mm_hpd_y.svg" class="org-svg" alt="panter_source_Fe_Kalpha_perfect_mirrors_3x3mm_hpd_y.svg" />

<figcaption>Figure 37: <span class="figure-number">Figure 234: </span>HPD in Y for perfect mirrors of Fe Kα</figcaption>
</figure>


<figure id="orgc96ee8b">
<img src="./figs/home/basti/phd/Figs/raytracing/llnlPanter/panter_source_Fe_Kalpha_perfect_mirrors_3x3mm_hpd_via_eef_50.svg" class="org-svg" alt="panter_source_Fe_Kalpha_perfect_mirrors_3x3mm_hpd_via_eef_50.svg" />

<figcaption>Figure 38: <span class="figure-number">Figure 235: </span>HPD of Fe Kα computed from the EEF (radial cumulative distribution function, encircled energy)</figcaption>
</figure>
</div>
</li>
</ol>
</div>
</div>
</div>


<div class="outline-3" id="outline-container-sec:appendix:raytracing:axion_image">
<h3 id="sec:appendix:raytracing:axion_image"><span class="section-number-3">37.4.</span> Computing an axion image with TrAXer</h3>
<div class="outline-text-3" id="text-sec:appendix:raytracing:axion_image">
<p>
The previous section provides us with reasonable guarantees that our
raytracer produces compatible results to PANTER measurements and the
LLNL raytracing results. In particular for the axion-electron coupling
we do not wish to reuse the raytracing prediction for the solar axion
image computed by Michael Pivovaroff at LLNL, as used in the CAST
Nature 2017 paper (<a href="./bibliography.html#citeproc_bib_item_66">Collaboration and others 2017</a>) paper. <sup>  <a role="doc-backlink" class="footref" id="fnr.18" href="#fn.18">18</a></sup> This is
because of the different radial emission profile (compare
fig. <a href="#fig:theory:solar_axion_flux:radial_dependence_ksvz_dfsz">#fig:theory:solar_axion_flux:radial_dependence_ksvz_dfsz</a>). And
for the chameleon, due to its production in the solar tachocline, this
is of course absolutely mandatory.
</p>

<p>
To simulate the solar axion image, we use the scene already shown in
fig. <a href="#fig:appendix:raytracing:cast_setup_example">1(b)</a>. The Sun is
placed as an X-ray emitter <sup>  <a role="doc-backlink" class="footref" id="fnr.19" href="#fn.19">19</a></sup> at \(\SI{0.989}{AU}\)
away <sup>  <a role="doc-backlink" class="footref" id="fnr.20" href="#fn.20">20</a></sup> from the telescope. It emits X-rays of energies and
from radii corresponding to the distribution seen in
fig. <a href="#fig:theory:solar_axion_flux:flux_vs_energy_and_radius">#fig:theory:solar_axion_flux:flux_vs_energy_and_radius</a>
calculated using the opacity calculation code (<a href="./bibliography.html#citeproc_bib_item_163">Von Oy 2023</a>)
also developed by Johanna von Oy during her master thesis
(<a href="./bibliography.html#citeproc_bib_item_162">Von Oy 2020</a>). The calculations are based on the AGSS09 solar model
(<a href="./bibliography.html#citeproc_bib_item_25">Asplund et al. 2009</a>; <a href="./bibliography.html#citeproc_bib_item_210">Serenelli et al. 2009</a>). The telescope is rotated under
the angle it was installed at CAST, as deduced from the X-ray finger
taken at CAST, fig. <a href="#fig:cast:xray_finger_centers">#fig:cast:xray_finger_centers</a> (about
\(\SI{14}{°}\)). The image sensor is placed slightly in front of the
focal point. \(\SI{1492.93}{mm}\) away from the center of the telescope
(to the virtual reflection point) instead of \(\SI{1500}{mm}\) to
account for the median conversion point of the X-rays of the expected
axion electron X-ray flux (as mentioned in
sec. <a href="./limit.html#sec:limit:median_absorption_depth">13.10.5</a> and calculated in
<a href="./average_depth_xrays_argon.html#sec:appendix:average_depth_xrays_argon">36</a>).
</p>

<p>
With all these in place, the axion image comes out as seen in
fig. <a href="#fig:appendix:raytracing:traxer_solar_axion_image">39(a)</a>. In
comparison fig. <a href="#fig:appendix:raytracing:llnl_solar_axion_image">39(b)</a>
shows the axion image as computed by the LLNL raytracing code (albeit
only for the axion-photon coupling and related emission). The
similarity between the two images is implying our raytracing
simulation is sensible. Small differences are expected, not only
because of a different solar emission. The different rotation angle is
due to a different assumed rotation of the telescope. Our raytracing
image shows a larger bulge in the center at very low intensity. The
absolute size of the major flux region is very comparable. The slight
asymmetry in our image is due to it being effectively \(\SI{8}{mm}\) in
front of the focal point.
</p>


<figure class="figure-wrapper" id="fig:appendix:raytracing:comparison_traxer_llnl_axion_image">
<figure class="subfigure" id="fig:appendix:raytracing:traxer_solar_axion_image" data-width="49%">  <img src="./figs/~/phd/Figs/raytracing/solar_axion_image_fkAxionElectronPhoton_0.989AU_1492.93mm.svg" data-width="99%" />  <figcaption>Figure 39(a): TrAXer</figcaption></figure> <figure class="subfigure" id="fig:appendix:raytracing:llnl_solar_axion_image" data-width="49%">  <img src="./figs/~/phd/Figs/raytracing/raytracing_axion_image_llnl_jaime_all_energies.svg" data-width="99%" />  <figcaption>Figure 39(b): LLNL</figcaption></figure>
<figcaption>Figure 39: <a href="#fig:appendix:raytracing:traxer_solar_axion_image">39(a)</a>: TrAXer simulation of the solar axion image using the correct Sun-Earth distance with the
          image sensor placed $\SI{1492.93}{mm}$ away from the telescope center. <a href="#fig:appendix:raytracing:llnl_solar_axion_image">39(b)</a>: Corresponding raytracing simulation done at LLNL, however for axion-photon production only.</figcaption>
</figure>
</div>

<div class="outline-4" id="outline-container-org2260418">
<h4 id="org2260418"><span class="section-number-4">37.4.1.</span> Further thoughts on the (missing?) bow tie   <span class="tag">  <span class="extended">extended</span></span></h4>
<div class="outline-text-4" id="text-37-4-1">
<p>
The bow tie feature in the raytracing images is partially present even
in the perfect mirror raytracing results. But in those there is a hard
cutoff at some point, because the last shell and largest angles have
been reached. Once figure errors are included this turns into a much
smoother process, resulting in the bow tie shape.
</p>
</div>
</div>

<div class="outline-4" id="outline-container-orgf67e4ad">
<h4 id="orgf67e4ad"><span class="section-number-4">37.4.2.</span> Note on conversion point   <span class="tag">  <span class="extended">extended</span></span></h4>
<div class="outline-text-4" id="text-37-4-2">
<p>
The calculation for the conversion point was mentioned in
</p>

<ul class="org-ul">
<li class="off"><code>[ ]</code> <b>REFERENCE</b></li>
</ul>
</div>
</div>

<div class="outline-4" id="outline-container-sec:appendix:raytracing:generate_axion_image">
<h4 id="sec:appendix:raytracing:generate_axion_image"><span class="section-number-4">37.4.3.</span> Generate solar axion image using TrAXer <code>[/]</code>   <span class="tag">  <span class="extended">extended</span></span></h4>
<div class="outline-text-4" id="text-sec:appendix:raytracing:generate_axion_image">
<ul class="org-ul">
<li class="on"><code>[X]</code> <b>WE FORGOT TO USE THE CORRECT DISTANCE, I.E. MEAN CONVERSION!</b>
-&gt; Corrected.</li>
</ul>

<p>
The main ingredient we need to simulate the correct axion image is the
data file that describes the radial and spectral emission of axions
from the Sun.
</p>

<p>
Make sure to get the (<a href="./bibliography.html#citeproc_bib_item_163">Von Oy 2023</a>) code:
</p>
<div class="org-src-container">
<pre class="src src-sh"><span style="color: #F92672;">cd</span> &lt;path/of/choice&gt;
git clone https://github.com/jovoy/AxionElectronLimit.git
<span style="color: #F92672;">cd</span> AxionElectronLimit
<span style="color: #F92672;">cd</span> src
nim c -d:danger readOpacityFile
</pre>
</div>

<p>
Note that you also need to download the OPCD files from the opacity
project <a href="https://cdsweb.u-strasbg.fr/topbase/TheOP.html">https://cdsweb.u-strasbg.fr/topbase/TheOP.html</a>.
Download the <code>.tar</code> file and place it in a location of your
choice. With that done, update the <code>AxionElectronLimit</code> config file
found in
<a href="./../CastData/ExternCode/AxionElectronLimit/config/config.toml">./../CastData/ExternCode/AxionElectronLimit/config/config.toml</a>
by setting the
</p>
<div class="org-src-container">
<pre class="src src-toml"><span style="color: #FD971F;">opcdPath</span>         = <span style="color: #E6DB74;">&quot;/home/basti/CastData/data/&quot;</span>
</pre>
</div>
<p>
field under <code>[ReadOpacityFile]</code> to the correct directory. The
directory should point to the parent directory of the <code>OPCD_3.3</code> dir.
</p>

<p>
If you do not have a <code>config.toml</code> file, just create a copy of the
<code>config_default.toml</code> as <code>config.toml</code>.
</p>

<p>
Now we can run <code>readOpacityFile</code>:
</p>
<div class="org-src-container">
<pre class="src src-sh">./readOpacityFile <span style="color: #E6DB74; font-weight: bold;">\</span>
    --suffix <span style="color: #E6DB74;">&quot;_0.989AU&quot;</span> <span style="color: #E6DB74; font-weight: bold;">\</span>
    --distanceSunEarth 0.9891144450781392.AU <span style="color: #E6DB74; font-weight: bold;">\</span>
    --fluxKind fkAxionElectronPhoton <span style="color: #E6DB74; font-weight: bold;">\</span>
    --plotPath ~/phd/Figs/readOpacityFile/ <span style="color: #E6DB74; font-weight: bold;">\</span>
    --outpath ~/phd/resources/readOpacityFile/
</pre>
</div>
<p>
where we insert the correct distance from Sun to Earth, see
sec. <a href="./limit.html#sec:limit:ingredients:solar_axion_flux:gen_flux_distance_sun">13.10.2.1</a>. And
we set the fluxes to only those interactions we are interested in
(ignoring things like plasmon interactions).
</p>

<p>
The output data will be written as a CSV file to a location also
defined in the config file.
</p>

<p>
Using this CSV file, which should be called
<code>solar_model_dataframe_fluxKind_fkAxionElectronPhoton_0.989AU.csv</code> we
can run the raytracer, in this case in the focal point:
</p>

<div class="org-src-container">
<pre class="src src-sh">./raytracer <span style="color: #E6DB74; font-weight: bold;">\</span>
    --width 1200 --speed 10.0 --nJobs 32 --vfov 15 --maxDepth 5 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --llnl --focalPoint --sourceKind skSun <span style="color: #E6DB74; font-weight: bold;">\</span>
    --solarModelFile ~/CastData/ExternCode/AxionElectronLimit/resources/solar_model_dataframe_fluxKind_fkAxionElectronPhoton_0.989AU.csv <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sensorKind sSum <span style="color: #E6DB74; font-weight: bold;">\</span>
    --usePerfectMirror=false <span style="color: #E6DB74; font-weight: bold;">\</span>
    --ignoreWindow
</pre>
</div>
<p>
[INFO] Writing buffers to binary files.
[INFO] Writing file: out/buffer<sub>2023</sub>-11-12T16:12:11+01:00<sub>type</sub><sub>uint32</sub><sub>len</sub><sub>1440000</sub><sub>width</sub><sub>1200</sub><sub>height</sub><sub>1200.dat</sub>
[INFO] Writing file: out/counts<sub>2023</sub>-11-12T16:12:11+01:00<sub>type</sub><sub>int</sub><sub>len</sub><sub>1440000</sub><sub>width</sub><sub>1200</sub><sub>height</sub><sub>1200.dat</sub>
[INFO] Writing file: out/image<sub>sensor</sub><sub>0</sub><sub>2023</sub>-11-12T16:12:11+01:00_<sub>dx</sub><sub>14.0</sub><sub>dy</sub><sub>14.0</sub><sub>dz</sub><sub>0.1</sub><sub>type</sub><sub>float</sub><sub>len</sub><sub>1000000</sub><sub>width</sub><sub>1000</sub><sub>height</sub><sub>1000.dat</sub>
</p>

<p>
[INFO] Writing buffers to binary files.
[INFO] Writing file: out/buffer<sub>2023</sub>-11-10T12:40:44+01:00<sub>type</sub><sub>uint32</sub><sub>len</sub><sub>1440000</sub><sub>width</sub><sub>1200</sub><sub>height</sub><sub>1200.dat</sub>
[INFO] Writing file: out/counts<sub>2023</sub>-11-10T12:40:44+01:00<sub>type</sub><sub>int</sub><sub>len</sub><sub>1440000</sub><sub>width</sub><sub>1200</sub><sub>height</sub><sub>1200.dat</sub>
[INFO] Writing file: out/image<sub>sensor</sub><sub>0</sub><sub>2023</sub>-11-10T12:40:44+01:00_<sub>dx</sub><sub>14.0</sub><sub>dy</sub><sub>14.0</sub><sub>dz</sub><sub>0.1</sub><sub>type</sub><sub>float</sub><sub>len</sub><sub>1000000</sub><sub>width</sub><sub>1000</sub><sub>height</sub><sub>1000.dat</sub>
</p>

<p>
The important point is the <code>solarModelFile</code> parameter and
<code>--sensorKind sSum</code>, which sets image sensors up to sum up all flux
contributions in each pixel (instead of just counting how many rays
hit each pixel). We do not want to have the GridPix window strongback
in the result.
</p>

<p>
It will sample in an energy range between 0.03 and 15 keV. The lower
bound is due to the limit on the reflectivity calculation that is
possible based on the atomic scattering factors.
</p>

<p>
Time to produce a plot of the image:
</p>
<div class="org-src-container">
<pre class="src src-sh">./plotBinary <span style="color: #E6DB74; font-weight: bold;">\</span>
    --dtype float <span style="color: #E6DB74; font-weight: bold;">\</span>
    -f out/image_sensor_0_2023-11-10T12:40:44+01:00__dx_14.0_dy_14.0_dz_0.1_type_float_len_1000000_width_1000_height_1000.dat <span style="color: #E6DB74; font-weight: bold;">\</span>
    --invertY <span style="color: #E6DB74; font-weight: bold;">\</span>
    --out ~/phd/Figs/raytracing/solar_axion_image_fkAxionElectronPhoton_0.989AU_old_figure_errors.pdf <span style="color: #E6DB74; font-weight: bold;">\</span>
    --inPixels=false <span style="color: #E6DB74; font-weight: bold;">\</span>
    --title <span style="color: #E6DB74;">&quot;Solar axion image at 0.989 AU from Sun (old figure errors)&quot;</span>
</pre>
</div>

<p>
With the new fuzzing logic:
</p>
<div class="org-src-container">
<pre class="src src-sh">./plotBinary <span style="color: #E6DB74; font-weight: bold;">\</span>
    --dtype float <span style="color: #E6DB74; font-weight: bold;">\</span>
    -f out/image_sensor_0_2023-11-12T16:12:11+01:00__dx_14.0_dy_14.0_dz_0.1_type_float_len_1000000_width_1000_height_1000.dat <span style="color: #E6DB74; font-weight: bold;">\</span>
    --invertY <span style="color: #E6DB74; font-weight: bold;">\</span>
    --out ~/phd/Figs/raytracing/solar_axion_image_fkAxionElectronPhoton_0.989AU.pdf <span style="color: #E6DB74; font-weight: bold;">\</span>
    --inPixels=false <span style="color: #E6DB74; font-weight: bold;">\</span>
    --title <span style="color: #E6DB74;">&quot;Solar axion image at 0.989 AU from Sun (imperfect mirrors)&quot;</span>
</pre>
</div>



<p>
For comparison let&apos;s also run the code without any figure errors:
</p>

<div class="org-src-container">
<pre class="src src-sh">./raytracer <span style="color: #E6DB74; font-weight: bold;">\</span>
    --width 1200 --speed 10.0 --nJobs 32 --vfov 15 --maxDepth 5 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --llnl --focalPoint --sourceKind skSun <span style="color: #E6DB74; font-weight: bold;">\</span>
    --solarModelFile ~/CastData/ExternCode/AxionElectronLimit/resources/solar_model_dataframe_fluxKind_fkAxionElectronPhoton_0.989AU.csv <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sensorKind sSum <span style="color: #E6DB74; font-weight: bold;">\</span>
    --usePerfectMirror=true <span style="color: #E6DB74; font-weight: bold;">\</span>
    --ignoreWindow
</pre>
</div>
<p>
[INFO] Writing buffers to binary files.
[INFO] Writing file: out/buffer<sub>2023</sub>-11-10T12:45:29+01:00<sub>type</sub><sub>uint32</sub><sub>len</sub><sub>1440000</sub><sub>width</sub><sub>1200</sub><sub>height</sub><sub>1200.dat</sub>
[INFO] Writing file: out/counts<sub>2023</sub>-11-10T12:45:29+01:00<sub>type</sub><sub>int</sub><sub>len</sub><sub>1440000</sub><sub>width</sub><sub>1200</sub><sub>height</sub><sub>1200.dat</sub>
[INFO] Writing file: out/image<sub>sensor</sub><sub>0</sub><sub>2023</sub>-11-10T12:45:29+01:00_<sub>dx</sub><sub>14.0</sub><sub>dy</sub><sub>14.0</sub><sub>dz</sub><sub>0.1</sub><sub>type</sub><sub>float</sub><sub>len</sub><sub>1000000</sub><sub>width</sub><sub>1000</sub><sub>height</sub><sub>1000.dat</sub>
</p>

<div class="org-src-container">
<pre class="src src-sh">./plotBinary <span style="color: #E6DB74; font-weight: bold;">\</span>
    --dtype float <span style="color: #E6DB74; font-weight: bold;">\</span>
    -f out/image_sensor_0_2023-11-10T12:45:29+01:00__dx_14.0_dy_14.0_dz_0.1_type_float_len_1000000_width_1000_height_1000.dat <span style="color: #E6DB74; font-weight: bold;">\</span>
    --invertY <span style="color: #E6DB74; font-weight: bold;">\</span>
    --out ~/phd/Figs/raytracing/solar_axion_image_perfect_mirrors_fkAxionElectronPhoton_0.989AU.pdf <span style="color: #E6DB74; font-weight: bold;">\</span>
    --inPixels=false <span style="color: #E6DB74; font-weight: bold;">\</span>
    --title <span style="color: #E6DB74;">&quot;Solar axion image at 0.989 AU from Sun, perfect mirrors&quot;</span>
</pre>
</div>

<p>
And finally we also compute the axion image at the point of most
likely conversion of X-rays, i.e. at \(\SI{1492.93}{mm}\) instead of
\(\SI{1500}{mm}\). Thus, <code>--rayAt 0.995286666667</code> (1492.93 / 1500) to
get the correct placement:
</p>
<div class="org-src-container">
<pre class="src src-sh">./raytracer <span style="color: #E6DB74; font-weight: bold;">\</span>
    --width 1200 --speed 10.0 --nJobs 32 --vfov 15 --maxDepth 5 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --llnl --focalPoint --sourceKind skSun <span style="color: #E6DB74; font-weight: bold;">\</span>
    --solarModelFile ~/CastData/ExternCode/AxionElectronLimit/resources/solar_model_dataframe_fluxKind_fkAxionElectronPhoton_0.989AU.csv <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sensorKind sSum <span style="color: #E6DB74; font-weight: bold;">\</span>
    --usePerfectMirror=false <span style="color: #E6DB74; font-weight: bold;">\</span>
    --rayAt 0.995286666667 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --ignoreWindow
</pre>
</div>
<p>
[INFO] Writing buffers to binary files.
[INFO] Writing file: out/buffer<sub>2023</sub>-11-12T16:23:18+01:00<sub>type</sub><sub>uint32</sub><sub>len</sub><sub>1440000</sub><sub>width</sub><sub>1200</sub><sub>height</sub><sub>1200.dat</sub>
[INFO] Writing file: out/counts<sub>2023</sub>-11-12T16:23:18+01:00<sub>type</sub><sub>int</sub><sub>len</sub><sub>1440000</sub><sub>width</sub><sub>1200</sub><sub>height</sub><sub>1200.dat</sub>
[INFO] Writing file: out/image<sub>sensor</sub><sub>0</sub><sub>2023</sub>-11-12T16:23:18+01:00_<sub>dx</sub><sub>14.0</sub><sub>dy</sub><sub>14.0</sub><sub>dz</sub><sub>0.1</sub><sub>type</sub><sub>float</sub><sub>len</sub><sub>1000000</sub><sub>width</sub><sub>1000</sub><sub>height</sub><sub>1000.dat</sub>
</p>

<p>
[INFO] Writing buffers to binary files.
[INFO] Writing file: out/buffer<sub>2023</sub>-11-10T20:38:55+01:00<sub>type</sub><sub>uint32</sub><sub>len</sub><sub>1440000</sub><sub>width</sub><sub>1200</sub><sub>height</sub><sub>1200.dat</sub>
[INFO] Writing file: out/counts<sub>2023</sub>-11-10T20:38:55+01:00<sub>type</sub><sub>int</sub><sub>len</sub><sub>1440000</sub><sub>width</sub><sub>1200</sub><sub>height</sub><sub>1200.dat</sub>
[INFO] Writing file: out/image<sub>sensor</sub><sub>0</sub><sub>2023</sub>-11-10T20:38:55+01:00_<sub>dx</sub><sub>14.0</sub><sub>dy</sub><sub>14.0</sub><sub>dz</sub><sub>0.1</sub><sub>type</sub><sub>float</sub><sub>len</sub><sub>1000000</sub><sub>width</sub><sub>1000</sub><sub>height</sub><sub>1000.dat</sub>
</p>

<p>
Which we also plot:
</p>
<div class="org-src-container">
<pre class="src src-sh">./plotBinary <span style="color: #E6DB74; font-weight: bold;">\</span>
    --dtype float <span style="color: #E6DB74; font-weight: bold;">\</span>
    -f out/image_sensor_0_2023-11-10T20:38:55+01:00__dx_14.0_dy_14.0_dz_0.1_type_float_len_1000000_width_1000_height_1000.dat <span style="color: #E6DB74; font-weight: bold;">\</span>
    --invertY <span style="color: #E6DB74; font-weight: bold;">\</span>
    --out ~/phd/Figs/raytracing/solar_axion_image_fkAxionElectronPhoton_0.989AU_1492.93mm_old_figure_error.pdf <span style="color: #E6DB74; font-weight: bold;">\</span>
    --inPixels=false <span style="color: #E6DB74; font-weight: bold;">\</span>
    --title <span style="color: #E6DB74;">&quot;Solar axion image at 0.989 AU from Sun, 1492.93 mm (old figure error)&quot;</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #FD971F;">F_WIDTH</span>=0.5 <span style="color: #FD971F;">USE_TEX</span>=true ./plotBinary <span style="color: #E6DB74; font-weight: bold;">\</span>
    --dtype float <span style="color: #E6DB74; font-weight: bold;">\</span>
    -f out/image_sensor_0_2023-11-12T16:23:18+01:00__dx_14.0_dy_14.0_dz_0.1_type_float_len_1000000_width_1000_height_1000.dat <span style="color: #E6DB74; font-weight: bold;">\</span>
    --invertY <span style="color: #E6DB74; font-weight: bold;">\</span>
    --out ~/phd/Figs/raytracing/solar_axion_image_fkAxionElectronPhoton_0.989AU_1492.93mm.pdf <span style="color: #E6DB74; font-weight: bold;">\</span>
    --inPixels=false <span style="color: #E6DB74; font-weight: bold;">\</span>
    --gridpixOutfile ~/phd/resources/axionImages/solar_axion_image_fkAxionElectronPhoton_0.989AU_1492.93mm.csv <span style="color: #E6DB74; font-weight: bold;">\</span>
    --title <span style="color: #E6DB74;">&quot;Solar axion image at 0.989 AU from Sun, 1492.93 mm&quot;</span>
</pre>
</div>



<p>
This yields the files included in the main body.
</p>
<ul class="org-ul">
<li>  <code>~/phd/Figs/raytracing/solar_axion_image_fkAxionElectronPhoton_0.989AU_1492.93mm.pdf</code></li>
<li>  <code>~/phd/Figs/raytracing/solar_axion_image_fkAxionElectronPhoton_0.989AU.pdf</code></li>
<li>  <code>~/phd/Figs/raytracing/solar_axion_image_perfect_mirrors_fkAxionElectronPhoton_0.989AU.pdf</code></li>
</ul>

<p>
If you compare
<img src="./figs/home/basti/phd/Figs/raytracing/solar_axion_image_fkAxionElectronPhoton_0.989AU.svg" class="org-svg" alt="solar_axion_image_fkAxionElectronPhoton_0.989AU.svg" />
with
<img src="./figs/home/basti/phd/Figs/raytracing/solar_axion_image_fkAxionElectronPhoton_0.989AU_1492.93mm.svg" class="org-svg" alt="solar_axion_image_fkAxionElectronPhoton_0.989AU_1492.93mm.svg" />
you see that there is a minor amount of asymmetry in the version that
is ~1 cm in front of the focal point, as expected. The impact on the
size is very small though. This can be seen when comparing:
</p>

<ul class="org-ul">
<li>  <img src="./figs/home/basti/phd/Figs/raytracing/solar_axion_image_fkAxionElectronPhoton_0.989AU_1492.93mm_hpd_via_eef_50.svg" class="org-svg" alt="solar_axion_image_fkAxionElectronPhoton_0.989AU_1492.93mm_hpd_via_eef_50.svg" /></li>
<li>  <img src="./figs/home/basti/phd/Figs/raytracing/solar_axion_image_fkAxionElectronPhoton_0.989AU_1492.93mm_hpd_x.svg" class="org-svg" alt="solar_axion_image_fkAxionElectronPhoton_0.989AU_1492.93mm_hpd_x.svg" /></li>
<li>  <img src="./figs/home/basti/phd/Figs/raytracing/solar_axion_image_fkAxionElectronPhoton_0.989AU_1492.93mm_hpd_y.svg" class="org-svg" alt="solar_axion_image_fkAxionElectronPhoton_0.989AU_1492.93mm_hpd_y.svg" /></li>
</ul>

<p>
with the same plots from the focal point.  
</p>
<ul class="org-ul">
<li>  <img src="./figs/home/basti/phd/Figs/raytracing/solar_axion_image_fkAxionElectronPhoton_0.989AU_hpd_via_eef_50.svg" class="org-svg" alt="solar_axion_image_fkAxionElectronPhoton_0.989AU_hpd_via_eef_50.svg" /></li>
<li>  <img src="./figs/home/basti/phd/Figs/raytracing/solar_axion_image_fkAxionElectronPhoton_0.989AU_hpd_x.svg" class="org-svg" alt="solar_axion_image_fkAxionElectronPhoton_0.989AU_hpd_x.svg" /></li>
<li>  <img src="./figs/home/basti/phd/Figs/raytracing/solar_axion_image_fkAxionElectronPhoton_0.989AU_hpd_y.svg" class="org-svg" alt="solar_axion_image_fkAxionElectronPhoton_0.989AU_hpd_y.svg" /></li>
</ul>

<p>
The HPD increases by &lt;0.05 mm 
</p>

<p>
Comparing this to the LLNL raytracing axion image:
<img src="./figs/home/basti/org/Figs/statusAndProgress/rayTracing/raytracing_axion_image_llnl_jaime_all_energies_gridpix_size.svg" class="org-svg" alt="raytracing_axion_image_llnl_jaime_all_energies_gridpix_size.svg" />
they actually look very compatible.
</p>

<p>
<b>Note</b>: we also produced figures for \(\SI{1487.93}{mm}\) instead of the
final \(\SI{1492.93}{mm}\) found in
<a href="./Figs/raytracing/axion_image_assuming_1.5cm_behind_window/">./Figs/raytracing/axion_image_assuming_1.5cm_behind_window/</a>
</p>
</div>

<div class="outline-5" id="outline-container-org9273542">
<h5 id="org9273542"><span class="section-number-5">37.4.3.1.</span> What does the axion image look like without any orthogonal fuzzing?   <span class="tag">  <span class="extended">extended</span></span></h5>
<div class="outline-text-5" id="text-37-4-3-1">
<p>
This thought just occurred to me, because the LLNL raytracing image
still has more of a &apos;waist&apos; in the center.
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #FD971F;">FUZZ_ORTH</span>=0.0 ./raytracer <span style="color: #E6DB74; font-weight: bold;">\</span>
    --width 1200 --speed 10.0 --nJobs 32 --vfov 15 --maxDepth 5 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --llnl --focalPoint --sourceKind skSun <span style="color: #E6DB74; font-weight: bold;">\</span>
    --solarModelFile ~/CastData/ExternCode/AxionElectronLimit/resources/solar_model_dataframe_fluxKind_fkAxionElectronPhoton_0.989AU.csv <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sensorKind sSum <span style="color: #E6DB74; font-weight: bold;">\</span>
    --usePerfectMirror=false <span style="color: #E6DB74; font-weight: bold;">\</span>
    --ignoreWindow
</pre>
</div>
<p>
[INFO] Writing buffers to binary files.
[INFO] Writing file: out/buffer<sub>2023</sub>-11-12T16:29:50+01:00<sub>type</sub><sub>uint32</sub><sub>len</sub><sub>1440000</sub><sub>width</sub><sub>1200</sub><sub>height</sub><sub>1200.dat</sub>
[INFO] Writing file: out/counts<sub>2023</sub>-11-12T16:29:50+01:00<sub>type</sub><sub>int</sub><sub>len</sub><sub>1440000</sub><sub>width</sub><sub>1200</sub><sub>height</sub><sub>1200.dat</sub>
[INFO] Writing file: out/image<sub>sensor</sub><sub>0</sub><sub>2023</sub>-11-12T16:29:50+01:00_<sub>dx</sub><sub>14.0</sub><sub>dy</sub><sub>14.0</sub><sub>dz</sub><sub>0.1</sub><sub>type</sub><sub>float</sub><sub>len</sub><sub>1000000</sub><sub>width</sub><sub>1000</sub><sub>height</sub><sub>1000.dat</sub>
</p>

<div class="org-src-container">
<pre class="src src-sh">./plotBinary <span style="color: #E6DB74; font-weight: bold;">\</span>
    --dtype float <span style="color: #E6DB74; font-weight: bold;">\</span>
    -f out/image_sensor_0_2023-11-12T16:29:50+01:00__dx_14.0_dy_14.0_dz_0.1_type_float_len_1000000_width_1000_height_1000.dat <span style="color: #E6DB74; font-weight: bold;">\</span>
    --invertY <span style="color: #E6DB74; font-weight: bold;">\</span>
    --out /tmp/solar_axion_image_fkAxionElectronPhoton_0.989AU_1492.93mm_no_orth_fuzz.pdf <span style="color: #E6DB74; font-weight: bold;">\</span>
    --inPixels=false <span style="color: #E6DB74; font-weight: bold;">\</span>
    --title <span style="color: #E6DB74;">&quot;Solar axion image at 0.989 AU from Sun, 1492.93 mm (no orth fuzz)&quot;</span>
</pre>
</div>

<p>
Ok, the plot looks near identical. :)
</p>
</div>
</div>
</div>

<div class="outline-4" id="outline-container-org864bbe9">
<h4 id="org864bbe9"><span class="section-number-4">37.4.4.</span> Generating the plot of the LLNL axion image   <span class="tag">  <span class="extended">extended</span></span></h4>
<div class="outline-text-4" id="text-37-4-4">
<p>
The origin of the raytracing plot is
<a href="./../org/Doc/StatusAndProgress.html">./../org/Doc/StatusAndProgress.html</a>,
but we reproduce the code here to change it slightly. The code
requires the text data of the LLNL raytracing simulations.
</p>

<ul class="org-ul">
<li class="off"><code>[ ]</code> <b>FIND OUT IF I CAN PUBLISH THEM</b></li>
</ul>

<div class="org-src-container">
<pre class="src src-nim"><span style="color: #F92672;">import</span> ggplotnim, seqmath
<span style="color: #F92672;">import</span> std / <span style="color: #AE81FF;">[</span>os, sequtils, strutils<span style="color: #AE81FF;">]</span>
<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">readRT</span><span style="color: #AE81FF;">(</span>p: <span style="color: #66D9EF;">string</span><span style="color: #AE81FF;">)</span>: <span style="color: #66D9EF;">DataFrame</span> =
  <span style="color: #FD971F;">result</span> = readCsv<span style="color: #AE81FF;">(</span>p, sep = <span style="color: #E6DB74;">&apos; &apos;</span>, skipLines = <span style="font-style: italic;">4</span>, colNames = @<span style="color: #66D9EF;">[</span><span style="color: #E6DB74;">&quot;x&quot;</span>, <span style="color: #E6DB74;">&quot;y&quot;</span>, <span style="color: #E6DB74;">&quot;z&quot;</span><span style="color: #66D9EF;">]</span><span style="color: #AE81FF;">)</span>
  <span style="color: #FD971F;">result</span><span style="color: #AE81FF;">[</span><span style="color: #E6DB74;">&quot;File&quot;</span><span style="color: #AE81FF;">]</span> = p  
<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">meanData</span><span style="color: #AE81FF;">(</span>df: <span style="color: #66D9EF;">DataFrame</span><span style="color: #AE81FF;">)</span>: <span style="color: #66D9EF;">DataFrame</span> =
  <span style="color: #FD971F;">result</span> = df.mutate<span style="color: #AE81FF;">(</span>f<span style="color: #66D9EF;">{</span><span style="color: #E6DB74;">&quot;x&quot;</span> ~ `x` - mean<span style="color: #A6E22E;">(</span>col<span style="color: #E6DB74;">(</span><span style="color: #E6DB74;">&quot;x&quot;</span><span style="color: #E6DB74;">)</span><span style="color: #A6E22E;">)</span><span style="color: #66D9EF;">}</span>,
                     f<span style="color: #66D9EF;">{</span><span style="color: #E6DB74;">&quot;y&quot;</span> ~ `y` - mean<span style="color: #A6E22E;">(</span>col<span style="color: #E6DB74;">(</span><span style="color: #E6DB74;">&quot;y&quot;</span><span style="color: #E6DB74;">)</span><span style="color: #A6E22E;">)</span><span style="color: #66D9EF;">}</span><span style="color: #AE81FF;">)</span>
<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">customSideBySide</span><span style="color: #AE81FF;">()</span>: <span style="color: #66D9EF;">Theme</span> =
  <span style="color: #FD971F;">result</span> = sideBySide<span style="color: #AE81FF;">()</span>
  <span style="color: #FD971F;">result</span>.titleFont = some<span style="color: #AE81FF;">(</span>font<span style="color: #66D9EF;">(</span><span style="font-style: italic;">8</span>.<span style="font-style: italic;">0</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">plots</span><span style="color: #AE81FF;">(</span>df: <span style="color: #66D9EF;">DataFrame</span>, title, outfile: <span style="color: #66D9EF;">string</span><span style="color: #AE81FF;">)</span> =
  <span style="color: #F92672;">var</span> <span style="color: #FD971F;">customInferno </span>= inferno<span style="color: #AE81FF;">()</span>
  customInferno.colors<span style="color: #AE81FF;">[</span><span style="font-style: italic;">0</span><span style="color: #AE81FF;">]</span> = <span style="font-style: italic;">0</span> <span style="color: #75715E;"># </span><span style="color: #75715E;">transparent</span>
  ggplot<span style="color: #AE81FF;">(</span>df.filter<span style="color: #66D9EF;">(</span>f<span style="color: #A6E22E;">{</span>`x` &gt;= -<span style="font-style: italic;">7</span>.<span style="font-style: italic;">0</span> <span style="color: #F92672;">and</span> `x` &lt;= <span style="font-style: italic;">7</span>.<span style="font-style: italic;">0</span> <span style="color: #F92672;">and</span> `y` &gt;= -<span style="font-style: italic;">7</span>.<span style="font-style: italic;">0</span> <span style="color: #F92672;">and</span> `y` &lt;= <span style="font-style: italic;">7</span>.<span style="font-style: italic;">0</span><span style="color: #A6E22E;">}</span><span style="color: #66D9EF;">)</span>,
         aes<span style="color: #66D9EF;">(</span><span style="color: #E6DB74;">&quot;x&quot;</span>, <span style="color: #E6DB74;">&quot;y&quot;</span>, fill = <span style="color: #E6DB74;">&quot;z&quot;</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span> +
    geom_raster<span style="color: #AE81FF;">()</span> +
    scale_fill_gradient<span style="color: #AE81FF;">(</span>customInferno<span style="color: #AE81FF;">)</span> +
    xlab<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;x [mm]&quot;</span><span style="color: #AE81FF;">)</span> + ylab<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;y [mm]&quot;</span><span style="color: #AE81FF;">)</span> +
    xlim<span style="color: #AE81FF;">(</span>-<span style="font-style: italic;">7</span>.<span style="font-style: italic;">0</span>, <span style="font-style: italic;">7</span>.<span style="font-style: italic;">0</span><span style="color: #AE81FF;">)</span> + ylim<span style="color: #AE81FF;">(</span>-<span style="font-style: italic;">7</span>.<span style="font-style: italic;">0</span>, <span style="font-style: italic;">7</span>.<span style="font-style: italic;">0</span><span style="color: #AE81FF;">)</span> +
    coord_fixed<span style="color: #AE81FF;">(</span><span style="font-style: italic;">1</span>.<span style="font-style: italic;">0</span><span style="color: #AE81FF;">)</span> + 
    ggtitle<span style="color: #AE81FF;">(</span>title<span style="color: #AE81FF;">)</span> +
    themeLatex<span style="color: #AE81FF;">(</span>fWidth = <span style="font-style: italic;">0</span>.<span style="font-style: italic;">5</span>, width = <span style="font-style: italic;">600</span>, baseTheme = customSideBySide, useTeX = <span style="color: #AE81FF;">true</span><span style="color: #AE81FF;">)</span> + 
    ggsave<span style="color: #AE81FF;">(</span>outfile<span style="color: #AE81FF;">)</span>
  
<span style="color: #F92672;">var</span> <span style="color: #FD971F;">dfs </span>= <span style="color: #F92672;">newSeq</span><span style="color: #AE81FF;">[</span><span style="color: #66D9EF;">DataFrame</span><span style="color: #AE81FF;">]()</span>
<span style="color: #F92672;">for</span> f <span style="color: #F92672;">in</span> walkFiles<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;/home/basti/org/resources/llnl_cast_nature_jaime_data/2016_DEC_Final_CAST_XRT/*2Dmap.txt&quot;</span><span style="color: #AE81FF;">)</span>:
  <span style="color: #F92672;">echo</span> <span style="color: #E6DB74;">&quot;Reading: &quot;</span>, f
  dfs.<span style="color: #F92672;">add</span> readRT<span style="color: #AE81FF;">(</span>f<span style="color: #AE81FF;">)</span>
<span style="color: #F92672;">echo</span> <span style="color: #E6DB74;">&quot;Summarize&quot;</span>
<span style="color: #F92672;">var</span> <span style="color: #FD971F;">df </span>= dfs.assignStack<span style="color: #AE81FF;">()</span>
df = df.group_by<span style="color: #AE81FF;">(</span>@<span style="color: #66D9EF;">[</span><span style="color: #E6DB74;">&quot;x&quot;</span>, <span style="color: #E6DB74;">&quot;y&quot;</span><span style="color: #66D9EF;">]</span><span style="color: #AE81FF;">)</span>
  .summarize<span style="color: #AE81FF;">(</span>f<span style="color: #66D9EF;">{</span><span style="color: #66D9EF;">float</span>: <span style="color: #E6DB74;">&quot;z&quot;</span> &lt;&lt; sum<span style="color: #A6E22E;">(</span>`z`<span style="color: #A6E22E;">)</span><span style="color: #66D9EF;">}</span>,
             f<span style="color: #66D9EF;">{</span><span style="color: #66D9EF;">float</span>: <span style="color: #E6DB74;">&quot;zMean&quot;</span> &lt;&lt; mean<span style="color: #A6E22E;">(</span>`z`<span style="color: #A6E22E;">)</span><span style="color: #66D9EF;">}</span><span style="color: #AE81FF;">)</span>
  .mutate<span style="color: #AE81FF;">(</span>f<span style="color: #66D9EF;">{</span><span style="color: #E6DB74;">&quot;y&quot;</span> ~ col<span style="color: #A6E22E;">(</span><span style="color: #E6DB74;">&quot;y&quot;</span><span style="color: #A6E22E;">)</span>.<span style="color: #F92672;">max</span> - idx<span style="color: #A6E22E;">(</span>`y`<span style="color: #A6E22E;">)</span><span style="color: #66D9EF;">}</span><span style="color: #AE81FF;">)</span> <span style="color: #75715E;"># </span><span style="color: #75715E;">invert the y axis</span>
df = df.meanData<span style="color: #AE81FF;">()</span>
plots<span style="color: #AE81FF;">(</span>df,
      <span style="color: #E6DB74;">&quot;LLNL raytracing of axion image (sum all energies)&quot;</span>,
      <span style="color: #E6DB74;">&quot;~/phd/Figs/raytracing/raytracing_axion_image_llnl_jaime_all_energies.pdf&quot;</span><span style="color: #AE81FF;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div class="outline-3" id="outline-container-org7d687b6">
<h3 id="org7d687b6"><span class="section-number-3">37.5.</span> Reproducing an X-ray finger run with TrAXer   <span class="tag">  <span class="extended">extended</span></span></h3>
<div class="outline-text-3" id="text-37-5">
<p>
We can of course also attempt to reproduce an X-ray finger run using
TrAXer. Essentially it is not too dissimilar from the PANTER
measurements, with two differences:
</p>
<ol class="org-ol">
<li>source distance and size</li>
<li>source placement. In contrast to the PANTER measurement, where the
source is on the optical axis, at CAST for X-ray finger
measurements the source is in the magnet bore and therefore in
front of the telescope (i.e. <span class="underline">away</span> from the optical axis).</li>
</ol>

<p>
The main reason this is not part of the main thesis is that this is
neither very important and at the same time we don&apos;t actually know the
dimensions or distance of the X-ray finger used at CAST very well.
</p>


<p>
-&gt; Decide final arguments
</p>
<div class="org-src-container">
<pre class="src src-sh">./raytracer <span style="color: #E6DB74; font-weight: bold;">\</span>
    --width 1200 --speed 10.0 --nJobs 32 --vfov 45 --maxDepth 10 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --llnl --focalPoint <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sourceKind skXrayFinger <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sensorKind sSum <span style="color: #E6DB74; font-weight: bold;">\</span>
    --energyMin 2.5 --energyMax 3.5 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --usePerfectMirror=false <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sourceDistance 10.m <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sourceRadius 2.0.mm 
</pre>
</div>
<p>
[INFO] Writing buffers to binary files.
[INFO] Writing file: out/buffer<sub>2023</sub>-11-12T17:16:36+01:00<sub>type</sub><sub>uint32</sub><sub>len</sub><sub>1440000</sub><sub>width</sub><sub>1200</sub><sub>height</sub><sub>1200.dat</sub>
[INFO] Writing file: out/counts<sub>2023</sub>-11-12T17:16:36+01:00<sub>type</sub><sub>int</sub><sub>len</sub><sub>1440000</sub><sub>width</sub><sub>1200</sub><sub>height</sub><sub>1200.dat</sub>
[INFO] Writing file: out/image<sub>sensor</sub><sub>0</sub><sub>2023</sub>-11-12T17:16:36+01:00_<sub>dx</sub><sub>14.0</sub><sub>dy</sub><sub>14.0</sub><sub>dz</sub><sub>0.1</sub><sub>type</sub><sub>float</sub><sub>len</sub><sub>1000000</sub><sub>width</sub><sub>1000</sub><sub>height</sub><sub>1000.dat</sub>
</p>

<p>
Note the lack of <code>--sourceOnOpticalAxis</code>, which puts the source behind
in at the center of the magnet bore instead of the optical axis.
</p>


<div class="org-src-container">
<pre class="src src-sh">./plotBinary <span style="color: #E6DB74; font-weight: bold;">\</span>
    --dtype float <span style="color: #E6DB74; font-weight: bold;">\</span>
    -f out/image_sensor_0_2023-11-12T17:16:36+01:00__dx_14.0_dy_14.0_dz_0.1_type_float_len_1000000_width_1000_height_1000.dat <span style="color: #E6DB74; font-weight: bold;">\</span>
    --invertY <span style="color: #E6DB74; font-weight: bold;">\</span>
    --out ~/phd/Figs/raytracing/xray_finger_10m_2mm_3keV.pdf <span style="color: #E6DB74; font-weight: bold;">\</span>
    --inPixels=false <span style="color: #E6DB74; font-weight: bold;">\</span>
    --title <span style="color: #E6DB74;">&quot;X-ray finger in 10 m distance, 2 mm radius at 2.5-3.5 keV&quot;</span>
</pre>
</div>


<p>
And now using 14.2 m and 3 mm source, which is what is mentioned in
(<a href="./bibliography.html#citeproc_bib_item_123">Jakobsen 2015</a>) under fig. 4.32. While I don&apos;t understand how these
numbers are supposed to make sense, they produce a better image.
</p>

<div class="org-src-container">
<pre class="src src-sh">./raytracer <span style="color: #E6DB74; font-weight: bold;">\</span>
    --width 1200 --speed 10.0 --nJobs 32 --vfov 45 --maxDepth 10 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --llnl --focalPoint <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sourceKind skXrayFinger <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sensorKind sSum <span style="color: #E6DB74; font-weight: bold;">\</span>
    --energyMin 2.5 --energyMax 3.5 <span style="color: #E6DB74; font-weight: bold;">\</span>
    --usePerfectMirror=false <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sourceDistance 14.2.m <span style="color: #E6DB74; font-weight: bold;">\</span>
    --sourceRadius 3.0.mm 
</pre>
</div>
<p>
[INFO] Writing buffers to binary files.
[INFO] Writing file: out/buffer<sub>2023</sub>-11-12T17:21:37+01:00<sub>type</sub><sub>uint32</sub><sub>len</sub><sub>1440000</sub><sub>width</sub><sub>1200</sub><sub>height</sub><sub>1200.dat</sub>
[INFO] Writing file: out/counts<sub>2023</sub>-11-12T17:21:37+01:00<sub>type</sub><sub>int</sub><sub>len</sub><sub>1440000</sub><sub>width</sub><sub>1200</sub><sub>height</sub><sub>1200.dat</sub>
[INFO] Writing file: out/image<sub>sensor</sub><sub>0</sub><sub>2023</sub>-11-12T17:21:37+01:00_<sub>dx</sub><sub>14.0</sub><sub>dy</sub><sub>14.0</sub><sub>dz</sub><sub>0.1</sub><sub>type</sub><sub>float</sub><sub>len</sub><sub>1000000</sub><sub>width</sub><sub>1000</sub><sub>height</sub><sub>1000.dat</sub>
</p>

<div class="org-src-container">
<pre class="src src-sh">./plotBinary <span style="color: #E6DB74; font-weight: bold;">\</span>
    --dtype float <span style="color: #E6DB74; font-weight: bold;">\</span>
    -f out/image_sensor_0_2023-11-12T17:21:37+01:00__dx_14.0_dy_14.0_dz_0.1_type_float_len_1000000_width_1000_height_1000.dat <span style="color: #E6DB74; font-weight: bold;">\</span>
    --invertY <span style="color: #E6DB74; font-weight: bold;">\</span>
    --out ~/phd/Figs/raytracing/xray_finger_14.2m_3mm_3keV.pdf <span style="color: #E6DB74; font-weight: bold;">\</span>
    --inPixels=false <span style="color: #E6DB74; font-weight: bold;">\</span>
    --title <span style="color: #E6DB74;">&quot;X-ray finger in 14.2 m distance, 3 mm radius at 2.5-3.5 keV&quot;</span>
</pre>
</div>

<p>
Yielding (10 m)
<img src="./figs/home/basti/phd/Figs/raytracing/xray_finger_10m_2mm_3keV.svg" class="org-svg" alt="xray_finger_10m_2mm_3keV.svg" />
and (14.2 m):
<img src="./figs/home/basti/phd/Figs/raytracing/xray_finger_14.2m_3mm_3keV.svg" class="org-svg" alt="xray_finger_14.2m_3mm_3keV.svg" />
</p>


<p>
<b>I still believe</b> it is a bit weird as to why the 10 m case is
definitely too large. Comparing our result to
<img src="./figs/home/basti/org/Figs/statusAndProgress/rayTracing/raytracing_xray_finger_llnl_jaime_gridpix_size.svg" class="org-svg" alt="raytracing_xray_finger_llnl_jaime_gridpix_size.svg" />
(from
<a href="./../org/Doc/StatusAndProgress.html">./../org/Doc/StatusAndProgress.html</a>)
</p>

<p>
also looks a bit smaller than ours.
</p>

<p>
But well, maybe there is still something wrong, but I think this will
be for someone else to understand. :/
</p>

<p>
In any case, comparing the 14.2 m simulation to our real data:
<img src="./figs/home/basti/phd/Figs/CAST_Alignment/xray_finger_centers_run_189.svg" class="org-svg" alt="xray_finger_centers_run_189.svg" />
shows a near perfect match! So all in all this is a success!
</p>
</div>
</div>


<div class="outline-3" id="outline-container-orgc4745d9">
<h3 id="orgc4745d9"><span class="section-number-3">37.6.</span> Figure error development notes   <span class="tag">  <span class="extended">extended</span></span></h3>
<div class="outline-text-3" id="text-37-6">
<p>
For my development notes taken when I fixed the implementation to what
it is now in the above, see
<a href="./../org/Doc/StatusAndProgress.html">./../org/Doc/StatusAndProgress.html</a>.
</p>
</div>
</div>
</div>

<div id="footnotes"><h2 class="footnotes">Footnotes: </h2><div class="footdef"><sup>  <a role="doc-backlink" class="footnum" id="fn.1" href="#fnr.1">1</a></sup> <div role="doc-footnote" class="footpara">  <p class="footpara">
The history of raytracing goes back much further than its
application to computer graphics, though.
</p></div></div>

<div class="footdef"><sup>  <a role="doc-backlink" class="footnum" id="fn.2" href="#fnr.2">2</a></sup> <div role="doc-footnote" class="footpara">  <p class="footpara">
The first feature length movie entirely rendered using
path tracing was <i>Monster House</i> (2006).
</p></div></div>

<div class="footdef"><sup>  <a role="doc-backlink" class="footnum" id="fn.3" href="#fnr.3">3</a></sup> <div role="doc-footnote" class="footpara">  <p class="footpara">
There were of course previous experiments in interactive
real time raytracing.
</p></div></div>

<div class="footdef"><sup>  <a role="doc-backlink" class="footnum" id="fn.4" href="#fnr.4">4</a></sup> <div role="doc-footnote" class="footpara">  <p class="footpara">
By &apos;hardcoded&apos; in this context I mean that the scene
geometry is entirely embedded in imperative code. Each reflection is
calculated manually. Thus, the raytracer is not generic.
</p></div></div>

<div class="footdef"><sup>  <a role="doc-backlink" class="footnum" id="fn.5" href="#fnr.5">5</a></sup> <div role="doc-footnote" class="footpara">  <p class="footpara">
The nice thing about the first book is that it
can literally be implemented in a single weekend!
</p></div></div>

<div class="footdef"><sup>  <a role="doc-backlink" class="footnum" id="fn.6" href="#fnr.6">6</a></sup> <div role="doc-footnote" class="footpara">  <p class="footpara">
Some people may just be better at judging which
efforts are worth it, than I am, haha! On a serious note, given her
other obligations and this not being an urgent problem, we did not
pursue it at the time.
</p></div></div>

<div class="footdef"><sup>  <a role="doc-backlink" class="footnum" id="fn.7" href="#fnr.7">7</a></sup> <div role="doc-footnote" class="footpara">  <p class="footpara">
At least that is my understanding. There are two public
X-ray raytracing packages I am aware of, <code>McXtrace</code> (<a href="#citeproc_bib_item_134">Knudsen et al. 2013</a>) and
<code>MT_RAYOR</code> (<a href="#citeproc_bib_item_199">Schmidt 2022a</a>). There is a chance <code>MT_RAYOR</code> may have been
used, because it is written in an interpreted programming language,
&apos;Yorick&apos; (<a href="#citeproc_bib_item_239">“Yorick - Interpreted Programming Language,” n.d.</a>), developed at LLNL. And it was used for NuSTAR
raytracing simulations in the past (<a href="#citeproc_bib_item_54">Brejnholt 2012</a>).
</p></div></div>

<div class="footdef"><sup>  <a role="doc-backlink" class="footnum" id="fn.8" href="#fnr.8">8</a></sup> <div role="doc-footnote" class="footpara">  <p class="footpara">
You may wonder why there is nothing shielding the
image sensor from direct illumination by the Sun. The reason is that
the X-rays emitted from the Sun are only sampled into the entrance of
the magnet bore. This way we save compute and do not need a mask to
shield the sensor. 
</p></div></div>

<div class="footdef"><sup>  <a role="doc-backlink" class="footnum" id="fn.9" href="#fnr.9">9</a></sup> <div role="doc-footnote" class="footpara">  <p class="footpara">
By &apos;opening end&apos; I talk about the side of a truncated
cone with the larger radius. For an ice cream cone it would simply be
the radius at the top.
</p></div></div>

<div class="footdef"><sup>  <a role="doc-backlink" class="footnum" id="fn.10" href="#fnr.10">10</a></sup> <div role="doc-footnote" class="footpara">  <p class="footpara">
An alternative, equivalent description replaces the
angle by the minimum radii of the coni.
</p></div></div>

<div class="footdef"><sup>  <a role="doc-backlink" class="footnum" id="fn.11" href="#fnr.11">11</a></sup> <div role="doc-footnote" class="footpara">  <p class="footpara">
Anders&apos; thesis contains numbers for a telescope
design with a focal length of \(\SI{1530}{mm}\) instead of
\(\SI{1500}{mm}\), possibly due to a typo in a form of the Wolter
equation. The paper contains schematics with factually wrong
annotations and more wrong (or outdated?) numbers.
</p></div></div>

<div class="footdef"><sup>  <a role="doc-backlink" class="footnum" id="fn.12" href="#fnr.12">12</a></sup> <div role="doc-footnote" class="footpara">  <p class="footpara">
Let me be very clear: by no means I am trying to demean
Anders work! These things happen. It is just a shame to not have any
public, accurate information about the telescope. In particular the
paper (<a href="#citeproc_bib_item_28">Aznar et al. 2015</a>) should have received an errata.
</p></div></div>

<div class="footdef"><sup>  <a role="doc-backlink" class="footnum" id="fn.13" href="#fnr.13">13</a></sup> <div role="doc-footnote" class="footpara">  <p class="footpara">
I mention the exact dates, because if you have access to
the indico page of all the CAST collaboration meetings, this should
make it easy to find the slides.
</p></div></div>

<div class="footdef"><sup>  <a role="doc-backlink" class="footnum" id="fn.14" href="#fnr.14">14</a></sup> <div role="doc-footnote" class="footpara">  <p class="footpara">
The differences on the order of \(\SI{1}{mm}\) are very
small. I haven&apos;t implemented an optimization routine to find the
absolute smallest value precisely. This is by eye.
</p></div></div>

<div class="footdef"><sup>  <a role="doc-backlink" class="footnum" id="fn.15" href="#fnr.15">15</a></sup> <div role="doc-footnote" class="footpara">  <p class="footpara">
I don&apos;t show a screenshot of the scene, because the
source is obviously tiny and far away. The telescope and sensor are
the same as in the CAST scene shown earlier. The CAST magnet bore is
not included.
</p></div></div>

<div class="footdef"><sup>  <a role="doc-backlink" class="footnum" id="fn.16" href="#fnr.16">16</a></sup> <div role="doc-footnote" class="footpara">  <p class="footpara">
To be precise the <code>NLOPT_GN_DIRECT_L</code> algorithm of the
NLopt (<a href="#citeproc_bib_item_125">Johnson 2007</a>) library, an implementation of the locally biased
&apos;DIviding RECTangles&apos; algorithm
(<a href="#citeproc_bib_item_126">Jones, Perttunen, and Stuckman 1993</a>; <a href="#citeproc_bib_item_89">Gablonsky and Kelley 2001</a>). The algorithm performs a
hyperrectangle search of the bounded parameter space. Note that many
other algorithms would work fine too, but we want a global search
algorithm, as there are possibly different local minima in how the
parameters are chosen. Derivative-free is an advantage, as each
iteration is expensive, having to run the entire raytracer to
accumulate enough statistics (\(\mathcal{O}(\SI{10}{s})\)).
</p></div></div>

<div class="footdef"><sup>  <a role="doc-backlink" class="footnum" id="fn.17" href="#fnr.17">17</a></sup> <div role="doc-footnote" class="footpara">  <p class="footpara">
Batch mode just refers to only running the X-ray
raytracer without interactivity, graphical interface or the visible
light raytracer running.
</p></div></div>

<div class="footdef"><sup>  <a role="doc-backlink" class="footnum" id="fn.18" href="#fnr.18">18</a></sup> <div role="doc-footnote" class="footpara">  <p class="footpara">
Let alone the fact that we only got access to these
raytracing results mid 2023, but our raytracing work started years
before that.
</p></div></div>

<div class="footdef"><sup>  <a role="doc-backlink" class="footnum" id="fn.19" href="#fnr.19">19</a></sup> <div role="doc-footnote" class="footpara">  <p class="footpara">
The axion-photon conversion probability is handled in
the limit code.
</p></div></div>

<div class="footdef"><sup>  <a role="doc-backlink" class="footnum" id="fn.20" href="#fnr.20">20</a></sup> <div role="doc-footnote" class="footpara">  <p class="footpara">
This was the average distance to the Sun during our CAST
data taking campaign, as discussed in
sec. <a href="#sec:limit:ingredients:solar_axion_flux">13.10.2</a>.
</p></div></div>

</div>
<div class="hint-message">Click on any heading marked '<span class="extended">extended</span>' to open it</div>
</div>
</body>
</html>
