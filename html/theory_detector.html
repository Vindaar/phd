<!DOCTYPE html>
<html lang="en">
<head>
<!--  2024-06-19 Wed 12:01  -->
<meta charset="utf-8" />
<meta content="width=device-width, initial-scale=1" name="viewport" />
<title>‎</title>
<meta content="Vindaar" name="author" />
<meta content="Org Mode" name="generator" />

<link type="text/css" rel="stylesheet" href="org_html_export.css" />
<script type="text/javascript">

document.addEventListener('DOMContentLoaded', function() {
    // Set the initial width for subfigures and their images
    document.querySelectorAll('figure.subfigure[data-width]').forEach(function(subfigure) {
        subfigure.style.width = subfigure.getAttribute('data-width');
    });

    document.querySelectorAll('figure.subfigure img[data-width]').forEach(function(img) {
        img.style.width = img.getAttribute('data-width');
    });

    // Event listener for images within subfigures
    document.querySelectorAll('figure.subfigure img[data-width]').forEach(function(img) {
        img.addEventListener('click', function() {
            // Determine the .figure-wrapper that contains the clicked image
            let wrapper = this.closest('.figure-wrapper');

            // If found, adjust the sizes of its subfigures
            if (wrapper) {
                let subfigures = wrapper.querySelectorAll('figure.subfigure');
                subfigures.forEach(subfigure => {
                    let width = parseFloat(subfigure.getAttribute('data-width'));
                    if (width < 50) { // Double size if less than 50%
                        subfigure.setAttribute('data-width', (width * 2) + '%');
                        subfigure.style.width = (width * 2) + '%';
                    } else { // Halve size otherwise
                        subfigure.setAttribute('data-width', (width / 2) + '%');
                        subfigure.style.width = (width / 2) + '%';
                    }
                });
            }
        });
    });
});

document.addEventListener('DOMContentLoaded', function () {
    var headers = document.querySelectorAll('h1 .extended, h2 .extended, h3 .extended, h4 .extended, h5 .extended, h6 .extended');

    headers.forEach(function (header) {
        var foldableHeader = header.closest('h1, h2, h3, h4, h5, h6');
        if (foldableHeader) {
            foldableHeader.classList.add('foldable-header');
            var nextElement = foldableHeader.nextElementSibling;
            var contentToFold = [];
            while (nextElement && !nextElement.matches('h1, h2, h3, h4, h5, h6')) {
                contentToFold.push(nextElement);
                nextElement = nextElement.nextElementSibling;
            }
            contentToFold.forEach(function (element) {
                element.classList.add('folded-content');
            });

            foldableHeader.addEventListener('click', function () {
                contentToFold.forEach(function (element) {
                    if (element.style.display === 'none' || element.style.display == '') {
                        element.style.display = 'block';
                    } else {
                        element.style.display = 'none';
                    }
                });
            });
        }
    });
});

</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript"></script>
<script type="text/x-mathjax-config">
<!-- /* --><![CDATA[/*><!--*/
    MathJax.Hub.Config({
        jax: ["input/TeX", "output/HTML-CSS"],
        extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js",
                     "TeX/noUndefined.js", "[Contrib]/siunitx/siunitx.js", "[Contrib]/mhchem/mhchem.js"],
        tex2jax: {
            inlineMath: [ ["\\(","\\)"], ['$', '$'], ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"], ["\\begin{displaymath}","\\end{displaymath}"] ],
            skipTags: ["script","noscript","style","textarea","pre","code"],
            ignoreClass: "tex2jax_ignore",
            processEscapes: false,
            processEnvironments: true,
            preview: "TeX"
        },
        showProcessingMessages: true,
        displayAlign: "center",
        displayIndent: "2em",

        "HTML-CSS": {
             scale: 1.0,
             availableFonts: ["STIX","TeX"],
             preferredFont: "TeX",
             webFont: "TeX",
             imageFont: "TeX",
             showMathMenu: true,
        },
        MMLorHTML: {
             prefer: {
                 MSIE:    "MML",
                 Firefox: "MML",
                 Opera:   "HTML",
                 other:   "HTML"
             }
        },
        TeX: {
              equationNumbers: { autoNumber: 'AMS' },
              Macros: {
                  ccsini: '{\\mathrm{Si}₃\\mathrm{N}₄}',
                  cefe: '{\\ce{^{55}Fe}}',
                  vektor: ['{\\begin{pmatrix}#1\\end{pmatrix}}', 1],
                  mtrix: ['{\\begin{pmatrix}#1\\end{pmatrix}}', 1],
                  cp: '{\\mathrm{CP}}',
                  cpt: '{\\mathrm{CPT}}',
                  dd: '{\\mathop{}\\!{\\mathrm{d}}}',
                  sinc: '{\\mathrm{sinc}}'
              }
        }
    });
/*]]>*///--&gt;
</script>
</head>
<body>
<div id="content" class="content">
<nav role="doc-toc" id="table-of-contents">
<h2>Table of Contents</h2>
<div role="doc-toc" id="text-table-of-contents">
<ul>
<li>  <a href="./errata.html#sec:errata">1. Errata   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./introduction.html#sec:introduction">2. Introduction   <span class="tag">    <span class="Intro">Intro</span>  </span></a></li>
<li><a href="./about_thesis.html#sec:about_thesis">3. About this thesis   <span class="tag">  <span class="Intro">Intro</span></span></a>
<ul>
<li>  <a href="./about_thesis.html#orgcc5a826">3.1. Extended notes for the extended thesis <code>[/]</code>   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./about_thesis.html#org6bb3d01">3.2. Why Org mode   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./about_thesis.html#org5c64f4e">3.3. Notes for future PhD students and IAXO analyses   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li><a href="./theory.html#sec:theory">4. Theory of axions   <span class="tag">  <span class="Theory">Theory</span></span></a>
<ul>
<li>  <a href="./theory.html#sec:theory:useful_reading_material">4.1. Useful reading material   <span class="tag">    <span class="optional">optional</span>  </span></a></li>
<li>  <a href="./theory.html#sec:theory:illustration_cpt">4.2. Illustration of the \cpt symmetry <code>[/]</code>   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./theory.html#sec:theory:invisible_axion_models">4.3. Invisible axion models and axion couplings</a></li>
<li>  <a href="./theory.html#sec:theory:axion_interactions">4.4. Implications for axion interactions - conversion probability</a></li>
<li>  <a href="./theory.html#sec:theory:solar_axion_flux">4.5. Solar axion flux</a></li>
<li>  <a href="./theory.html#sec:theory:chameleon">4.6. Chameleons</a></li>
<li>  <a href="./theory.html#sec:theory:current_bounds">4.7. Current bounds on coupling constants</a></li>
</ul>
</li>
<li><a href="./helioscopes.html#sec:helioscopes">5. Axion helioscopes   <span class="tag">  <span class="Theory">Theory</span></span></a>
<ul>
<li>  <a href="./helioscopes.html#sec:helioscopes:cast">5.1. CERN Axion Solar Telescope (CAST)</a></li>
<li>  <a href="./helioscopes.html#sec:helioscopes:iaxo">5.2. International AXion Observatory (IAXO)</a></li>
</ul>
</li>
<li><a href="./theory_detector.html#sec:theory_detector">6. X-rays, cosmic muons and gaseous detectors   <span class="tag">  <span class="Theory">Theory</span></span></a>
<ul>
<li>  <a href="./theory_detector.html#sec:theory:particle_int">6.1. Particle interactions with matter</a></li>
<li>  <a href="./theory_detector.html#sec:theory:cosmic_radiation">6.2. Cosmic rays</a></li>
<li>  <a href="./theory_detector.html#sec:theory:gas_fundamentals">6.3. Gaseous detector fundamentals</a></li>
</ul>
</li>
<li><a href="./septemboard.html#sec:septemboard">7. Septemboard detector   <span class="tag">  <span class="Detector">Detector</span></span></a>
<ul>
<li>  <a href="./septemboard.html#sec:detector:micromegas">7.1. Micromegas working principle</a></li>
<li>  <a href="./septemboard.html#sec:detector:timepix">7.2. Timepix ASIC</a></li>
<li>  <a href="./septemboard.html#sec:detector:gridpix">7.3. GridPix</a></li>
<li>  <a href="./septemboard.html#sec:detector:detector_2014_15">7.4. 2014 / 2015 GridPix detector for CAST</a></li>
<li>  <a href="./septemboard.html#sec:detector:detector_overview">7.5. Septemboard detector overview</a></li>
<li>  <a href="./septemboard.html#orgb47d68b">7.6. Detector readout system</a></li>
<li>  <a href="./septemboard.html#sec:detector:scintillators">7.7. Scintillator vetoes</a></li>
<li>  <a href="./septemboard.html#sec:detector:fadc">7.8. FADC</a></li>
<li>  <a href="./septemboard.html#sec:detector:sin_window">7.9. SiN window</a></li>
<li>  <a href="./septemboard.html#sec:detector:septemboard">7.10. Septemboard - 6 GridPixes around a center one</a></li>
<li>  <a href="./septemboard.html#sec:detector:water_cooling">7.11. Water cooling and temperature readout for the septemboard</a></li>
<li>  <a href="./septemboard.html#sec:septem:efficiency">7.12. Detector efficiency</a></li>
<li>  <a href="./septemboard.html#sec:detector:daq">7.13. Data acquisition and detector monitoring</a></li>
</ul>
</li>
<li><a href="./operation_calibration.html#sec:operation_calibration">8. Detector calibration for operation   <span class="tag">  <span class="Detector">Detector</span></span></a>
<ul>
<li>  <a href="./operation_calibration.html#sec:operation_calibration:timepix">8.1. Timepix calibrations</a></li>
<li>  <a href="./operation_calibration.html#sec:operation_calibration:fadc">8.2. FADC calibration</a></li>
<li>  <a href="./operation_calibration.html#sec:operation_calibration:scintillators">8.3. Scintillator calibration</a></li>
</ul>
</li>
<li><a href="./reconstruction.html#sec:reconstruction">9. Data reconstruction   <span class="tag">  <span class="Reconstruction">Reconstruction</span></span></a>
<ul>
<li>  <a href="./reconstruction.html#sec:reco:tpa">9.1. <code>TimepixAnalysis</code> and Nim</a></li>
<li>  <a href="./reconstruction.html#sec:reco:tos_data_parsing">9.2. TOS data parsing</a></li>
<li>  <a href="./reconstruction.html#sec:reco:event_shape">9.3. Expectation of event shapes</a></li>
<li>  <a href="./reconstruction.html#sec:reco:data_reconstruction">9.4. Data reconstruction</a></li>
<li>  <a href="./reconstruction.html#sec:reco:fadc_data">9.5. FADC reconstruction</a></li>
<li>  <a href="./reconstruction.html#sec:reco:scintillator_data">9.6. Scintillator data</a></li>
</ul>
</li>
<li><a href="./cast.html#sec:cast">10. Detector installation &amp; data taking at CAST   <span class="tag">  <span class="CAST">CAST</span></span></a>
<ul>
<li>  <a href="./cast.html#sec:cast:timeline">10.1. Timeline</a></li>
<li>  <a href="./cast.html#sec:cast:alignment">10.2. Alignment</a></li>
<li>  <a href="./cast.html#sec:cast:detector_setup">10.3. Detector setup at CAST</a></li>
<li>  <a href="./cast.html#sec:cast:window_accident">10.4. Window accident</a></li>
<li>  <a href="./cast.html#sec:cast:data_taking_woes">10.5. Data taking woes</a></li>
<li>  <a href="./cast.html#sec:cast:data_taking_campaigns">10.6. Summary of CAST data taking</a></li>
</ul>
</li>
<li><a href="./calibration.html#sec:calibration">11. Data calibration   <span class="tag">  <span class="Calibration">Calibration</span></span></a>
<ul>
<li>  <a href="./calibration.html#sec:calibration:energy">11.1. Energy calibration - in principle</a></li>
<li>  <a href="./calibration.html#sec:calib:detector_behavior_over_time">11.2. Detector behavior over time</a></li>
<li>  <a href="./calibration.html#sec:calib:final_energy_calibration">11.3. Energy calibration dependence on the gas gain</a></li>
<li>  <a href="./calibration.html#sec:calib:fadc">11.4. FADC</a></li>
</ul>
</li>
<li><a href="./background.html#sec:background">12. Finding signal and defining background | Background rate computation   <span class="tag">  <span class="Analysis">Analysis</span></span></a>
<ul>
<li>  <a href="./background.html#sec:background:likelihood_method">12.1. Likelihood method</a></li>
<li>  <a href="./background.html#sec:cdl">12.2. CAST Detector Lab</a></li>
<li>  <a href="./background.html#sec:background:likelihood_cut">12.3. Application of likelihood cut for background rate</a></li>
<li>  <a href="./background.html#sec:background:mlp">12.4. Artificial neural networks as cluster classifiers</a></li>
<li>  <a href="./background.html#sec:background:additional_vetoes">12.5. Additional detector features as vetoes</a></li>
<li>  <a href="./background.html#sec:background:all_vetoes_combined">12.6. Background rates of combined vetoes and efficiencies</a></li>
</ul>
</li>
<li><a href="./limit.html#sec:limit">13. Limit calculation   <span class="tag">  <span class="Limit">Limit</span></span></a>
<ul>
<li>  <a href="./limit.html#sec:limit:method_introduction">13.1. Limit method - introduction</a></li>
<li>  <a href="./limit.html#sec:limit:method_likelihood">13.2. Limit method - likelihood function \(\mathcal{L}\)</a></li>
<li>  <a href="./limit.html#sec:limit:method_computing_L">13.3. Limit method - computing \(\mathcal{L}\)</a></li>
<li>  <a href="./limit.html#sec:limit:method_computing_a_limit">13.4. Limit method - computing a limit</a></li>
<li>  <a href="./limit.html#sec:limit:method_expected_limit">13.5. Limit method - toy candidate sets and expected limits</a></li>
<li>  <a href="./limit.html#sec:limit:method_systematics">13.6. Limit method - extending \(\mathcal{L}\) for systematics</a></li>
<li>  <a href="./limit.html#sec:limit:method_mcmc">13.7. Limit method - evaluating \(\mathcal{L}\) with nuisance parameters</a></li>
<li>  <a href="./limit.html#orgc9cf5b1">13.8. Note about likelihood integral   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./limit.html#org632b2b1">13.9. Derivation of short form of \(\mathcal{L}\) <code>[/]</code>   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./limit.html#sec:limit:ingredients">13.10. Likelihood ingredients in detail</a></li>
<li>  <a href="./limit.html#sec:limit:systematics">13.11. Systematics</a></li>
<li>  <a href="./limit.html#sec:limit:mcmc_calc_limit">13.12. MCMC to sample the distribution and compute a limit</a></li>
<li>  <a href="./limit.html#sec:limit:expected_limits">13.13. Expected limits of different setups</a></li>
<li>  <a href="./limit.html#sec:limit:candidates">13.14. Solar tracking candidates</a></li>
<li>  <a href="./limit.html#sec:limit:observed_limit">13.15. Observed limit - \(g_{ae}\)</a></li>
<li>  <a href="./limit.html#sec:limit:other_couplings">13.16. Other coupling constants</a></li>
<li>  <a href="./limit.html#org590d25a">13.17. Comparison to 2013 limit (using their method)   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./limit.html#org828d95d">13.18. Observed limit for different axion masses   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li>  <a href="./outlook.html#sec:outlook">14. Outlook</a></li>
<li>  <a href="./summary.html#sec:summary">15. Summary &amp; conclusion</a></li>
<li>  <a href="./bibliography.html#sec:bibliography">16. Bibliography   <span class="tag">    <span class="html">html</span>  </span></a></li>
<li><a href="./daq.html#sec:daq">17. Data acquisition and detector monitoring   <span class="tag"><span class="Appendix">Appendix</span> <span class="Detector">Detector</span></span></a>
<ul>
<li>  <a href="./daq.html#sec:daq:tof">17.1. Timepix Operating Firmware - TOF</a></li>
<li>  <a href="./daq.html#sec:daq:tos">17.2. Timepix Operating Software - TOS</a></li>
<li>  <a href="./daq.html#sec:daq:septemboard_event_display">17.3. Septemboard event display</a></li>
</ul>
</li>
<li><a href="./configuration.html#sec:appendix:configuration">18. Configuration and TOS / TOF versions   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./configuration.html#sec:appendix:configuration:tos_config">18.1. TOS configuration file</a></li>
<li>  <a href="./configuration.html#sec:appendix:configuration:tos_tof_versions">18.2. TOS and TOF versions used at CAST</a></li>
</ul>
</li>
<li><a href="./calibration.html#sec:appendix:calibration">19. Calibrations   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./calibration.html#sec:appendix:calibration:timepix">19.1. Timepix calibrations</a></li>
<li>  <a href="./calibration.html#sec:appendix:septemboard_calibrations">19.2. Septemboard calibration</a></li>
<li>  <a href="./calibration.html#sec:appendix:scintillator_calibration_notes">19.3. Calibration measurements of the veto scintillator paddle   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li><a href="./cast_operations.html#sec:appendix:cast_operations">20. CAST operation procedures   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./cast_operations.html#sec:appendix:cast_operations:terminology">20.1. CAST terminology</a></li>
<li>  <a href="./cast_operations.html#sec:cast:high_voltage">20.2. High voltage supply</a></li>
<li>  <a href="./cast_operations.html#sec:cast:vacuum_system">20.3. Vacuum system</a></li>
<li>  <a href="./cast_operations.html#sec:cast:watercooling_gas">20.4. Watercooling system &amp; gas supply</a></li>
<li>  <a href="./cast_operations.html#sec:cast:interlock_systems">20.5. Interlock systems</a></li>
<li>  <a href="./cast_operations.html#sec:appendix:cast_log_files">20.6. CAST log files</a></li>
</ul>
</li>
<li><a href="./cast_run_list.html#sec:appendix:cast_run_list">21. CAST data taking run list   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./cast_run_list.html#org2592d2e">21.1. Full version   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li><a href="./cast_data_taking_notes.html#sec:appendix:cast_data_taking_notes">22. CAST data taking notes <code>[0/1]</code>   <span class="tag"><span class="Appendix">Appendix</span> <span class="extended">extended</span></span></a>
<ul>
<li>  <a href="./cast_data_taking_notes.html#org7528aaa">22.1. Run table</a></li>
<li>  <a href="./cast_data_taking_notes.html#org5e2f4f6">22.2. Data runs</a></li>
<li>  <a href="./cast_data_taking_notes.html#orgd35ca85">22.3. Calibration runs</a></li>
<li>  <a href="./cast_data_taking_notes.html#org8d05ac6">22.4. Automatically generated run list</a></li>
<li>  <a href="./cast_data_taking_notes.html#org44b9f29">22.5. Automatically calculated total run times</a></li>
<li>  <a href="./cast_data_taking_notes.html#orgb749477">22.6. InGrid temperature from shift forms</a></li>
</ul>
</li>
<li><a href="./cabling_and_softwar_setup.html#sec:appendix:cabling_and_softwar_setup">23. Cabling &amp; software setup <code>[/]</code>   <span class="tag"><span class="Appendix">Appendix</span> <span class="extended">extended</span></span></a>
<ul>
<li>  <a href="./cabling_and_softwar_setup.html#orgfadf61a">23.1. Virtex V6 cabling</a></li>
<li>  <a href="./cabling_and_softwar_setup.html#orge6068cd">23.2. Detector cabling</a></li>
<li>  <a href="./cabling_and_softwar_setup.html#orgf8388c3">23.3. Vivado / ISE on void linux &amp; flashing Virtex V6</a></li>
<li>  <a href="./cabling_and_softwar_setup.html#org33b1740">23.4. Setting up the chips in TOS</a></li>
</ul>
</li>
<li><a href="./vacuum_contamination.html#sec:appendix:vacuum_contamination">24. Window rupture and vacuum contamination   <span class="tag"><span class="Appendix">Appendix</span> <span class="extended">extended</span></span></a>
<ul>
<li>  <a href="./vacuum_contamination.html#org6860b71">24.1. Calculation of vacuum volume</a></li>
<li>  <a href="./vacuum_contamination.html#orgb699e1f">24.2. Calculation of potential influx of gas</a></li>
<li>  <a href="./vacuum_contamination.html#org5a010b5">24.3. Consider pumping of pumps</a></li>
<li>  <a href="./vacuum_contamination.html#org2d474fa">24.4. Calculation of possible contamination</a></li>
</ul>
</li>
<li><a href="./detector_time_behavior.html#sec:appendix:detector_time_behavior">25. Detector behavior over time   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./detector_time_behavior.html#sec:appendix:choice_gas_gain_binning">25.1. Choice of gas gain binning time interval</a></li>
<li>  <a href="./detector_time_behavior.html#sec:appendix:correlation_gas_gain_ambient_temp">25.2. Correlation of gas gain and ambient CAST temperature</a></li>
</ul>
</li>
<li><a href="./cast_detector_lab.html#sec:appendix:cast_detector_lab">26. CAST Detector Lab data   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./cast_detector_lab.html#orgb3fb613">26.1. Generate all spectrum plots split by run   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./cast_detector_lab.html#sec:appendix:cdl_spectra_by_run">26.2. All spectra split by run</a></li>
<li>  <a href="./cast_detector_lab.html#sec:appendix:cdl:all_spectra_fits">26.3. All CDL spectra with line fits   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./cast_detector_lab.html#sec:appendix:cdl:all_spectra_fits_by_run">26.4. All CDL spectra with line fits by run</a></li>
</ul>
</li>
<li><a href="./fit_by_run_justification.html#sec:appendix:fit_by_run_justification">27. CAST Detector Lab variations and fitting by run   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./fit_by_run_justification.html#sec:appendix:fit_by_run:gas_gain_var_cluster_prop">27.1. Influence of gas gain variations on cluster properties</a></li>
</ul>
</li>
<li><a href="./morphing_cdl_spectra.html#sec:appendix:morphing_cdl_spectra">28. Morphing of CDL reference spectra   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./morphing_cdl_spectra.html#orgf6bac68">28.1. Generate all morphing / tile related plots   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./morphing_cdl_spectra.html#org87b76a1">28.2. Generate plot comparing likelihood behavior   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./morphing_cdl_spectra.html#sec:appendix:morphing_cdl_spectra:tilemaps">28.3. Tilemap of each likelihood dataset</a></li>
<li>  <a href="./morphing_cdl_spectra.html#sec:appendix:morphing_cdl_spectra:interpolation_raster">28.4. Interpolation of each likelihood dataset</a></li>
<li>  <a href="./morphing_cdl_spectra.html#sec:appendix:morphing_cdl_spectra:binwise_linear">28.5. Binwise linear interpolations for each likelihood dataset</a></li>
<li>  <a href="./morphing_cdl_spectra.html#org6333e1a">28.6. Notes on CDL morphing development   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li><a href="./occupancy.html#sec:appendix:occupancy">29. Occupancy maps   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./occupancy.html#org09d9790">29.1. Run-2</a></li>
<li>  <a href="./occupancy.html#org14d6465">29.2. Run-3</a></li>
<li>  <a href="./occupancy.html#orgb0e50b1">29.3. Generate occupancy map plots   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li><a href="./fadc.html#sec:appendix:fadc">30. FADC   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./fadc.html#sec:appendix:fadc:rise_fall">30.1. FADC rise and fall time</a></li>
<li>  <a href="./fadc.html#sec:appendix:background:fadc">30.2. FADC veto</a></li>
<li>  <a href="./fadc.html#orgacfd0c0">30.3. Generate plot of rise time vs skewness   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./fadc.html#sec:appendix:fadc_veto_empirical_cluster_length">30.4. Expected cluster size</a></li>
</ul>
</li>
<li><a href="./background_rates.html#sec:appendix:background_rates">31. Raw data and background rates   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./background_rates.html#sec:appendix:background_rates:full_chip">31.1. Background rates over full chip</a></li>
<li>  <a href="./background_rates.html#org6a9ffb9">31.2. Generate rate without any vetoes over full chip   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./background_rates.html#org6b8af44">31.3. Generate background rates over full chip   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./background_rates.html#org3c65b09">31.4. Generate table of background rates for all setups   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li>  <a href="./background_interpolation_chip_area.html#sec:appendix:background_interpolation_chip_area">32. Background interpolation chip cutout correction   <span class="tag">    <span class="Appendix">Appendix</span>  </span></a></li>
<li><a href="./limit_additional.html#sec:appendix:limit_additional">33. Additional limit information   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./limit_additional.html#sec:appendix:conversion_probability">33.1. Conversion probability as a function of mass   <span class="tag">    <span class="Appendix">Appendix</span>  </span></a></li>
<li>  <a href="./limit_additional.html#sec:appendix:exp_limit_percentiles">33.2. Expected limit table with percentiles</a></li>
<li>  <a href="./limit_additional.html#sec:appendix:limit_additional:axion_photon">33.3. Observed limit - axion photon \(g_{aγ}\)</a></li>
<li>  <a href="./limit_additional.html#sec:appendix:limit_additional:chameleon">33.4. Observed limit - chameleon \(β_γ\)</a></li>
</ul>
</li>
<li><a href="./software.html#sec:appendix:software">34. Software   <span class="tag"><span class="Software">Software</span> <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./software.html#org436bedd">34.1. Why did I start writing my own analysis framework?   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./software.html#org86f63ec">34.2. Nim   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./software.html#sec:appendix:timepix_analysis">34.3. TimepixAnalysis</a></li>
<li>  <a href="./software.html#org8803ffa">34.4. Other libraries relevant for TimepixAnalysis</a></li>
</ul>
</li>
<li><a href="./full_data_reconstruction.html#sec:appendix:full_data_reconstruction">35. Full data reconstruction   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./full_data_reconstruction.html#orgdcf5166">35.1. Raw data parsing and reconstruction</a></li>
<li>  <a href="./full_data_reconstruction.html#orgb8d4b95">35.2. Parse and reconstruct the CDL data</a></li>
<li>  <a href="./full_data_reconstruction.html#orgf215b40">35.3. Add tracking information to background files</a></li>
<li>  <a href="./full_data_reconstruction.html#orgd02ba6b">35.4. Using <code>runAnalysisChain</code></a></li>
<li>  <a href="./full_data_reconstruction.html#orgeb8cb90">35.5. Applying a classifier</a></li>
<li>  <a href="./full_data_reconstruction.html#org4877c84">35.6. Computing limits</a></li>
</ul>
</li>
<li><a href="./average_depth_xrays_argon.html#sec:appendix:average_depth_xrays_argon">36. Average distance X-rays travel in argon at CAST conditions   <span class="tag">  <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./average_depth_xrays_argon.html#org154d979">36.1. Reference to original document   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./average_depth_xrays_argon.html#orgbcac2c8">36.2. Calculate conversion point numerically</a></li>
<li>  <a href="./average_depth_xrays_argon.html#org14e6f71">36.3. Compiling and running the code   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li><a href="./raytracing.html#sec:appendix:raytracing">37. Raytracing   <span class="tag"><span class="Software">Software</span> <span class="Appendix">Appendix</span></span></a>
<ul>
<li>  <a href="./raytracing.html#sec:appendix:raytracing:traxer">37.1. TrAXer - An interactive axion raytracer</a></li>
<li>  <a href="./raytracing.html#sec:appendix:raytracing:llnl_telescope">37.2. A few more details about the LLNL telescope</a></li>
<li>  <a href="./raytracing.html#sec:appendix:raytracing:panter">37.3. Comparison of TrAXer results with PANTER measurements</a></li>
<li>  <a href="./raytracing.html#sec:appendix:raytracing:axion_image">37.4. Computing an axion image with TrAXer</a></li>
<li>  <a href="./raytracing.html#org4d72781">37.5. Reproducing an X-ray finger run with TrAXer   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
<li>  <a href="./raytracing.html#orgcf3cd15">37.6. Figure error development notes   <span class="tag">    <span class="extended">extended</span>  </span></a></li>
</ul>
</li>
<li>  <a href="./acknowledgments.html#sec:appendix:acknowledgments">38. Acknowledgments   <span class="tag">    <span class="Ack">Ack</span>  </span></a></li>
</ul>
</div>
</nav>
<div class="outline-2" id="outline-container-sec:theory_detector">
<h2 id="sec:theory_detector"><span class="section-number-2">6.</span> X-rays, cosmic muons and gaseous detectors   <span class="tag">  <span class="Theory">Theory</span></span></h2>
<div class="outline-text-2" id="text-sec:theory_detector">
<p>
As we have seen in the previous two chapters, solar axions should
produce photons in the soft X-ray energy range. In experiments like CAST,
gaseous detectors – like the one used in this thesis – are therefore
a common and suitable choice for the detection of the X-rays focused
by the X-ray optics. In order to give a guiding reference for the
relevant physics associated with the detection of particles at CAST,
we will now cover each aspect that we make use of in explanations or
calculations. The focus will be on aspects either not commonly
discussed (for example depth graded multilayers for X-ray telescopes)
or essential for explanation (gas diffusion).
</p>

<p>
We start with a section on particle interactions with matter,
sec. <a href="./theory_detector.html#sec:theory:particle_int">6.1</a>, where we discuss X-ray interactions as
well as charged particles in gases. Next in
sec. <a href="./theory_detector.html#sec:theory:cosmic_radiation">6.2</a> follows a short section about cosmic
radiation, in particular the expected muon flux as it serves as a
dominant source of background in experiments like CAST. Finally, in
sec. <a href="./theory_detector.html#sec:theory:gas_fundamentals">6.3</a> we cover concepts of gaseous
detector physics that we depend on.
</p>
</div>

<div class="outline-3" id="outline-container-sec:theory:particle_int">
<h3 id="sec:theory:particle_int"><span class="section-number-3">6.1.</span> Particle interactions with matter</h3>
<div class="outline-text-3" id="text-sec:theory:particle_int">
<p>
On the one hand we will discuss how X-rays interact with matter. Both
in terms of solids as well as gases, focused on their attenuation,
because this is required to describe signal attenuation due to – for
example – a detector window of a gaseous detector or the absorption
of X-rays in the detector gas. In addition, X-ray reflectivity will be
discussed as it is of interest for the behavior of X-ray
telescopes. On the other hand the interaction of highly energetic
charged particles with matter will be discussed and its relation to
cosmic radiation as a source of background. Finally, X-ray
fluorescence will be covered as well. As a source of background in an
axion helioscope experiment it is indistinguishable <sup>  <a role="doc-backlink" class="footref" id="fnr.1" href="#fn.1">1</a></sup> from
axion-induced X-rays.
</p>

<p>
For a detailed overview of the interaction of X-rays with matter, see the X-ray data
booklet (<a href="./bibliography.html#citeproc_bib_item_235">Williams 2001</a>).
</p>
</div>

<div class="outline-4" id="outline-container-sec:theory:xray_matter_gas">
<h4 id="sec:theory:xray_matter_gas"><span class="section-number-4">6.1.1.</span> X-rays in solid matter &amp; gases</h4>
<div class="outline-text-4" id="text-sec:theory:xray_matter_gas">
<p>
Lambert-Beer&apos;s law (<a href="./bibliography.html#citeproc_bib_item_50">Bouguer 1729</a>; <a href="./bibliography.html#citeproc_bib_item_141">Lambert 1760</a>; <a href="./bibliography.html#citeproc_bib_item_39">Beer 1852</a>)
</p>

\begin{equation}
\label{eq:theory:beer_lambert_law}
I(z) = I_0 e^{-μz},
\end{equation}

<p>
gives the intensity of radiation \(I(z)\) after traversing through a
medium with constant attenuation \(μ\) of length \(z\), given a starting
intensity of \(I_0\). Directly related is of course the absorption
length \(l_{\text{abs}} = 1/μ\) (or mean free path), which is a useful
property when considering typical absorption depths.
</p>

<p>
This law is of vital importance for the behavior of X-rays traversing
through matter, which is needed to compute the efficiency of a gaseous
detector with an entrance window. In addition, it is also related to
the mean free path of X-rays in a gas, which is an important parameter
in gaseous detectors to understand the absorption efficiency of X-rays
at different energies and the resulting expected diffusion.
</p>

<p>
In the context of X-rays the factor \(μ\) is typically rewritten via the
&apos;mass attenuation coefficient&apos; \(μ_m = μ · ρ\) with \(ρ\) the density of
the material, commonly in \(\si{g.cm^{-3}}\). \(μ_m\) is then defined by
</p>

<p>
\[
μ_m = \frac{N_A}{M} σ_A,
\]
</p>

<p>
where \(N_A\) is Avogadro&apos;s number, \(M\) the molar mass of the medium in
units of \(\si{g\per\mol}\) and \(σ_A\) is the photoabsorption cross section
in units of \(\si{cm^2}\). Thus, the mass attenuation coefficient is
usually given in \(\si{cm^2.g^{-1}}\) such that \(μ = μ_m · ρ\) is of inverse length
as expected. This directly yields the definition of the absorption
length,
</p>

<p>
\[
l_{\text{abs}} = \frac{1}{μ}.
\]
</p>

<p>
Further, the photoabsorption cross section can be described via the
atomic scattering factor \(f₂\)
</p>

<p>
\[
σ_A = 2 r_e λ f₂,
\]
</p>

<p>
where \(r_e\) is the classical electron radius and \(λ\) the wavelength of
the X-ray. \(f₂\) is the imaginary part of the forward scattering factor
\(f\)
</p>

<p>
\[
f = f₁ - i f₂
\]
</p>

<p>
which itself is the simplification of the general atomic scattering
factor that describes the atom specific part of the scattering cross
section.
</p>

<p>
This way of expressing it has the nice property of relying on a well
tabulated parameter \(f₂\). Together with \(f₁\) these tabulated values
can be used to compute everything from the refractive index at a
specific X-ray energy of a compound to the attenuation coefficient and
even reflectivity of a multi-layer substrate. It generalizes from
single element to compounds easily by
</p>

<p>
\[
μ_m = \frac{N_A}{M_c} \sum_i n_i σ_{A,i},
\]
</p>

<p>
with \(M_c\) the molar weight of the compound and \(n_i\) the number of
atoms of kind \(i\). X-ray absorption and transmission properties can be
calculated from this only requiring the atomic scattering factors,
which can be found tabulated for different elements, for example by
<a href="https://www.nist.gov/pml/x-ray-form-factor-attenuation-and-scattering-tables">NIST</a> and <a href="https://henke.lbl.gov/optical_constants/asf.html">Henke</a>.
</p>

<p>
There is an online calculator for calculations of X-ray transmission
found under <sup>  <a role="doc-backlink" class="footref" id="fnr.2" href="#fn.2">2</a></sup> (<a href="./bibliography.html#citeproc_bib_item_107">Henke, Gullikson, and Davis 1993</a>), as well as a library
implementation developed during the course of this thesis
under <sup>  <a role="doc-backlink" class="footref" id="fnr.3" href="#fn.3">3</a></sup> (<a href="./bibliography.html#citeproc_bib_item_203">Schmidt and SciNim contributors 2022</a>)
for this purpose. 
</p>

<p>
Fig. <a href="#fig:theory:transmission_examples">1</a> shows an example of X-ray
transmission through a \(\SI{300}{nm}\) thick layer of \ccsini as well
as transmission through \(\SI{3}{cm}\) of argon at normal temperature and
pressure (NTP), \(\SI{1}{atm}\), \(\SI{20}{°C}\). All information about
the absorption lines and general transmission is encoded in \(f₂\). 
</p>


<figure id="fig:theory:transmission_examples">
<img src="./figs/home/basti/phd/Figs/theory/transmission_example.svg" class="org-svg" alt="transmission_example.svg" />

<figcaption>Figure 1: <span class="figure-number">Figure 8: </span>X-ray transmission through a \SI{300}{nm} thick layer of \ccsini and \SI{3}{cm} of argon calculated with <a href="Schmidt_xrayAttenuation_2022">Schmidt_xrayAttenuation_2022</a>. Calculation of the transmission based on tabulated scattering form factors.</figcaption>
</figure>
</div>

<div class="outline-5" id="outline-container-orgbf8ea3b">
<h5 id="orgbf8ea3b"><span class="section-number-5">6.1.1.1.</span> Absorption length of Argon   <span class="tag">  <span class="extended">extended</span></span></h5>
<div class="outline-text-5" id="text-6-1-1-1">
<p>
Fig. <a href="#fig:theory:absorption_length_argon">3</a> also shows the absorption
length for argon at NTP.
</p>


<figure id="fig:theory:absorption_length_argon">
<img src="./figs/home/basti/phd/Figs/theory/absorption_length_example.svg" class="org-svg" alt="absorption_length_example.svg" />

<figcaption>Figure 3: <span class="figure-number">Figure 9: </span>Absorption length of \SI{3}{cm} of argon calculated with <a href="Schmidt_xrayAttenuation_2022">Schmidt_xrayAttenuation_2022</a>. Calculation based on tabulated scattering form factors.</figcaption>
</figure>
</div>
</div>

<div class="outline-5" id="outline-container-sec:theory:generate_transmission_plot">
<h5 id="sec:theory:generate_transmission_plot"><span class="section-number-5">6.1.1.2.</span> Generation of \ccsini transmission figure   <span class="tag">  <span class="extended">extended</span></span></h5>
<div class="outline-text-5" id="text-sec:theory:generate_transmission_plot">
<p>
Let&apos;s compute an example transmission plot using the Lambert-Beer law
as presented above based on <code>xrayAttenuation</code> now, on the one hand for
\ccsini as well as argon (common detector gas).
</p>

<p>
<b>TODO</b>: update ginger to use <code>-output-directory</code> to put the plot in
the right path &amp; turn it into a TikZ plot.
</p>

<div class="org-src-container">
<pre class="src src-nim"><span style="color: #F92672;">import</span> std / strutils
<span style="color: #F92672;">import</span> xrayAttenuation, ggplotnim
<span style="color: #75715E;"># </span><span style="color: #75715E;">generate a compound of silicon and nitrogen with correct number of atoms</span>
<span style="color: #F92672;">let</span> <span style="color: #FD971F;">Si</span>₃N₄ = compound<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">(</span><span style="color: #66D9EF;">Si</span>, <span style="font-style: italic;">3</span><span style="color: #66D9EF;">)</span>, <span style="color: #66D9EF;">(</span><span style="color: #66D9EF;">N</span>, <span style="font-style: italic;">4</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">instantiate an Argon instance</span>
<span style="color: #F92672;">let</span> <span style="color: #FD971F;">ar </span>= <span style="color: #66D9EF;">Argon</span>.init<span style="color: #AE81FF;">()</span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">compute the density using ideal gas law at 1 atm</span>
<span style="color: #F92672;">let</span> <span style="color: #FD971F;">ρ_Ar </span>= density<span style="color: #AE81FF;">(</span><span style="font-style: italic;">1013</span>.<span style="font-style: italic;">25</span>.mbar.to<span style="color: #66D9EF;">(</span><span style="color: #66D9EF;">Pascal</span><span style="color: #66D9EF;">)</span>, <span style="font-style: italic;">293</span>.<span style="font-style: italic;">15</span>.<span style="color: #66D9EF;">K</span>, ar.molarMass<span style="color: #AE81FF;">)</span>

<span style="color: #75715E;"># </span><span style="color: #75715E;">define energies in which to compute the transmission</span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">(we don&apos;t start at 0, as at 0 energy the parameters are not well defined)</span>
<span style="color: #F92672;">let</span> <span style="color: #FD971F;">energies </span>= linspace<span style="color: #AE81FF;">(</span>1e-<span style="font-style: italic;">2</span>, <span style="font-style: italic;">10</span>.<span style="font-style: italic;">0</span>, <span style="font-style: italic;">1000</span><span style="color: #AE81FF;">)</span>
<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">compTrans</span><span style="color: #AE81FF;">[</span><span style="color: #66D9EF;">T</span>: <span style="color: #66D9EF;">AnyCompound</span><span style="color: #AE81FF;">](</span>el: <span style="color: #66D9EF;">T</span>, ρ: g•cm⁻³, length: <span style="color: #66D9EF;">Meter</span><span style="color: #AE81FF;">)</span>: <span style="color: #66D9EF;">DataFrame</span> =
  <span style="color: #FD971F;">result</span> = toDf<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">{</span> <span style="color: #E6DB74;">&quot;Energy [keV]&quot;</span> : energies <span style="color: #66D9EF;">}</span><span style="color: #AE81FF;">)</span>
    .mutate<span style="color: #AE81FF;">(</span>f<span style="color: #66D9EF;">{</span><span style="color: #66D9EF;">float</span>: <span style="color: #E6DB74;">&quot;μ&quot;</span> ~ el.attenuationCoefficient<span style="color: #A6E22E;">(</span>idx<span style="color: #E6DB74;">(</span><span style="color: #E6DB74;">&quot;Energy [keV]&quot;</span><span style="color: #E6DB74;">)</span>.keV<span style="color: #A6E22E;">)</span>.<span style="color: #66D9EF;">float</span><span style="color: #66D9EF;">}</span>,
            f<span style="color: #66D9EF;">{</span><span style="color: #66D9EF;">float</span>: <span style="color: #E6DB74;">&quot;Trans&quot;</span> ~ transmission<span style="color: #A6E22E;">(</span>`μ`.cm²•g⁻¹, ρ, length<span style="color: #A6E22E;">)</span>.<span style="color: #66D9EF;">float</span><span style="color: #66D9EF;">}</span>,
            f<span style="color: #66D9EF;">{</span><span style="color: #66D9EF;">float</span>: <span style="color: #E6DB74;">&quot;l_abs&quot;</span> ~ absorptionLength<span style="color: #A6E22E;">(</span>el, ρ, idx<span style="color: #E6DB74;">(</span><span style="color: #E6DB74;">&quot;Energy [keV]&quot;</span><span style="color: #E6DB74;">)</span>.keV<span style="color: #A6E22E;">)</span>.to<span style="color: #A6E22E;">(</span>cm<span style="color: #A6E22E;">)</span>.<span style="color: #66D9EF;">float</span><span style="color: #66D9EF;">}</span>,
            f<span style="color: #66D9EF;">{</span><span style="color: #E6DB74;">&quot;Compound&quot;</span> &lt;- el.name<span style="color: #66D9EF;">}</span><span style="color: #AE81FF;">)</span>
<span style="color: #F92672;">var</span> <span style="color: #FD971F;">df </span>= newDataFrame<span style="color: #AE81FF;">()</span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">compute transmission for Si₃N₄ (known density and desired length)</span>
df.<span style="color: #F92672;">add</span> Si₃N₄.compTrans<span style="color: #AE81FF;">(</span><span style="font-style: italic;">3</span>.<span style="font-style: italic;">44</span>.g•cm⁻³, <span style="font-style: italic;">300</span>.nm.to<span style="color: #66D9EF;">(</span><span style="color: #66D9EF;">Meter</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">and for argon </span>
df.<span style="color: #F92672;">add</span> ar.compTrans<span style="color: #AE81FF;">(</span>ρ_Ar, <span style="font-style: italic;">3</span>.cm.to<span style="color: #66D9EF;">(</span><span style="color: #66D9EF;">Meter</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">create a plot for the transmissions</span>
<span style="color: #F92672;">echo</span> df
<span style="color: #F92672;">let</span> <span style="color: #FD971F;">dS </span>= pretty<span style="color: #AE81FF;">(</span><span style="font-style: italic;">300</span>.nm, <span style="font-style: italic;">3</span>, short = <span style="color: #AE81FF;">true</span><span style="color: #AE81FF;">)</span>
<span style="color: #F92672;">let</span> <span style="color: #FD971F;">dA </span>= pretty<span style="color: #AE81FF;">(</span><span style="font-style: italic;">3</span>.cm, <span style="font-style: italic;">1</span>, short = <span style="color: #AE81FF;">true</span><span style="color: #AE81FF;">)</span>
<span style="color: #F92672;">let</span> <span style="color: #FD971F;">si </span>= r<span style="color: #E6DB74;">&quot;$\mathrm{Si}₃\mathrm{N}₄$&quot;</span>
ggplot<span style="color: #AE81FF;">(</span>df, aes<span style="color: #66D9EF;">(</span><span style="color: #E6DB74;">&quot;Energy [keV]&quot;</span>, <span style="color: #E6DB74;">&quot;Trans&quot;</span>, color = <span style="color: #E6DB74;">&quot;Compound&quot;</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span> +
  geom_line<span style="color: #AE81FF;">()</span> +
  xlab<span style="color: #AE81FF;">(</span>r<span style="color: #E6DB74;">&quot;Energy [$\si{keV}$]&quot;</span><span style="color: #AE81FF;">)</span> + ylab<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;Transmission&quot;</span><span style="color: #AE81FF;">)</span> +
  ggtitle<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;Transmission examples of </span><span style="color: #F92672;">$#</span><span style="color: #E6DB74;"> </span><span style="color: #F92672;">$#</span><span style="color: #E6DB74;"> and </span><span style="color: #F92672;">$#</span><span style="color: #E6DB74;"> Argon at NTP&quot;</span> % <span style="color: #66D9EF;">[</span>dS, si, dA<span style="color: #66D9EF;">]</span><span style="color: #AE81FF;">)</span> +
  themeLatex<span style="color: #AE81FF;">(</span>fWidth = <span style="font-style: italic;">0</span>.<span style="font-style: italic;">9</span>, width = <span style="font-style: italic;">600</span>, baseTheme = singlePlot<span style="color: #AE81FF;">)</span> +
  ggsave<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;/home/basti/phd/Figs/theory/transmission_example.pdf&quot;</span>,
         useTex = <span style="color: #AE81FF;">true</span>, standalone = <span style="color: #AE81FF;">true</span>, width = <span style="font-style: italic;">600</span>, height = <span style="font-style: italic;">360</span><span style="color: #AE81FF;">)</span>

<span style="color: #F92672;">let</span> <span style="color: #FD971F;">dff </span>= df.filter<span style="color: #AE81FF;">(</span>f<span style="color: #66D9EF;">{</span><span style="color: #66D9EF;">float</span> -&gt; <span style="color: #66D9EF;">bool</span>: classify<span style="color: #A6E22E;">(</span>`l_abs`<span style="color: #A6E22E;">)</span> != fcInf<span style="color: #66D9EF;">}</span>,
                    f<span style="color: #66D9EF;">{</span>`<span style="color: #66D9EF;">Compound</span>` == <span style="color: #E6DB74;">&quot;Argon&quot;</span><span style="color: #66D9EF;">}</span><span style="color: #AE81FF;">)</span>
<span style="color: #F92672;">echo</span> dff
ggplot<span style="color: #AE81FF;">(</span>dff, aes<span style="color: #66D9EF;">(</span><span style="color: #E6DB74;">&quot;Energy [keV]&quot;</span>, <span style="color: #E6DB74;">&quot;l_abs&quot;</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span> +
  geom_line<span style="color: #AE81FF;">()</span> +
  xlab<span style="color: #AE81FF;">(</span>r<span style="color: #E6DB74;">&quot;Energy [$\si{keV}$]&quot;</span><span style="color: #AE81FF;">)</span> + ylab<span style="color: #AE81FF;">(</span>r<span style="color: #E6DB74;">&quot;Absorption length [$\si{cm}$]&quot;</span><span style="color: #AE81FF;">)</span> +
  ggtitle<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;Absorption length of </span><span style="color: #F92672;">$#</span><span style="color: #E6DB74;"> Argon at NTP&quot;</span> % <span style="color: #66D9EF;">[</span>dA<span style="color: #66D9EF;">]</span><span style="color: #AE81FF;">)</span> +
  themeLatex<span style="color: #AE81FF;">(</span>fWidth = <span style="font-style: italic;">0</span>.<span style="font-style: italic;">9</span>, width = <span style="font-style: italic;">600</span>, baseTheme = singlePlot<span style="color: #AE81FF;">)</span> +  
  ggsave<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;/home/basti/phd/Figs/theory/absorption_length_example.pdf&quot;</span>,
         useTex = <span style="color: #AE81FF;">true</span>, standalone = <span style="color: #AE81FF;">true</span>, width = <span style="font-style: italic;">600</span>, height = <span style="font-style: italic;">360</span><span style="color: #AE81FF;">)</span>
  
</pre>
</div>


<p>
The absorption length of pure argon at NTP is seen in
fig. <a href="#fig:theory:absorption_length_argon">3</a>.
</p>


<figure id="fig:theory:absorption_length_argon">
<img src="./figs/home/basti/phd/Figs/theory/absorption_length_example.svg" class="org-svg" alt="absorption_length_example.svg" />

<figcaption>Figure 3: <span class="figure-number">Figure 10: </span>Absorption length of argon at NTP. The absorption edge and long absorption length around the Kα line is clearly visible showing the reason for the escape peak in the \cefe spectrum.</figcaption>
</figure>
</div>
</div>
</div>

<div class="outline-4" id="outline-container-sec:theory:xray_reflectivity">
<h4 id="sec:theory:xray_reflectivity"><span class="section-number-4">6.1.2.</span> X-ray reflectivity &amp; scattering</h4>
<div class="outline-text-4" id="text-sec:theory:xray_reflectivity">
<p>
The same atomic scattering factors \(f₁\) and \(f₂\) introduced in section
<a href="./theory_detector.html#sec:theory:xray_matter_gas">6.1.1</a> for the attenuation can also be used to
compute the reflectivity of X-rays under shallow angles. A great
overview of the relevant physics for X-ray reflectivity is found in
(<a href="./bibliography.html#citeproc_bib_item_236">Windt 1998</a>), which introduces the <code>IMD</code> program for the
simulation of multilayer coatings for X-rays.
</p>

<p>
By defining the combined scattering factor
</p>

<p>
\[
f(E) = f₁(E) + i f₂(E)
\]
</p>

<p>
at energy \(E\), the refractive index \(n\) of a medium can be computed using
</p>

<p>
\[
n(E) = 1 - r_e \frac{λ²}{2π} \sum_i n_{ai} f_i(E)
\]
</p>

<p>
where \(n_{ai}\) is the number density of the \(i\text{-th}\) compound of the
medium. By expressing the refractive index for X-rays in this fashion,
reflectivity can be expressed using the Fresnel equations, just like
for visible light. The reflectivity for s-polarization is calculated
by
</p>
\begin{equation}
\label{eq:theory:fresnell_reflectance_s}
r^s_{ik} = \frac{n_i · \cos(θ_i) - n_k · \cos(θ_k)}{n_i · \cos(θ_i) + n_k · \cos(θ_k)}
\end{equation}
<p>
while for p-polarization it is done via
</p>
\begin{equation}
\label{eq:theory:fresnell_reflectance_p}
r^p_{ik} = \frac{n_i · \cos(θ_k) - n_k · \cos(θ_i)}{n_i · \cos(θ_k) + n_k · \cos(θ_i)}.
\end{equation}

<p>
Here \(θ_i\), \(θ_k\) are the incident and refracted angles and \(n_i\), \(n_k\) the
refractive indices on the incident and outgoing
side \(i\) and \(k\), respectively.
</p>

<p>
The total reflected energy, the reflectance \(R\), is expressed as
</p>

<p>
\[
R = \frac{1}{2}\left( \left|r^s\right|² + \left|r^p\right|²\right)
\]
</p>

<p>
for unpolarized light. This can be generalized to multiple layers of
material on a substrate and including a surface roughness. Combined,
these provide the essence for a realistic computation of the
efficiency of an X-ray telescope mirror shell. 
</p>

<p>
This is also implemented in <sup>  <a role="doc-backlink" class="footref" id="fnr.3" href="#fn.3">3</a></sup>
(<a href="./bibliography.html#citeproc_bib_item_203">Schmidt and SciNim contributors 2022</a>) and <sup>  <a role="doc-backlink" class="footref" id="fnr.2" href="#fn.2">2</a></sup>
(<a href="./bibliography.html#citeproc_bib_item_107">Henke, Gullikson, and Davis 1993</a>) also provides an online calculator for such
reflectivities.
</p>

<dl class="org-dl">
<dt>Depth graded multilayers</dt><dd><p>
One particular kind of surface, the
depth graded multilayer, is used in certain kinds of modern X-ray
telescopes, for example the LLNL telescope at CAST following the
NuSTAR design. In such a multilayer, repeating layers of a low atomic
number \(Z\) material and a high \(Z\) material are stacked at
decreasing thicknesses.
</p>

<p>
A depth-graded multilayer is described by the equation:
\[
  d_i = \frac{a}{(b + i)^c}
  \]
where \(d_i\) is the depth of layer \(i\) (out of \(N\) layers),
\[
  a = d_{\text{min}} (b + N)^c
  \]
and
\[
  b = \frac{1 - N k}{k - 1}
  \]
with
\[
  k = \left(\frac{d_{\text{min}}}{d_{\text{max}}}\right)^{\frac{1}{c}}
  \]
where \(d_{\text{min}}\) and \(d_{\text{max}}\) are the thickness of the
bottom and top most layers, respectively.
</p>

<p>
For example for the the LLNL telescope a Pt/C depth graded
multilayer is used, in which a top layer of carbon is stacked on top
of a platinum layer. Between 2 to 5 repetitions of decreasing
thickness are stacked with a ratio of \(\SIrange{40}{45}{\%}\) carbon
to platinum in thickness. More details on this will be discussed in
appendix <a href="./raytracing.html#sec:appendix:raytracing">37</a>, as it is of vital importance to
calculate the axion image required for the limit calculation
correctly.
</p>

<p>
The reflectivity for a depth-graded multilayer is computed
recursively from the bottom of the stack to the top layer using
</p>

<p>
\[
  r_i = \frac{r_{ik} + r_k \exp(2 i β_i)}{1 + r_{ik} r_k \exp(2 i β_i)}
  \]
</p>

<p>
with
</p>

<p>
\[
  β_i = 2π · d_i · \frac{\cos(θ_i)}{λ},
  \]
</p>

<p>
where \(θ_i\) as seen from the normal axis and with the wavelength of
the incoming X-rays \(λ\). The \(r_{ik}\) values are computed following
equations \eqref{eq:theory:fresnell_reflectance_s} and
\eqref{eq:theory:fresnell_reflectance_p}. Such multilayers work by summing
the reflecting contributions from the different layer
transitions. Different thicknesses of the different multilayers mean
X-rays at different energies and angles are best reflected from
different layers. Thus, a much improved overall reflectivity over a
wider energy and angle range can be achieved compared to a normal
single layer on a substrate (e.g. a gold coating as used for the
XMM-Newton or ABRIXAS optics).
</p></dd>
</dl>
</div>
</div>



<div class="outline-4" id="outline-container-sec:theory:bethe_bloch">
<h4 id="sec:theory:bethe_bloch"><span class="section-number-4">6.1.3.</span> Bethe-Bloch equation</h4>
<div class="outline-text-4" id="text-sec:theory:bethe_bloch">
<p>
Another relevant aspect for gaseous detectors is the energy deposition
of charged particles. In particular for experiments that sit near
Earth&apos;s surface, a major source of background is due to cosmic
radiation, with cosmic muons making up more than \(\SI{95}{\%}\)
(<a href="./bibliography.html#citeproc_bib_item_244">Zyla and others 2020</a>) of radiation (aside from neutrinos) at the surface,
see sec. <a href="./theory_detector.html#sec:theory:cosmic_radiation">6.2</a>. 
</p>

<p>
The energy loss of such muons can be calculated with the Bethe-Bloch
equation, which describes the average energy loss per distance for a
charged particle with charge \(z\) in a homogeneous medium with charge
carriers \(Z\). (<a href="./bibliography.html#citeproc_bib_item_244">Zyla and others 2020</a>) <sup>  <a role="doc-backlink" class="footref" id="fnr.4" href="#fn.4">4</a></sup> 
</p>

\begin{equation}
\label{eq:theory:bethe_bloch_eq}
  \left⟨ -\frac{\mathrm{d}E}{\mathrm{d}x} \right⟩ = 
    K z² \frac{Z}{A} \frac{1}{β²} \left[ 
      \frac{1}{2} \ln\frac{2m_e c² β² γ² W_{\text{max}}}{I²} - β² - \frac{δ(βγ)}{2} 
    \right]
\end{equation}
<p>
where the different variables are as follows:
</p>
<ul class="org-ul">
<li>\(K = 4π N_A r_e² m_e c² = \SI{0.307075}{MeV.mol^{-1}.cm^2}\)</li>
<li>\(W_{\text{max}}\): maximum possible energy transfer to an electron in
a single interaction</li>
<li>\(I\): mean excitation energy of the absorber material in \si{\eV}</li>
<li>\(δ(βγ)\): density-effect correction to energy loss</li>
<li>and \(r_e = \frac{e²}{4π ε_0 m_e c²}\) the classical electron radius,
\(N_A\) Avogadro&apos;s number, \(m_e\) electron mass, \(c\) speed of light
in vacuum, \(z\) charge number of incident particle, \(Z\) atomic number
of absorber material, \(A\) atomic mass of absorber material, \(β =
  v/c\) speed of incident particle, \(γ\) Lorentz factor</li>
</ul>

<p>
This interaction behavior of muons leads to a specific, expected
energy loss per distance. Commonly they are &apos;minimum ionizing
particles&apos; (MIPs), as their energies lies between
\(\SIrange{0.1}{100}{GeV}\), the large &apos;valley&apos; in which the Bethe
equation is applicable <sup>  <a role="doc-backlink" class="footref" id="fnr.5" href="#fn.5">5</a></sup>. For argon gas at normal
conditions this is shown in fig. <a href="#fig:theory:muon_argon_3cm_bethe_loss">4</a>.
</p>

<p>
As the Bethe formula was derived from quantum mechanical perturbation
theory, higher order corrections can be computed. For our purposes
here the leading order is enough. It is important to keep in mind that
the Bethe-Bloch equation gives the <i>mean energy</i> per distance. When
considering short distances as typically encountered in particle
detectors, this mean is skewed by rare interactions that deposit large
amounts of energy (towards \(W_{\text{max}}\)). The energy deposition
along short distances is typically described by a Landau-Vavilov
distribution (similar, but different from a normal Landau
distribution) (<a href="./bibliography.html#citeproc_bib_item_244">Zyla and others 2020</a>; <a href="./bibliography.html#citeproc_bib_item_46">Bichsel 2006</a>). The most probable
energy loss is often a more appropriate number to look at. It can be
expressed as
</p>

\begin{equation}
\label{eq:theory:most_probable_loss}
Δ_p = ξ \left[ \ln{ \frac{2 m_e c² β² γ²}{I}} + \ln{\frac{ξ}{I}} + j - β² - δ(βγ) \right],
\end{equation}

<p>
where \(ξ\) is
</p>

<p>
\[
ξ = \frac{1}{2} K z² \left⟨ \frac{Z}{A} \right⟩ \frac{x}{β²} \, \si{MeV},
\]
</p>

<p>
for a detector in which the material column the particle travels
through is expressed as \(x = d · ρ\) of a distance \(d\) in
\(\si{g.cm^{-2}}\). \(j = \num{0.200}\) is an empirical constant
(<a href="./bibliography.html#citeproc_bib_item_244">Zyla and others 2020</a>; <a href="./bibliography.html#citeproc_bib_item_45">Bichsel 1988</a>). Further, \(⟨Z / A⟩\) is simply
the average \(Z/A\) for a material compound \(⟨Z/A⟩ = \sum_i w_i Z_i / A_i\).
</p>

<p>
The large difference typically encountered between the most probable
and the mean value for the energy loss in particle detectors, makes
studying the expected signals a complicated topic. For a detailed
description relevant for thin gaseous detectors, see especially
(<a href="./bibliography.html#citeproc_bib_item_46">Bichsel 2006</a>). 
</p>

<p>
Fig. <a href="#fig:theory:muon_argon_3cm_bethe_loss">4</a> shows the comparison of the
most probable energy loss via equation \eqref{eq:theory:most_probable_loss}
and the mean energy loss via the Bethe-Bloch equation
\eqref{eq:theory:bethe_bloch_eq} for muons of different energies traversing
\(\SI{3}{cm}\) of argon gas.
</p>


<figure id="fig:theory:muon_argon_3cm_bethe_loss">
<img src="./figs/home/basti/phd/Figs/muonStudies/ar_energy_loss_cast.svg" class="org-svg" alt="ar_energy_loss_cast.svg" />

<figcaption>Figure 4: <span class="figure-number">Figure 11: </span>Mean energy loss via Bethe-Bloch (purple) equation of muons in \SI{3}{\cm} of argon at conditions in use in GridPix detector at CAST. \SI{1050}{mbar} of chamber pressure at room temperature. Note that the mean is skewed by events that transfer a large amount of energy, but are very rare! As such care must be taken interpreting the numbers. Green shows the most probable energy loss, based on the peak of the Landau-Vavilov distribution underlying the Bethe-Bloch mean value.</figcaption>
</figure>
</div>

<div class="outline-5" id="outline-container-orgaa0fab5">
<h5 id="orgaa0fab5"><span class="section-number-5">6.1.3.1.</span> Bethe equation for muons traversing \(\SI{3}{\cm}\) of argon gas   <span class="tag">  <span class="extended">extended</span></span></h5>
<div class="outline-text-5" id="text-6-1-3-1">
<p>
We will now compute the energy loss for muons traversing the
\SI{3}{\cm} of argon gas that are seen by a muon traversing
orthogonally to the readout plane (i.e. such that it may look like a
photon).
</p>

<div class="org-src-container">
<pre class="src src-nim"><span style="color: #F92672;">import</span> math, macros, unchained, ggplotnim, sequtils, strformat, strutils
<span style="color: #F92672;">import</span> thesisHelpers
<span style="color: #F92672;">import</span> ggplotnim / ggplot_vegatex

<span style="color: #F92672;">let</span> <span style="color: #66D9EF;">K</span> = <span style="font-style: italic;">4</span> * π * <span style="color: #66D9EF;">N_A</span> * r_e^<span style="font-style: italic;">2</span> * m_e * c^<span style="font-style: italic;">2</span> <span style="color: #75715E;"># </span><span style="color: #75715E;">usually in: [MeV mol⁻¹ cm²]</span>

defUnit<span style="color: #AE81FF;">(</span>cm³•g⁻¹<span style="color: #AE81FF;">)</span>
defUnit<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">J</span>•m⁻¹<span style="color: #AE81FF;">)</span>
defUnit<span style="color: #AE81FF;">(</span>cm⁻³<span style="color: #AE81FF;">)</span>
defUnit<span style="color: #AE81FF;">(</span>g•mol⁻¹<span style="color: #AE81FF;">)</span>
defUnit<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">MeV</span>•g⁻¹•cm²<span style="color: #AE81FF;">)</span>
defUnit<span style="color: #AE81FF;">(</span>mol⁻¹<span style="color: #AE81FF;">)</span>
defUnit<span style="color: #AE81FF;">(</span>keV•cm⁻¹<span style="color: #AE81FF;">)</span>
defUnit<span style="color: #AE81FF;">(</span>g•cm⁻³<span style="color: #AE81FF;">)</span>
defUnit<span style="color: #AE81FF;">(</span>g•cm⁻²<span style="color: #AE81FF;">)</span>

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">I</span><span style="color: #AE81FF;">[</span><span style="color: #66D9EF;">T</span><span style="color: #AE81FF;">](</span>z: <span style="color: #66D9EF;">float</span><span style="color: #AE81FF;">)</span>: <span style="color: #66D9EF;">T</span> =
  <span style="color: #E6DB74;">## use Bloch approximation for all but Argon (better use tabulated values!)</span>
  <span style="color: #FD971F;">result</span> = <span style="color: #F92672;">if</span> z == <span style="font-style: italic;">18</span>.<span style="font-style: italic;">0</span>: <span style="font-style: italic;">188</span>.<span style="font-style: italic;">0</span>.eV.to<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">T</span><span style="color: #AE81FF;">)</span> 
           <span style="color: #F92672;">else</span>: <span style="color: #AE81FF;">(</span><span style="font-style: italic;">10</span>.eV * z<span style="color: #AE81FF;">)</span>.to<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">T</span><span style="color: #AE81FF;">)</span>

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">calcβ</span><span style="color: #AE81FF;">(</span>γ: <span style="color: #66D9EF;">UnitLess</span><span style="color: #AE81FF;">)</span>: <span style="color: #66D9EF;">UnitLess</span> =
  <span style="color: #FD971F;">result</span> = sqrt<span style="color: #AE81FF;">(</span><span style="font-style: italic;">1</span>.<span style="font-style: italic;">0</span> - <span style="font-style: italic;">1</span>.<span style="font-style: italic;">0</span> / <span style="color: #66D9EF;">(</span>γ^<span style="font-style: italic;">2</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">betheBloch</span><span style="color: #AE81FF;">(</span>z, <span style="color: #66D9EF;">Z</span>: <span style="color: #66D9EF;">UnitLess</span>, <span style="color: #66D9EF;">A</span>: g•mol⁻¹, γ: <span style="color: #66D9EF;">UnitLess</span>, <span style="color: #66D9EF;">M</span>: kg<span style="color: #AE81FF;">)</span>: <span style="color: #66D9EF;">MeV</span>•g⁻¹•cm² =
  <span style="color: #E6DB74;">## result in MeV cm² g⁻¹ (normalized by density)</span>
  <span style="color: #E6DB74;">## z: charge of particle</span>
  <span style="color: #E6DB74;">## Z: charge of particles making up medium</span>
  <span style="color: #E6DB74;">## A: atomic mass of particles making up medium</span>
  <span style="color: #E6DB74;">## γ: Lorentz factor of particle</span>
  <span style="color: #E6DB74;">## M: mass of particle in MeV (or same mass as `</span><span style="color: #AE81FF;">m_e</span><span style="color: #E6DB74;">` defined as)</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">β </span>= calcβ<span style="color: #AE81FF;">(</span>γ<span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">W_max</span> = <span style="font-style: italic;">2</span> * m_e * c^<span style="font-style: italic;">2</span> * β^<span style="font-style: italic;">2</span> * γ^<span style="font-style: italic;">2</span> / <span style="color: #AE81FF;">(</span><span style="font-style: italic;">1</span> + <span style="font-style: italic;">2</span> * γ * m_e / <span style="color: #66D9EF;">M</span> + <span style="color: #66D9EF;">(</span>m_e / <span style="color: #66D9EF;">M</span><span style="color: #66D9EF;">)</span>^<span style="font-style: italic;">2</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">lnArg </span>= <span style="font-style: italic;">2</span> * m_e * c^<span style="font-style: italic;">2</span> * β^<span style="font-style: italic;">2</span> * γ^<span style="font-style: italic;">2</span> * <span style="color: #66D9EF;">W_max</span> / <span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">I</span><span style="color: #66D9EF;">[</span><span style="color: #66D9EF;">Joule</span><span style="color: #66D9EF;">](</span><span style="color: #66D9EF;">Z</span><span style="color: #66D9EF;">)</span>^<span style="font-style: italic;">2</span><span style="color: #AE81FF;">)</span>
  <span style="color: #FD971F;">result</span> = <span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">K</span> * z^<span style="font-style: italic;">2</span> * <span style="color: #66D9EF;">Z</span> / <span style="color: #66D9EF;">A</span> * <span style="font-style: italic;">1</span>.<span style="font-style: italic;">0</span> / <span style="color: #66D9EF;">(</span>β^<span style="font-style: italic;">2</span><span style="color: #66D9EF;">)</span> * <span style="color: #66D9EF;">(</span>
   <span style="font-style: italic;">0</span>.<span style="font-style: italic;">5</span> * ln<span style="color: #A6E22E;">(</span>lnArg<span style="color: #A6E22E;">)</span> - β^<span style="font-style: italic;">2</span>
  <span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>.to<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">MeV</span>•g⁻¹•cm²<span style="color: #AE81FF;">)</span>

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">mostProbableLoss</span><span style="color: #AE81FF;">(</span>z, <span style="color: #66D9EF;">Z</span>: <span style="color: #66D9EF;">UnitLess</span>, <span style="color: #66D9EF;">A</span>: g•mol⁻¹, γ: <span style="color: #66D9EF;">UnitLess</span>,
                      x: g•cm⁻²<span style="color: #AE81FF;">)</span>: keV =
  <span style="color: #E6DB74;">## Computes the most probable value, corresponding to the peak of the Landau</span>
  <span style="color: #E6DB74;">## distribution, that gives rise to the Bethe-Bloch formula.</span>
  <span style="color: #E6DB74;">##</span>
  <span style="color: #E6DB74;">## Taken from PDG chapter &apos;Passage of particles through matter&apos; equation</span>
  <span style="color: #E6DB74;">## `</span><span style="color: #AE81FF;">34.12</span><span style="color: #E6DB74;">` in &apos;Fluctuations in energy loss&apos;, version 2020).</span>
  <span style="color: #E6DB74;">##</span>
  <span style="color: #E6DB74;">## `</span><span style="color: #AE81FF;">x</span><span style="color: #E6DB74;">` is the &quot;thickness&quot;. Density times length, `</span><span style="color: #AE81FF;">x = ρ * d</span><span style="color: #E6DB74;">`. The other parameters</span>
  <span style="color: #E6DB74;">## are as in `</span><span style="color: #AE81FF;">betheBloch</span><span style="color: #E6DB74;">` above.</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">β </span>= calcβ<span style="color: #AE81FF;">(</span>γ<span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">ξ </span>= <span style="color: #66D9EF;">K</span> / <span style="font-style: italic;">2</span>.<span style="font-style: italic;">0</span> * <span style="color: #66D9EF;">Z</span> / <span style="color: #66D9EF;">A</span> * z*z * <span style="color: #AE81FF;">(</span>x / <span style="color: #66D9EF;">(</span>β*β<span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">const</span> <span style="color: #FD971F;">j </span>= <span style="font-style: italic;">0</span>.<span style="font-style: italic;">200</span>
  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">I</span> = <span style="color: #66D9EF;">I</span><span style="color: #AE81FF;">[</span><span style="color: #66D9EF;">Joule</span><span style="color: #AE81FF;">](</span><span style="color: #66D9EF;">Z</span><span style="color: #AE81FF;">)</span>
  <span style="color: #FD971F;">result</span> = <span style="color: #AE81FF;">(</span>ξ * <span style="color: #66D9EF;">(</span> ln<span style="color: #A6E22E;">(</span><span style="color: #E6DB74;">(</span><span style="font-style: italic;">2</span> * m_e * c^<span style="font-style: italic;">2</span> * β^<span style="font-style: italic;">2</span> * γ^<span style="font-style: italic;">2</span><span style="color: #E6DB74;">)</span>.to<span style="color: #E6DB74;">(</span><span style="color: #66D9EF;">Joule</span><span style="color: #E6DB74;">)</span> / <span style="color: #66D9EF;">I</span><span style="color: #A6E22E;">)</span> + ln<span style="color: #A6E22E;">(</span>ξ.to<span style="color: #E6DB74;">(</span><span style="color: #66D9EF;">Joule</span><span style="color: #E6DB74;">)</span> / <span style="color: #66D9EF;">I</span><span style="color: #A6E22E;">)</span> + j - β^<span style="font-style: italic;">2</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>.to<span style="color: #AE81FF;">(</span>keV<span style="color: #AE81FF;">)</span> <span style="color: #75715E;"># </span><span style="color: #75715E;">- δ*(β*γ)</span>

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">density</span><span style="color: #AE81FF;">(</span>p: mbar, <span style="color: #66D9EF;">M</span>: g•mol⁻¹, temp: <span style="color: #66D9EF;">Kelvin</span><span style="color: #AE81FF;">)</span>: g•cm⁻³ =
  <span style="color: #E6DB74;">## returns the density of the gas for the given pressure.</span>
  <span style="color: #E6DB74;">## The pressure is assumed in `</span><span style="color: #AE81FF;">mbar</span><span style="color: #E6DB74;">` and the temperature (in `</span><span style="color: #AE81FF;">K</span><span style="color: #E6DB74;">`).</span>
  <span style="color: #E6DB74;">## The default temperature corresponds to BabyIAXO aim.</span>
  <span style="color: #E6DB74;">## Returns the density in `</span><span style="color: #AE81FF;">g / cm^3</span><span style="color: #E6DB74;">`</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">gasConstant </span>= <span style="font-style: italic;">8</span>.<span style="font-style: italic;">314</span>.<span style="color: #66D9EF;">J</span>•K⁻¹•mol⁻¹ <span style="color: #75715E;"># </span><span style="color: #75715E;">joule K^-1 mol^-1</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">pressure </span>= p.to<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">Pa</span><span style="color: #AE81FF;">)</span> <span style="color: #75715E;"># </span><span style="color: #75715E;">pressure in Pa</span>
  <span style="color: #FD971F;">result</span> = <span style="color: #AE81FF;">(</span>pressure * <span style="color: #66D9EF;">M</span> / <span style="color: #66D9EF;">(</span>gasConstant * temp<span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>.to<span style="color: #AE81FF;">(</span>g•cm⁻³<span style="color: #AE81FF;">)</span>

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">E_to_γ</span><span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">E</span>: <span style="color: #66D9EF;">GeV</span><span style="color: #AE81FF;">)</span>: <span style="color: #66D9EF;">UnitLess</span> =
  <span style="color: #FD971F;">result</span> = <span style="color: #66D9EF;">E</span>.to<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">Joule</span><span style="color: #AE81FF;">)</span> / <span style="color: #AE81FF;">(</span>m_μ * c^<span style="font-style: italic;">2</span><span style="color: #AE81FF;">)</span> + <span style="font-style: italic;">1</span>

<span style="color: #F92672;">type</span>
  <span style="color: #66D9EF;">Element</span> = <span style="color: #F92672;">object</span>
    name: <span style="color: #66D9EF;">string</span>
    <span style="color: #66D9EF;">Z</span>: <span style="color: #66D9EF;">UnitLess</span>
    <span style="color: #66D9EF;">M</span>: g•mol⁻¹
    <span style="color: #66D9EF;">A</span>: <span style="color: #66D9EF;">UnitLess</span> <span style="color: #75715E;"># </span><span style="color: #75715E;">numerically same as `</span><span style="color: #AE81FF;">M</span><span style="color: #75715E;">`</span>
    ρ: g•cm⁻³

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">initElement</span><span style="color: #AE81FF;">(</span>name: <span style="color: #66D9EF;">string</span>, <span style="color: #66D9EF;">Z</span>: <span style="color: #66D9EF;">UnitLess</span>, <span style="color: #66D9EF;">M</span>: g•mol⁻¹, ρ: g•cm⁻³<span style="color: #AE81FF;">)</span>: <span style="color: #66D9EF;">Element</span> =
  <span style="color: #66D9EF;">Element</span><span style="color: #AE81FF;">(</span>name: name, <span style="color: #66D9EF;">Z</span>: <span style="color: #66D9EF;">Z</span>, <span style="color: #66D9EF;">M</span>: <span style="color: #66D9EF;">M</span>, <span style="color: #66D9EF;">A</span>: <span style="color: #66D9EF;">M</span>.<span style="color: #66D9EF;">UnitLess</span>, ρ: ρ<span style="color: #AE81FF;">)</span>

<span style="color: #F92672;">let</span> <span style="color: #66D9EF;">M_Ar</span> = <span style="font-style: italic;">39</span>.<span style="font-style: italic;">95</span>.g•mol⁻¹ <span style="color: #75715E;"># </span><span style="color: #75715E;">molar mass. Numerically same as relative atomic mass</span>
<span style="color: #75715E;">#</span><span style="color: #75715E;">let ρAr = density(1050.mbar, M_Ar, temp = 293.15.K)</span>
<span style="color: #F92672;">let</span> <span style="color: #FD971F;">ρAr </span>= density<span style="color: #AE81FF;">(</span><span style="font-style: italic;">1013</span>.mbar, <span style="color: #66D9EF;">M_Ar</span>, temp = <span style="font-style: italic;">293</span>.<span style="font-style: italic;">15</span>.<span style="color: #66D9EF;">K</span><span style="color: #AE81FF;">)</span>
<span style="color: #F92672;">let</span> <span style="color: #66D9EF;">Argon</span> = initElement<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;ar&quot;</span>, <span style="font-style: italic;">18</span>.<span style="font-style: italic;">0</span>.<span style="color: #66D9EF;">UnitLess</span>, <span style="font-style: italic;">39</span>.<span style="font-style: italic;">95</span>.g•mol⁻¹, ρAr<span style="color: #AE81FF;">)</span>

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">intBethe</span><span style="color: #AE81FF;">(</span>e: <span style="color: #66D9EF;">Element</span>, d_total: cm, <span style="color: #66D9EF;">E0</span>: eV, dx = <span style="font-style: italic;">1</span>.μm<span style="color: #AE81FF;">)</span>: eV =
  <span style="color: #E6DB74;">## integrated energy loss of bethe formula after `</span><span style="color: #AE81FF;">d</span><span style="color: #E6DB74;">` cm of matter</span>
  <span style="color: #E6DB74;">## and returns the energy remaining</span>
  <span style="color: #F92672;">var</span> <span style="color: #FD971F;">γ</span>: <span style="color: #66D9EF;">UnitLess</span> = <span style="color: #66D9EF;">E_to_γ</span><span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">E0</span>.to<span style="color: #66D9EF;">(</span><span style="color: #66D9EF;">GeV</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">var</span> <span style="color: #FD971F;">d</span>: cm
  <span style="color: #FD971F;">result</span> = <span style="color: #66D9EF;">E0</span>
  <span style="color: #F92672;">var</span> <span style="color: #FD971F;">totalLoss </span>= <span style="font-style: italic;">0</span>.eV
  <span style="color: #F92672;">while</span> d &lt; d_total <span style="color: #F92672;">and</span> <span style="color: #FD971F;">result</span> &gt; <span style="font-style: italic;">0</span>.eV:
    <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">E_loss</span>: <span style="color: #66D9EF;">MeV</span> = betheBloch<span style="color: #AE81FF;">(</span>-<span style="font-style: italic;">1</span>, e.<span style="color: #66D9EF;">Z</span>, e.<span style="color: #66D9EF;">M</span>, γ, m_μ<span style="color: #AE81FF;">)</span> * e.ρ * dx
    <span style="color: #FD971F;">result</span> = <span style="color: #FD971F;">result</span> - <span style="color: #66D9EF;">E_loss</span>.to<span style="color: #AE81FF;">(</span>eV<span style="color: #AE81FF;">)</span>
    γ = <span style="color: #66D9EF;">E_to_γ</span><span style="color: #AE81FF;">(</span><span style="color: #FD971F;">result</span>.to<span style="color: #66D9EF;">(</span><span style="color: #66D9EF;">GeV</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
    d = d + dx.to<span style="color: #AE81FF;">(</span>cm<span style="color: #AE81FF;">)</span>
    totalLoss = totalLoss + <span style="color: #66D9EF;">E_loss</span>.to<span style="color: #AE81FF;">(</span>eV<span style="color: #AE81FF;">)</span>
  <span style="color: #FD971F;">result</span> = <span style="color: #F92672;">max</span><span style="color: #AE81FF;">(</span><span style="font-style: italic;">0</span>.<span style="color: #66D9EF;">float</span>, <span style="color: #FD971F;">result</span>.<span style="color: #66D9EF;">float</span><span style="color: #AE81FF;">)</span>.eV

<span style="color: #F92672;">func</span> <span style="color: #A6E22E;">argonLabel</span><span style="color: #AE81FF;">()</span>: <span style="color: #66D9EF;">string</span> = <span style="color: #E6DB74;">&quot;fig:theory:muon_argon_3cm_bethe_loss&quot;</span>

<span style="color: #E6DB74;">## TODO: add in the most probable value calc!  </span>
<span style="color: #F92672;">func</span> <span style="color: #A6E22E;">argonCaption</span><span style="color: #AE81FF;">()</span>: <span style="color: #66D9EF;">string</span> = 
  <span style="color: #FD971F;">result</span> = r<span style="color: #E6DB74;">&quot;Mean energy loss via Bethe-Bloch (purple) equation of muons in \SI{3}{\cm} of argon at &quot;</span> &amp;
    r<span style="color: #E6DB74;">&quot;conditions in use in GridPix detector at CAST. \SI{1050}{mbar} of chamber pressure at room &quot;</span> &amp;
    r<span style="color: #E6DB74;">&quot;temperature. Note that the mean is skewed by events that transfer a large amount of energy, &quot;</span> &amp;
    r<span style="color: #E6DB74;">&quot;but are very rare! As such care must be taken interpreting the numbers. Green shows the most &quot;</span> &amp;
    r<span style="color: #E6DB74;">&quot;probable energy loss, based on the peak of the Landau-Vavilov distribution underlying the &quot;</span> &amp;
    r<span style="color: #E6DB74;">&quot;Bethe-Bloch mean value.&quot;</span> &amp;
    interactiveVega<span style="color: #AE81FF;">(</span>argonLabel<span style="color: #66D9EF;">()</span><span style="color: #AE81FF;">)</span>

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">plotDetectorAbsorption</span><span style="color: #AE81FF;">(</span>element: <span style="color: #66D9EF;">Element</span><span style="color: #AE81FF;">)</span> =
  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">E_float</span> = logspace<span style="color: #AE81FF;">(</span>-<span style="font-style: italic;">2</span>, <span style="font-style: italic;">2</span>, <span style="font-style: italic;">1000</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">energies </span>= <span style="color: #66D9EF;">E_float</span>.mapIt<span style="color: #AE81FF;">(</span>it.<span style="color: #66D9EF;">GeV</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">E_loss</span> = energies.mapIt<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">(</span>it.to<span style="color: #A6E22E;">(</span>eV<span style="color: #A6E22E;">)</span> - intBethe<span style="color: #A6E22E;">(</span>element, <span style="font-style: italic;">3</span>.cm, it.to<span style="color: #E6DB74;">(</span>eV<span style="color: #E6DB74;">)</span><span style="color: #A6E22E;">)</span><span style="color: #66D9EF;">)</span>.to<span style="color: #66D9EF;">(</span>keV<span style="color: #66D9EF;">)</span>.<span style="color: #66D9EF;">float</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">E_lossMP</span> = energies.mapIt<span style="color: #AE81FF;">(</span>mostProbableLoss<span style="color: #66D9EF;">(</span>-<span style="font-style: italic;">1</span>, element.<span style="color: #66D9EF;">Z</span>, element.<span style="color: #66D9EF;">M</span>, <span style="color: #66D9EF;">E_to_γ</span><span style="color: #A6E22E;">(</span>it<span style="color: #A6E22E;">)</span>, ρ_Ar * <span style="font-style: italic;">3</span>.cm<span style="color: #66D9EF;">)</span>.<span style="color: #66D9EF;">float</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">df </span>= seqsToDf<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">{</span><span style="color: #66D9EF;">E_float</span>, <span style="color: #E6DB74;">&quot;Bethe-Bloch (BB)&quot;</span> : <span style="color: #66D9EF;">E_loss</span>, <span style="color: #E6DB74;">&quot;Most probable (MP)&quot;</span> : <span style="color: #66D9EF;">E_lossMP</span><span style="color: #66D9EF;">}</span><span style="color: #AE81FF;">)</span>
    .gather<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">[</span><span style="color: #E6DB74;">&quot;Bethe-Bloch (BB)&quot;</span>, <span style="color: #E6DB74;">&quot;Most probable (MP)&quot;</span><span style="color: #66D9EF;">]</span>, <span style="color: #E6DB74;">&quot;Type&quot;</span>, <span style="color: #E6DB74;">&quot;Value&quot;</span><span style="color: #AE81FF;">)</span>
  ggplot<span style="color: #AE81FF;">(</span>df, aes<span style="color: #66D9EF;">(</span><span style="color: #E6DB74;">&quot;E_float&quot;</span>, <span style="color: #E6DB74;">&quot;Value&quot;</span>, color = <span style="color: #E6DB74;">&quot;Type&quot;</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span> +
    geom_line<span style="color: #AE81FF;">()</span> +
    <span style="color: #75715E;">#</span><span style="color: #75715E;">xlab(r&quot;μ Energy [\si{\GeV}]&quot;) + ylab(r&quot;$-\left\langle \frac{\mathrm{d}E}{\mathrm{d}x}\right\rangle$ [\si{\keV}]&quot;) +</span>
    xlab<span style="color: #AE81FF;">(</span>r<span style="color: #E6DB74;">&quot;μ Energy [\si{\GeV}]&quot;</span><span style="color: #AE81FF;">)</span> +
    ylab<span style="color: #AE81FF;">(</span>r<span style="color: #E6DB74;">&quot;$-\left\langle \frac{\mathrm{d}E}{\mathrm{d}x}\right\rangle$ (BB), $Δ_p$ (MP) [\si{\keV}]&quot;</span><span style="color: #AE81FF;">)</span> +
    scale_x_log10<span style="color: #AE81FF;">()</span> + scale_y_log10<span style="color: #AE81FF;">()</span> +
    themeLatex<span style="color: #AE81FF;">(</span>fWidth = <span style="font-style: italic;">0</span>.<span style="font-style: italic;">9</span>, width = <span style="font-style: italic;">600</span>, baseTheme = singlePlot<span style="color: #AE81FF;">)</span> +
    margin<span style="color: #AE81FF;">(</span>right = <span style="font-style: italic;">6</span><span style="color: #AE81FF;">)</span> +
    ggtitle<span style="color: #AE81FF;">(</span>r<span style="color: #E6DB74;">&quot;Energy loss of Muons in \SI{3}{\cm} &quot;</span> &amp; &amp;<span style="color: #E6DB74;">&quot;{element.name.capitalizeAscii} at CAST conditions&quot;</span><span style="color: #AE81FF;">)</span> +
    ggsave<span style="color: #AE81FF;">(</span>&amp;<span style="color: #E6DB74;">&quot;/home/basti/phd/Figs/muonStudies/{element.name}_energy_loss_cast.pdf&quot;</span>, useTeX = <span style="color: #AE81FF;">true</span>, standalone = <span style="color: #AE81FF;">true</span><span style="color: #AE81FF;">)</span>
    <span style="color: #75715E;">#</span><span style="color: #75715E;">ggvegatex(&amp;&quot;/home/basti/phd/Figs/muonStudies/{element.name}_energy_loss_cast&quot;,</span>
    <span style="color: #75715E;">#          </span><span style="color: #75715E;">onlyTikZ = false,</span>
    <span style="color: #75715E;">#          </span><span style="color: #75715E;">caption = argonCaption(),</span>
    <span style="color: #75715E;">#          </span><span style="color: #75715E;">label = argonLabel(),</span>
    <span style="color: #75715E;">#          </span><span style="color: #75715E;">width = 600, height = 360)</span>
plotDetectorAbsorption<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">Argon</span><span style="color: #AE81FF;">)</span>

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">plotMostProbable</span><span style="color: #AE81FF;">(</span>e: <span style="color: #66D9EF;">Element</span><span style="color: #AE81FF;">)</span> =
  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">E_float</span> = logspace<span style="color: #AE81FF;">(</span>-<span style="font-style: italic;">1</span>.<span style="font-style: italic;">5</span>, <span style="font-style: italic;">2</span>, <span style="font-style: italic;">1000</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">energies </span>= <span style="color: #66D9EF;">E_float</span>.mapIt<span style="color: #AE81FF;">(</span>it.<span style="color: #66D9EF;">GeV</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">E_loss</span> = energies.mapIt<span style="color: #AE81FF;">(</span>mostProbableLoss<span style="color: #66D9EF;">(</span>-<span style="font-style: italic;">1</span>, e.<span style="color: #66D9EF;">Z</span>, e.<span style="color: #66D9EF;">M</span>, <span style="color: #66D9EF;">E_to_γ</span><span style="color: #A6E22E;">(</span>it<span style="color: #A6E22E;">)</span>, ρ_Ar * <span style="font-style: italic;">3</span>.cm<span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">df </span>= toDf<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">{</span><span style="color: #E6DB74;">&quot;E_loss&quot;</span> : <span style="color: #66D9EF;">E_loss</span>.mapIt<span style="color: #A6E22E;">(</span>it.<span style="color: #66D9EF;">float</span><span style="color: #A6E22E;">)</span>, <span style="color: #66D9EF;">E_float</span><span style="color: #66D9EF;">}</span><span style="color: #AE81FF;">)</span>
  ggplot<span style="color: #AE81FF;">(</span>df, aes<span style="color: #66D9EF;">(</span><span style="color: #E6DB74;">&quot;E_float&quot;</span>, <span style="color: #E6DB74;">&quot;E_loss&quot;</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span> +
    geom_line<span style="color: #AE81FF;">()</span> +
    scale_x_log10<span style="color: #AE81FF;">()</span> + 
    xlab<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;Energy [GeV]&quot;</span><span style="color: #AE81FF;">)</span> + ylab<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;Most probable loss [keV]&quot;</span><span style="color: #AE81FF;">)</span> +
    ggsave<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;/tmp/most_probable_loss.pdf&quot;</span><span style="color: #AE81FF;">)</span>
plotMostProbable<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">Argon</span><span style="color: #AE81FF;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div class="outline-4" id="outline-container-sec:theory:xray_fluorescence">
<h4 id="sec:theory:xray_fluorescence"><span class="section-number-4">6.1.4.</span> X-ray fluorescence</h4>
<div class="outline-text-4" id="text-sec:theory:xray_fluorescence">
<p>
Cosmic muons in their interactions with matter can ionize atoms,
leading to the possible emission of X-rays if the removed electron is
part of an inner shell, mostly K (and some L) shell electrons. This
leads to a form of background based on real X-rays and thus represents
a kind of background that is impossible to distinguish from any kind
of axion signal unless external scintillator based vetoes are used. Of
course, to be relevant as a form of detector background the material
must be close to the detector, as the X-rays will otherwise be
absorbed. This makes the detector material, the gas itself and all
material in the direction of the detectors&apos; sensitivity a candidate
for X-ray fluorescence background.
</p>

<p>
Table <a href="#tab:theory:xray_fluorescence">1</a> lists the X-ray fluorescence lines
for elements one commonly encounters in the context of gaseous
detectors for a helioscope experiment. Table
<a href="#tab:theory:binding_energies">2</a> lists the atomic binding energies of the
same elements. This is intended as a useful reference to understand
possible lines in background, potential targets for an X-ray tube for
reference X-ray data and understand the absorption edges for
materials.
</p>

<p>
The difference between the binding energy and the energies of the most
likely fluorescence lines is the explanation for why commonly a
material is more transparent for a fluorescence X-ray than energies
slightly above it. This (among other effects) explains the &apos;escape
peak&apos; seen in many types of gaseous detectors. For example see
fig. <a href="#fig:theory:transmission_examples">1</a> for the argon transmission. The
argon \(K 1s\) binding energy of \(\SI{3.2}{keV}\) is visible in the form
of the sudden drop in transmission (which is of course directly
proportional to the absorption length!). At the same time an X-ray
produced by an ionized argon atom from the \(K 1s\) electron via the Kα
line yields an X-ray of only \(\SI{2.95}{keV}\) and thus argon gas is
extremely transparent for such X-rays (this is the cause of so called
&apos;escape photons&apos;, see sec. <a href="./theory_detector.html#sec:theory:escape_peaks_55fe">6.3.8</a>).
</p>

<table id="tab:theory:xray_fluorescence">
<caption class="t-above"><span class="table-number">Table 1:</span> Excerpt of X-ray fluorescence energies of K, L and M emission lines for different elements mostly relevant for the context of this thesis in in \si{eV}. Taken from the X-ray data book <a href="williams2001x">williams2001x</a>, specifically <a href="https://xdb.lbl.gov/Section1/Table_1-2.pdf">https://xdb.lbl.gov/Section1/Table_1-2.pdf</a>.</caption>

<colgroup>
<col class="org-right" />

<col class="org-left" />

<col class="org-left" />

<col class="org-left" />

<col class="org-left" />

<col class="org-left" />

<col class="org-left" />

<col class="org-left" />

<col class="org-left" />

<col class="org-left" />

<col class="org-left" />
</colgroup>
<thead>
<tr>
<th class="org-right" scope="col">Z</th>
<th class="org-left" scope="col">Element</th>
<th class="org-left" scope="col">Kα1</th>
<th class="org-left" scope="col">Kα2</th>
<th class="org-left" scope="col">Kβ1</th>
<th class="org-left" scope="col">Lα1</th>
<th class="org-left" scope="col">Lα2</th>
<th class="org-left" scope="col">Lβ1</th>
<th class="org-left" scope="col">Lβ2</th>
<th class="org-left" scope="col">Lγ1</th>
<th class="org-left" scope="col">Mα1</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">6</td>
<td class="org-left">C</td>
<td class="org-left">277</td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
</tr>

<tr>
<td class="org-right">7</td>
<td class="org-left">N</td>
<td class="org-left">392.4</td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
</tr>

<tr>
<td class="org-right">8</td>
<td class="org-left">O</td>
<td class="org-left">524.9</td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
</tr>

<tr>
<td class="org-right">13</td>
<td class="org-left">Al</td>
<td class="org-left">1,486.70</td>
<td class="org-left">1,486.27</td>
<td class="org-left">1,557.45</td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
</tr>

<tr>
<td class="org-right">14</td>
<td class="org-left">Si</td>
<td class="org-left">1,739.98</td>
<td class="org-left">1,739.38</td>
<td class="org-left">1,835.94</td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
</tr>

<tr>
<td class="org-right">18</td>
<td class="org-left">Ar</td>
<td class="org-left">2,957.70</td>
<td class="org-left">2,955.63</td>
<td class="org-left">3,190.5</td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
</tr>

<tr>
<td class="org-right">22</td>
<td class="org-left">Ti</td>
<td class="org-left">4,510.84</td>
<td class="org-left">4,504.86</td>
<td class="org-left">4,931.81</td>
<td class="org-left">452.2</td>
<td class="org-left">452.2</td>
<td class="org-left">458.4</td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
</tr>

<tr>
<td class="org-right">25</td>
<td class="org-left">Mn</td>
<td class="org-left">5,898.75</td>
<td class="org-left">5,887.65</td>
<td class="org-left">6,490.45</td>
<td class="org-left">637.4</td>
<td class="org-left">637.4</td>
<td class="org-left">648.8</td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
</tr>

<tr>
<td class="org-right">26</td>
<td class="org-left">Fe</td>
<td class="org-left">6,403.84</td>
<td class="org-left">6,390.84</td>
<td class="org-left">7,057.98</td>
<td class="org-left">705.0</td>
<td class="org-left">705.0</td>
<td class="org-left">718.5</td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
</tr>

<tr>
<td class="org-right">28</td>
<td class="org-left">Ni</td>
<td class="org-left">7,478.15</td>
<td class="org-left">7,460.89</td>
<td class="org-left">8,264.66</td>
<td class="org-left">851.5</td>
<td class="org-left">851.5</td>
<td class="org-left">868.8</td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
</tr>

<tr>
<td class="org-right">29</td>
<td class="org-left">Cu</td>
<td class="org-left">8,047.78</td>
<td class="org-left">8,027.83</td>
<td class="org-left">8,905.29</td>
<td class="org-left">929.7</td>
<td class="org-left">929.7</td>
<td class="org-left">949.8</td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
</tr>

<tr>
<td class="org-right">47</td>
<td class="org-left">Ag</td>
<td class="org-left">22,162.92</td>
<td class="org-left">21,990.3</td>
<td class="org-left">24,942.4</td>
<td class="org-left">2,984.31</td>
<td class="org-left">2,978.21</td>
<td class="org-left">3,150.94</td>
<td class="org-left">3,347.81</td>
<td class="org-left">3,519.59</td>
<td class="org-left"> </td>
</tr>

<tr>
<td class="org-right">54</td>
<td class="org-left">Xe</td>
<td class="org-left">29,779</td>
<td class="org-left">29,458</td>
<td class="org-left">33,624</td>
<td class="org-left">4,109.9</td>
<td class="org-left">—</td>
<td class="org-left">—</td>
<td class="org-left"> </td>
<td class="org-left">—</td>
<td class="org-left"> </td>
</tr>

<tr>
<td class="org-right">78</td>
<td class="org-left">Pt</td>
<td class="org-left">66,832</td>
<td class="org-left">65,112</td>
<td class="org-left">75,748</td>
<td class="org-left">9,442.3</td>
<td class="org-left">9,361.8</td>
<td class="org-left">11,070.7</td>
<td class="org-left">11,250.5</td>
<td class="org-left">12,942.0</td>
<td class="org-left">2,050.5</td>
</tr>

<tr>
<td class="org-right">79</td>
<td class="org-left">Au</td>
<td class="org-left">68,803.7</td>
<td class="org-left">66,989.5</td>
<td class="org-left">77,984</td>
<td class="org-left">9,713.3</td>
<td class="org-left">9,628.0</td>
<td class="org-left">11,442.3</td>
<td class="org-left">11,584.7</td>
<td class="org-left">13,381.7</td>
<td class="org-left">2,122.9</td>
</tr>

<tr>
<td class="org-right">82</td>
<td class="org-left">Pb</td>
<td class="org-left">74,969.4</td>
<td class="org-left">72,804.2</td>
<td class="org-left">84,936</td>
<td class="org-left">10,551.5</td>
<td class="org-left">10,449.5</td>
<td class="org-left">12,613.7</td>
<td class="org-left">12,622.6</td>
<td class="org-left">14,764.4</td>
<td class="org-left">2,345.5</td>
</tr>
</tbody>
</table>

<table id="tab:theory:binding_energies">
<caption class="t-above"><span class="table-number">Table 2:</span> Excerpt of electron binding energies of elements mostly relevant for the context of this thesis in \si{eV}. Taken from the X-ray data book <a href="williams2001x">williams2001x</a>, specifically <a href="https://xdb.lbl.gov/Section1/Table_1-1.pdf">https://xdb.lbl.gov/Section1/Table_1-1.pdf</a>.</caption>

<colgroup>
<col class="org-right" />

<col class="org-left" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-right" />

<col class="org-left" />

<col class="org-left" />

<col class="org-left" />
</colgroup>
<thead>
<tr>
<th class="org-right" scope="col">Z</th>
<th class="org-left" scope="col">Element</th>
<th class="org-right" scope="col">K 1s</th>
<th class="org-right" scope="col">L1 2s</th>
<th class="org-right" scope="col">L2 2p1/2</th>
<th class="org-right" scope="col">L3 2p3/2</th>
<th class="org-right" scope="col">M1 3s</th>
<th class="org-right" scope="col">M2 3p1/2</th>
<th class="org-right" scope="col">M3 3p3/2</th>
<th class="org-left" scope="col">M4 3d3/2</th>
<th class="org-left" scope="col">M5 3d5/2</th>
<th class="org-left" scope="col"> </th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">6</td>
<td class="org-left">C</td>
<td class="org-right">284.2</td>
<td class="org-right"> </td>
<td class="org-right"> </td>
<td class="org-right"> </td>
<td class="org-right"> </td>
<td class="org-right"> </td>
<td class="org-right"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
</tr>

<tr>
<td class="org-right">7</td>
<td class="org-left">N</td>
<td class="org-right">409.9</td>
<td class="org-right">37.3</td>
<td class="org-right"> </td>
<td class="org-right"> </td>
<td class="org-right"> </td>
<td class="org-right"> </td>
<td class="org-right"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
</tr>

<tr>
<td class="org-right">8</td>
<td class="org-left">O</td>
<td class="org-right">543.1</td>
<td class="org-right">41.6</td>
<td class="org-right"> </td>
<td class="org-right"> </td>
<td class="org-right"> </td>
<td class="org-right"> </td>
<td class="org-right"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
</tr>

<tr>
<td class="org-right">13</td>
<td class="org-left">Al</td>
<td class="org-right">1559.6</td>
<td class="org-right">117.8</td>
<td class="org-right">72.95</td>
<td class="org-right">72.55</td>
<td class="org-right"> </td>
<td class="org-right"> </td>
<td class="org-right"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
</tr>

<tr>
<td class="org-right">14</td>
<td class="org-left">Si</td>
<td class="org-right">1839</td>
<td class="org-right">149.7</td>
<td class="org-right">99.82</td>
<td class="org-right">99.42</td>
<td class="org-right"> </td>
<td class="org-right"> </td>
<td class="org-right"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
</tr>

<tr>
<td class="org-right">18</td>
<td class="org-left">Ar</td>
<td class="org-right">3205.9</td>
<td class="org-right">326.3</td>
<td class="org-right">250.6</td>
<td class="org-right">248.4</td>
<td class="org-right">29.3</td>
<td class="org-right">15.9</td>
<td class="org-right">15.7</td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
</tr>

<tr>
<td class="org-right">22</td>
<td class="org-left">Ti</td>
<td class="org-right">4966</td>
<td class="org-right">560.9</td>
<td class="org-right">460.2</td>
<td class="org-right">453.8</td>
<td class="org-right">58.7</td>
<td class="org-right">32.6</td>
<td class="org-right">32.6</td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
</tr>

<tr>
<td class="org-right">25</td>
<td class="org-left">Mn</td>
<td class="org-right">6539</td>
<td class="org-right">769.1</td>
<td class="org-right">649.9</td>
<td class="org-right">638.7</td>
<td class="org-right">82.3</td>
<td class="org-right">47.2</td>
<td class="org-right">47.2</td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
</tr>

<tr>
<td class="org-right">26</td>
<td class="org-left">Fe</td>
<td class="org-right">7112</td>
<td class="org-right">844.6</td>
<td class="org-right">719.9</td>
<td class="org-right">706.8</td>
<td class="org-right">91.3</td>
<td class="org-right">52.7</td>
<td class="org-right">52.7</td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
</tr>

<tr>
<td class="org-right">28</td>
<td class="org-left">Ni</td>
<td class="org-right">8333</td>
<td class="org-right">1008.6</td>
<td class="org-right">870.0</td>
<td class="org-right">852.7</td>
<td class="org-right">110.8</td>
<td class="org-right">68.0</td>
<td class="org-right">66.2</td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
</tr>

<tr>
<td class="org-right">29</td>
<td class="org-left">Cu</td>
<td class="org-right">8979</td>
<td class="org-right">1096.7</td>
<td class="org-right">952.3</td>
<td class="org-right">932.7</td>
<td class="org-right">122.5</td>
<td class="org-right">77.3</td>
<td class="org-right">75.1</td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
</tr>

<tr>
<td class="org-right">47</td>
<td class="org-left">Ag</td>
<td class="org-right">25514</td>
<td class="org-right">3806</td>
<td class="org-right">3524</td>
<td class="org-right">3351</td>
<td class="org-right">719.0</td>
<td class="org-right">603.8</td>
<td class="org-right">573.0</td>
<td class="org-left">374.0</td>
<td class="org-left">368.3</td>
<td class="org-left"> </td>
</tr>

<tr>
<td class="org-right">54</td>
<td class="org-left">Xe</td>
<td class="org-right">34561</td>
<td class="org-right">5453</td>
<td class="org-right">5107</td>
<td class="org-right">4786</td>
<td class="org-right">1148.7</td>
<td class="org-right">1002.1</td>
<td class="org-right">940.6</td>
<td class="org-left">689.0</td>
<td class="org-left">676.4</td>
<td class="org-left"> </td>
</tr>

<tr>
<td class="org-right">78</td>
<td class="org-left">Pt</td>
<td class="org-right">78395</td>
<td class="org-right">13880</td>
<td class="org-right">13273</td>
<td class="org-right">11564</td>
<td class="org-right">3296</td>
<td class="org-right">3027</td>
<td class="org-right">2645</td>
<td class="org-left">2202</td>
<td class="org-left">2122</td>
<td class="org-left"> </td>
</tr>

<tr>
<td class="org-right">79</td>
<td class="org-left">Au</td>
<td class="org-right">80725</td>
<td class="org-right">14353</td>
<td class="org-right">13734</td>
<td class="org-right">11919</td>
<td class="org-right">3425</td>
<td class="org-right">3148</td>
<td class="org-right">2743</td>
<td class="org-left">2291</td>
<td class="org-left">2206</td>
<td class="org-left"> </td>
</tr>

<tr>
<td class="org-right">82</td>
<td class="org-left">Pb</td>
<td class="org-right">88005</td>
<td class="org-right">15861</td>
<td class="org-right">15200</td>
<td class="org-right">13035</td>
<td class="org-right">3851</td>
<td class="org-right">3554</td>
<td class="org-right">3066</td>
<td class="org-left">2586</td>
<td class="org-left">2484</td>
<td class="org-left">891.8</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">Z</td>
<td class="org-left">Element</td>
<td class="org-right">N1 4s</td>
<td class="org-right">N2 4p1/2</td>
<td class="org-right">N3 4p3/2</td>
<td class="org-right">N4 4d3/2</td>
<td class="org-right">N5 4d5/2</td>
<td class="org-right">N6 4f5/2</td>
<td class="org-right">N7 4f7/2</td>
<td class="org-left">O1 5s</td>
<td class="org-left">O2 5p1/2</td>
<td class="org-left">O3 5p3/2</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-right">47</td>
<td class="org-left">Ag</td>
<td class="org-right">97.0</td>
<td class="org-right">63.7</td>
<td class="org-right">58.3</td>
<td class="org-right"> </td>
<td class="org-right"> </td>
<td class="org-right"> </td>
<td class="org-right"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
<td class="org-left"> </td>
</tr>

<tr>
<td class="org-right">54</td>
<td class="org-left">Xe</td>
<td class="org-right">213.2</td>
<td class="org-right">146.7</td>
<td class="org-right">145.5</td>
<td class="org-right">69.5</td>
<td class="org-right">67.5</td>
<td class="org-right">---</td>
<td class="org-right">---</td>
<td class="org-left">23.3</td>
<td class="org-left">13.4</td>
<td class="org-left">12.1</td>
</tr>

<tr>
<td class="org-right">78</td>
<td class="org-left">Pt</td>
<td class="org-right">725.4</td>
<td class="org-right">609.1</td>
<td class="org-right">519.4</td>
<td class="org-right">331.6</td>
<td class="org-right">314.6</td>
<td class="org-right">74.5</td>
<td class="org-right">71.2</td>
<td class="org-left">101.7</td>
<td class="org-left">65.3</td>
<td class="org-left">51.7</td>
</tr>

<tr>
<td class="org-right">79</td>
<td class="org-left">Au</td>
<td class="org-right">762.1</td>
<td class="org-right">642.7</td>
<td class="org-right">546.3</td>
<td class="org-right">353.2</td>
<td class="org-right">335.1</td>
<td class="org-right">87.6</td>
<td class="org-right">84.0</td>
<td class="org-left">107.2</td>
<td class="org-left">74.2</td>
<td class="org-left">57.2</td>
</tr>

<tr>
<td class="org-right">82</td>
<td class="org-left">Pb</td>
<td class="org-right">761.9</td>
<td class="org-right">643.5</td>
<td class="org-right">434.3</td>
<td class="org-right">412.2</td>
<td class="org-right">141.7</td>
<td class="org-right">136.9</td>
<td class="org-right">147</td>
<td class="org-left">106.4</td>
<td class="org-left">83.3</td>
<td class="org-left">20.7</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div class="outline-3" id="outline-container-sec:theory:cosmic_radiation">
<h3 id="sec:theory:cosmic_radiation"><span class="section-number-3">6.2.</span> Cosmic rays</h3>
<div class="outline-text-3" id="text-sec:theory:cosmic_radiation">
<p>
Cosmic rays, or cosmic radiation refers to two aspects of a related
phenomenon. Primary cosmic radiation is the radiation arriving at
Earth from the Sun, galactic and extragalactic sources. The main
contribution are highly energetic protons, but other long lived
elementary particles and nuclei also contribute to a lesser
extent. Cosmic rays are isotropic at most energies, because of the
influence of galactic magnetic fields. Their energies range from
\(\SI{1e9}{eV}\) up to \(\SI{1e21}{eV}\). It is generally assumed that
particles below \(\SI{1e18}{eV}\) are of mainly galactic origin, whereas
the above is dominated by extragalactic sources. The flux of the
primary cosmic rays generally follows a power law
distribution. Different contributions follow a generally similar power
law (also see (<a href="./bibliography.html#citeproc_bib_item_244">Zyla and others 2020</a>), chapter on cosmic rays).
</p>

<p>
When cosmic rays interact with the molecules of Earth&apos;s atmosphere,
mesons are produced, mainly pions. Neutral pions generate showers of
photons and electron-positron pairs. Charged pions on the other hand
decay into muons and anti muon-neutrinos. Muons are produced over
electrons in this case, due to chirality. As they are more massive
than electrons they have a larger component of the opposite chirality
to the neutrino, which is necessary for this &apos;forbidden&apos; decay due to
angular momentum conservation.
</p>

<p>
They are produced at an altitude of roughly \(\SI{15}{km}\). A large
fraction of them reaches the surface as they are highly
relativistic. Their spectrum is described by a convolution of the
production energy, their energy loss due to ionization in the
atmosphere and possible decay.
</p>

<p>
Muons are of interest in the context of helioscope experiments, as
they present a dominant source of background, especially in gaseous
detectors (directly and indirectly due to fluorescence). And because
current helioscope experiments are built near Earth&apos;s surface, little
attenuation of muon flux happens. Therefore, a good understanding of
the expected muon flux is required.
</p>

<p>
Above \(\SI{100}{GeV}\) muon decay is negligible. At those energies the
muon flux at the surface strictly follows the same power law as the
primary cosmic ray flux. Following (<a href="./bibliography.html#citeproc_bib_item_90">Gaisser, Engel, and Resconi 2016</a>), in this
regime it can be described by
</p>

\begin{equation}
\label{eq:theory:muon_flux_gaisser}
\frac{\mathrm{d}N_μ}{\mathrm{d}E_μ \mathrm{d}Ω} \approx \frac{0.14
E_μ^{-2.7}}{\si{\centi\meter\squared \second \steradian \giga\electronvolt}} \times \left[ \frac{1}{1 + \frac{1.1
E_μ \cos ϑ}{\SI{115}{GeV}}} + \frac{0.054}{1 + \frac{1.1 E_μ \cos
ϑ}{\SI{850}{GeV}}} \right]
\end{equation}

<p>
where the first term in parenthesis is the pion and the second the
kaon contribution.
</p>

<p>
For lower energies, (<a href="./bibliography.html#citeproc_bib_item_213">Shukla and Sankrith 2018</a>) provide a set
of fitted functions based on \eqref{eq:theory:muon_flux_gaisser} with a
single power law
</p>

<p>
\[
I(E, θ) = I_0 N (E_0 + E)^{-n} \left(1 + \frac{E}{ε}\right)^{-1} D(θ)^{-(n - 1)},
\]
</p>

<p>
where \(I_0\), the intensity under zenith angle \(θ\), and \(ε\) is another
fit parameter for the replacement of the separate meson masses in
eq. \eqref{eq:theory:muon_flux_gaisser}. \(D(θ)\) is the path length through the
atmosphere under an angle \(θ\) from the zenith. \(N\) is a normalization
constant given by
</p>

<p>
\[
N = (n - 1) (E_0 + E_c)^{n-1},
\]
</p>

<p>
where \(n\) corresponds to the effective power of the cosine behavior
and is the final fit parameter. \(E_0\) accounts for the energy loss due
to interactions in the atmosphere and \(E_c\) is the lowest energy given
in a data set.
</p>

<p>
If the Earth is assumed flat, it is \(D(θ) = 1/\cosθ\) (which is often
assumed for simplicity and is a reasonable approximation as long as
only angles close to \(θ = 0\) are considered). To describe a trajectory
through Earth&apos;s curved atmosphere however, \(D(θ)\) can be modified to:
</p>

<p>
\[
D(θ) = \sqrt{
  \left(
    \frac{R²}{d²} \cos² θ + 2\frac{R}{d} + 1
  \right)
} -
  \frac{R}{d}\cos θ
\]
where \(R\) is the Earth radius, \(d\) the vertical path length (i.e. the
height at which the muon is created) and \(θ\) the zenith angle.
</p>

<p>
While this parametrization is very useful to describe the few specific
datasets shown in (<a href="./bibliography.html#citeproc_bib_item_213">Shukla and Sankrith 2018</a>) and provides a
way to fit any measured muon flux at a specific location, it is
limited in applicability to arbitrary locations, altitudes and
angles. For that an approach that does not require a fit to a dataset
is preferable, namely by utilizing a combination of the approximation
by Gaisser, eq. \eqref{eq:theory:muon_flux_gaisser}, and the interaction of
muons with the atmosphere. As such, we modify the equation for the
intensity \(I\) to the following:
</p>

<p>
\[
I(E, θ) = I_0 (n-1) (E_θ(E, θ) + E_c)^{n-1} (E_θ(E, θ) + E)^{-n} \left[ \frac{1}{1 + \frac{1.1
E_μ \cos ϑ}{\SI{115}{GeV}}} + \frac{0.054}{1 + \frac{1.1 E_μ \cos
ϑ}{\SI{850}{GeV}}} \right] D(θ)^{-(n - 1)},
\]
</p>

<p>
where we take \(n = 3\) exactly. One could put in the best fit for the
general cosine behavior under zenith angles, \(n = n_{\text{fit}} + 1\),
but for simplicity we just use 3 here. Take \(E_θ(E, θ)\) to be the
energy of a muon left from initial energy \(E\) at generation in the
upper atmosphere after transporting it through the atmosphere under
the angle \(θ\). The transport must take into account the density change
using the barometric height formula of the atmosphere. Transport is
done using the Bethe-Bloch equation as introduced in
sec. <a href="./theory_detector.html#sec:theory:bethe_bloch">6.1.3</a> assuming an atmosphere made up of
nitrogen, oxygen and argon. As such we remove all parameters except an
initial intensity \(I_0\), which can be set to the best fit of the
integrated muon flux at the zenith angle at sea level. In the
following figures we simply use \(I_0 = \SI{90}{\per\meter\squared
\per\steradian \per\second}\). Figure <a href="#fig:theory:muon_flux_surface">5</a>
shows the expected differential muon flux using these parameters for
different angles at sea level. In
<a href="#fig:theory:muon_flux_surface:initial">5(a)</a> the initial energy of the
muons is shown before transporting through the atmosphere. For each
angle the lines cut off at the energy below which the muon would
likely be stopped by the atmosphere according to its energy loss per
distance or reaches the surface with less than \(\SI{300}{MeV}\). On the
right we see the final energy of the same muons at the surface. The
lines in <a href="#fig:theory:muon_flux_surface:final">5(b)</a> are ragged, because
muon decay is simulated using Monte Carlo. <sup>  <a role="doc-backlink" class="footref" id="fnr.6" href="#fn.6">6</a></sup>
</p>

<p>
These numbers match reasonably well with different datasets for
different locations under different angles, but they should <i>not</i> be
considered as more than a starting point for a general
expectation. However, they are still useful as a reference to consider
when evaluating muon fluxes under different angles at CAST.
</p>


<figure class="figure-wrapper" id="fig:theory:muon_flux_surface">
<figure class="subfigure" id="fig:theory:muon_flux_surface:initial" data-width="49%">  <img src="./figs/home/basti/phd/Figs/muons/initial_energy_vs_flux_and_angle_cosmic_muons.svg" data-width="99%" />  <figcaption>Figure 5(a): Initial energy</figcaption></figure> <figure class="subfigure" id="fig:theory:muon_flux_surface:final" data-width="49%">  <img src="./figs/home/basti/phd/Figs/muons/final_energy_vs_flux_and_angle_cosmic_muons.svg" data-width="99%" />  <figcaption>Figure 5(b): Final energy</figcaption></figure>
<figcaption>Figure 5: Differential muon flux at sea level for different zenith angles. <a href="#fig:theory:muon_flux_surface:initial">5(a)</a> shows the initial energy of the muon. The cutoff corresponds to the
          lowest energy transported through the atmosphere; muons still arrive at the surface without decay or stopping. <a href="#fig:theory:muon_flux_surface:final">5(b)</a> shows the final muon energy at the surface, with the lowest muon $\SI{300}{MeV}$ at the surface. </figcaption>
</figure>
</div>

<div class="outline-4" id="outline-container-sec:theory:calc_muon_angular_flux">
<h4 id="sec:theory:calc_muon_angular_flux"><span class="section-number-4">6.2.1.</span> Calculation of muon angular / energy dependence at surface   <span class="tag">  <span class="extended">extended</span></span></h4>
<div class="outline-text-4" id="text-sec:theory:calc_muon_angular_flux">
<p>
The code here is directly based on code written in my notes
<a href="./../org/Doc/StatusAndProgress.html">./../org/Doc/StatusAndProgress.html</a> being tangled into a file
<code>/tmp/muon_flux.nim</code>.
</p>

<p>
Aside from the figures included in the main thesis, this also produces
fig. <a href="#fig:theory:flux_at_88deg_CAST">6</a>.
</p>


<figure id="fig:theory:flux_at_88deg_CAST">
<img src="./figs/home/basti/phd/Figs/muons/flux_at_cast_88_deg.svg" class="org-svg" alt="flux_at_cast_88_deg.svg" />

<figcaption>Figure 6: <span class="figure-number">Figure 12: </span>Expected muon flux under an angle of \(\SI{88}{°}\) at CAST.</figcaption>
</figure>

<div class="org-src-container">
<pre class="src src-nim"><span style="color: #F92672;">import</span> math, macros, unchained
<span style="color: #F92672;">import</span> seqmath, ggplotnim, sequtils, strformat

<span style="color: #F92672;">let</span> <span style="color: #66D9EF;">K</span> = <span style="font-style: italic;">4</span> * π * <span style="color: #66D9EF;">N_A</span> * r_e^<span style="font-style: italic;">2</span> * m_e * c^<span style="font-style: italic;">2</span> <span style="color: #75715E;"># </span><span style="color: #75715E;">usually in: [MeV mol⁻¹ cm²]</span>

defUnit<span style="color: #AE81FF;">(</span>cm³•g⁻¹<span style="color: #AE81FF;">)</span>
defUnit<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">J</span>•m⁻¹<span style="color: #AE81FF;">)</span>
defUnit<span style="color: #AE81FF;">(</span>cm⁻³<span style="color: #AE81FF;">)</span>
defUnit<span style="color: #AE81FF;">(</span>g•mol⁻¹<span style="color: #AE81FF;">)</span>
defUnit<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">MeV</span>•g⁻¹•cm²<span style="color: #AE81FF;">)</span>
defUnit<span style="color: #AE81FF;">(</span>mol⁻¹<span style="color: #AE81FF;">)</span>
defUnit<span style="color: #AE81FF;">(</span>keV•cm⁻¹<span style="color: #AE81FF;">)</span>
defUnit<span style="color: #AE81FF;">(</span>g•cm⁻³<span style="color: #AE81FF;">)</span>
defUnit<span style="color: #AE81FF;">(</span>g•cm⁻²<span style="color: #AE81FF;">)</span>

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">electronDensity</span><span style="color: #AE81FF;">(</span>ρ: g•cm⁻³, <span style="color: #66D9EF;">Z</span>, <span style="color: #66D9EF;">A</span>: <span style="color: #66D9EF;">UnitLess</span><span style="color: #AE81FF;">)</span>: cm⁻³ =
  <span style="color: #FD971F;">result</span> = <span style="color: #66D9EF;">N_A</span> * <span style="color: #66D9EF;">Z</span> * ρ / <span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">A</span> * <span style="color: #66D9EF;">M_u</span>.to<span style="color: #66D9EF;">(</span>g•mol⁻¹<span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">I</span><span style="color: #AE81FF;">[</span><span style="color: #66D9EF;">T</span><span style="color: #AE81FF;">](</span>z: <span style="color: #66D9EF;">float</span><span style="color: #AE81FF;">)</span>: <span style="color: #66D9EF;">T</span> =
  <span style="color: #E6DB74;">## use Bloch approximation for all but Argon (better use tabulated values!)</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">188.0 eV from NIST table </span>
  <span style="color: #FD971F;">result</span> = <span style="color: #F92672;">if</span> z == <span style="font-style: italic;">18</span>.<span style="font-style: italic;">0</span>: <span style="font-style: italic;">188</span>.<span style="font-style: italic;">0</span>.eV.to<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">T</span><span style="color: #AE81FF;">)</span> 
           <span style="color: #F92672;">else</span>: <span style="color: #AE81FF;">(</span><span style="font-style: italic;">10</span>.eV * z<span style="color: #AE81FF;">)</span>.to<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">T</span><span style="color: #AE81FF;">)</span>

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">calcβ</span><span style="color: #AE81FF;">(</span>γ: <span style="color: #66D9EF;">UnitLess</span><span style="color: #AE81FF;">)</span>: <span style="color: #66D9EF;">UnitLess</span> =
  <span style="color: #FD971F;">result</span> = sqrt<span style="color: #AE81FF;">(</span><span style="font-style: italic;">1</span>.<span style="font-style: italic;">0</span> - <span style="font-style: italic;">1</span>.<span style="font-style: italic;">0</span> / <span style="color: #66D9EF;">(</span>γ^<span style="font-style: italic;">2</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">betheBloch</span><span style="color: #AE81FF;">(</span>z, <span style="color: #66D9EF;">Z</span>: <span style="color: #66D9EF;">UnitLess</span>,
                   <span style="color: #66D9EF;">A</span>: g•mol⁻¹,
                   γ: <span style="color: #66D9EF;">UnitLess</span>,
                   <span style="color: #66D9EF;">M</span>: kg<span style="color: #AE81FF;">)</span>: <span style="color: #66D9EF;">MeV</span>•g⁻¹•cm² =
  <span style="color: #E6DB74;">## result in MeV cm² g⁻¹ (normalized by density)</span>
  <span style="color: #E6DB74;">## z: charge of particle</span>
  <span style="color: #E6DB74;">## Z: charge of particles making up medium</span>
  <span style="color: #E6DB74;">## A: atomic mass of particles making up medium</span>
  <span style="color: #E6DB74;">## γ: Lorentz factor of particle</span>
  <span style="color: #E6DB74;">## M: mass of particle in MeV (or same mass as `</span><span style="color: #AE81FF;">m_e</span><span style="color: #E6DB74;">` defined as)</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">β </span>= calcβ<span style="color: #AE81FF;">(</span>γ<span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">W_max</span> = <span style="font-style: italic;">2</span> * m_e * c^<span style="font-style: italic;">2</span> * β^<span style="font-style: italic;">2</span> * γ^<span style="font-style: italic;">2</span> /
    <span style="color: #AE81FF;">(</span><span style="font-style: italic;">1</span> + <span style="font-style: italic;">2</span> * γ * m_e / <span style="color: #66D9EF;">M</span> + <span style="color: #66D9EF;">(</span>m_e / <span style="color: #66D9EF;">M</span><span style="color: #66D9EF;">)</span>^<span style="font-style: italic;">2</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">lnArg </span>= <span style="font-style: italic;">2</span> * m_e * c^<span style="font-style: italic;">2</span> * β^<span style="font-style: italic;">2</span> * γ^<span style="font-style: italic;">2</span> * <span style="color: #66D9EF;">W_max</span> / <span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">I</span><span style="color: #66D9EF;">[</span><span style="color: #66D9EF;">Joule</span><span style="color: #66D9EF;">](</span><span style="color: #66D9EF;">Z</span><span style="color: #66D9EF;">)</span>^<span style="font-style: italic;">2</span><span style="color: #AE81FF;">)</span>
  <span style="color: #FD971F;">result</span> = <span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">K</span> * z^<span style="font-style: italic;">2</span> * <span style="color: #66D9EF;">Z</span> / <span style="color: #66D9EF;">A</span> * <span style="font-style: italic;">1</span>.<span style="font-style: italic;">0</span> / <span style="color: #66D9EF;">(</span>β^<span style="font-style: italic;">2</span><span style="color: #66D9EF;">)</span> * <span style="color: #66D9EF;">(</span>
    <span style="font-style: italic;">0</span>.<span style="font-style: italic;">5</span> * ln<span style="color: #A6E22E;">(</span>lnArg<span style="color: #A6E22E;">)</span> - β^<span style="font-style: italic;">2</span>
  <span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>.to<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">MeV</span>•g⁻¹•cm²<span style="color: #AE81FF;">)</span>

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">mostProbableLoss</span><span style="color: #AE81FF;">(</span>z, <span style="color: #66D9EF;">Z</span>: <span style="color: #66D9EF;">UnitLess</span>, <span style="color: #66D9EF;">A</span>: g•mol⁻¹, γ: <span style="color: #66D9EF;">UnitLess</span>,
                      x: g•cm⁻²<span style="color: #AE81FF;">)</span>: keV =
  <span style="color: #E6DB74;">## Computes the most probable value, corresponding to the peak of the Landau</span>
  <span style="color: #E6DB74;">## distribution, that gives rise to the Bethe-Bloch formula.</span>
  <span style="color: #E6DB74;">##</span>
  <span style="color: #E6DB74;">## Taken from PDG chapter &apos;Passage of particles through matter&apos; equation</span>
  <span style="color: #E6DB74;">## `</span><span style="color: #AE81FF;">34.12</span><span style="color: #E6DB74;">` in &apos;Fluctuations in energy loss&apos;, version 2020).</span>
  <span style="color: #E6DB74;">##</span>
  <span style="color: #E6DB74;">## `</span><span style="color: #AE81FF;">x</span><span style="color: #E6DB74;">` is the &quot;thickness&quot;. Density times length, `</span><span style="color: #AE81FF;">x = ρ * d</span><span style="color: #E6DB74;">`. The other parameters</span>
  <span style="color: #E6DB74;">## are as in `</span><span style="color: #AE81FF;">betheBloch</span><span style="color: #E6DB74;">` above.</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">β </span>= calcβ<span style="color: #AE81FF;">(</span>γ<span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">ξ </span>= <span style="color: #66D9EF;">K</span> / <span style="font-style: italic;">2</span>.<span style="font-style: italic;">0</span> * <span style="color: #66D9EF;">Z</span> / <span style="color: #66D9EF;">A</span> * z*z * <span style="color: #AE81FF;">(</span>x / <span style="color: #66D9EF;">(</span>β*β<span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">const</span> <span style="color: #FD971F;">j </span>= <span style="font-style: italic;">0</span>.<span style="font-style: italic;">200</span>
  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">I</span> = <span style="color: #66D9EF;">I</span><span style="color: #AE81FF;">[</span><span style="color: #66D9EF;">Joule</span><span style="color: #AE81FF;">](</span><span style="color: #66D9EF;">Z</span><span style="color: #AE81FF;">)</span>
  <span style="color: #FD971F;">result</span> = <span style="color: #AE81FF;">(</span>ξ * <span style="color: #66D9EF;">(</span> ln<span style="color: #A6E22E;">(</span><span style="color: #E6DB74;">(</span><span style="font-style: italic;">2</span> * m_e * c^<span style="font-style: italic;">2</span> * β^<span style="font-style: italic;">2</span> * γ^<span style="font-style: italic;">2</span><span style="color: #E6DB74;">)</span>.to<span style="color: #E6DB74;">(</span><span style="color: #66D9EF;">Joule</span><span style="color: #E6DB74;">)</span> / <span style="color: #66D9EF;">I</span><span style="color: #A6E22E;">)</span> + ln<span style="color: #A6E22E;">(</span>ξ.to<span style="color: #E6DB74;">(</span><span style="color: #66D9EF;">Joule</span><span style="color: #E6DB74;">)</span> / <span style="color: #66D9EF;">I</span><span style="color: #A6E22E;">)</span> + j - β^<span style="font-style: italic;">2</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>.to<span style="color: #AE81FF;">(</span>keV<span style="color: #AE81FF;">)</span> <span style="color: #75715E;"># </span><span style="color: #75715E;">- δ*(β*γ)</span>

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">density</span><span style="color: #AE81FF;">(</span>p: mbar, <span style="color: #66D9EF;">M</span>: g•mol⁻¹, temp: <span style="color: #66D9EF;">Kelvin</span><span style="color: #AE81FF;">)</span>: g•cm⁻³ =
  <span style="color: #E6DB74;">## returns the density of the gas for the given pressure.</span>
  <span style="color: #E6DB74;">## The pressure is assumed in `</span><span style="color: #AE81FF;">mbar</span><span style="color: #E6DB74;">` and the temperature (in `</span><span style="color: #AE81FF;">K</span><span style="color: #E6DB74;">`).</span>
  <span style="color: #E6DB74;">## The default temperature corresponds to BabyIAXO aim.</span>
  <span style="color: #E6DB74;">## Returns the density in `</span><span style="color: #AE81FF;">g / cm^3</span><span style="color: #E6DB74;">`</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">gasConstant </span>= <span style="font-style: italic;">8</span>.<span style="font-style: italic;">314</span>.<span style="color: #66D9EF;">J</span>•K⁻¹•mol⁻¹ <span style="color: #75715E;"># </span><span style="color: #75715E;">joule K^-1 mol^-1</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">pressure </span>= p.to<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">Pa</span><span style="color: #AE81FF;">)</span> <span style="color: #75715E;"># </span><span style="color: #75715E;">pressure in Pa</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">factor 1000 for conversion of M in g / mol to kg / mol</span>
  <span style="color: #FD971F;">result</span> = <span style="color: #AE81FF;">(</span>pressure * <span style="color: #66D9EF;">M</span> / <span style="color: #66D9EF;">(</span>gasConstant * temp<span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>.to<span style="color: #AE81FF;">(</span>g•cm⁻³<span style="color: #AE81FF;">)</span>

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">E_to_γ</span><span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">E</span>: <span style="color: #66D9EF;">GeV</span><span style="color: #AE81FF;">)</span>: <span style="color: #66D9EF;">UnitLess</span> =
  <span style="color: #FD971F;">result</span> = <span style="color: #66D9EF;">E</span>.to<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">Joule</span><span style="color: #AE81FF;">)</span> / <span style="color: #AE81FF;">(</span>m_μ * c^<span style="font-style: italic;">2</span><span style="color: #AE81FF;">)</span> + <span style="font-style: italic;">1</span>

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">γ_to_E</span><span style="color: #AE81FF;">(</span>γ: <span style="color: #66D9EF;">UnitLess</span><span style="color: #AE81FF;">)</span>: <span style="color: #66D9EF;">GeV</span> =
  <span style="color: #FD971F;">result</span> = <span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">(</span>γ - <span style="font-style: italic;">1</span><span style="color: #66D9EF;">)</span> * m_μ * c^<span style="font-style: italic;">2</span><span style="color: #AE81FF;">)</span>.to<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">GeV</span><span style="color: #AE81FF;">)</span>

<span style="color: #F92672;">type</span>
  <span style="color: #66D9EF;">Element</span> = <span style="color: #F92672;">object</span>
    <span style="color: #66D9EF;">Z</span>: <span style="color: #66D9EF;">UnitLess</span>
    <span style="color: #66D9EF;">M</span>: g•mol⁻¹
    <span style="color: #66D9EF;">A</span>: <span style="color: #66D9EF;">UnitLess</span> <span style="color: #75715E;"># </span><span style="color: #75715E;">numerically same as `</span><span style="color: #AE81FF;">M</span><span style="color: #75715E;">`</span>
    ρ: g•cm⁻³
<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">initElement</span><span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">Z</span>: <span style="color: #66D9EF;">UnitLess</span>, <span style="color: #66D9EF;">M</span>: g•mol⁻¹, ρ: g•cm⁻³<span style="color: #AE81FF;">)</span>: <span style="color: #66D9EF;">Element</span> =
  <span style="color: #66D9EF;">Element</span><span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">Z</span>: <span style="color: #66D9EF;">Z</span>, <span style="color: #66D9EF;">M</span>: <span style="color: #66D9EF;">M</span>, <span style="color: #66D9EF;">A</span>: <span style="color: #66D9EF;">M</span>.<span style="color: #66D9EF;">UnitLess</span>, ρ: ρ<span style="color: #AE81FF;">)</span>

<span style="color: #75715E;"># </span><span style="color: #75715E;">molar mass. Numerically same as relative atomic mass</span>
<span style="color: #F92672;">let</span> <span style="color: #66D9EF;">M_Ar</span> = <span style="font-style: italic;">39</span>.<span style="font-style: italic;">95</span>.g•mol⁻¹
<span style="color: #F92672;">let</span> <span style="color: #FD971F;">ρAr </span>= density<span style="color: #AE81FF;">(</span><span style="font-style: italic;">1050</span>.mbar, <span style="color: #66D9EF;">M_Ar</span>, temp = <span style="font-style: italic;">293</span>.<span style="font-style: italic;">15</span>.<span style="color: #66D9EF;">K</span><span style="color: #AE81FF;">)</span>
<span style="color: #F92672;">let</span> <span style="color: #66D9EF;">Argon</span> = initElement<span style="color: #AE81FF;">(</span><span style="font-style: italic;">18</span>.<span style="font-style: italic;">0</span>.<span style="color: #66D9EF;">UnitLess</span>, <span style="font-style: italic;">39</span>.<span style="font-style: italic;">95</span>.g•mol⁻¹, ρAr<span style="color: #AE81FF;">)</span>

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">intBethe</span><span style="color: #AE81FF;">(</span>e: <span style="color: #66D9EF;">Element</span>, d_total: cm, <span style="color: #66D9EF;">E0</span>: eV, dx = <span style="font-style: italic;">1</span>.μm<span style="color: #AE81FF;">)</span>: eV =
  <span style="color: #E6DB74;">## integrated energy loss of bethe formula after `</span><span style="color: #AE81FF;">d</span><span style="color: #E6DB74;">` cm of matter</span>
  <span style="color: #E6DB74;">## and returns the energy remaining</span>
  <span style="color: #F92672;">var</span> <span style="color: #FD971F;">γ</span>: <span style="color: #66D9EF;">UnitLess</span> = <span style="color: #66D9EF;">E_to_γ</span><span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">E0</span>.to<span style="color: #66D9EF;">(</span><span style="color: #66D9EF;">GeV</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">var</span> <span style="color: #FD971F;">d</span>: cm
  <span style="color: #FD971F;">result</span> = <span style="color: #66D9EF;">E0</span>
  <span style="color: #F92672;">var</span> <span style="color: #FD971F;">totalLoss </span>= <span style="font-style: italic;">0</span>.eV
  <span style="color: #F92672;">while</span> d &lt; d_total <span style="color: #F92672;">and</span> <span style="color: #FD971F;">result</span> &gt; <span style="font-style: italic;">0</span>.eV:
    <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">E_loss</span>: <span style="color: #66D9EF;">MeV</span> = betheBloch<span style="color: #AE81FF;">(</span>-<span style="font-style: italic;">1</span>, e.<span style="color: #66D9EF;">Z</span>, e.<span style="color: #66D9EF;">M</span>, γ, m_μ<span style="color: #AE81FF;">)</span> * e.ρ * dx
    <span style="color: #FD971F;">result</span> = <span style="color: #FD971F;">result</span> - <span style="color: #66D9EF;">E_loss</span>.to<span style="color: #AE81FF;">(</span>eV<span style="color: #AE81FF;">)</span>
    γ = <span style="color: #66D9EF;">E_to_γ</span><span style="color: #AE81FF;">(</span><span style="color: #FD971F;">result</span>.to<span style="color: #66D9EF;">(</span><span style="color: #66D9EF;">GeV</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
    d = d + dx.to<span style="color: #AE81FF;">(</span>cm<span style="color: #AE81FF;">)</span>
    totalLoss = totalLoss + <span style="color: #66D9EF;">E_loss</span>.to<span style="color: #AE81FF;">(</span>eV<span style="color: #AE81FF;">)</span>
  <span style="color: #FD971F;">result</span> = <span style="color: #F92672;">max</span><span style="color: #AE81FF;">(</span><span style="font-style: italic;">0</span>.<span style="color: #66D9EF;">float</span>, <span style="color: #FD971F;">result</span>.<span style="color: #66D9EF;">float</span><span style="color: #AE81FF;">)</span>.eV

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">plotDetectorAbsorption</span><span style="color: #AE81FF;">()</span> =
  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">E_float</span> = logspace<span style="color: #AE81FF;">(</span>-<span style="font-style: italic;">2</span>, <span style="font-style: italic;">2</span>, <span style="font-style: italic;">1000</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">energies </span>= <span style="color: #66D9EF;">E_float</span>.mapIt<span style="color: #AE81FF;">(</span>it.<span style="color: #66D9EF;">GeV</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">E_loss</span> = energies.mapIt<span style="color: #AE81FF;">(</span>
    <span style="color: #66D9EF;">(</span>it.to<span style="color: #A6E22E;">(</span>eV<span style="color: #A6E22E;">)</span> - intBethe<span style="color: #A6E22E;">(</span><span style="color: #66D9EF;">Argon</span>, <span style="font-style: italic;">3</span>.cm, it.to<span style="color: #E6DB74;">(</span>eV<span style="color: #E6DB74;">)</span><span style="color: #A6E22E;">)</span><span style="color: #66D9EF;">)</span>.to<span style="color: #66D9EF;">(</span>keV<span style="color: #66D9EF;">)</span>.<span style="color: #66D9EF;">float</span>
  <span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">df </span>= toDf<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">E_float</span>, <span style="color: #66D9EF;">E_loss</span><span style="color: #AE81FF;">)</span>
  ggplot<span style="color: #AE81FF;">(</span>df, aes<span style="color: #66D9EF;">(</span><span style="color: #E6DB74;">&quot;E_float&quot;</span>, <span style="color: #E6DB74;">&quot;E_loss&quot;</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span> +
    geom_line<span style="color: #AE81FF;">()</span> +
    xlab<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;μ Energy [GeV]&quot;</span><span style="color: #AE81FF;">)</span> + ylab<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;ΔE [keV]&quot;</span><span style="color: #AE81FF;">)</span> +
    scale_x_log10<span style="color: #AE81FF;">()</span> + scale_y_log10<span style="color: #AE81FF;">()</span> +
    ggtitle<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;Energy loss of Muons in 3 cm Ar at CAST conditions&quot;</span><span style="color: #AE81FF;">)</span> +
    ggsave<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;/home/basti/phd/Figs/muons/ar_energy_loss_cast.pdf&quot;</span><span style="color: #AE81FF;">)</span>
plotDetectorAbsorption<span style="color: #AE81FF;">()</span>

<span style="color: #F92672;">let</span> <span style="color: #66D9EF;">Atmosphere</span> = @<span style="color: #AE81FF;">[</span><span style="color: #66D9EF;">(</span><span style="font-style: italic;">0</span>.<span style="font-style: italic;">78084</span>, initElement<span style="color: #A6E22E;">(</span><span style="font-style: italic;">7</span>.<span style="font-style: italic;">0</span>.<span style="color: #66D9EF;">UnitLess</span>, <span style="font-style: italic;">14</span>.<span style="font-style: italic;">006</span>.g•mol⁻¹, <span style="font-style: italic;">1</span>.<span style="font-style: italic;">2506</span>.g•dm⁻³.to<span style="color: #E6DB74;">(</span>g•cm⁻³<span style="color: #E6DB74;">)</span><span style="color: #A6E22E;">)</span><span style="color: #66D9EF;">)</span>, <span style="color: #75715E;"># </span><span style="color: #75715E;">N2</span>
                   <span style="color: #66D9EF;">(</span><span style="font-style: italic;">0</span>.<span style="font-style: italic;">20964</span>, initElement<span style="color: #A6E22E;">(</span><span style="font-style: italic;">8</span>.<span style="font-style: italic;">0</span>.<span style="color: #66D9EF;">UnitLess</span>, <span style="font-style: italic;">15</span>.<span style="font-style: italic;">999</span>.g•mol⁻¹, <span style="font-style: italic;">1</span>.<span style="font-style: italic;">429</span>.g•dm⁻³.to<span style="color: #E6DB74;">(</span>g•cm⁻³<span style="color: #E6DB74;">)</span><span style="color: #A6E22E;">)</span><span style="color: #66D9EF;">)</span>,  <span style="color: #75715E;"># </span><span style="color: #75715E;">O2</span>
                   <span style="color: #66D9EF;">(</span><span style="font-style: italic;">0</span>.<span style="font-style: italic;">00934</span>, initElement<span style="color: #A6E22E;">(</span><span style="font-style: italic;">18</span>.<span style="font-style: italic;">0</span>.<span style="color: #66D9EF;">UnitLess</span>, <span style="font-style: italic;">39</span>.<span style="font-style: italic;">95</span>.g•mol⁻¹, <span style="font-style: italic;">1</span>.<span style="font-style: italic;">784</span>.g•dm⁻³.to<span style="color: #E6DB74;">(</span>g•cm⁻³<span style="color: #E6DB74;">)</span><span style="color: #A6E22E;">)</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">]</span>  <span style="color: #75715E;"># </span><span style="color: #75715E;">Ar</span>

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">plotMuonBethe</span><span style="color: #AE81FF;">()</span> =
  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">E_float</span> = logspace<span style="color: #AE81FF;">(</span>-<span style="font-style: italic;">2</span>, <span style="font-style: italic;">2</span>, <span style="font-style: italic;">1000</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">energies </span>= <span style="color: #66D9EF;">E_float</span>.mapIt<span style="color: #AE81FF;">(</span>it.<span style="color: #66D9EF;">GeV</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">var</span> <span style="color: #FD971F;">dEdxs </span>= <span style="color: #F92672;">newSeq</span><span style="color: #AE81FF;">[</span><span style="color: #66D9EF;">float</span><span style="color: #AE81FF;">]()</span>
  <span style="color: #F92672;">for</span> e <span style="color: #F92672;">in</span> energies:
    <span style="color: #F92672;">var</span> <span style="color: #FD971F;">dEdx </span>= <span style="font-style: italic;">0</span>.<span style="font-style: italic;">0</span>.<span style="color: #66D9EF;">MeV</span>•g⁻¹•cm²
    <span style="color: #F92672;">for</span> elTup <span style="color: #F92672;">in</span> <span style="color: #66D9EF;">Atmosphere</span>:
      <span style="color: #F92672;">let</span> <span style="color: #AE81FF;">(</span>w, element<span style="color: #AE81FF;">)</span> = elTup
      <span style="color: #F92672;">let</span> <span style="color: #FD971F;">γ </span>= <span style="color: #66D9EF;">E_to_γ</span><span style="color: #AE81FF;">(</span>e<span style="color: #AE81FF;">)</span>
      dEdx += w * betheBloch<span style="color: #AE81FF;">(</span>-<span style="font-style: italic;">1</span>, element.<span style="color: #66D9EF;">Z</span>, element.<span style="color: #66D9EF;">M</span>, γ, m_μ<span style="color: #AE81FF;">)</span>
    dEdxs.<span style="color: #F92672;">add</span> dEdx.<span style="color: #66D9EF;">float</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">df </span>= toDf<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">E_float</span>, dEdxs<span style="color: #AE81FF;">)</span>
  ggplot<span style="color: #AE81FF;">(</span>df, aes<span style="color: #66D9EF;">(</span><span style="color: #E6DB74;">&quot;E_float&quot;</span>, <span style="color: #E6DB74;">&quot;dEdxs&quot;</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span> +
    geom_line<span style="color: #AE81FF;">()</span> +
    xlab<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;μ Energy [GeV]&quot;</span><span style="color: #AE81FF;">)</span> + ylab<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;dE/dx [MeV•g⁻¹•cm²]&quot;</span><span style="color: #AE81FF;">)</span> +
    scale_x_log10<span style="color: #AE81FF;">()</span> + scale_y_log10<span style="color: #AE81FF;">()</span> +
    ggtitle<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;Energy loss of Muons in atmosphere&quot;</span><span style="color: #AE81FF;">)</span> +
    ggsave<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;/home/basti/phd/Figs/muons/energy_loss_muons_atmosphere.pdf&quot;</span><span style="color: #AE81FF;">)</span>  
plotMuonBethe<span style="color: #AE81FF;">()</span>
<span style="color: #75715E;">#</span><span style="color: #75715E;">if true: quit()</span>
<span style="color: #F92672;">import</span> math, unchained, ggplotnim, sequtils

<span style="color: #F92672;">const</span> <span style="color: #66D9EF;">R_Earth</span> = <span style="font-style: italic;">6371</span>.km
<span style="color: #F92672;">func</span> <span style="color: #A6E22E;">distanceAtmosphere</span><span style="color: #AE81FF;">(</span>θ: <span style="color: #66D9EF;">Radian</span>, d: <span style="color: #66D9EF;">KiloMeter</span> = <span style="font-style: italic;">36</span>.<span style="font-style: italic;">6149</span>.km<span style="color: #AE81FF;">)</span>: <span style="color: #66D9EF;">UnitLess</span> =
  <span style="color: #E6DB74;">## NOTE: The default value for `</span><span style="color: #AE81FF;">d</span><span style="color: #E6DB74;">` is not to be understood as a proper height. It.s an</span>
  <span style="color: #E6DB74;">## approximation based on a fit to get `</span><span style="color: #AE81FF;">R_Earth / d = 174</span><span style="color: #E6DB74;">`!</span>
  <span style="color: #FD971F;">result</span> = sqrt<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">(</span><span style="color: #66D9EF;">R_Earth</span> / d * cos<span style="color: #A6E22E;">(</span>θ<span style="color: #A6E22E;">)</span><span style="color: #66D9EF;">)</span>^<span style="font-style: italic;">2</span> + <span style="font-style: italic;">2</span> * <span style="color: #66D9EF;">R_Earth</span> / d + <span style="font-style: italic;">1</span><span style="color: #AE81FF;">)</span> - <span style="color: #66D9EF;">R_Earth</span> / d * cos<span style="color: #AE81FF;">(</span>θ<span style="color: #AE81FF;">)</span>

defUnit<span style="color: #AE81FF;">(</span>cm⁻²•s⁻¹•sr⁻¹<span style="color: #AE81FF;">)</span>  
defUnit<span style="color: #AE81FF;">(</span>m⁻²•s⁻¹•sr⁻¹<span style="color: #AE81FF;">)</span>
<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">muonFlux</span><span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">E</span>: <span style="color: #66D9EF;">GeV</span>, θ: <span style="color: #66D9EF;">Radian</span>, E₀, <span style="color: #66D9EF;">E_c</span>: <span style="color: #66D9EF;">GeV</span>,
              I₀: m⁻²•s⁻¹•sr⁻¹,
              ε: <span style="color: #66D9EF;">GeV</span><span style="color: #AE81FF;">)</span>: m⁻²•s⁻¹•sr⁻¹ =
  <span style="color: #F92672;">const</span> <span style="color: #FD971F;">n </span>= <span style="font-style: italic;">3</span>.<span style="font-style: italic;">0</span>
  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">N</span> = <span style="color: #AE81FF;">(</span>n - <span style="font-style: italic;">1</span><span style="color: #AE81FF;">)</span> * pow<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">(</span>E₀ + <span style="color: #66D9EF;">E_c</span><span style="color: #66D9EF;">)</span>.<span style="color: #66D9EF;">float</span>, n - <span style="font-style: italic;">1</span><span style="color: #AE81FF;">)</span>
  <span style="color: #FD971F;">result</span> = I₀ * <span style="color: #66D9EF;">N</span> * pow<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">(</span>E₀ + <span style="color: #66D9EF;">E</span><span style="color: #66D9EF;">)</span>.<span style="color: #66D9EF;">float</span>, -n<span style="color: #AE81FF;">)</span> *
    <span style="color: #75715E;">#</span><span style="color: #75715E;">pow((1 + E / ε).float, -1) *</span>
    <span style="color: #AE81FF;">(</span> <span style="color: #66D9EF;">(</span> <span style="font-style: italic;">1</span>.<span style="font-style: italic;">0</span> / <span style="color: #A6E22E;">(</span><span style="font-style: italic;">1</span> + <span style="font-style: italic;">1</span>.<span style="font-style: italic;">1</span> * <span style="color: #66D9EF;">E</span> * cos<span style="color: #E6DB74;">(</span>θ<span style="color: #E6DB74;">)</span> / <span style="font-style: italic;">115</span>.<span style="color: #66D9EF;">GeV</span><span style="color: #A6E22E;">)</span>.<span style="color: #66D9EF;">float</span><span style="color: #66D9EF;">)</span> + <span style="color: #66D9EF;">(</span><span style="font-style: italic;">0</span>.<span style="font-style: italic;">054</span> / <span style="color: #A6E22E;">(</span><span style="font-style: italic;">1</span> + <span style="font-style: italic;">1</span>.<span style="font-style: italic;">1</span> * <span style="color: #66D9EF;">E</span> * cos<span style="color: #E6DB74;">(</span>θ<span style="color: #E6DB74;">)</span> / <span style="font-style: italic;">850</span>.<span style="color: #66D9EF;">GeV</span><span style="color: #A6E22E;">)</span>.<span style="color: #66D9EF;">float</span><span style="color: #66D9EF;">)</span> <span style="color: #AE81FF;">)</span> * 
    pow<span style="color: #AE81FF;">(</span>distanceAtmosphere<span style="color: #66D9EF;">(</span>θ<span style="color: #66D9EF;">)</span>, -<span style="color: #66D9EF;">(</span>n - <span style="font-style: italic;">1</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>

<span style="color: #F92672;">from</span> numericalnim/integrate <span style="color: #F92672;">import</span> simpson
<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">plotE_vs_flux</span><span style="color: #AE81FF;">(</span>θ: <span style="color: #66D9EF;">Radian</span>, E₀, <span style="color: #66D9EF;">E_c</span>: <span style="color: #66D9EF;">GeV</span>, I₀: m⁻²•s⁻¹•sr⁻¹, ε: <span style="color: #66D9EF;">GeV</span>,
                   suffix = <span style="color: #E6DB74;">&quot;&quot;</span><span style="color: #AE81FF;">)</span> =
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">energies </span>= linspace<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">E_c</span>.<span style="color: #66D9EF;">float</span>, <span style="font-style: italic;">100</span>.<span style="font-style: italic;">0</span>, <span style="font-style: italic;">1000</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">E</span> = energies.mapIt<span style="color: #AE81FF;">(</span>it.<span style="color: #66D9EF;">GeV</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">flux </span>= <span style="color: #66D9EF;">E</span>.mapIt<span style="color: #AE81FF;">(</span>muonFlux<span style="color: #66D9EF;">(</span>it, θ, E₀, <span style="color: #66D9EF;">E_c</span>, I₀, ε<span style="color: #66D9EF;">)</span>.<span style="color: #66D9EF;">float</span><span style="color: #AE81FF;">)</span> <span style="color: #75715E;"># </span><span style="color: #75715E;">.to(cm⁻²•s⁻¹•sr⁻¹)</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">df </span>= toDf<span style="color: #AE81FF;">(</span>energies, flux<span style="color: #AE81FF;">)</span>

  <span style="color: #F92672;">echo</span> <span style="color: #E6DB74;">&quot;Integrated flux: &quot;</span>, simpson<span style="color: #AE81FF;">(</span>flux, energies<span style="color: #AE81FF;">)</span>
  
  ggplot<span style="color: #AE81FF;">(</span>df, aes<span style="color: #66D9EF;">(</span><span style="color: #E6DB74;">&quot;energies&quot;</span>, <span style="color: #E6DB74;">&quot;flux&quot;</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span> +
    geom_line<span style="color: #AE81FF;">()</span> +
    xlab<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;Energy [GeV]&quot;</span><span style="color: #AE81FF;">)</span> + ylab<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;Flux [m⁻²•s⁻¹•sr⁻¹]&quot;</span><span style="color: #AE81FF;">)</span> +
    scale_x_log10<span style="color: #AE81FF;">()</span> + scale_y_log10<span style="color: #AE81FF;">()</span> +
    ggtitle<span style="color: #AE81FF;">(</span>&amp;<span style="color: #E6DB74;">&quot;Flux dependency on the energy of muons at θ = {θ.to(°)}{suffix}&quot;</span><span style="color: #AE81FF;">)</span> +
    ggsave<span style="color: #AE81FF;">(</span>&amp;<span style="color: #E6DB74;">&quot;/home/basti/phd/Figs/muons/energy_vs_flux_cosmic_muons{suffix}.pdf&quot;</span><span style="color: #AE81FF;">)</span>
plotE_vs_flux<span style="color: #AE81FF;">(</span><span style="font-style: italic;">0</span>.<span style="color: #66D9EF;">Radian</span>,
              <span style="font-style: italic;">2</span>.<span style="font-style: italic;">5</span>.<span style="color: #66D9EF;">GeV</span>, <span style="color: #75715E;">#</span><span style="color: #75715E;">4.29.GeV,</span>
              <span style="font-style: italic;">0</span>.<span style="font-style: italic;">5</span>.<span style="color: #66D9EF;">GeV</span>, <span style="font-style: italic;">70</span>.<span style="font-style: italic;">7</span>.m⁻²•s⁻¹•sr⁻¹, <span style="font-style: italic;">854</span>.<span style="color: #66D9EF;">GeV</span><span style="color: #AE81FF;">)</span>


<span style="color: #F92672;">let</span> <span style="color: #FD971F;">E</span>₀ = <span style="font-style: italic;">25</span>.<span style="font-style: italic;">0</span>.<span style="color: #66D9EF;">GeV</span>
<span style="color: #F92672;">let</span> <span style="color: #FD971F;">I</span>₀ = <span style="font-style: italic;">90</span>.<span style="font-style: italic;">0</span>.m⁻²•s⁻¹•sr⁻¹
<span style="color: #F92672;">let</span> <span style="color: #66D9EF;">E_c</span> = <span style="font-style: italic;">1</span>.<span style="color: #66D9EF;">GeV</span>
<span style="color: #F92672;">let</span> <span style="color: #FD971F;">ε </span>= <span style="font-style: italic;">2000</span>.<span style="color: #66D9EF;">GeV</span>

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">plotFlux_at_CAST</span><span style="color: #AE81FF;">()</span> =
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">energies </span>= linspace<span style="color: #AE81FF;">(</span><span style="font-style: italic;">0</span>.<span style="font-style: italic;">5</span>, <span style="font-style: italic;">100</span>.<span style="font-style: italic;">0</span>, <span style="font-style: italic;">1000</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">E</span> = energies.mapIt<span style="color: #AE81FF;">(</span>it.<span style="color: #66D9EF;">GeV</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">flux </span>= <span style="color: #66D9EF;">E</span>.mapIt<span style="color: #AE81FF;">(</span>muonFlux<span style="color: #66D9EF;">(</span>it, <span style="font-style: italic;">88</span>.<span style="font-style: italic;">0</span>.degToRad.<span style="color: #66D9EF;">Radian</span>, E₀, <span style="color: #66D9EF;">E_c</span>, I₀, ε<span style="color: #66D9EF;">)</span>.<span style="color: #66D9EF;">float</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">df </span>= toDf<span style="color: #AE81FF;">(</span>energies, flux<span style="color: #AE81FF;">)</span>
  ggplot<span style="color: #AE81FF;">(</span>df, aes<span style="color: #66D9EF;">(</span><span style="color: #E6DB74;">&quot;energies&quot;</span>, <span style="color: #E6DB74;">&quot;flux&quot;</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span> +
    geom_line<span style="color: #AE81FF;">()</span> +
    xlab<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;Energy [GeV]&quot;</span><span style="color: #AE81FF;">)</span> + ylab<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;Flux [m⁻²•s⁻¹•sr⁻¹]&quot;</span><span style="color: #AE81FF;">)</span> +
    scale_x_log10<span style="color: #AE81FF;">()</span> + scale_y_log10<span style="color: #AE81FF;">()</span> +
    ggtitle<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;Flux dependency on the energy at θ = 88° at CAST altitude&quot;</span><span style="color: #AE81FF;">)</span> +
    ggsave<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;/home/basti/phd/Figs/muons/flux_at_cast_88_deg.pdf&quot;</span><span style="color: #AE81FF;">)</span>
plotFlux_at_CAST<span style="color: #AE81FF;">()</span>

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">computeMeanEnergyLoss</span><span style="color: #AE81FF;">()</span> =
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">energies </span>= linspace<span style="color: #AE81FF;">(</span><span style="font-style: italic;">0</span>.<span style="font-style: italic;">5</span>, <span style="font-style: italic;">100</span>.<span style="font-style: italic;">0</span>, <span style="font-style: italic;">1000</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">E</span> = energies.mapIt<span style="color: #AE81FF;">(</span>it.<span style="color: #66D9EF;">GeV</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">flux </span>= <span style="color: #66D9EF;">E</span>.mapIt<span style="color: #AE81FF;">(</span>muonFlux<span style="color: #66D9EF;">(</span>
    it, <span style="font-style: italic;">88</span>.<span style="font-style: italic;">0</span>.degToRad.<span style="color: #66D9EF;">Radian</span>, E₀, <span style="color: #66D9EF;">E_c</span>, I₀, ε<span style="color: #66D9EF;">)</span>.<span style="color: #66D9EF;">float</span>
  <span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">E_loss</span> = <span style="color: #66D9EF;">E</span>.mapIt<span style="color: #AE81FF;">(</span>
    <span style="color: #66D9EF;">(</span>it.to<span style="color: #A6E22E;">(</span>eV<span style="color: #A6E22E;">)</span> - intBethe<span style="color: #A6E22E;">(</span><span style="color: #66D9EF;">Argon</span>, <span style="font-style: italic;">3</span>.cm, it.to<span style="color: #E6DB74;">(</span>eV<span style="color: #E6DB74;">)</span><span style="color: #A6E22E;">)</span><span style="color: #66D9EF;">)</span>.to<span style="color: #66D9EF;">(</span>keV<span style="color: #66D9EF;">)</span>.<span style="color: #66D9EF;">float</span>
  <span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">fluxSum </span>= flux.sum
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">df </span>= toDf<span style="color: #AE81FF;">(</span>energies, <span style="color: #66D9EF;">E_loss</span>, flux<span style="color: #AE81FF;">)</span>
      .mutate<span style="color: #AE81FF;">(</span>f<span style="color: #66D9EF;">{</span><span style="color: #E6DB74;">&quot;flux&quot;</span> ~ `flux` / fluxSum<span style="color: #66D9EF;">}</span>,
              f<span style="color: #66D9EF;">{</span><span style="color: #E6DB74;">&quot;AdjFlux&quot;</span> ~ `<span style="color: #66D9EF;">E_loss</span>` * `flux`<span style="color: #66D9EF;">}</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">echo</span> <span style="color: #E6DB74;">&quot;Mean energy loss: &quot;</span>, df<span style="color: #AE81FF;">[</span><span style="color: #E6DB74;">&quot;AdjFlux&quot;</span>, <span style="color: #66D9EF;">float</span><span style="color: #AE81FF;">]</span>.sum
computeMeanEnergyLoss<span style="color: #AE81FF;">()</span>

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">computeHeight</span><span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">S</span>: <span style="color: #66D9EF;">Meter</span>, θ: <span style="color: #66D9EF;">Radian</span><span style="color: #AE81FF;">)</span>: <span style="color: #66D9EF;">KiloMeter</span> =
  <span style="color: #E6DB74;">## For given remaining distance distance along the path of a muon</span>
  <span style="color: #E6DB74;">## `</span><span style="color: #AE81FF;">S</span><span style="color: #E6DB74;">` (see fig. 1 in 1606.06907) computes the remaining height above</span>
  <span style="color: #E6DB74;">## ground. Formula is the result of inverting eq. 7 to `</span><span style="color: #AE81FF;">d</span><span style="color: #E6DB74;">` using quadratic</span>
  <span style="color: #E6DB74;">## formula. Positive result, because negative is negative.</span>
  <span style="color: #FD971F;">result</span> = <span style="color: #AE81FF;">(</span>-<span style="font-style: italic;">1</span>.<span style="font-style: italic;">0</span> * <span style="color: #66D9EF;">R_Earth</span> + sqrt<span style="color: #66D9EF;">(</span><span style="color: #66D9EF;">R_Earth</span>^<span style="font-style: italic;">2</span> + <span style="color: #66D9EF;">S</span>^<span style="font-style: italic;">2</span> + <span style="font-style: italic;">2</span> * <span style="color: #66D9EF;">S</span> * <span style="color: #66D9EF;">R_Earth</span> * cos<span style="color: #A6E22E;">(</span>θ<span style="color: #A6E22E;">)</span><span style="color: #66D9EF;">)</span>.m<span style="color: #AE81FF;">)</span>.to<span style="color: #AE81FF;">(</span>km<span style="color: #AE81FF;">)</span>

<span style="color: #F92672;">import</span> algorithm
defUnit<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">K</span>•m⁻¹<span style="color: #AE81FF;">)</span>
<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">barometricFormula</span><span style="color: #AE81FF;">(</span>h: <span style="color: #66D9EF;">KiloMeter</span><span style="color: #AE81FF;">)</span>: g•cm⁻³ =
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">hs </span>= @<span style="color: #AE81FF;">[</span><span style="font-style: italic;">0</span>.<span style="font-style: italic;">0</span>.km, <span style="font-style: italic;">11</span>.<span style="font-style: italic;">0</span>.km<span style="color: #AE81FF;">]</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">ρs </span>= @<span style="color: #AE81FF;">[</span><span style="font-style: italic;">1</span>.<span style="font-style: italic;">225</span>.kg•m⁻³, <span style="font-style: italic;">0</span>.<span style="font-style: italic;">36391</span>.kg•m⁻³<span style="color: #AE81FF;">]</span>
  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">Ts</span> = @<span style="color: #AE81FF;">[</span><span style="font-style: italic;">288</span>.<span style="font-style: italic;">15</span>.<span style="color: #66D9EF;">K</span>, <span style="font-style: italic;">216</span>.<span style="font-style: italic;">65</span>.<span style="color: #66D9EF;">K</span><span style="color: #AE81FF;">]</span>
  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">Ls</span> = @<span style="color: #AE81FF;">[</span>-<span style="font-style: italic;">1</span>.<span style="font-style: italic;">0</span> * <span style="font-style: italic;">0</span>.<span style="font-style: italic;">0065</span>.<span style="color: #66D9EF;">K</span>•m⁻¹, <span style="font-style: italic;">0</span>.<span style="font-style: italic;">0</span>.<span style="color: #66D9EF;">K</span>•m⁻¹<span style="color: #AE81FF;">]</span>
  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">M_air</span> = <span style="font-style: italic;">0</span>.<span style="font-style: italic;">0289644</span>.kg•mol⁻¹
  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">R</span> = <span style="font-style: italic;">8</span>.<span style="font-style: italic;">3144598</span>.<span style="color: #66D9EF;">N</span>•m•mol⁻¹•K⁻¹
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">g_0 </span>= <span style="font-style: italic;">9</span>.<span style="font-style: italic;">80665</span>.m•s⁻²
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">idx </span>= hs.mapIt<span style="color: #AE81FF;">(</span>it.<span style="color: #66D9EF;">float</span><span style="color: #AE81FF;">)</span>.lowerBound<span style="color: #AE81FF;">(</span>h.<span style="color: #66D9EF;">float</span><span style="color: #AE81FF;">)</span> - <span style="font-style: italic;">1</span>
  <span style="color: #F92672;">case</span> idx
  <span style="color: #F92672; font-style: italic;">of</span> <span style="font-style: italic;">0</span>:
    <span style="color: #75715E;"># </span><span style="color: #75715E;">in Troposphere, using regular barometric formula for denities</span>
    <span style="color: #F92672;">let</span> <span style="color: #FD971F;">expArg </span>= g_0 * <span style="color: #66D9EF;">M_air</span> / <span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">R</span> * <span style="color: #66D9EF;">Ls</span><span style="color: #66D9EF;">[</span>idx<span style="color: #66D9EF;">]</span><span style="color: #AE81FF;">)</span>
    <span style="color: #FD971F;">result</span> = <span style="color: #AE81FF;">(</span>ρs<span style="color: #66D9EF;">[</span>idx<span style="color: #66D9EF;">]</span> * pow<span style="color: #66D9EF;">(</span><span style="color: #66D9EF;">Ts</span><span style="color: #A6E22E;">[</span>idx<span style="color: #A6E22E;">]</span> / <span style="color: #A6E22E;">(</span><span style="color: #66D9EF;">Ts</span><span style="color: #E6DB74;">[</span>idx<span style="color: #E6DB74;">]</span> + <span style="color: #66D9EF;">Ls</span><span style="color: #E6DB74;">[</span>idx<span style="color: #E6DB74;">]</span> * <span style="color: #E6DB74;">(</span>h - hs<span style="color: #FD971F;">[</span>idx<span style="color: #FD971F;">]</span><span style="color: #E6DB74;">)</span><span style="color: #A6E22E;">)</span>, expArg<span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>.to<span style="color: #AE81FF;">(</span>g•cm⁻³<span style="color: #AE81FF;">)</span>
  <span style="color: #F92672; font-style: italic;">of</span> <span style="font-style: italic;">1</span>:
    <span style="color: #75715E;"># </span><span style="color: #75715E;">in Tropopause, use equation valid for L_b = 0</span>
    <span style="color: #FD971F;">result</span> = <span style="color: #AE81FF;">(</span>ρs<span style="color: #66D9EF;">[</span>idx<span style="color: #66D9EF;">]</span> * exp<span style="color: #66D9EF;">(</span>-<span style="font-style: italic;">1</span>.<span style="font-style: italic;">0</span> * g_0 * <span style="color: #66D9EF;">M_air</span> * <span style="color: #A6E22E;">(</span>h - hs<span style="color: #E6DB74;">[</span>idx<span style="color: #E6DB74;">]</span><span style="color: #A6E22E;">)</span> / <span style="color: #A6E22E;">(</span><span style="color: #66D9EF;">R</span> * <span style="color: #66D9EF;">Ts</span><span style="color: #E6DB74;">[</span>idx<span style="color: #E6DB74;">]</span><span style="color: #A6E22E;">)</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>.to<span style="color: #AE81FF;">(</span>g•cm⁻³<span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">else</span>: <span style="color: #F92672;">doAssert</span> <span style="color: #AE81FF;">false</span>, <span style="color: #E6DB74;">&quot;Invalid height! Outside of range!&quot;</span>

<span style="color: #F92672;">import</span> random
randomize<span style="color: #AE81FF;">(</span><span style="font-style: italic;">430</span><span style="color: #AE81FF;">)</span>
<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">intBetheAtmosphere</span><span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">E</span>: <span style="color: #66D9EF;">GeV</span>, θ: <span style="color: #66D9EF;">Radian</span>, dx = <span style="font-style: italic;">10</span>.cm<span style="color: #AE81FF;">)</span>: eV =
  <span style="color: #E6DB74;">## integrated energy loss using Bethe formula for muons generated at</span>
  <span style="color: #E6DB74;">## `</span><span style="color: #AE81FF;">15.km</span><span style="color: #E6DB74;">` under an angle of `</span><span style="color: #AE81FF;">θ</span><span style="color: #E6DB74;">` to the observer for a muon of energy</span>
  <span style="color: #E6DB74;">## `</span><span style="color: #AE81FF;">E</span><span style="color: #E6DB74;">`.</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">Main contributions in Earth&apos;s atmosphere</span>
  <span style="color: #F92672;">const</span> <span style="color: #FD971F;">τ </span>= <span style="font-style: italic;">2</span>.<span style="font-style: italic;">19618</span>.μs <span style="color: #75715E;"># </span><span style="color: #75715E;">muon half life</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">elements </span>= <span style="color: #66D9EF;">Atmosphere</span>
  <span style="color: #F92672;">var</span> <span style="color: #FD971F;">γ</span>: <span style="color: #66D9EF;">UnitLess</span> = <span style="color: #66D9EF;">E_to_γ</span><span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">E</span>.to<span style="color: #66D9EF;">(</span><span style="color: #66D9EF;">GeV</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
  <span style="color: #FD971F;">result</span> = <span style="color: #66D9EF;">E</span>.to<span style="color: #AE81FF;">(</span>eV<span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">var</span> <span style="color: #FD971F;">totalLoss </span>= <span style="font-style: italic;">0</span>.eV
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">h_muon </span>= <span style="font-style: italic;">15</span>.km <span style="color: #75715E;"># </span><span style="color: #75715E;">assume creation happens in `</span><span style="color: #AE81FF;">15.km</span><span style="color: #75715E;">`</span>
  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">S</span> = h_muon.to<span style="color: #AE81FF;">(</span>m<span style="color: #AE81FF;">)</span> * distanceAtmosphere<span style="color: #AE81FF;">(</span>θ.rad, d = h_muon<span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">var</span> <span style="color: #66D9EF;">S_prime</span> = <span style="color: #66D9EF;">S</span>
  <span style="color: #F92672;">while</span> <span style="color: #66D9EF;">S_prime</span> &gt; <span style="font-style: italic;">0</span>.m <span style="color: #F92672;">and</span> <span style="color: #FD971F;">result</span> &gt; <span style="font-style: italic;">0</span>.eV:
    <span style="color: #F92672;">let</span> <span style="color: #FD971F;">h </span>= computeHeight<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">S_prime</span>, θ<span style="color: #AE81FF;">)</span>
    <span style="color: #F92672;">let</span> <span style="color: #FD971F;">ρ_at_h </span>= barometricFormula<span style="color: #AE81FF;">(</span>h<span style="color: #AE81FF;">)</span>
    <span style="color: #F92672;">var</span> <span style="color: #66D9EF;">E_loss</span> = <span style="font-style: italic;">0</span>.<span style="font-style: italic;">0</span>.<span style="color: #66D9EF;">MeV</span>
    <span style="color: #F92672;">for</span> eTup <span style="color: #F92672;">in</span> elements: <span style="color: #75715E;"># </span><span style="color: #75715E;">compute the weighted contribution of the element fraction</span>
      <span style="color: #F92672;">let</span> <span style="color: #AE81FF;">(</span>w, e<span style="color: #AE81FF;">)</span> = eTup
      <span style="color: #66D9EF;">E_loss</span> += w * betheBloch<span style="color: #AE81FF;">(</span>-<span style="font-style: italic;">1</span>, e.<span style="color: #66D9EF;">Z</span>, e.<span style="color: #66D9EF;">M</span>, γ, m_μ<span style="color: #AE81FF;">)</span> * ρ_at_h * dx

    <span style="color: #E6DB74;">## Add step for radioactive decay of muon.</span>
    <span style="color: #E6DB74;">## - given `</span><span style="color: #AE81FF;">dx</span><span style="color: #E6DB74;">` compute likelihood of decay</span>
    <span style="color: #E6DB74;">## - eigen time of muon: dx / v = dt. dτ = dt / γ</span>
    <span style="color: #E6DB74;">## - muon decay is λ = 1 / 2.2e-6s</span>
    <span style="color: #F92672;">let</span> <span style="color: #FD971F;">β </span>= calcβ<span style="color: #AE81FF;">(</span>γ<span style="color: #AE81FF;">)</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">compute effective time in lab frame</span>
    <span style="color: #F92672;">let</span> <span style="color: #FD971F;">δt </span>= dx / <span style="color: #AE81FF;">(</span>β * c<span style="color: #AE81FF;">)</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">compute eigen time</span>
    <span style="color: #F92672;">let</span> <span style="color: #FD971F;">δτ </span>= δt / γ
    <span style="color: #75715E;"># </span><span style="color: #75715E;">probability of a decay in this time frame</span>
    <span style="color: #F92672;">let</span> <span style="color: #FD971F;">p </span>= pow<span style="color: #AE81FF;">(</span><span style="font-style: italic;">1</span> / math.<span style="color: #66D9EF;">E</span>, δτ / τ<span style="color: #AE81FF;">)</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">decay with likelihood `</span><span style="color: #AE81FF;">p</span><span style="color: #75715E;">`</span>
    <span style="color: #75715E;">#</span><span style="color: #75715E;">echo &quot;γ = &quot;, γ, &quot; yields &quot;, p, &quot; in δτ &quot;, δτ, &quot; for energy &quot;, E</span>
    <span style="color: #F92672;">if</span> rand<span style="color: #AE81FF;">(</span><span style="font-style: italic;">1</span>.<span style="font-style: italic;">0</span><span style="color: #AE81FF;">)</span> &lt; <span style="color: #AE81FF;">(</span><span style="font-style: italic;">1</span>.<span style="font-style: italic;">0</span> - p<span style="color: #AE81FF;">)</span>:
      <span style="color: #F92672;">echo</span> <span style="color: #E6DB74;">&quot;Particle decayed after: &quot;</span>, <span style="color: #66D9EF;">S_prime</span>
      <span style="color: #F92672;">return</span> <span style="font-style: italic;">0</span>.eV
          
    <span style="color: #FD971F;">result</span> = <span style="color: #FD971F;">result</span> - <span style="color: #66D9EF;">E_loss</span>.to<span style="color: #AE81FF;">(</span>eV<span style="color: #AE81FF;">)</span>
    <span style="color: #66D9EF;">S_prime</span> = <span style="color: #66D9EF;">S_prime</span> - dx
    γ = <span style="color: #66D9EF;">E_to_γ</span><span style="color: #AE81FF;">(</span><span style="color: #FD971F;">result</span>.to<span style="color: #66D9EF;">(</span><span style="color: #66D9EF;">GeV</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
    totalLoss = totalLoss + <span style="color: #66D9EF;">E_loss</span>.to<span style="color: #AE81FF;">(</span>eV<span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">echo</span> <span style="color: #E6DB74;">&quot;total Loss &quot;</span>, totalLoss.to<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">GeV</span><span style="color: #AE81FF;">)</span>
  <span style="color: #FD971F;">result</span> = <span style="color: #F92672;">max</span><span style="color: #AE81FF;">(</span><span style="font-style: italic;">0</span>.<span style="color: #66D9EF;">float</span>, <span style="color: #FD971F;">result</span>.<span style="color: #66D9EF;">float</span><span style="color: #AE81FF;">)</span>.eV

<span style="color: #F92672;">block</span> <span style="color: #66D9EF;">MuonLimits</span>:
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">τ_μ </span>= <span style="font-style: italic;">2</span>.<span style="font-style: italic;">1969811</span>.μs
  <span style="color: #75715E;"># </span><span style="color: #75715E;">naively this means given some distance `</span><span style="color: #AE81FF;">s</span><span style="color: #75715E;">` the muon can</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">traverse `</span><span style="color: #AE81FF;">s = c • τ_μ</span><span style="color: #75715E;">` (approximating its speed by `</span><span style="color: #AE81FF;">c</span><span style="color: #75715E;">`) before</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">it has decayed with a 1/e chance</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">due to special relativity this is extended by γ</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">s </span>= c * τ_μ
  <span style="color: #F92672;">echo</span> s
  <span style="color: #75715E;"># </span><span style="color: #75715E;">given production in 15 km, means</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">h </span>= <span style="font-style: italic;">15</span>.km
  <span style="color: #F92672;">echo</span> h / s
  <span style="color: #75715E;"># </span><span style="color: #75715E;">so a reduction of (1/e)^22. So 0.</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">now it&apos;s not 15 km but under an angle `</span><span style="color: #AE81FF;">θ = 88°</span><span style="color: #75715E;">`.</span>
  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">R_over_d</span> = <span style="font-style: italic;">174</span>.<span style="color: #66D9EF;">UnitLess</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">n </span>= <span style="font-style: italic;">3</span>.<span style="font-style: italic;">0</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">E</span>₀ = <span style="font-style: italic;">25</span>.<span style="font-style: italic;">0</span>.<span style="color: #66D9EF;">GeV</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">I</span>₀ = <span style="font-style: italic;">90</span>.<span style="font-style: italic;">0</span>.m⁻²•s⁻¹•sr⁻¹
  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">E_c</span> = <span style="font-style: italic;">1</span>.<span style="color: #66D9EF;">GeV</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">ε </span>= <span style="font-style: italic;">2000</span>.<span style="color: #66D9EF;">GeV</span>

  <span style="color: #75715E;"># </span><span style="color: #75715E;">distance atmospher gives S / d, where `</span><span style="color: #AE81FF;">d</span><span style="color: #75715E;">` corresponds to our `</span><span style="color: #AE81FF;">h</span><span style="color: #75715E;">` up there</span>
  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">S</span> = h * distanceAtmosphere<span style="color: #AE81FF;">(</span><span style="font-style: italic;">88</span>.<span style="font-style: italic;">0</span>.degToRad.rad<span style="color: #AE81FF;">)</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">so about 203 km</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">so let&apos;s say 5 * mean distance is ok, means we ned</span>
  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">S_max</span> = <span style="color: #66D9EF;">S</span> / <span style="font-style: italic;">5</span>.<span style="font-style: italic;">0</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">so need a `</span><span style="color: #AE81FF;">γ</span><span style="color: #75715E;">` such that `</span><span style="color: #AE81FF;">s</span><span style="color: #75715E;">` is stretched to `</span><span style="color: #AE81FF;">S_max</span><span style="color: #75715E;">`</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">γ </span>= <span style="color: #66D9EF;">S_max</span> / s
  <span style="color: #F92672;">echo</span> γ
  <span style="color: #75715E;"># </span><span style="color: #75715E;">ouch. Something has to be wrong. γ of 61?</span>

  <span style="color: #75715E;"># </span><span style="color: #75715E;">corresponds to an energy loss of what?</span>
  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">Nitrogen</span> = initElement<span style="color: #AE81FF;">(</span><span style="font-style: italic;">7</span>.<span style="font-style: italic;">0</span>.<span style="color: #66D9EF;">UnitLess</span>, <span style="font-style: italic;">14</span>.<span style="font-style: italic;">006</span>.g•mol⁻¹, <span style="font-style: italic;">1</span>.<span style="font-style: italic;">2506</span>.g•dm⁻³.to<span style="color: #66D9EF;">(</span>g•cm⁻³<span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">echo</span> <span style="color: #E6DB74;">&quot;================================================================================&quot;</span>
  <span style="color: #F92672;">echo</span> <span style="color: #E6DB74;">&quot;Energy left: &quot;</span>, intBethe<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">Nitrogen</span>, <span style="color: #66D9EF;">S</span>.to<span style="color: #66D9EF;">(</span>cm<span style="color: #66D9EF;">)</span>, <span style="font-style: italic;">6</span>.<span style="color: #66D9EF;">GeV</span>.to<span style="color: #66D9EF;">(</span>eV<span style="color: #66D9EF;">)</span>, dx = <span style="font-style: italic;">1</span>.m.to<span style="color: #66D9EF;">(</span>μm<span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>.to<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">GeV</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">print</span><span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">E</span>: <span style="color: #66D9EF;">GeV</span>, θ: <span style="color: #66D9EF;">Radian</span><span style="color: #AE81FF;">)</span> =
    <span style="color: #F92672;">let</span> <span style="color: #FD971F;">left </span>= intBetheAtmosphere<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">E</span>, θ = θ<span style="color: #AE81FF;">)</span>.to<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">GeV</span><span style="color: #AE81FF;">)</span>
    <span style="color: #F92672;">echo</span> <span style="color: #E6DB74;">&quot;E = &quot;</span>, <span style="color: #66D9EF;">E</span>, <span style="color: #E6DB74;">&quot;, θ = &quot;</span>, θ, <span style="color: #E6DB74;">&quot;, Bethe = &quot;</span>, <span style="color: #66D9EF;">E</span> - left
  print<span style="color: #AE81FF;">(</span><span style="font-style: italic;">6</span>.<span style="color: #66D9EF;">GeV</span>, <span style="font-style: italic;">0</span>.<span style="color: #66D9EF;">Radian</span><span style="color: #AE81FF;">)</span>
  <span style="color: #75715E;">#</span><span style="color: #75715E;">print(200.GeV, 0.Radian)  </span>
  <span style="color: #75715E;">#</span><span style="color: #75715E;">print(200.GeV, 88.°.to(Radian))</span>
  <span style="color: #75715E;">#</span><span style="color: #75715E;">print(200.GeV, 75.°.to(Radian))</span>

  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">E_loss75</span> = <span style="font-style: italic;">100</span>.<span style="color: #66D9EF;">GeV</span> - intBetheAtmosphere<span style="color: #AE81FF;">(</span><span style="font-style: italic;">100</span>.<span style="color: #66D9EF;">GeV</span>, <span style="font-style: italic;">75</span>.°.to<span style="color: #66D9EF;">(</span><span style="color: #66D9EF;">Radian</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>.to<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">GeV</span><span style="color: #AE81FF;">)</span>
  plotE_vs_flux<span style="color: #AE81FF;">(</span><span style="font-style: italic;">75</span>.°.to<span style="color: #66D9EF;">(</span><span style="color: #66D9EF;">Radian</span><span style="color: #66D9EF;">)</span>,
                <span style="color: #66D9EF;">E_loss75</span>, <span style="color: #75715E;">#</span><span style="color: #75715E;">23.78.GeV, #25.GeV, #E_loss75,</span>
                <span style="font-style: italic;">1</span>.<span style="font-style: italic;">0</span>.<span style="color: #66D9EF;">GeV</span>,
                <span style="font-style: italic;">90</span>.m⁻²•s⁻¹•sr⁻¹, <span style="color: #75715E;">#</span><span style="color: #75715E;">65.2.m⁻²•s⁻¹•sr⁻¹,</span>
                <span style="font-style: italic;">2000</span>.<span style="color: #66D9EF;">GeV</span>, <span style="color: #75715E;"># </span><span style="color: #75715E;">854.GeV,</span>
                <span style="color: #E6DB74;">&quot;_at_75deg&quot;</span><span style="color: #AE81FF;">)</span>

  
  <span style="color: #F92672;">echo</span> <span style="color: #E6DB74;">&quot;S@75° = &quot;</span>, h * distanceAtmosphere<span style="color: #AE81FF;">(</span><span style="font-style: italic;">75</span>.<span style="font-style: italic;">0</span>.degToRad.rad, d = <span style="font-style: italic;">15</span>.<span style="font-style: italic;">0</span>.km<span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">echo</span> <span style="color: #E6DB74;">&quot;================================================================================&quot;</span>  
<span style="color: #F92672;">echo</span> <span style="color: #66D9EF;">E_to_γ</span><span style="color: #AE81FF;">(</span><span style="font-style: italic;">4</span>.<span style="color: #66D9EF;">GeV</span><span style="color: #AE81FF;">)</span>
<span style="color: #F92672;">echo</span> <span style="color: #66D9EF;">E_to_γ</span><span style="color: #AE81FF;">(</span><span style="font-style: italic;">0</span>.<span style="color: #66D9EF;">GeV</span><span style="color: #AE81FF;">)</span>

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">plotE_vs_flux_and_angles</span><span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">E_c</span>: <span style="color: #66D9EF;">GeV</span>, I₀: m⁻²•s⁻¹•sr⁻¹, ε: <span style="color: #66D9EF;">GeV</span>,
                              suffix = <span style="color: #E6DB74;">&quot;&quot;</span><span style="color: #AE81FF;">)</span> =
  <span style="color: #E6DB74;">## Generates a plot of the muon flux vs energy for a fixed set of different</span>
  <span style="color: #E6DB74;">## angles.</span>
  <span style="color: #E6DB74;">##</span>
  <span style="color: #E6DB74;">## The energy loss is computed using a fixed </span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">energies </span>= logspace<span style="color: #AE81FF;">(</span>log10<span style="color: #66D9EF;">(</span><span style="color: #66D9EF;">E_c</span>.<span style="color: #66D9EF;">float</span><span style="color: #66D9EF;">)</span>, <span style="font-style: italic;">2</span>.<span style="color: #66D9EF;">float</span>, <span style="font-style: italic;">1000</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">angles </span>= linspace<span style="color: #AE81FF;">(</span><span style="font-style: italic;">0</span>.<span style="font-style: italic;">0</span>, <span style="font-style: italic;">80</span>.<span style="font-style: italic;">0</span>, <span style="font-style: italic;">9</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">block</span> <span style="color: #66D9EF;">CalcLossEachMuon</span>:
    <span style="color: #F92672;">var</span> <span style="color: #FD971F;">df </span>= newDataFrame<span style="color: #AE81FF;">()</span>
    <span style="color: #F92672;">for</span> angle <span style="color: #F92672;">in</span> angles:
      <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">E</span> = energies.mapIt<span style="color: #AE81FF;">(</span>it.<span style="color: #66D9EF;">GeV</span><span style="color: #AE81FF;">)</span>
      <span style="color: #F92672;">let</span> <span style="color: #FD971F;">θ </span>= angle.°.to<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">Radian</span><span style="color: #AE81FF;">)</span>
      <span style="color: #F92672;">var</span> <span style="color: #FD971F;">flux </span>= <span style="color: #F92672;">newSeq</span><span style="color: #AE81FF;">[</span><span style="color: #66D9EF;">float</span><span style="color: #AE81FF;">]()</span>
      <span style="color: #F92672;">var</span> <span style="color: #66D9EF;">E_initials</span> = <span style="color: #F92672;">newSeq</span><span style="color: #AE81FF;">[</span><span style="color: #66D9EF;">float</span><span style="color: #AE81FF;">]()</span>
      <span style="color: #F92672;">var</span> <span style="color: #66D9EF;">E_lefts</span> = <span style="color: #F92672;">newSeq</span><span style="color: #AE81FF;">[</span><span style="color: #66D9EF;">float</span><span style="color: #AE81FF;">]()</span>
      <span style="color: #F92672;">var</span> <span style="color: #FD971F;">lastDropped </span>= <span style="font-style: italic;">0</span>.<span style="color: #66D9EF;">GeV</span>
      <span style="color: #F92672;">for</span> e <span style="color: #F92672;">in</span> <span style="color: #66D9EF;">E</span>:
        <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">E_left</span> = intBetheAtmosphere<span style="color: #AE81FF;">(</span>e, θ<span style="color: #AE81FF;">)</span>.to<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">GeV</span><span style="color: #AE81FF;">)</span>
        <span style="color: #F92672;">if</span> <span style="color: #66D9EF;">E_left</span> &lt;= <span style="font-style: italic;">0</span>.<span style="font-style: italic;">0</span>.<span style="color: #66D9EF;">GeV</span>:
          <span style="color: #F92672;">echo</span> <span style="color: #E6DB74;">&quot;Skipping energy : &quot;</span>, e, <span style="color: #E6DB74;">&quot; as muon was lost in atmosphere&quot;</span>
          <span style="color: #F92672;">continue</span>
        <span style="color: #F92672;">elif</span> <span style="color: #66D9EF;">E_left</span> &lt;= <span style="color: #66D9EF;">E_c</span>:
          <span style="color: #F92672;">echo</span> <span style="color: #E6DB74;">&quot;Skipping energy : &quot;</span>, e, <span style="color: #E6DB74;">&quot; as muon has less than E_c = &quot;</span>, <span style="color: #66D9EF;">E_c</span>, <span style="color: #E6DB74;">&quot; energy left&quot;</span>
          lastDropped = e
          <span style="color: #F92672;">continue</span>
        <span style="color: #F92672;">let</span> <span style="color: #FD971F;">E</span>₀ = e - <span style="color: #66D9EF;">E_left</span>
        flux.<span style="color: #F92672;">add</span> muonFlux<span style="color: #AE81FF;">(</span>e, θ, E₀, <span style="color: #66D9EF;">E_c</span>, I₀, ε<span style="color: #AE81FF;">)</span>.<span style="color: #66D9EF;">float</span>
        <span style="color: #66D9EF;">E_initials</span>.<span style="color: #F92672;">add</span> e.<span style="color: #66D9EF;">float</span>        
        <span style="color: #66D9EF;">E_lefts</span>.<span style="color: #F92672;">add</span> <span style="color: #66D9EF;">E_left</span>.<span style="color: #66D9EF;">float</span>
      <span style="color: #F92672;">let</span> <span style="color: #FD971F;">dfLoc </span>= toDf<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">{</span><span style="color: #66D9EF;">E_initials</span>, <span style="color: #66D9EF;">E_lefts</span>, flux, <span style="color: #E6DB74;">&quot;angle [°]&quot;</span> : angle<span style="color: #66D9EF;">}</span><span style="color: #AE81FF;">)</span>
      <span style="color: #75715E;">#  </span><span style="color: #75715E;">.filter(f{`</span><span style="color: #AE81FF;">E_initials</span><span style="color: #75715E;">` &gt;= lastDropped.float})</span>
      df.<span style="color: #F92672;">add</span> dfLoc

    <span style="color: #F92672;">var</span> <span style="color: #FD971F;">theme </span>= themeLatex<span style="color: #AE81FF;">(</span>fWidth = <span style="font-style: italic;">0</span>.<span style="font-style: italic;">5</span>, width = <span style="font-style: italic;">600</span>, baseTheme = sideBySide<span style="color: #AE81FF;">)</span>
    theme.tickWidth = some<span style="color: #AE81FF;">(</span>theme.tickWidth.get / <span style="font-style: italic;">2</span>.<span style="font-style: italic;">0</span><span style="color: #AE81FF;">)</span>
    theme.tickLength = some<span style="color: #AE81FF;">(</span>theme.tickLength.get / <span style="font-style: italic;">2</span>.<span style="font-style: italic;">0</span><span style="color: #AE81FF;">)</span>    
    theme.gridLineWidth = some<span style="color: #AE81FF;">(</span>theme.gridLineWidth.get / <span style="font-style: italic;">2</span>.<span style="font-style: italic;">0</span><span style="color: #AE81FF;">)</span>    
    ggplot<span style="color: #AE81FF;">(</span>df, aes<span style="color: #66D9EF;">(</span><span style="color: #E6DB74;">&quot;E_initials&quot;</span>, <span style="color: #E6DB74;">&quot;flux&quot;</span>, color = factor<span style="color: #A6E22E;">(</span><span style="color: #E6DB74;">&quot;angle [°]&quot;</span><span style="color: #A6E22E;">)</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span> +
      geom_line<span style="color: #AE81FF;">()</span> +
      xlab<span style="color: #AE81FF;">(</span>r<span style="color: #E6DB74;">&quot;Initial energy [\si{GeV}]&quot;</span><span style="color: #AE81FF;">)</span> + ylab<span style="color: #AE81FF;">(</span>r<span style="color: #E6DB74;">&quot;Flux [\si{m^{-2}.s^{-1}.sr^{-1}}]&quot;</span>, margin = <span style="font-style: italic;">2</span>.<span style="font-style: italic;">5</span><span style="color: #AE81FF;">)</span> +
      scale_x_log10<span style="color: #AE81FF;">()</span> + scale_y_log10<span style="color: #AE81FF;">()</span> +
      margin<span style="color: #AE81FF;">(</span>right = <span style="font-style: italic;">3</span>.<span style="font-style: italic;">0</span><span style="color: #AE81FF;">)</span> + 
      ggtitle<span style="color: #AE81FF;">(</span>&amp;<span style="color: #E6DB74;">&quot;Muon flux at different angles{suffix}&quot;</span><span style="color: #AE81FF;">)</span> +
      theme + 
      ggsave<span style="color: #AE81FF;">(</span>&amp;<span style="color: #E6DB74;">&quot;/home/basti/phd/Figs/muons/initial_energy_vs_flux_and_angle_cosmic_muons{suffix}.pdf&quot;</span>,
             useTeX = <span style="color: #AE81FF;">true</span>, standalone = <span style="color: #AE81FF;">true</span>, width = <span style="font-style: italic;">600</span>, height = <span style="font-style: italic;">450</span><span style="color: #AE81FF;">)</span>
  
    ggplot<span style="color: #AE81FF;">(</span>df, aes<span style="color: #66D9EF;">(</span><span style="color: #E6DB74;">&quot;E_lefts&quot;</span>, <span style="color: #E6DB74;">&quot;flux&quot;</span>, color = factor<span style="color: #A6E22E;">(</span><span style="color: #E6DB74;">&quot;angle [°]&quot;</span><span style="color: #A6E22E;">)</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span> +
      geom_line<span style="color: #AE81FF;">()</span> +
      xlab<span style="color: #AE81FF;">(</span>r<span style="color: #E6DB74;">&quot;Energy at surface [\si{GeV}]&quot;</span><span style="color: #AE81FF;">)</span> + ylab<span style="color: #AE81FF;">(</span>r<span style="color: #E6DB74;">&quot;Flux [\si{m^{-2}.s^{-1}.sr^{-1}}]&quot;</span>, margin = <span style="font-style: italic;">2</span>.<span style="font-style: italic;">5</span><span style="color: #AE81FF;">)</span> +
      scale_x_log10<span style="color: #AE81FF;">()</span> + scale_y_log10<span style="color: #AE81FF;">()</span> +
      margin<span style="color: #AE81FF;">(</span>right = <span style="font-style: italic;">3</span>.<span style="font-style: italic;">0</span><span style="color: #AE81FF;">)</span> +       
      theme + 
      ggtitle<span style="color: #AE81FF;">(</span>&amp;<span style="color: #E6DB74;">&quot;Muon flux at different angles{suffix}&quot;</span><span style="color: #AE81FF;">)</span> +
      ggsave<span style="color: #AE81FF;">(</span>&amp;<span style="color: #E6DB74;">&quot;/home/basti/phd/Figs/muons/final_energy_vs_flux_and_angle_cosmic_muons{suffix}.pdf&quot;</span>,
             useTeX = <span style="color: #AE81FF;">true</span>, standalone = <span style="color: #AE81FF;">true</span>, width = <span style="font-style: italic;">600</span>, height = <span style="font-style: italic;">450</span><span style="color: #AE81FF;">)</span>              
  <span style="color: #F92672;">block</span> <span style="color: #66D9EF;">StaticLoss</span>:
    <span style="color: #F92672;">var</span> <span style="color: #FD971F;">df </span>= newDataFrame<span style="color: #AE81FF;">()</span>
    <span style="color: #F92672;">for</span> angle <span style="color: #F92672;">in</span> angles:
      <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">E</span> = energies.mapIt<span style="color: #AE81FF;">(</span>it.<span style="color: #66D9EF;">GeV</span><span style="color: #AE81FF;">)</span>
      <span style="color: #F92672;">let</span> <span style="color: #FD971F;">θ </span>= angle.°.to<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">Radian</span><span style="color: #AE81FF;">)</span>
      <span style="color: #F92672;">let</span> <span style="color: #FD971F;">E</span>₀ = <span style="font-style: italic;">100</span>.<span style="color: #66D9EF;">GeV</span> - intBetheAtmosphere<span style="color: #AE81FF;">(</span><span style="font-style: italic;">100</span>.<span style="color: #66D9EF;">GeV</span>, <span style="font-style: italic;">0</span>.<span style="font-style: italic;">0</span>.<span style="color: #66D9EF;">Radian</span><span style="color: #AE81FF;">)</span>.to<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">GeV</span><span style="color: #AE81FF;">)</span>    
      <span style="color: #F92672;">let</span> <span style="color: #FD971F;">flux </span>= <span style="color: #66D9EF;">E</span>.mapIt<span style="color: #AE81FF;">(</span>muonFlux<span style="color: #66D9EF;">(</span>it, θ, E₀, <span style="color: #66D9EF;">E_c</span>, I₀, ε<span style="color: #66D9EF;">)</span>.<span style="color: #66D9EF;">float</span><span style="color: #AE81FF;">)</span>
      <span style="color: #F92672;">let</span> <span style="color: #FD971F;">dfLoc </span>= toDf<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">{</span>energies, flux, <span style="color: #E6DB74;">&quot;angle [°]&quot;</span> : angle<span style="color: #66D9EF;">}</span><span style="color: #AE81FF;">)</span>
      df.<span style="color: #F92672;">add</span> dfLoc
    ggplot<span style="color: #AE81FF;">(</span>df, aes<span style="color: #66D9EF;">(</span><span style="color: #E6DB74;">&quot;energies&quot;</span>, <span style="color: #E6DB74;">&quot;flux&quot;</span>, color = factor<span style="color: #A6E22E;">(</span><span style="color: #E6DB74;">&quot;angle [°]&quot;</span><span style="color: #A6E22E;">)</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span> +
      geom_line<span style="color: #AE81FF;">()</span> +
      xlab<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;Energy [GeV]&quot;</span><span style="color: #AE81FF;">)</span> + ylab<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;Flux [m⁻²•s⁻¹•sr⁻¹]&quot;</span><span style="color: #AE81FF;">)</span> +
      scale_x_log10<span style="color: #AE81FF;">()</span> + scale_y_log10<span style="color: #AE81FF;">()</span> +
      ggtitle<span style="color: #AE81FF;">(</span>&amp;<span style="color: #E6DB74;">&quot;Differential muon flux dependency at different angles{suffix}&quot;</span><span style="color: #AE81FF;">)</span> +
      ggsave<span style="color: #AE81FF;">(</span>&amp;<span style="color: #E6DB74;">&quot;/home/basti/phd/Figs/muons/energy_vs_flux_and_angle_cosmic_muons{suffix}.pdf&quot;</span><span style="color: #AE81FF;">)</span>


<span style="color: #75715E;">#</span><span style="color: #75715E;">proc plotE_vs_flux_and_angles(E_c: GeV, I₀: m⁻²•s⁻¹•sr⁻¹, ε: GeV,</span>
<span style="color: #75715E;">#                              </span><span style="color: #75715E;">suffix = &quot;&quot;) =</span>
<span style="color: #75715E;">#  </span><span style="color: #75715E;">## Generates a plot of the integrated muon flux vs angles for a fixed set of different</span>
<span style="color: #75715E;">#  </span><span style="color: #75715E;">## energies.</span>
<span style="color: #75715E;">#  </span><span style="color: #75715E;">let angles = linspace(0.0, 90.0, 100)</span>
<span style="color: #75715E;">#  </span><span style="color: #75715E;">var df = newDataFrame()</span>
<span style="color: #75715E;">#  </span><span style="color: #75715E;">let energies = linspace(E_c.float, 100.0, 1000)</span>
<span style="color: #75715E;">#  </span><span style="color: #75715E;">let E = energies.mapIt(it.GeV)</span>
<span style="color: #75715E;">#  </span><span style="color: #75715E;">for angle in angles:</span>
<span style="color: #75715E;">#    </span><span style="color: #75715E;">let θ = angle.°.to(Radian)</span>
<span style="color: #75715E;">#    </span><span style="color: #75715E;">let E₀ = 100.GeV - intBetheAtmosphere(100.GeV, θ).to(GeV)</span>
<span style="color: #75715E;">#    </span><span style="color: #75715E;">let flux = E.mapIt(muonFlux(it, θ, E₀, E_c, I₀, ε).float) </span>
<span style="color: #75715E;">#    </span><span style="color: #75715E;">let dfLoc = toDf({energies, flux, &quot;angle [°]&quot; : angle})</span>
<span style="color: #75715E;">#    </span><span style="color: #75715E;">df.add dfLoc</span>
<span style="color: #75715E;">#  </span><span style="color: #75715E;">ggplot(df, aes(&quot;energies&quot;, &quot;flux&quot;, color = factor(&quot;angle [°]&quot;))) +</span>
<span style="color: #75715E;">#    </span><span style="color: #75715E;">geom_line() +</span>
<span style="color: #75715E;">#    </span><span style="color: #75715E;">xlab(&quot;Energy [GeV]&quot;) + ylab(&quot;Flux [m⁻²•s⁻¹•sr⁻¹]&quot;) +</span>
<span style="color: #75715E;">#    </span><span style="color: #75715E;">scale_x_log10() + scale_y_log10() +</span>
<span style="color: #75715E;">#    </span><span style="color: #75715E;">ggtitle(&amp;&quot;Differential muon flux dependency at different angles{suffix}&quot;) +</span>
<span style="color: #75715E;">#    </span><span style="color: #75715E;">ggsave(&amp;&quot;/home/basti/phd/Figs/muons/energy_vs_flux_and_angle_cosmic_muons{suffix}.pdf&quot;)</span>

<span style="color: #75715E;"># </span><span style="color: #75715E;">different angles!      </span>
<span style="color: #F92672;">block</span> <span style="color: #66D9EF;">MuonBehavior</span>:
  plotE_vs_flux_and_angles<span style="color: #AE81FF;">(</span><span style="font-style: italic;">0</span>.<span style="font-style: italic;">3</span>.<span style="color: #66D9EF;">GeV</span>, <span style="font-style: italic;">90</span>.m⁻²•s⁻¹•sr⁻¹, <span style="font-style: italic;">854</span>.<span style="color: #66D9EF;">GeV</span><span style="color: #AE81FF;">)</span>

<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">unbinnedCdf</span><span style="color: #AE81FF;">(</span>x: <span style="color: #66D9EF;">seq</span><span style="color: #66D9EF;">[</span><span style="color: #66D9EF;">float</span><span style="color: #66D9EF;">]</span><span style="color: #AE81FF;">)</span>: <span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">seq</span><span style="color: #66D9EF;">[</span><span style="color: #66D9EF;">float</span><span style="color: #66D9EF;">]</span>, <span style="color: #66D9EF;">seq</span><span style="color: #66D9EF;">[</span><span style="color: #66D9EF;">float</span><span style="color: #66D9EF;">]</span><span style="color: #AE81FF;">)</span> =
  <span style="color: #E6DB74;">## Computes the CDF of unbinned data</span>
  <span style="color: #F92672;">var</span> <span style="color: #FD971F;">cdf </span>= <span style="color: #F92672;">newSeq</span><span style="color: #AE81FF;">[</span><span style="color: #66D9EF;">float</span><span style="color: #AE81FF;">](</span>x.<span style="color: #F92672;">len</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">for</span> i <span style="color: #F92672;">in</span> <span style="font-style: italic;">0</span> ..&lt; x.<span style="color: #F92672;">len</span>:
    cdf<span style="color: #AE81FF;">[</span>i<span style="color: #AE81FF;">]</span> = i.<span style="color: #66D9EF;">float</span> / x.<span style="color: #F92672;">len</span>.<span style="color: #66D9EF;">float</span>
  <span style="color: #FD971F;">result</span> = <span style="color: #AE81FF;">(</span>x.sorted, cdf<span style="color: #AE81FF;">)</span>

<span style="color: #F92672;">import</span> random, algorithm
<span style="color: #F92672;">proc</span> <span style="color: #A6E22E;">sampleFlux</span><span style="color: #AE81FF;">(</span>samples = <span style="font-style: italic;">1_000_000</span><span style="color: #AE81FF;">)</span>: <span style="color: #66D9EF;">DataFrame</span> =
  randomize<span style="color: #AE81FF;">(</span><span style="font-style: italic;">1337</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">energies </span>= linspace<span style="color: #AE81FF;">(</span><span style="font-style: italic;">0</span>.<span style="font-style: italic;">1</span>, <span style="font-style: italic;">100</span>.<span style="font-style: italic;">0</span>, <span style="font-style: italic;">100_000</span><span style="color: #AE81FF;">)</span>
  <span style="color: #75715E;">#</span><span style="color: #75715E;">let energies = logspace(0, 2, 1000)</span>
  <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">E</span> = energies.mapIt<span style="color: #AE81FF;">(</span>it.<span style="color: #66D9EF;">GeV</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">flux </span>= <span style="color: #66D9EF;">E</span>.mapIt<span style="color: #AE81FF;">(</span>muonFlux<span style="color: #66D9EF;">(</span>it, <span style="font-style: italic;">88</span>.<span style="font-style: italic;">0</span>.degToRad.<span style="color: #66D9EF;">Radian</span>, E₀, <span style="color: #66D9EF;">E_c</span>, I₀, ε<span style="color: #66D9EF;">)</span>.<span style="color: #66D9EF;">float</span><span style="color: #AE81FF;">)</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">given flux compute CDF</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">fluxCS </span>= flux.cumSum<span style="color: #AE81FF;">()</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">fluxCS_sorted </span>= flux.sorted.cumSum<span style="color: #AE81FF;">()</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">fluxCDF </span>= fluxCS.mapIt<span style="color: #AE81FF;">(</span>it / fluxCS<span style="color: #66D9EF;">[</span>^<span style="font-style: italic;">1</span><span style="color: #66D9EF;">]</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">fluxCDF_sorted </span>= fluxCS_sorted.mapIt<span style="color: #AE81FF;">(</span>it / fluxCS_sorted<span style="color: #66D9EF;">[</span>^<span style="font-style: italic;">1</span><span style="color: #66D9EF;">]</span><span style="color: #AE81FF;">)</span>

  <span style="color: #F92672;">let</span> <span style="color: #AE81FF;">(</span>data, cdf<span style="color: #AE81FF;">)</span> = unbinnedCdf<span style="color: #AE81FF;">(</span>flux<span style="color: #AE81FF;">)</span>

  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">dfX </span>= toDf<span style="color: #AE81FF;">(</span>energies, fluxCS, fluxCS_sorted, fluxCDF, fluxCDF_sorted<span style="color: #AE81FF;">)</span>
  ggplot<span style="color: #AE81FF;">(</span>dfX, aes<span style="color: #66D9EF;">(</span><span style="color: #E6DB74;">&quot;energies&quot;</span>, <span style="color: #E6DB74;">&quot;fluxCS&quot;</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span> +
    geom_line<span style="color: #AE81FF;">()</span> +
    ggsave<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;/t/cumsum_test.pdf&quot;</span><span style="color: #AE81FF;">)</span>
  ggplot<span style="color: #AE81FF;">(</span>dfX, aes<span style="color: #66D9EF;">(</span><span style="color: #E6DB74;">&quot;energies&quot;</span>, <span style="color: #E6DB74;">&quot;fluxCDF&quot;</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span> +
    geom_line<span style="color: #AE81FF;">()</span> +
    ggsave<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;/t/cdf_test.pdf&quot;</span><span style="color: #AE81FF;">)</span>    
  ggplot<span style="color: #AE81FF;">(</span>dfX, aes<span style="color: #66D9EF;">(</span><span style="color: #E6DB74;">&quot;energies&quot;</span>, <span style="color: #E6DB74;">&quot;fluxCS_sorted&quot;</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span> +
    geom_line<span style="color: #AE81FF;">()</span> +
    ggsave<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;/t/cumsum_sorted_test.pdf&quot;</span><span style="color: #AE81FF;">)</span>    
  ggplot<span style="color: #AE81FF;">(</span>dfX, aes<span style="color: #66D9EF;">(</span><span style="color: #E6DB74;">&quot;energies&quot;</span>, <span style="color: #E6DB74;">&quot;fluxCDF_sorted&quot;</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span> +
    geom_line<span style="color: #AE81FF;">()</span> +
    ggsave<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;/t/cdf_sorted_test.pdf&quot;</span><span style="color: #AE81FF;">)</span>

  ggplot<span style="color: #AE81FF;">(</span>toDf<span style="color: #66D9EF;">(</span>data, cdf<span style="color: #66D9EF;">)</span>, aes<span style="color: #66D9EF;">(</span><span style="color: #E6DB74;">&quot;data&quot;</span>, <span style="color: #E6DB74;">&quot;cdf&quot;</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span> +
    geom_line<span style="color: #AE81FF;">()</span> +
    ggsave<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;/t/unbinned_cdf.pdf&quot;</span><span style="color: #AE81FF;">)</span>
  
  <span style="color: #75715E;">#</span><span style="color: #75715E;">if true: quit()</span>
  <span style="color: #F92672;">var</span> <span style="color: #FD971F;">lossesBB </span>= <span style="color: #F92672;">newSeq</span><span style="color: #AE81FF;">[</span><span style="color: #66D9EF;">float</span><span style="color: #AE81FF;">]()</span>
  <span style="color: #F92672;">var</span> <span style="color: #FD971F;">lossesMP </span>= <span style="color: #F92672;">newSeq</span><span style="color: #AE81FF;">[</span><span style="color: #66D9EF;">float</span><span style="color: #AE81FF;">]()</span>
  <span style="color: #F92672;">var</span> <span style="color: #FD971F;">energySamples </span>= <span style="color: #F92672;">newSeq</span><span style="color: #AE81FF;">[</span><span style="color: #66D9EF;">float</span><span style="color: #AE81FF;">]()</span>

  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">dedxmin </span>= <span style="font-style: italic;">1</span>.<span style="font-style: italic;">519</span>.<span style="color: #66D9EF;">MeV</span>•cm²•g⁻¹
  <span style="color: #F92672;">echo</span> <span style="color: #E6DB74;">&quot;Loss = &quot;</span>, <span style="color: #AE81FF;">(</span>dedxmin * <span style="color: #66D9EF;">Argon</span>.ρ * <span style="font-style: italic;">3</span>.cm<span style="color: #AE81FF;">)</span>.to<span style="color: #AE81FF;">(</span>keV<span style="color: #AE81FF;">)</span>
  
  <span style="color: #F92672;">for</span> i <span style="color: #F92672;">in</span> <span style="font-style: italic;">0</span> ..&lt; samples:
    <span style="color: #75715E;"># </span><span style="color: #75715E;">given the fluxCDF sample different energies, which correspond to the</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">distribution expected at CAST</span>
    <span style="color: #F92672;">let</span> <span style="color: #FD971F;">idx </span>= fluxCdf.lowerBound<span style="color: #AE81FF;">(</span>rand<span style="color: #66D9EF;">(</span><span style="font-style: italic;">1</span>.<span style="font-style: italic;">0</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>
    <span style="color: #F92672;">let</span> <span style="color: #66D9EF;">E_element</span> = <span style="color: #66D9EF;">E</span><span style="color: #AE81FF;">[</span>idx<span style="color: #AE81FF;">]</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">given this energy `</span><span style="color: #AE81FF;">E</span><span style="color: #75715E;">` compute the loss</span>
    <span style="color: #F92672;">let</span> <span style="color: #FD971F;">lossBB </span>= <span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">E_element</span>.to<span style="color: #66D9EF;">(</span>eV<span style="color: #66D9EF;">)</span> - intBethe<span style="color: #66D9EF;">(</span><span style="color: #66D9EF;">Argon</span>, <span style="font-style: italic;">3</span>.cm, <span style="color: #66D9EF;">E_element</span>.to<span style="color: #A6E22E;">(</span>eV<span style="color: #A6E22E;">)</span>, dx = <span style="font-style: italic;">50</span>.μm<span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>.to<span style="color: #AE81FF;">(</span>keV<span style="color: #AE81FF;">)</span>.<span style="color: #66D9EF;">float</span>
    lossesBB.<span style="color: #F92672;">add</span> lossBB
    <span style="color: #F92672;">let</span> <span style="color: #FD971F;">lossMP </span>= mostProbableLoss<span style="color: #AE81FF;">(</span>-<span style="font-style: italic;">1</span>, <span style="color: #66D9EF;">Argon</span>.<span style="color: #66D9EF;">Z</span>, <span style="color: #66D9EF;">Argon</span>.<span style="color: #66D9EF;">M</span>, <span style="color: #66D9EF;">E_Element</span>.<span style="color: #66D9EF;">E_to_γ</span><span style="color: #66D9EF;">()</span>, <span style="color: #66D9EF;">Argon</span>.ρ * <span style="font-style: italic;">3</span>.cm<span style="color: #AE81FF;">)</span>
    lossesMP.<span style="color: #F92672;">add</span> lossMP.<span style="color: #66D9EF;">float</span>
    <span style="color: #75715E;">#</span><span style="color: #75715E;">echo &quot;Index &quot;, i, &quot; yields energy &quot;, E_element, &quot; and loss &quot;, loss</span>
    energySamples.<span style="color: #F92672;">add</span> <span style="color: #66D9EF;">E_element</span>.<span style="color: #66D9EF;">float</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">df </span>= toDf<span style="color: #AE81FF;">(</span>energySamples, lossesBB, lossesMP<span style="color: #AE81FF;">)</span>
    .gather<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">[</span><span style="color: #E6DB74;">&quot;lossesBB&quot;</span>, <span style="color: #E6DB74;">&quot;lossesMP&quot;</span><span style="color: #66D9EF;">]</span>, <span style="color: #E6DB74;">&quot;Type&quot;</span>, <span style="color: #E6DB74;">&quot;Value&quot;</span><span style="color: #AE81FF;">)</span>
  ggplot<span style="color: #AE81FF;">(</span>df, aes<span style="color: #66D9EF;">(</span><span style="color: #E6DB74;">&quot;Value&quot;</span>, fill = <span style="color: #E6DB74;">&quot;Type&quot;</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span> +
    geom_histogram<span style="color: #AE81FF;">(</span>bins = <span style="font-style: italic;">300</span>, hdKind = hdOutline, alpha = <span style="font-style: italic;">0</span>.<span style="font-style: italic;">5</span>, position = <span style="color: #E6DB74;">&quot;identity&quot;</span><span style="color: #AE81FF;">)</span> +
    margin<span style="color: #AE81FF;">(</span>top = <span style="font-style: italic;">2</span><span style="color: #AE81FF;">)</span> +
    xlim<span style="color: #AE81FF;">(</span><span style="font-style: italic;">5</span>, <span style="font-style: italic;">15</span><span style="color: #AE81FF;">)</span> +
    ggtitle<span style="color: #AE81FF;">(</span>&amp;<span style="color: #E6DB74;">&quot;Energy loss of muon flux at CAST based on MC sampling with {samples} samples&quot;</span><span style="color: #AE81FF;">)</span> +
    ggsave<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;/home/basti/phd/Figs/muons/sampled_energy_loss.pdf&quot;</span><span style="color: #AE81FF;">)</span>

  ggplot<span style="color: #AE81FF;">(</span>df, aes<span style="color: #66D9EF;">(</span><span style="color: #E6DB74;">&quot;energySamples&quot;</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span> +
    geom_histogram<span style="color: #AE81FF;">(</span>bins = <span style="font-style: italic;">300</span><span style="color: #AE81FF;">)</span> +
    margin<span style="color: #AE81FF;">(</span>top = <span style="font-style: italic;">2</span><span style="color: #AE81FF;">)</span> +
    ggtitle<span style="color: #AE81FF;">(</span>&amp;<span style="color: #E6DB74;">&quot;Sampled energies for energy loss of muon flux at CAST&quot;</span><span style="color: #AE81FF;">)</span> +
    ggsave<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;/home/basti/phd/Figs/muons/sampled_energy_for_energy_loss.pdf&quot;</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #AE81FF;">(</span>samples, bins<span style="color: #AE81FF;">)</span> = histogram<span style="color: #AE81FF;">(</span>energySamples, bins = <span style="font-style: italic;">300</span><span style="color: #AE81FF;">)</span>
  <span style="color: #F92672;">let</span> <span style="color: #FD971F;">dfH </span>= toDf<span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">{</span><span style="color: #E6DB74;">&quot;bins&quot;</span> : bins<span style="color: #A6E22E;">[</span><span style="font-style: italic;">0</span> ..&lt; ^<span style="font-style: italic;">1</span><span style="color: #A6E22E;">]</span>, samples<span style="color: #66D9EF;">}</span><span style="color: #AE81FF;">)</span>
    .filter<span style="color: #AE81FF;">(</span>f<span style="color: #66D9EF;">{</span>`bins` &gt; <span style="font-style: italic;">0</span>.<span style="font-style: italic;">0</span> <span style="color: #F92672;">and</span> `samples`.<span style="color: #66D9EF;">float</span> &gt; <span style="font-style: italic;">0</span>.<span style="font-style: italic;">0</span><span style="color: #66D9EF;">}</span><span style="color: #AE81FF;">)</span>
  ggplot<span style="color: #AE81FF;">(</span>dfH, aes<span style="color: #66D9EF;">(</span><span style="color: #E6DB74;">&quot;bins&quot;</span>, <span style="color: #E6DB74;">&quot;samples&quot;</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span> +
    geom_line<span style="color: #AE81FF;">()</span> +
    scale_x_log10<span style="color: #AE81FF;">()</span> + 
    margin<span style="color: #AE81FF;">(</span>top = <span style="font-style: italic;">2</span><span style="color: #AE81FF;">)</span> +
    ggtitle<span style="color: #AE81FF;">(</span>&amp;<span style="color: #E6DB74;">&quot;Sampled energies for energy loss of muon flux at CAST&quot;</span><span style="color: #AE81FF;">)</span> +
    ggsave<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;/home/basti/phd/Figs/muons/sampled_energy_for_energy_loss_manual.pdf&quot;</span><span style="color: #AE81FF;">)</span>

  ggplot<span style="color: #AE81FF;">(</span>toDf<span style="color: #66D9EF;">(</span>energies, flux<span style="color: #66D9EF;">)</span>, aes<span style="color: #66D9EF;">(</span><span style="color: #E6DB74;">&quot;energies&quot;</span>, <span style="color: #E6DB74;">&quot;flux&quot;</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span> +
    geom_line<span style="color: #AE81FF;">()</span> +
    scale_x_log10<span style="color: #AE81FF;">()</span> +
    ggsave<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;/tmp/starting_data_e_flux.pdf&quot;</span><span style="color: #AE81FF;">)</span>

  ggplot<span style="color: #AE81FF;">(</span>toDf<span style="color: #66D9EF;">(</span>energies, flux<span style="color: #66D9EF;">)</span>, aes<span style="color: #66D9EF;">(</span><span style="color: #E6DB74;">&quot;energies&quot;</span>, <span style="color: #E6DB74;">&quot;flux&quot;</span><span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span> +
    geom_line<span style="color: #AE81FF;">()</span> +
    ggsave<span style="color: #AE81FF;">(</span><span style="color: #E6DB74;">&quot;/tmp/linear_starting_data_e_flux.pdf&quot;</span><span style="color: #AE81FF;">)</span>
    

<span style="color: #F92672;">discard</span> sampleFlux<span style="color: #AE81FF;">(</span>samples = <span style="font-style: italic;">1_000_000</span><span style="color: #AE81FF;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-sh">ntangle thesis.org &amp;&amp; nim c -d:release code/muons
code/muons
</pre>
</div>
</div>
</div>
</div>


<div class="outline-3" id="outline-container-sec:theory:gas_fundamentals">
<h3 id="sec:theory:gas_fundamentals"><span class="section-number-3">6.3.</span> Gaseous detector fundamentals</h3>
<div class="outline-text-3" id="text-sec:theory:gas_fundamentals">
<p>
Gaseous detectors consist of a volume filled with gas, usually a noble
gas with a small amount of molecular gas. For low rate, low energy
experiments an entrance window allows the particles to be detected, to
enter. An electric field is applied over the gas volume, strong enough
to cause electron-ion pairs created by ionization of the incoming
particles to drift to opposite ends of the volume (magnetic fields may
be utilized in addition). At least on the side of the anode (where the
electrons arrive), a readout of some form is installed to measure the
time of arrival, amount of collected charge and / or the position of
the electrons. Depending on the details, this in principle allows for
a 3D reconstruction of the initial event in the gas volume. The
details of choice of detector gas, applied electric fields, gas volume
dimensions and types of readout have a very large impact on the
applications a detector is useful for. In the following we will focus
on the physics concepts required for gaseous detectors with few
\(\si{cm}\) long drift volumes and high spatial resolution readouts.
</p>

<p>
Note: this section covers the basic fundamentals that will be later
referenced in the thesis. For a much more in-depth understanding of
these concepts, see references (<a href="./bibliography.html#citeproc_bib_item_191">Sauli 2014</a>) and
(<a href="./bibliography.html#citeproc_bib_item_136">Kolanoski and Wermes 2020</a>) and to some extent the PDG
(<a href="./bibliography.html#citeproc_bib_item_244">Zyla and others 2020</a>) (in particular chapters on particle detectors and
passage of particles through matter; chapter number varies by year).
</p>
</div>

<div class="outline-4" id="outline-container-sec:theory:daltons_law">
<h4 id="sec:theory:daltons_law"><span class="section-number-4">6.3.1.</span> Gas mixtures and Dalton&apos;s law</h4>
<div class="outline-text-4" id="text-sec:theory:daltons_law">
<p>
Of common interest when dealing with gas mixtures is the notion of
partial pressures. In ideal gas theory, a mixture of gases at a
pressure \(P\) can be considered to be the sum of the &apos;partial
pressures&apos; of each gas species
</p>

<p>
\[
P = \sum_i p_i,
\]
</p>

<p>
initially noted by John Dalton in 1802 (<a href="./bibliography.html#citeproc_bib_item_76">Dalton 1802</a>).
</p>

<p>
The contribution of each gas only depends on the species&apos; mole
fraction. Typically when considering gas mixtures the fractions of
each gas species is given as a percentage. The percentage already
refers to the mole fraction of each species. As such, the partial
pressure of a single species can be expressed as:
</p>

<p>
\[
p_i = n_i P
\]
</p>

<p>
where \(n_i\) is the mole fraction of species \(i\).
</p>

<p>
This is an extremely valuable property when computing different
interactions of particles with gas mixtures. For example when
computing the absorption of X-rays after propagating through a certain
distance of a gas mixture, as one can compute absorption for each
partial pressure independently and combine the contributions after
(whether they be added, multiplied or something else of course depends
on the considered process).
</p>
</div>
</div>

<div class="outline-4" id="outline-container-orgdcca098">
<h4 id="orgdcca098"><span class="section-number-4">6.3.2.</span> Ionization energy and average energy per electron-ion pair</h4>
<div class="outline-text-4" id="text-6-3-2">
<p>
In order to understand the signals detected by a gaseous detector, the
average number of electrons liberated by an incident particle should
be known. This can be calculated given the energy loss in a gas required to
produce a single electron-ion pair, called the \(W\text{-value}\),
</p>

<p>
\[
W = \frac{I}{⟨N⟩}.
\]
</p>

<p>
Here, \(I\) is the mean ionization energy of the gas and \(⟨N⟩\) the
average number of electron-ion pairs generated per interaction. \(⟨N⟩\)
is usually smaller than one, \(\numrange{0.6}{0.7}\) for noble gases and
even below \(\num{0.5}\) for molecular gases. Not all energy of the
incoming particle is always deposited in the form of generation of,
for example, a photoelectron. Other forms of energy loss are
possible. In molecular gases vibrational and rotational modes offer
even more possibilities, resulting in the smaller values.
</p>

<p>
The mean excitation energy \(I\) of an element is the weighted
combination of the most likely energy levels the element is ionized
from. The exact values are dependent on the specific element and
tabulated values like from NIST (<a href="./bibliography.html#citeproc_bib_item_115">Hubbell and Seltzer 1996</a>) exist. Above some
\(Z\) (roughly argon, \(Z = 18\)) a rough approximation of \(I =
\SI{10}{eV} · Z\) can be substituted (<a href="./bibliography.html#citeproc_bib_item_244">Zyla and others 2020</a>), developed by
Bloch (<a href="./bibliography.html#citeproc_bib_item_47">Bloch 1933</a>).
</p>

<p>
The precise number for \(W\) strongly depends on the used gas mixture
and typically requires experimental measurements to determine. Monte
Carlo based simulations can be used as a rough guide, but care must be
taken interpreting the results as significant uncertainty can
remain. Tools for such Monte Carlo simulations include GEANT4
(<a href="./bibliography.html#citeproc_bib_item_4">Agostinelli and others 2003</a>) <sup>  <a role="doc-backlink" class="footref" id="fnr.7" href="#fn.7">7</a></sup> and MCNelectron
(<a href="./bibliography.html#citeproc_bib_item_178">Poškus 2015</a>) <sup>  <a role="doc-backlink" class="footref" id="fnr.8" href="#fn.8">8</a></sup>. These are
based on atomic excitation cross sections, which are well tabulated in
projects like ENDF (<a href="./bibliography.html#citeproc_bib_item_56">Brown et al. 2018</a>) (citation for the latest data
release) <sup>  <a role="doc-backlink" class="footref" id="fnr.9" href="#fn.9">9</a></sup> and LXCat
(<a href="./bibliography.html#citeproc_bib_item_165">Pancheshnyi et al. 2012</a>; <a href="./bibliography.html#citeproc_bib_item_176">Pitchford et al. 2016</a>; <a href="./bibliography.html#citeproc_bib_item_60">Carbone et al. 2021</a>) <sup>  <a role="doc-backlink" class="footref" id="fnr.10" href="#fn.10">10</a></sup>.
</p>
</div>
</div>


<div class="outline-4" id="outline-container-orged8b957">
<h4 id="orged8b957"><span class="section-number-4">6.3.3.</span> Mean free path</h4>
<div class="outline-text-4" id="text-6-3-3">
<p>
While we have already discussed the mean free path for X-rays in
sec. <a href="./theory_detector.html#sec:theory:xray_matter_gas">6.1.1</a>, we should revisit it quickly for
electrons in a gas. It is a necessary concept when trying to
understand other gaseous detector physics concepts, in particular for the gas
amplification. <sup>  <a role="doc-backlink" class="footref" id="fnr.11" href="#fn.11">11</a></sup>
</p>

<p>
The mean free path of an electron in a gas can be described by
</p>

\begin{equation}
\label{eq:theory:mean_free_path_e_def}
λ = \frac{1}{nσ}
\end{equation}

<p>
where \(n = N/V\) is the number density (atoms or molecules per unit
volume) of the gas particles and \(σ\) the cross section of electrons
interacting with them. Such cross sections are tabulated for different
elements, for example again see LXCat
(<a href="./bibliography.html#citeproc_bib_item_165">Pancheshnyi et al. 2012</a>; <a href="./bibliography.html#citeproc_bib_item_176">Pitchford et al. 2016</a>; <a href="./bibliography.html#citeproc_bib_item_60">Carbone et al. 2021</a>).
</p>

<p>
Based on the ideal gas law, we can express it as a function of
pressure \(p\) and temperature \(T\) to
</p>

<p>
\[
p V = N k_B T ⇔ p = n k_B T,
\]
</p>

<p>
with the Boltzmann constant \(k_B\).  Inserting this via \(n\) into
eq. \eqref{eq:theory:mean_free_path_e_def} yields
</p>

\begin{equation}
\label{eq:theory:mean_free_path_e}
λ = \frac{k_B T}{p σ}.
\end{equation}
</div>
</div>


<div class="outline-4" id="outline-container-sec:theory:gas_diffusion">
<h4 id="sec:theory:gas_diffusion"><span class="section-number-4">6.3.4.</span> Diffusion</h4>
<div class="outline-text-4" id="text-sec:theory:gas_diffusion">
<p>
Diffusion in the context of gaseous detectors is the process of the
random walk of electrons either in longitudinal or transverse (to the
electric field) direction they exhibit, when drifting towards the
readout. Depending on the specific detector technology, some
transverse diffusion may be a desired property. For long drift
distances, magnetic fields can be used to significantly reduce the
transverse diffusion.
</p>

<p>
For an overview of the mathematics of diffusion as a random walk
process, see (<a href="./bibliography.html#citeproc_bib_item_40">Berg 1993</a>). In the context of gaseous detectors
see for example any of
(<a href="./bibliography.html#citeproc_bib_item_191">Sauli 2014</a>; <a href="./bibliography.html#citeproc_bib_item_136">Kolanoski and Wermes 2020</a>; <a href="./bibliography.html#citeproc_bib_item_108">Hilke and Riegler 2020</a>) In general, for
precise numbers measurements must be taken. Monte Carlo simulations
using tools like Magboltz (<a href="./bibliography.html#citeproc_bib_item_43">Biagi 1995b</a>) or PyBoltz
(<a href="./bibliography.html#citeproc_bib_item_27">Atoum et al. 2020</a>) can be used as a general reference if no measurements are
available.
</p>

<p>
The mean distance \(σ_t\) from a starting point after a certain amount
of time \(t\) is given by
</p>

<p>
\[
σ_t = \sqrt{ 2 N D t }
\]
</p>

<p>
for a random walk in \(N\) dimensions, where \(D\) is a diffusion
coefficient specifying the movement in distance squared per time.  For
example for a point like source of multiple electrons, after diffusion
of some distance a 2 dimensional gaussian distribution will be
expected with a standard deviation of \(σ_t\). By relating the time to
the drift velocity \(v\) along an axis and introducing the diffusion
constant \(D_t\)
</p>

<p>
\[
D_t = \sqrt{ \frac{2 N D}{v} }
\]
</p>

<p>
we can further express \(σ_t\) as
</p>

\begin{equation}
\label{eq:gas_physics:diffusion_after_drift}
σ_t = D_t · \sqrt{x},
\end{equation}

<p>
which is often practically useful to estimate the expected diffusion
after a certain drift length. 
</p>

<p>
Note that the terminology of &quot;diffusion constant&quot;, &quot;diffusion
coefficient&quot; and similar is often used ambiguously as to whether they
refer to \(D\) or \(D_t\) (or sometimes even \(σ_t\)). Nor is the considered
dimensionality \(N\) always clearly indicated. Keeping \(N = 1\) and
handling multiple dimensions as independent random walks is a
practical approach to take (as long as it is valid in the
application). <sup>  <a role="doc-backlink" class="footref" id="fnr.12" href="#fn.12">12</a></sup>
</p>
</div>
</div>


<div class="outline-4" id="outline-container-org6441e4b">
<h4 id="org6441e4b"><span class="section-number-4">6.3.5.</span> Drift velocity</h4>
<div class="outline-text-4" id="text-6-3-5">
<p>
The drift velocity is the average speed at which electrons move
towards the anode in a gaseous detector under the influence of an
electric field. It is required to understand how recorded time
information relates to longitudinal shape information of recorded
data. Based on the so called &apos;friction force model&apos; an analytical
expression for the drift velocity in an electromagnetic field can be
written to:
</p>

<p>
\[
\vec{v} = \frac{e}{m_e} \frac{τ}{1 + ω²τ²}\left( \vec{E} + \frac{ωτ}{B} (\vec{E}
× \vec{B}) + \frac{ω²τ²}{B²}(\vec{E} · \vec{B}) \vec{B} \right)
\]
</p>

<p>
with the electron charge \(e\) and mass \(m_e\), in an electric field
\(\vec{E}\) and magnetic field \(\vec{B}\), given the Lamor frequency \(ω =
eB / m_e\) and the mean collision time \(τ\). (<a href="./bibliography.html#citeproc_bib_item_244">Zyla and others 2020</a>)
</p>

<p>
For detectors without a magnetic field \(B = 0, ω = 0\) and a constant,
homogeneous electric field \(E\), this reduces to the Townsend
expression:
</p>

<p>
\[
v = \frac{e E τ}{m_e}.
\]
</p>

<p>
If measurements are not available, these can also be computed by Magboltz
(<a href="./bibliography.html#citeproc_bib_item_43">Biagi 1995b</a>) or PyBoltz (<a href="./bibliography.html#citeproc_bib_item_27">Atoum et al. 2020</a>), which solve the
underlying transport equation, the Boltzmann equation.
</p>
</div>
</div>



<div class="outline-4" id="outline-container-sec:theory:gas_gain_polya">
<h4 id="sec:theory:gas_gain_polya"><span class="section-number-4">6.3.6.</span> Gas amplification</h4>
<div class="outline-text-4" id="text-sec:theory:gas_gain_polya">
<p>
In order to turn the individual electrons into a measurable signal,
gaseous detectors use some form of gas amplification. Details vary,
but it is usually a region in the gas volume close to the readout with
a very strong electric field (multiple \(\si{kV.cm^{-1}}\)) such that
each electron causes many secondary ionizations, leading to an
avalanche effect. In case of the detectors described in this thesis,
amplification factors between \(\numrange{2000}{4500}\) are desired.
</p>

<p>
An electron in a strong electric field \(\vec{E}\) will gain enough
energy to ionize an atom of the gas after a distance
</p>

<p>
\[
l \geq \frac{I}{|\vec{E}|}
\]
</p>

<p>
with the ionization potential of the gas, \(I\). This needs to be put
into relation with the mean free path,
eq. \eqref{eq:theory:mean_free_path_e}. If \(l \ll λ\) no secondary ionization
takes place and if \(l \gg λ\) every interaction leads to ionization,
likely resulting in a breakdown causing an arc (see also Paschen&apos;s
law (<a href="./bibliography.html#citeproc_bib_item_166">Paschen 1889</a>), not covered here). In the intermediate range some interactions
cause secondary ionization, some does not.
</p>

<p>
We can make the statistical argument that
</p>

<p>
\[
\mathcal{N} = e^{-l/λ}
\]
</p>

<p>
is the relative number of collisions with \(l &gt; λ\). This
allows to define the probability of finding a number of ionizations
per unit length to be
</p>

<p>
\[
P(l) = \frac{1}{λ} e^{-l / λ} = α,
\]
</p>

<p>
where we introduce the definition of the &apos;first Townsend coefficient&apos;,
\(α\).  We can insert the definition of the mean free path,
eq. \eqref{eq:theory:mean_free_path_e}, and \(l\) into this equation to obtain
</p>

\begin{equation}
\label{eq:theory:townsend_coefficient}
α(T) = \frac{pσ}{kT} \exp\left( - \frac{I}{|\vec{E}|}\frac{pσ}{kT}\right).
\end{equation}

<p>
With this we have an expression for the temperature and pressure
dependency of the first Townsend coefficient. <sup>  <a role="doc-backlink" class="footref" id="fnr.13" href="#fn.13">13</a></sup> This
derivation followed (<a href="./bibliography.html#citeproc_bib_item_192">Scharenberg 2019</a>) based on (<a href="./bibliography.html#citeproc_bib_item_84">Engel and Marton 1965</a>), but
see (<a href="./bibliography.html#citeproc_bib_item_18">Aoyama 1985</a>) for a more general treatment. Similarly to
diffusion and drift parameters, the first Townsend coefficient can be
computed numerically using tools like Magboltz.
</p>

<p>
Note that (<a href="./bibliography.html#citeproc_bib_item_191">Sauli 2014</a>) introduces the Townsend coefficient
as \(α = \frac{1}{λ}\), introducing a specific \(λ\) and \(σ\) referring to
the <i>ionization</i> mean free path and <i>ionizing</i> cross sections. This
can be misleading as it makes it seem as if the Townsend coefficient
is inversely proportional to the temperature. This is of course only
the case in the regime where each interaction actually causes another
ionization.
</p>

<p>
The first Townsend coefficient can be used to express the
multiplication factor – or gas amplification – used in a detector,
</p>

<p>
\[
G = e^{α x}
\]
</p>

<p>
as the number increases by \(α\) after each step \(\mathrm{d}x\).
</p>

<p>
The statistical distribution describing the number of electrons after
gas amplification is the Pólya distribution
</p>


\begin{equation}
\label{eq:theory:polya_distribution}
p(x) = \frac{N}{G} \frac{(1 + θ)^{1 + θ}}{Γ(1 + θ)}
\left(\frac{x}{G}\right)^θ \exp\left[- \frac{(1 + θ) x}{G}\right]
\end{equation}

<p>
where \(N\) is a normalization constant, \(θ\) is another parameter
performing shaping of the distribution and \(G\) is the effective gas
gain. \(Γ\) refers to the gamma function. It is to note that the term
&quot;polya distribution&quot; in this context is different from other
mathematical definitions, in which polya distribution usually means a
negative binomial distribution. The above definition goes back to
Alkhazov (<a href="./bibliography.html#citeproc_bib_item_5">Alkhazov 1970</a>) and in slight variations is
commonly used. Due to the complexity of this definition, care needs to
be taken when performing numerical fits to data with this function
(using bounded parameters and preferring more general non-linear
optimization routines instead of a normal Levenberg-Marquardt
non-linear least squares approach).
</p>

<p>
Based on eq. \eqref{eq:theory:townsend_coefficient} the largest impacts on the
expected gas amplification have the electric field, the choice of gas
and the temperature of the gas. While the former two parameters are
comparatively easy to control, the temperature in the amplification
region may vary and is hard to measure. As such depending on the
detector details and application, gas gain variations are expected and
corrections based on a running gas gain value may be necessary.
</p>

<p>
As the large number of interactions in the amplification region can
excite many atoms of the (typically) noble gas, UV photons can be
produced. Their mean free path is comparatively long relative to the
size of the amplification region. They can start further avalanches,
potentially away from the location of the initial avalanche start,
lowering spatial resolution and increasing apparent primary electron
counts. Molecular gases are added – often only in small fractions –
to the gas mixture to provide rotational or vibrational modes to
dissipate energy without emitting UV photons. In this context the
molecular additions are called &apos;quencher gases&apos;.
</p>
</div>
</div>

<div class="outline-4" id="outline-container-org57aa44b">
<h4 id="org57aa44b"><span class="section-number-4">6.3.7.</span> Energy resolution</h4>
<div class="outline-text-4" id="text-6-3-7">
<p>
Because of the statistical processes associated with the full
detection method used in gaseous detectors, even a perfect delta like
signal in energy, will lead to a natural spread of the measured
signal. The convolution of different ionization yields, potential
losses and gas gain variation all contribute to such a spread.
</p>

<p>
As such a typical measure of interest for gaseous detectors is the
energy resolution, which is commonly defined by
</p>

<p>
\[
ΔE = \frac{σ}{E}
\]
</p>

<p>
where \(σ\) is the standard deviation of the normal distribution
associated with the resolved peak in the detectors data, assuming a –
for practical purposes – delta peak as the input spectrum. Sometimes
definitions using the full width at half maximum (FWHM) are also used
in place of \(σ\). Typical values for the energy resolution defined like
this are smaller than \(\SI{15}{\%}\).
</p>

<p>
If the absolute magnitude of the \(σ\) at a given energy is constant,
which at least is partially reasonable as the width is not fully due
to energy dependent effects, the energy resolution is proportional to
\(1/E\).
</p>

<p>
The Fano factor (<a href="./bibliography.html#citeproc_bib_item_86">Fano 1963</a>), defined by the variance over the mean of
a distribution \(F = σ² / μ\) (typically within some time window),
improves the ideal energy resolution. It arises in the associated
statistical processes, because there are a finite number of possible
interaction states. For X-rays an additional aspect is due to the
maximum energy transferable into the gas due to the X-rays energy. In
practice though the energy resolution of gaseous detectors is usually
limited by other effects.
</p>
</div>

<div class="outline-5" id="outline-container-org28f94cb">
<h5 id="org28f94cb"><span class="section-number-5">6.3.7.1.</span> More notes on Fano factor   <span class="tag">  <span class="extended">extended</span></span></h5>
<div class="outline-text-5" id="text-6-3-7-1">
<p>
The Fano factor is related to the fact that the average energy needed
to produce an electron-ion pair in each interaction. 
</p>

<p>
(<a href="./bibliography.html#citeproc_bib_item_136">Kolanoski and Wermes 2020</a>) derives the Fano factor on page 783 in
sec. 17.10.2. The relationship to the W-value is studied in
(<a href="./bibliography.html#citeproc_bib_item_55">Bronic 1992</a>) and mentioned in (<a href="./bibliography.html#citeproc_bib_item_191">Sauli 2014</a>) on
page 62.  
</p>
</div>
</div>
</div>

<div class="outline-4" id="outline-container-sec:theory:escape_peaks_55fe">
<h4 id="sec:theory:escape_peaks_55fe"><span class="section-number-4">6.3.8.</span> Escape photons and peaks | 55Fe as a typical calibration source</h4>
<div class="outline-text-4" id="text-sec:theory:escape_peaks_55fe">
<p>
Finally, gaseous detectors need to be calibrated, monitored and
tested. This is commonly done with a \cefe source. \cefe is a
radioactive isotope of iron, which decays under inverse beta decay to
\(\ce{^{55}Mn}\). Due to the required restructuring of the electronic
shells, the manganese is in an excited state. While the emission of an
Auger electron with \(\SI{5.19}{keV}\) dominates with a probability of
\(\SI{60}{\%}\), as an X-ray source the Kα₁ and Kα₂ lines with
combined energies of about \(\SI{5.9}{keV}\) are of note.
</p>

<p>
When using such a \cefe source as a calibration source for an argon
filled gaseous detector, the \(\SI{5.9}{keV}\) photons will produce a
photoelectron in argon. Mostly an inner shell electron will be
liberated, producing a photoelectron of around \(\SI{2.7}{keV}\). The
excited argon atom can now emit an Auger electron in about
\(\SI{85}{\%}\) of cases, which will fully deposit its remaining energy
into the surrounding gas via further ionizations, resulting in the
&apos;photopeak&apos; at around \(\SI{5.9}{keV}\).
</p>

<p>
If however another photon is produced with an energy below the \(K 1s\)
energy of argon (\(\SI{3.2}{keV}\)) – for example via Kα₁ or Kα₂
fluorescence of argon, both at about \(\SI{2.95}{keV}\) – such a photon
has a very long absorption length in the gas volume, about
\(l_{\text{abs}} = \SI{3.5}{cm}\)
(cf. fig. <a href="#fig:theory:transmission_examples">1</a>). This can cause it to
easily escape the active detection region, especially if the sensitive
region of the detector is comparatively small. The result is a
measured signal of \(E_i - E_k = \SI{5.9}{keV} - \SI{2.95}{keV} \approx
\SI{2.9}{keV}\), called the &apos;escape
peak&apos;. (<a href="./bibliography.html#citeproc_bib_item_191">Sauli 2014</a>; <a href="./bibliography.html#citeproc_bib_item_136">Kolanoski and Wermes 2020</a>; <a href="./bibliography.html#citeproc_bib_item_115">Hubbell and Seltzer 1996</a>)
</p>

<p>
Such an additional escape peak is useful as a calibration tool, as it
gives two distinct peaks in a \cefe calibration spectrum, which can be
utilized for an energy calibration. One important consideration of
such an escape peak is however, that this escape peak of about
\(\SI{3}{keV}\) is not equivalent to a real \(\SI{3}{keV}\) X-ray. As the
original X-ray is still the \(\SI{5.9}{keV}\) photon with its distinct
absorption length, the geometric properties of ensembles of escape
peak events and real \(\SI{3}{keV}\) photons is different. This will be
important later in sec. <a href="./background.html#sec:background:mlp:effective_efficiency">12.4.7</a>.
</p>
</div>
</div>
</div>
</div>

<div id="footnotes"><h2 class="footnotes">Footnotes: </h2><div class="footdef"><sup>  <a role="doc-backlink" class="footnum" id="fn.1" href="#fnr.1">1</a></sup> <div role="doc-footnote" class="footpara">  <p class="footpara">
Outside of vetoes to tag muons that cause fluorescence for
example. 
</p></div></div>

<div class="footdef"><sup>  <a role="doc-backlink" class="footnum" id="fn.2" href="#fnr.2">2</a></sup> <div role="doc-footnote" class="footpara">  <p class="footpara">
<a href="https://henke.lbl.gov/optical_constants/">https://henke.lbl.gov/optical_constants/</a> 
</p></div></div>

<div class="footdef"><sup>  <a role="doc-backlink" class="footnum" id="fn.3" href="#fnr.3">3</a></sup> <div role="doc-footnote" class="footpara">  <p class="footpara">
<a href="https://github.com/SciNim/xrayAttenuation">https://github.com/SciNim/xrayAttenuation</a>
</p></div></div>

<div class="footdef"><sup>  <a role="doc-backlink" class="footnum" id="fn.4" href="#fnr.4">4</a></sup> <div role="doc-footnote" class="footpara">  <p class="footpara">
Note that there are different common
parametrizations of the Bethe-Bloch equation.
</p></div></div>

<div class="footdef"><sup>  <a role="doc-backlink" class="footnum" id="fn.5" href="#fnr.5">5</a></sup> <div role="doc-footnote" class="footpara">  <p class="footpara">
Energies of muons detected near Earth&apos;s surface
are in this range precisely because they are MIPs. Below and above the
much stronger interactions result either in stopping and decay or loss
until they are in the MIP range.
</p></div></div>

<div class="footdef"><sup>  <a role="doc-backlink" class="footnum" id="fn.6" href="#fnr.6">6</a></sup> <div role="doc-footnote" class="footpara">  <p class="footpara">
The calculation is a &quot;hybrid&quot; Monte Carlo
approach. We don&apos;t sample a large number of muons and transport them
through the atmosphere. We just compute the loss through the
atmosphere and allow the muon to decay randomly, dropping a single
data point. This is for simplicity on the one hand and the fact that
there is a very sharp transition of &apos;most muons traverse&apos; to
&apos;essentially no muons traverse&apos; the atmosphere at a given energy. For
that reason the flux in <a href="#fig:theory:muon_flux_surface:final">#fig:theory:muon_flux_surface:final</a> at low
energies is to be taken with a grain of salt. The fluxes are literally
mappings from data points in <a href="#fig:theory:muon_flux_surface:initial">#fig:theory:muon_flux_surface:initial</a>
to the corresponding energy left at the surface (i.e. assuming no
muons decay). Further the \(\SI{300}{MeV}\) energy left is already well
inside the energy range where a large number of muons would already decay.
</p></div></div>

<div class="footdef"><sup>  <a role="doc-backlink" class="footnum" id="fn.7" href="#fnr.7">7</a></sup> <div role="doc-footnote" class="footpara">  <p class="footpara">
<a href="https://geant4.cern.web.ch">https://geant4.cern.web.ch</a>
</p></div></div>

<div class="footdef"><sup>  <a role="doc-backlink" class="footnum" id="fn.8" href="#fnr.8">8</a></sup> <div role="doc-footnote" class="footpara">  <p class="footpara">
<a href="http://web.vu.lt/ff/a.poskus/mcnelectron/">http://web.vu.lt/ff/a.poskus/mcnelectron/</a>
</p></div></div>

<div class="footdef"><sup>  <a role="doc-backlink" class="footnum" id="fn.9" href="#fnr.9">9</a></sup> <div role="doc-footnote" class="footpara">  <p class="footpara">
<a href="https://www.nndc.bnl.gov/endf-b8.0/index.html">https://www.nndc.bnl.gov/endf-b8.0/index.html</a>
</p></div></div>

<div class="footdef"><sup>  <a role="doc-backlink" class="footnum" id="fn.10" href="#fnr.10">10</a></sup> <div role="doc-footnote" class="footpara">  <p class="footpara">
<a href="https://lxcat.net">https://lxcat.net</a>
</p></div></div>

<div class="footdef"><sup>  <a role="doc-backlink" class="footnum" id="fn.11" href="#fnr.11">11</a></sup> <div role="doc-footnote" class="footpara">  <p class="footpara">
Its usefulness depends on the angle from which
different aspects are discussed of course. We mainly use it to
understand the gas amplification later.
</p></div></div>

<div class="footdef"><sup>  <a role="doc-backlink" class="footnum" id="fn.12" href="#fnr.12">12</a></sup> <div role="doc-footnote" class="footpara">  <p class="footpara">
Later in chapter
<a href="#sec:background:mlp:event_generation">12.4.2</a> we will discuss Monte Carlo event
generation, which use the diffusion coefficient as an input to
generate clusters after drift. Distance \(x\) and \(y\) are each sampled
individually according to eq. \eqref{eq:gas_physics:diffusion_after_drift} and
combined to a radial distance from the cluster center.
</p></div></div>

<div class="footdef"><sup>  <a role="doc-backlink" class="footnum" id="fn.13" href="#fnr.13">13</a></sup> <div role="doc-footnote" class="footpara">  <p class="footpara">
This will be a useful reference later when discussing
possible temperature effects of the detector operated at CAST.
</p></div></div>

</div>
<div class="hint-message">Click on any heading marked '<span class="extended">extended</span>' to open it</div>
</div>
</body>
</html>
