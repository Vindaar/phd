#+startup: beamer
#+LATEX_CLASS: beamer

# set to 16:9
#+LaTeX_CLASS_options: [8pt,aspectratio=169]

# disable the navigation bar 
#+LaTeX_HEADER:\beamertemplatenavigationsymbolsempty

# enable page numbers in footer
# define the page numbers without total numbers
#+LATEX_HEADER:\setbeamertemplate{footline}{% 
#+LATEX_HEADER:  \hfill% 
#+LATEX_HEADER:  \usebeamercolor[fg]{page number in head/foot}% 
#+LATEX_HEADER:  \usebeamerfont{page number in head/foot}% 
#+LATEX_HEADER:  \insertframenumber%
#+LATEX_HEADER:  %\,/\,\inserttotalframenumber
#+LATEX_HEADER:  \kern1em\vskip2pt% 
#+LATEX_HEADER:}

# define additional packages
#+LATEX_HEADER: \usepackage{siunitx}
#+LATEX_HEADER: \sisetup{mode=text,range-phrase = {\text{~to~}}, range-units=single, print-unity-mantissa=false}
#+LATEX_HEADER: \usepackage{mhchem}
#+LATEX_HEADER: \usepackage{booktabs}
#+LaTeX_HEADER: \usepackage{pdfpages}
#+LATEX_HEADER: \usetheme{Singapore}
#+LATEX_HEADER: \usecolortheme{rose}
#+LATEX_HEADER: \usefonttheme{professionalfonts}
#+LATEX_HEADER: \usepackage{luatextra}
#+LATEX_HEADER: \useinnertheme{rounded}

# set org beamer export options
# headline of depth 2 == frame (H:2)
# no table of contents (toc:nil)
#+OPTIONS: ^:nil H:2 toc:nil

#+BEAMER_HEADER: \titlegraphic{%
#+BEAMER_HEADER: \includegraphics[height=.15\textheight]{../../../Documents/Talks/logos/PI_logo_blue}
#+BEAMER_HEADER: \hfill
#+BEAMER_HEADER: \includegraphics[height=.15\textheight]{../../../Documents/Talks/logos/unibonn-logo}}

# ##############################
# Define the monokai colors
# ##############################

#+LATEX_HEADER: \definecolor{monokai_bg}{RGB}{39, 40, 34}
#+LATEX_HEADER: \definecolor{monokai_fg}{RGB}{241, 235, 235}
#+LATEX_HEADER: \definecolor{monokai_0}{RGB}{72,72,62}
#+LATEX_HEADER: \definecolor{monokai_1}{RGB}{220,37,102}
#+LATEX_HEADER: \definecolor{monokai_3}{RGB}{212,201,110}
#+LATEX_HEADER: \definecolor{monokai_4}{RGB}{85,188,206}
# something is wrong with this 5
# however, looks better on slides
#+LATEX_HEADER: \definecolor{monokai_5}{RGB}{80,40,151}
# this is the original, but it's too bright
# #+LATEX_HEADER: \definecolor{monokai_5}{RGB}{147, 88, 254}
#+LATEX_HEADER: \definecolor{monokai_7}{RGB}{172,173,161}
#+LATEX_HEADER: \definecolor{monokai_8}{RGB}{118,113,94}
#+LATEX_HEADER: \definecolor{monokai_9}{RGB}{250,39,114}
#+LATEX_HEADER: \definecolor{monokai_11}{RGB}{231, 219, 117}
#+LATEX_HEADER: \definecolor{monokai_15}{RGB}{207,208,194}
#+LATEX_HEADER: \definecolor{monokai_green}{RGB}{166, 226, 46}
#+LATEX_HEADER: \definecolor{monokai_orange}{RGB}{253, 151, 31}
#+LATEX_HEADER: \definecolor{monokai_term_5}{RGB}{175,135,255}

# ##############################
# change output of code blocks to use monokai
# ##############################
#+LaTeX_HEADER: \usemintedstyle{monokai}

# ##############################
# Change the style of bullet points and enumerations to flat circles
# ##############################

# change singapore style of items from ball to circle
#  #+LATEX_HEADER: \setbeamertemplate{itemize items}[circle]
#  #+LATEX_HEADER: \setbeamertemplate{enumerate items}[circle]
# in one line:
#+LATEX_HEADER: \setbeamertemplate{items}[circle]


# ##############################
# Apply different colors to the theme
# ##############################

# structure is the default theme color
#+LATEX_HEADER: \setbeamercolor{structure}{fg=monokai_0}
#+LATEX_HEADER: \setbeamercolor{title}{fg=monokai_5}
#+LATEX_HEADER: \setbeamercolor{frametitle}{fg=monokai_5}
# text of the block title
#+LATEX_HEADER: \setbeamercolor{block title}{fg=monokai_5}
# background of block title
# #+LATEX_HEADER: \setbeamercolor{block title}{bg=monokai_7}
# text in a block
#+LATEX_HEADER: \setbeamercolor{block body}{fg=monokai_bg}
#+LATEX_HEADER: \setbeamercolor{itemize item}{fg=monokai_orange}
# enumeration points (thanks to rounded theme under item projected)
#+LATEX_HEADER: \setbeamercolor{item projected}{bg=monokai_orange}
#+LATEX_HEADER: \setbeamercolor{item projected}{fg=monokai_0}
#+LATEX_HEADER: \setbeamercolor{normal text}{fg=monokai_bg}
#+LATEX_HEADER: \setbeamercolor{alerted text}{fg=monokai_1}

#+LATEX_HEADER: \newcommand{\beamerbullet}{\textcolor{monokai_orange}{\textbullet}}
#+LATEX_HEADER: \newcommand{\orange}{\textcolor{monokai_orange}}
#+LATEX_HEADER: \newcommand{\green}{\textcolor{monokai_green}}
#+LATEX_HEADER: \newcommand{\red}{\textcolor{red}}
# 
#+LATEX_HEADER: \usepackage{amsmath}
#+LATEX_HEADER: \usepackage{unicode-math}
#+LATEX_HEADER: \setmathfont{Latin Modern Math}


#+LATEX_HEADER: \newcommand{\Lhood}{\mathcal{L}}

# title and subtitle
#+TITLE: Search for solar axions using a 7-GridPix IAXO prototype detector at CAST
#+AUTHOR: Sebastian Schmidt
#+DATE: $25^{\text{th}}$ April 2024

#+LATEX_HEADER: \institute{University of Bonn}

* Talk for my PhD defense - structure                              :noexport:


1. Introduction metaphysics and how that can lead to the axion
2. Axion? Ah, can produce in the Sun!
3. Expected axion spectrum, blackbody similar
4. Helioscope experiments, example CAST
5. Show our setup at CAST, data taking there. What kind of detector?
6. Show exploded detector. Focus on GridPix functionality (slides
   showing detection we once created), and Septemboard. Other detector
   features only name them.
7. X-ray telescope! Creates image of axions! Small enough to fit on
   center chip! Show expected axion image
8. GridPix function: Can deduce expectation of signals!
   - low axion rate: background dominant
9. Try to find signal in tracking dataset! 
10. Biggest question: how find little signal in dataset?
11. Classifier needed: past used likelihood, now simple 2 layer MLP!
12. All know machine learning needs lots of data:
    - simulate X-ray events. Monte Carlo fun!
    - Background data of outer chips! Not needed for physics limit!
13. Verification based on CDL and 55Fe data
14. What happens if applied to center chip?
15. Septem veto! Show schematic from thesis what idea is!
    - improvement single -> septem full chip clusters or suppression
16. Have background. Can extract candidates.
17. Compute a limit! Quick (!) intro Bayesian unbinned likelihood
    method
18. Inclusion of systematics via nuisance parameters -> expensive
    evaluation. MCMC for rescue. MCMC example
19. Background interpolation and candidate sampling (& expected limits)
20. Mention signal inputs
21. Mention evaluated different setups etc, focus on best one. Show
    expected & observed limit
22. Method fully generic, also computed limits for axion-photon &
    chameleon.
23. Result presented, but not done: Something very important to me,
    reproducibility in science. Made sure all results reproducible,
    i.e. data and plots in theses have code snippets / commands
    associated with them, plots made available. Also as CSV for all
    plots other people can reproduce them / include them. All code
    made available. All data made available.
24. If you are physicist and only take one thing from my presentation,
    please focus on allowing your results to be reproducible. Not only
    for other people, but also 'future you'!
25. Summary and thank you.
    
** Thoughts about test talk on XXX

** Thoughts about the actual presentation

* Physics, math and philosophy?
** Physics, math and philosophy?

Mathematics has long served as a guiding tool in theoretical
physics. Symmetries, mathematical 'beauty' and the notion of
'naturalness' have long been successfully used to predict new
phenomena in physics to be verified experimentally later. Although we
may never know whether the universe actually cares about our funny
intuitions, in the lack of empirical evidence to the contrary we tend
to stick to such approaches. Arguably in the infinite space of
mathematical avenues physics /could/ express itself, this may be
considered an application of Occam's razor to physics. In a sense it
underlines the intersection between philosophy, mathematics and
physics and indicates that the term 'philosophy of nature' is not
actually wholly inapplicable to modern physics. And so we arrive at
one of our current representations of this in the form of an angle $θ$
in quantum chromodynamics. Measurements seem to indicate this angle is
essentially zero. However, we tend to reject the idea that our
universe simply /is/ such that $θ$ happens to be close to
zero. Instead we derive the simplest explanations as to why this might
be the case. And who can blame us when the result of accepting $θ = 0$
by nature would lead us precisely nowhere? Finding an explanation
spawns a new hypothetical friend in our zoo of particles, the
/axion/. The point of this thesis is to continue the search for this
zoo member by way of staring into the core of the Sun. With the help
of a very large number of /virtual/ photons we will attempt to entice
some axions to become real X-rays, directly detectable by us. And if
we fail in this quest, we can put our philosopher's hat back on and
muse about how little our axion friends want to dance with our virtual
photons.





























* Detector and data taking at CAST
** Septemboard detector
*** 
:PROPERTIES:
:BEAMER_col: 0.6
:BEAMER_env: block
:END:

- 7 GridPix, one center (contains axion image), 6 as a 'veto ring'
- shutter based readout, \SI{2.4}{\second} frames at CAST  
- FADC measuring decoupled signals from center grid
  - trigger (close shutter early)
  - theoretically as means to get longitudinal event
    shape information. Latter very problematic due to noise & required
    signal integration
- 2 scintillators
  - top veto paddle
  - SiPM behind board
  \Rightarrow only have trigger information of each, and only in 2018
  data taking

*** 
:PROPERTIES:
:BEAMER_col: 0.4
:BEAMER_env: block
:END:

#+begin_center
#+ATTR_LATEX: :height 0.8\textheight
[[~/org/Figs/detector-mk4c-assembly2_with_axion_image.png]]
#+end_center
    
** Data taking

- Run-1: 2014/15 data taking with single GridPix detector (not part of
  this talk)
  
- \orange{Run-2}: October 2017 - March 2018

- \orange{Run-3}: October 2018 - December 2018

- X-ray reference data: February 2019 detector in CAST detector lab
  behind X-ray tube

#+ATTR_LATEX: :align lrrrrr
|       | Solar tracking [h] | Active s. [h] | Background [h] | Active b. [h] | Active % |
|-------+--------------------+---------------+----------------+---------------+----------|
| Run-2 |             106.01 |         94.12 |        2401.43 |       2144.67 |     89.3 |
| Run-3 |              74.29 |         66.92 |        1124.93 |       1012.68 |     90.0 |
| Total |             180.30 |        161.05 |        3526.36 |       3157.35 |     89.5 |

* Data reconstruction
** Example events
- X-ray & background events geometrically different
- compute properties to classify them by
- background can vary *wildly*. Majority track like
*** Calibration ($^{55}\text{Fe}$ X-ray)
:PROPERTIES:
:BEAMER_col: 0.5
:BEAMER_env: block
:END:
#+begin_center
#+ATTR_LATEX: :width 1.0\textwidth
[[~/org/Figs/statusAndProgress/exampleEvents/calibration_event_run266_chip3_event5791_region_crAll_hits_200.0_250.0_centerX_4.5_9.5_centerY_4.5_9.5_applyAll_true_numIdxs_100.pdf]]
#+end_center
  
*** Background
:PROPERTIES:
:BEAMER_col: 0.5
:BEAMER_env: block
:END:
#+begin_center
#+ATTR_LATEX: :width 1.0\textwidth
[[~/org/Figs/statusAndProgress/exampleEvents/background_event_run267_chip3_event1456_region_crAll_hits_200.0_250.0_centerX_4.5_9.5_centerY_4.5_9.5_applyAll_true_numIdxs_100.pdf]]
#+end_center


** Data reconstruction

#+begin_center
#+ATTR_LATEX: :width 0.8\textwidth
[[~/org/Figs/InGridRecoExplanation/ingrid_data_reco_explanation_bigger.pdf]]
#+end_center

** Main properties for background rejection

#+begin_center
#+ATTR_LATEX: :width 0.75\textwidth
[[~/org/Figs/InGridPropExplanation/pixels.pdf]]
#+end_center

** Main properties for background rejection

#+begin_center
#+ATTR_LATEX: :width 0.75\textwidth
[[~/org/Figs/InGridPropExplanation/center.pdf]]
#+end_center

** Main properties for background rejection

#+begin_center
#+ATTR_LATEX: :width 0.75\textwidth
[[~/org/Figs/InGridPropExplanation/long_short_axis.pdf]]
#+end_center

** Main properties for background rejection

#+begin_center
#+ATTR_LATEX: :width 0.75\textwidth
[[~/org/Figs/InGridPropExplanation/rms_trans.pdf]]
#+end_center

** Main properties for background rejection

#+begin_center
#+ATTR_LATEX: :width 0.75\textwidth
[[~/org/Figs/InGridPropExplanation/eccentricity.pdf]]
#+end_center

** Main properties for background rejection

#+begin_center
#+ATTR_LATEX: :width 0.75\textwidth
[[~/org/Figs/InGridPropExplanation/frac_in_trans_rms.pdf]]
#+end_center

** Main properties for background rejection

#+begin_center
#+ATTR_LATEX: :width 0.75\textwidth
[[~/org/Figs/InGridPropExplanation/length_div_rms_trans.pdf]]
#+end_center

** Data instability

*** 
:PROPERTIES:
:BEAMER_col: 0.45
:BEAMER_env: block
:END:

- minor detector instabilities observed
- variation in gas gain   
- recorded charge (small dots, each chip different color) shows
  inverse correlation to temperature in CAST hall $T_{\text{amb}}$
  (purple line)

*** Temperature dependence of observed charge
:PROPERTIES:
:BEAMER_col: 0.6
:BEAMER_env: block
:END:
#+ATTR_LATEX: :width 1\textwidth
[[~/phd/Figs/behavior_over_time/correlation_feCharge_all_chips_gasgain.pdf]]

** Data instability

Gas gain $⇒$ cluster energy. Multiple gas gains per run (instead of a single) to improve stability.

*** Median cluster energy stability improved by $\SI{90}{min}$ time bins

#+ATTR_LATEX: :width 0.8\textwidth
[[~/phd/Figs/behavior_over_time/median_energy_binned_vs_unbinned.pdf]]

# * Old
# ROPERTIES:
# EAMER_col: 0.5
# EAMER_env: block
# ND:
# BEGIN_CENTER 
# ATTR_LATEX: :width 1.0\textwidth
# [[~/org/Figs/SPSC_Jan_2021/background_mean_energy_binned_90_min_filtered_crSilver_gasgain_runWide.pdf]]
# END_CENTER
# 
# * New 
# ROPERTIES:
# EAMER_col: 0.5
# EAMER_env: block
# ND:
# BEGIN_CENTER 
# ATTR_LATEX: :width 1.0\textwidth
# [[~/org/Figs/SPSC_Jan_2021/background_mean_energy_binned_90_min_filtered_crSilver_gasgain_90min.pdf]]
# END_CENTER

* Background rejection

** X-ray reference data :noexport:
*** 
:PROPERTIES:
:BEAMER_col: 0.45
:BEAMER_env: block
:END:
*THIS IS LNL, NEED MLP*

- taken data behind X-ray tube w/ 8 different targets
- each target defines reference for X-rays at that energy
- energies between obtained using linear interpolation  
- use 3 geometric properties to define likelihood cluster is X-ray
\[
\mathcal{L}(ε, f, l) = \mathcal{L}_{ε}(ε) \cdot \mathcal{L}_{f}(f) \cdot \mathcal{L}_l(l)
\]
- define $-\ln\mathcal{L}$ cut based on it, such that
\[
ε_{\text{eff}} = \frac{∫_0^{L'} -\ln \mathcal{L}(ε, f, l) \,
\mathrm{d} L}{∫_0^{∞} -\ln \mathcal{L}(ε, f, l) \, \mathrm{d} L} =
\text{EDF @ } ε_{\text{eff}}
\]

*** REPLACE BY PLOT WITH ~energyFromCdl~!
:PROPERTIES:
:BEAMER_col: 0.6
:BEAMER_env: block
:END:
#+BEGIN_CENTER 
#+ATTR_LATEX: :width 1.0\textwidth
[[~/org/Figs/statusAndProgress/cdl_energy_spectra.pdf]]
#+END_CENTER

** Cluster discrimination methods

*** Likelihood cut - $\ln\mathcal{L}$ 
:PROPERTIES:
:BEAMER_col: 0.52
:BEAMER_env: block
:END:

- use 3 geometric properties to define likelihood cluster is X-ray
  ($ε, f, l$ referring to 3 variables introduced before)
\[
\mathcal{L}(ε, f, l) = \mathcal{P}_{ε}(ε) \cdot \mathcal{P}_{f}(f) \cdot \mathcal{P}_l(l)
\]
- define $-\ln\mathcal{L}$ cut based on it, such that
\[
ε_{\text{eff}} = \frac{∫_0^{L'} -\ln \mathcal{L}(ε, f, l) \,
\mathrm{d} L}{∫_0^{∞} -\ln \mathcal{L}(ε, f, l) \, \mathrm{d} L} =
\text{EDF @ } ε_{\text{eff}}
\]
- data to define cuts: *calibration data* behind X-ray tube

*** MultiLayer Perceptron - MLP
:PROPERTIES:
:BEAMER_col: 0.52
:BEAMER_env: block
:END:

- fully connected feed-forward network
- 1 input neuron per geometric property, plus 2 non-geometric
- 2 hidden layers (300 neurons each), tanh (or ReLU) activation
  function, 2 output neurons, sigmoid on output layer, mean squared
  error as loss function
- trained using stochastic gradient descent (SGD) for 500k epochs
- training data 250k background and 250k X-rays (and same number for
  validation)

- background data: from actual background dataset 
- X-ray training data: *fully simulated events*, inputs:
  - gas diffusion, gas gain, target energy

** Background rate without vetoes

*** 
:PROPERTIES:
:BEAMER_col: 0.45
:BEAMER_env: block
:END:

- MLP slightly higher rate *where real X-rays expected*
- at significantly better signal efficiency
Mean background rate (in $\SIrange{0.2}{8}{keV}$):
- $\ln\mathcal{L}: \SI{1.94e-05}{keV^{-1}.cm^{-2}.s^{-1}}$
- $\text{MLP}: \SI{2.56e-05}{keV^{-1}.cm^{-2}.s^{-1}}$

*** Background rate MLP ($ε = \SI{97}{\%}$) vs. LnL ($ε = \SI{80}{\%}$)
:PROPERTIES:
:BEAMER_col: 0.6
:BEAMER_env: block
:END:

#+ATTR_LATEX: :width 1\textwidth
[[~/org/Figs/statusAndProgress/backgroundRates/limitMethodTalk/background_rate_run2_3_mlp_0.99_no_vetoes.pdf]]

** MLP :noexport:

- Multilayer Perceptron: fully connected feed-forward network
- *MATH?*
  $n_i,k = Σ_j f(n_j,(k-1) · ω_j,(k-1)) + b_j$
  -> Neuron i on layer k is sum of all neuron inputs on layer (k-1)
  multiplied by the weight of each fed through the activation function
  f, plus a potential bias offset
- one input neuron per geometric property, plus 2 non-geometric
- 2 hidden layers, 300 neurons each, tanh (or ReLU) activation
  function, 2 output neurons, sigmoid on output layer, mean squared
  error as loss function
- trained using stochastic gradient descent (SGD) for 500k epochs
- training data 250k background and 250k X-rays (and same number for
  validation)

- background data: from actual background dataset
- X-ray data: fully simulated events, inputs:
  - gas diffusion, gas gain, target energy
- *appendix slide on simulation?*
- *HOW TO DEDUCE CUT VALUES, PURE SIMULATION TOO, PER ENERGY RANGE*
      
** Vetoes

*** Scintillator veto
:PROPERTIES:
:BEAMER_col: 0.45
:BEAMER_env: block
:END:

- scintillators used as pure cut
- for every event passing $\ln\mathcal{L}$, veto if there was
  scintillator trigger $\SI{2.5}{\micro\second}$ before event
- very likely event caused by cosmic
- indeed: most effective in $\sim\SI{3}{keV}$ Ar & $\sim\SI{8}{keV}$
  Cu lines

*** FADC veto
:PROPERTIES:
:BEAMER_col: 0.45
:BEAMER_env: block
:END:

- FADC records induced charge on grid
- only triggers above ~1.5 keV  
- amount of charge and time information
- for X-rays expected FADC signals estimated from X-ray energy and diffusion
- using calibration data determine 1st & 99th percentile of signal
  rise time, cut anything outside
$↦$ efficiency: $\SI{98}{\percent}$

# *** Background rate for end of 2018 data using 'scinti veto'
# :PROPERTIES:
# :BEAMER_col: 0.6
# :BEAMER_env: block
# :END:
#   #+begin_center
# #+ATTR_LATEX: :width 1.0\textwidth
# [[~/org/Figs/statusAndProgress/backgroundRates/IAXO_CM_2022/background_rate_crGold_scinti.pdf]]
# #+end_center

  
** 'Septem veto'

*** 
:PROPERTIES:
:BEAMER_col: 0.45
:BEAMER_env: block
:END:

$\ln\mathcal{L}$ method looks at *individual* chips. The 'septem veto'
extends this by:
1. perform $\ln\mathcal{L}$ cut on center chip as usual
2. for all clusters $c_i$ on center chip passing $\ln\mathcal{L}$ cut, read
   event data from all chips, build a 'septem event'
3. perform *full* reconstruction (clustering, geometry & energy
   calc. of found clusters) on the 'septem event'
4. if data outside center chip is clustered together with $c_i$, it
   likely now *won't* pass $\ln\mathcal{L}$ cut
5. veto the original cluster $c_i$

$↦$ efficiency: $\SI{78.41}{\%}$
   
*** Example of event vetoed by 'septem veto'
:PROPERTIES:
:BEAMER_col: 0.6
:BEAMER_env: block
:END:

#+begin_center
#+ATTR_LATEX: :width 0.9\textwidth
[[~/org/Figs/statusAndProgress/exampleEvents/background_septem_vetoed.pdf]]
#+end_center

** 'Line veto'
*** Septem veto is good. Can we do more?
:PROPERTIES:
:BEAMER_col: 0.45
:BEAMER_env: block
:END:

- ionization is statistical. May be gaps in ionization larger than
  cluster 'search range'
- \Rightarrow not only use distance (i.e. clustering). If eccentric cluster
  "points" at cluster passing
- blue cluster 'points' at red cluster in center (green line cuts
  black circle)
$↦$ efficiency: $\SI{86.02}{\%}$  

*** Example of event vetoed by 'line veto'
:PROPERTIES:
:BEAMER_col: 0.6
:BEAMER_env: block
:END:

#+begin_center
#+ATTR_LATEX: :width 0.9\textwidth
[[~/org/Figs/statusAndProgress/exampleEvents/background_event_vetoed_by_lineveto.pdf]]
#+end_center


** Efficiencies of Septem and line veto

*** Septem and line veto are not "free"
- efficiencies of septem and line veto come down to random coincidence
  rates
- only center chip has FADC as trigger
- if no trigger: $\SI{2.2}{s}$ long shuttered readout (due to
  full readout of all 7 GridPix taking $>\SI{200}{ms}$; low rate
  experiment therefore reduce dead time)
- X-ray like cluster on center chip: correlation on outside
  chips might be random coincidence!
*** How to estimate efficiency? Generate events with guaranteed random coinc.
- take center chip events with X-ray like clusters
- bootstrap new 'septem events' by combining with outer GridPix data
  of *other events*
- resulting events either do \green{not trigger} septem / line veto or \orange{trigger} $⇒$ *random coincidence*
- fraction of septem / line veto triggers of these events: _random
  coincidence rate_ ($= 1 - \text{efficiency}$)
*** Efficiencies of both vetoes
- septem veto: $\SI{78.41}{\%}$
- line veto: $\SI{86.02}{\%}$
- $⇒$ good improvement to background rate, but high loss in sensitivity!
  

** Background rates with all vetoes

*** Background rate with all vetoes                         :B_block:BMCOL:
:PROPERTIES:
:BEAMER_col: 0.45
:BEAMER_env: block
:END:
- scintillator
- fadc
- septem veto
- line veto
Mean background rates (in $\SIrange{0.2}{8}{keV}$):
- $\ln\mathcal{L}: \SI{7.98e-06}{keV^{-1}.cm^{-2}.s^{-1}}$
- $\text{MLP}: \SI{1.14e-05}{keV^{-1}.cm^{-2}.s^{-1}}$ (and at $ε = \SI{80}{\%}: \SI{7.17e-06}{keV^{-1}.cm^{-2}.s^{-1}}$)
*** Rates comparing $\ln\mathcal{L}$ and MLP with / without vetoes :B_block:BMCOL:
:PROPERTIES:
:BEAMER_env: block
:BEAMER_col: 0.6
:END:

#+ATTR_LATEX: :width 1.0\textwidth
[[~/org/Figs/statusAndProgress/backgroundRates/limitMethodTalk/background_rate_run2_3_mlp_0.99_plus_vetoes.pdf]]

** Background over whole chip
- application of septem & line veto to whole chip
- yields > 4 times reduction in total background: $\sim{43000} ⇒ \sim{8900}$ clusters
*** Background whole chip w/o vetoes
:PROPERTIES:
:BEAMER_col: 0.5
:BEAMER_env: block
:END:
#+begin_center
#+ATTR_LATEX: :width 1.0\textwidth
[[~/org/Figs/statusAndProgress/IAXO_TDR/background_clusters_2017_2018_no_septemveto.pdf]]
#+end_center
*** Background whole chip w/ vetoes
:PROPERTIES:
:BEAMER_col: 0.5
:BEAMER_env: block
:END:
#+begin_center
#+ATTR_LATEX: :width 1.0\textwidth
[[~/org/Figs/statusAndProgress/background_clusters_all_vetoes_dbscan_2017_2018_cdl_mapping_fixed_noise_filtered.pdf]]
#+end_center

* Background rate :noexport:

In practice not a single ideal combination of parameters & vetoes to
use. Instead: Decide on the "best" setting by their result on expected
limits! 


* Limit method :noexport:

- what's a limit?

- Show at least the basic Q = XY  

- MATH
  
- systematics
  - table of
- systematics make likelihood L more complicated! Integrating out
  parameters to get posterior distribution becomes intractable with 4
  additional parameters!
- Markov Chain MonteCarlo (MCMC) for the rescue
- Metropolis-Hastings algorithm
- used instead of integration to evaluate posterior  

- build 5(?) chains of 150k elements, burn-in is first 50k
- 
  
* Limit method
** A limit?

Context:
- experiment looking for new physics
- 1 dataset sensitive, 1 dataset insensitive
- any entry in sensitive dataset (after cleaning) a _candidate_ drawn
  from $s + b$ (signal + background) distribution
- any entry in insensitive dataset drawn from background only

Goal:
- compute upper limit on parameter describing new physics
  (e.g. coupling constant) 
- at \SI{95}{\%} confidence $s + b$ compatible with $b$ only

Condition and definition:
- assume experiment has some "channels" of our choice, modeled by
  Poisson distribution
  
  \[
  P_{\text{Pois}}(k; λ) = \frac{λ^k e^{-λ}}{k!}.
  \]
  
- probability for $k$ counts given mean counts $λ$
- $λ$ defined by our signal (theory!) & background hypotheses (data!)
- $k$ given by experimental data (candidates!)

- likelihood to measure experimental data given hypotheses: product of
  all channels
  \[
  \mathcal{L}(λ) = \prod_i P_{i, \text{Pois}}(k_i; λ_i) = \prod_i \frac{λ_i^{k_i} e^{-λ_i}}{k_i!}
  \]
- function of $λ$ and not $k$! 
  
** Practical likelihood

Now define likelihood for a limit calculation (technically extended
likelihood function):

\[
\Lhood(g_{ae}) = \prod_i \frac{P_{\text{pois}}(c_i; s_i(g_{ae}) + b_i)}{P_{\text{pois}}(c_i; b_i)}
\]

- $s_i, b_i, c_i$ signal, background, candidates in channel $i$
- $s_i(g_{ae})$ depends on the coupling constant
- _important_: $\Lhood$ explicitly is *not* a function of the candidates
  $c_i$. Our intent is to ask "likelihood to measure *our data* given
  our model".
  
  $⇒$ $\Lhood(g_{ae})$ encodes all relevant info about an experiment,
  multiple $\Lhood$  can be combined!

Simplify to:

\[
\Lhood(g_{ae}) = e^{-s_\text{tot}} \prod_i \left(1 + \frac{s_i}{b_i}\right)^{c_i}
\]

Choice of channels $i$ is ours! Choose bins in time, s.t. either 0 or
1 candidates in bin:

\[
\Lhood(g_{ae}) = e^{-s_\text{tot}} \prod_i \left(1 +
\frac{s_i}{b_i}\right)^{\orange{c_i =\, 0 \text{ or } 1}}
\]

** Signal $s_i$

  Each parameter with a subscript $i$ is the corresponding value that
  the candidate has we are currently looking at (e.g. $E_i$ is the energy
  of the recorded candidate $i$ used to compute the expected signal).
  #+NAME: eq:limit_method_signal_si
  \begin{equation}
  s_i(g_{ae}) = f(g_{ae}, E_i) · A · t · P_{a \rightarrow γ} · ε(E_i) · r(x_i, y_i)
  \end{equation}
  where:
  - $f(g_{ae}, E_i)$: axion flux at energy $E_i$ in units of
    $\si{keV^{-1}.cm^{-2}.s^{-1}}$ and function of $g_{ae}²$
  - $A$: area of the magnet bore in $\si{cm²}$
  - $t$: tracking time in $\si{s}$
  - $P_{a \rightarrow γ}$: conversion probability of the axion
    converting into a photon computed via
    \[
    P_{a \rightarrow γ} = \left( \frac{g_{aγ} B L}{2} \right)²
    \]
    written in *natural units* ($B, L$ need conversion!)
    #+begin_comment
    (meaning if we wish to use the equation
    as written here we need to convert $B = \SI{9}{T}$ and $L =
    \SI{9.26}{m}$ into values expressed in powers of electronvolt
    $\si{eV}$.
    #+end_comment
  - $ε(E_i)$: combined detection efficiency, i.e. the
    combination of X-ray telescope effective area, the transparency of
    the detector window and the absorption probability of an X-ray in
    the gas.
  - $r(x_i, y_i)$: expected amount of flux from the solar axion
    flux after it is focused by the X-ray telescope in the readout
    plane of the detector at the candidate's position $(x_i, y_i)$
    (this requires a raytracing model). It should be expressed as a
    fractional value in units of $\si{cm^{-2}}$.
  As a result the units of $s_i$ are then given in
  $\si{keV^{-1}.cm^{-2}}$ with the tracking time integrated out.

** Ingredients in detail :noexport:

*** Axion flux

- rescale by $\frac{g_{ae}²}{g^{'2}_{ae}}$
   
*** Area, tracking time and conversion probability

- magnet bore area: $A = π · (\SI{2.15}{cm})² = \SI{14.52}{cm²}$
- tracking time: $t = \SI{161}{h}$ (dead time taken into account)
- $P_{aγ}(g_{aγ} = \SI{1e-12}{GeV⁻¹}) = \num{1.78e-21}$

#+begin_src nim :exports none
import unchained, math
defUnit(GeV⁻¹)
func conversionProb(B: Tesla, L: Meter, g_aγ: GeV⁻¹): UnitLess =
  result = pow( (g_aγ * B.toNaturalUnit * L.toNaturalUnit / 2.0), 2.0 )
echo conversionProb(9.0.T, 9.26.m, 1e-12.GeV⁻¹)
#+end_src

#+RESULTS:
: 1.70182e-21 UnitLess
  
*** Efficiency

- plot of combined efficiencies with constituents
  
*** Axion image

- plot with strongback

*** Background

- 2D interpolation plot at one energy


** Axion flux

- $g_{aγ} = \SI[print-unity-mantissa=false]{1e-12}{GeV^{-1}}$ kept constant and implies negligible
  contribution to axion flux (relevant only for $P_{aγ}$)
- LLNL telescope focus point in center of detector chamber
- axion image computed at median conversion point of axion produced
  X-rays, $\sim\SI{0.3}{cm}$ behind detector window
  ($\sim\SI{1.2}{cm}$ from focal spot)

*** Axion flux from Sun                                           :B_block:
:PROPERTIES:
:BEAMER_env: block
:BEAMER_col: 0.5
:END:

#+ATTR_LATEX: :width 1\textwidth
[[~/org/Figs/statusAndProgress/differential_flux_sun_earth_distance/differential_solar_axion_fluxg_ae_1e-13_g_ag_1e-12_g_aN_1e-15_0.989AU.pdf]]

*** Axion image from raytracing
:PROPERTIES:
:BEAMER_env: block
:BEAMER_col: 0.5
:END:

[[~/org/Figs/statusAndProgress/axionImages/axion_image_2018_1487_93_0.989AU_with_window.pdf]]

** Detection efficiency and constant contributions                                

*** 
:PROPERTIES:
:BEAMER_env: block
:BEAMER_col: 0.4
:END:

**** Area, time and conversion

- magnet bore area: $A = π · (\SI{2.15}{cm})² = \SI{14.52}{cm²}$
- tracking time: $t = \SI{161}{h}$ (dead time taken into account)
- $P_{aγ}(g_{aγ} = \SI{1e-12}{GeV⁻¹}) = \num{1.78e-21}$

#+begin_src nim :exports none
import unchained, math
defUnit(GeV⁻¹)
func conversionProb(B: Tesla, L: Meter, g_aγ: GeV⁻¹): UnitLess =
  result = pow( (g_aγ * B.toNaturalUnit * L.toNaturalUnit / 2.0), 2.0 )
echo conversionProb(9.0.T, 9.26.m, 1e-12.GeV⁻¹)
#+end_src

#+RESULTS:
: 1.70182e-21 UnitLess
**** Detection efficiency dominated by:
- $\SI{300}{\nano\meter}$ SiN window at low energie
- LLNL telescope efficiency at medium to high energies
- Argon absorption at high energy and around fluorescence near $\SI{3}{keV}$ 

*** 
:PROPERTIES:
:BEAMER_env: block
:BEAMER_col: 0.6
:END:
#+ATTR_LATEX: :width 1\textwidth
[[~/org/Figs/statusAndProgress/detector/detection_efficiency.pdf]]

** Background $b_i$

Background dataset: define background hypothesis $b_i$, as a
function of candidate pos. $(x_i, y_i)$ and energy $E_i$,

\[
b_i(x_i, y_i, E_i) = \frac{I(x_i, y_i, E_i)}{W(x_i, y_i, E_i)}
\]

where $I$ is an 'intensity' defined over clusters within a range $R$
and a normalization weight $W$:

\[
I(x, y, E) = \sum_{b ∈ \{ \mathcal{D}(\vec{x}_b, \vec{x}) \leq R \}}\mathcal{M}(\vec{x}_b, E_b)
  = \sum_{b ∈ \{ \mathcal{D}(\vec{x}_b, \vec{x}) \leq R \} } \exp \left[ -\frac{1}{2} \mathcal{D}² / σ² \right] \text{ for clarity w/o arguments}
\]

where we introduce $\mathcal{M}$ to refer to the measure we use and
$\mathcal{D}$ to our metric:

\begin{equation*}
\mathcal{D}( (\vec{x}_1, E_1), (\vec{x}_2, E_2)) =
  \begin{cases}
    (\vec{x}_1 - \vec{x}_2)² \text{ if } |E_1 - E_2| \leq R \\
    ∞ \text{ if } (\vec{x}_1 - \vec{x}_2)² > R² \\
    ∞ \text{ if } |E_1 - E_2| > R
  \end{cases}
\end{equation*}

Finally, the normalization weight is the 'volume' of our 'cylinder'
described by $\mathcal{M}$ and $\mathcal{D}$:

\[
W(x', y', E') = ∫_{\mathcal{D}(\vec{x'}, \vec{x}) \leq R} ∫_{E' - E_c}^{E' + E_c} \mathcal{M}(x', y')\, \mathrm{d}x\, \mathrm{d}y\, \mathrm{d} E
\]



** Background interpolation
Using background over whole chip, compute smooth interpolation using
weighted nearest neighbor approach.
# - [ ] redo k-d tree plot. In background_interpolation.nim
*** Cluster centers after logL cut & vetoes                      :B_column:
:PROPERTIES:
:BEAMER_env: block
:BEAMER_col: 0.5
:END:
#+ATTR_LATEX: :width 1\textwidth
[[~/org/Figs/statusAndProgress/background_clusters_all_vetoes_dbscan_2017_2018_cdl_mapping_fixed_noise_filtered.pdf]]

*** Interpolation of background at specific energy               :B_column:
:PROPERTIES:
:BEAMER_env: block
:BEAMER_col: 0.5
:END:
#+ATTR_LATEX: :width 1\textwidth
[[~/org/Figs/statusAndProgress/limitSanityChecks/normalized_interpolation_at_3.0keV_ymax_5e-05.pdf]]


** Computing a limit

*** Limit definition                                             :B_column:
:PROPERTIES:
:BEAMER_env: block
:BEAMER_col: 0.4
:END:

#+begin_comment
With this in mind the "limit" is defined as the 95-th percentile of 
$\mathcal{L}(g)$  (the region $g < 0$ is
explicitly ignored, as a coupling constant cannot be negative! This
can be "rigorously" justified in Bayesian statistics by saying the
prior $π(g)$ is 0 for $g < 0$.).
#+end_comment

- Limit: 95-th percentile of $\mathcal{L}(g)$ *within the physical region of $g$*
- unphysical region excluded by prior $π(g)$
\[
π(g) = \begin{cases}
  1 \text{ if } g \geq 0 \\
  0 \text{ else}
  \end{cases}
\]
with the limit defined at $g'$ via the relation  
\[
0.95 = \frac{∫_{-∞}^{g'} \mathcal{L}(g) π(g) \, \mathrm{d}g}{∫_{-∞}^∞ \mathcal{L}(g) π(g) \, \mathrm{d}g}
\]




*** Likelihood $L(g_{ae}²)$ with limit                           :B_column:
:PROPERTIES:
:BEAMER_env: block
:BEAMER_col: 0.6
:END:
[[~/org/Figs/statusAndProgress/limitCalculation/mcmc_histo_example_limit_determination.pdf]]



* Systematics
** Systematics

| Uncertainty                                    | $s$ or $b$?    | rel. $σ$ [%] | bias?                             |
|------------------------------------------------+----------------+--------------+-----------------------------------|
| Earth $⇔$ Sun distance                         | $s$            |       0.7732 | none                              |
| Window thickness ($±\SI{10}{nm}$)              | $s$            |       0.5807 | none                              |
| Solar models                                   | $s$            |          < 1 | none                              |
| Magnet length ($-\SI{1}{cm}$)                  | $s$            |       0.2159 | likely 9.26m                      |
| Magnet bore diameter ($±\SI{0.5}{mm}$)         | $s$            |       2.3255 | measurements indicate 42.x - 43   |
| Window rotation (30° ± 0.5°)                   | $s$            |       0.1852 | none                              |
| Software efficiency                            | $s$            |        < 2.0 | exact value depends on parameters |
|------------------------------------------------+----------------+--------------+-----------------------------------|
| Gas gain time binning                          | $b$            |       0.2692 | to 0                              |
| Reference dist interp (CDL morphing)           | $b$            |       0.0844 | none                              |
|------------------------------------------------+----------------+--------------+-----------------------------------|
| Alignment (signal, related mounting)           | $s$ (position) |       0.5 mm | none                              |
| Detector mounting precision ($±\SI{0.25}{mm}$) | $s$ (position) |      0.25 mm | none                              |

*** Combined systematic $σ_i$
Compute based on sum of squares: $\bar{σ} = \sqrt{\sum_i σ_i²}$:
- $σ_s \leq \SI{3.38}{\percent}$ (assuming $σ_{\text{software}} = \SI{2}{\%}$)
- $σ_b = \SI{0.28}{\percent}$
- $σ_{xy} = \SI{5}{\percent}$ (chosen, uncertainty numbers are bounds)

** Likelihood with systematics

*** Bayesian approach to systematics
"Nuisance parameters" (NP) for each systematic $σ$:
  - signal (1): $θ_s$ with $σ_s$
  - background (1): $θ_b$ with $σ_b$
  - position (2): $θ_x, θ_y$ with $σ_{x,y}$
  ("Nuisance" $⇐$ do not care about their "value")

One normal distribution for each NP:
  \begin{align*}
  \mathcal{L}' &= \left(\prod_i \frac{P_{\text{pois}}(n_i; s_i'' + b_i')}{P_{\text{pois}}(n_i; b_i')}\right) \cdot \mathcal{N}(θ_s, σ_s)
  \cdot \mathcal{N}(θ_b, σ_b) \cdot \mathcal{N}(θ_x, σ_x) \cdot \mathcal{N}(θ_y, σ_y) \\
  \mathcal{L}'(g, θ_s, θ_b, θ_x, θ_y) &= e^{s'_\text{tot}} \prod_i (1 + \frac{s_i''}{b_i'}) ·
    \exp\left[-\frac{1}{2} \left(\frac{θ_s}{σ_s}\right)² 
      -\frac{1}{2} \left(\frac{θ_b}{σ_b}\right)² 
      -\frac{1}{2} \left(\frac{θ_x}{σ_x}\right)² 
      -\frac{1}{2} \left(\frac{θ_y}{σ_y}\right)² \right]
  \end{align*}

with $a' = a ( 1 + θ_a )$ and $a'' = a ( 1 + θ_a ) ( 1 + θ_x ) ( 1 + θ_y )$

- s.t. 0 yields our "best guess", $\mathcal{N}(θ_a = 0, σ_a) = 1$ ($\mathcal{L}$ unchanged) 
- deviation inc. / dec. related parameter (e.g. signal), but penalizes
  likelihood
  $\mathcal{N}(θ_a \neq 0, σ_a) < 1$

** Example of nuisance parameter effect


*** Position nuisance parameters $θ_x, θ_y$
:PROPERTIES:
:BEAMER_env: block
:BEAMER_col: 0.4
:END:

- $θ_x = θ_y = 0 ⇒$ axion image in chip center
- $θ_x, θ_y \neq 0 ⇒$ axion image moves, at $0.5$ on chip boundary
- *but* likelihood penalized by $\exp\left[ -\frac{θ_{x,y}}{2 σ_{x,y}²} \right]$

*** Axion image at $θ_x = θ_y = 0.6$
:PROPERTIES:
:BEAMER_env: block
:BEAMER_col: 0.6
:END:
[[~/org/Figs/statusAndProgress/limitSanityChecks/axion_image_limit_calc_theta_0_6.pdf]]

** Effect of $θ_x, θ_y$ on likelihood 

Comparison of examples with many candidates in signal sensitive
region. The larger the systematic ($σ_{x,y}$), the more spread out
contribution to $\mathcal{L}$ become. More sensitive to "regions of
large $s/b$"!

*** $σ_{x,y} = 0.05$                                             :B_column:
:PROPERTIES:
:BEAMER_env: block
:BEAMER_col: 0.5
:END:
#+ATTR_LATEX: :width 1\textwidth
[[~/org/Figs/statusAndProgress/limitSanityChecks/likelihood_sigma_0.05_manyθx_θy.pdf]]

*** $σ_{x,y} = 0.25$                                             :B_column:
:PROPERTIES:
:BEAMER_env: block
:BEAMER_col: 0.5
:END:
#+ATTR_LATEX: :width 1\textwidth
[[~/org/Figs/statusAndProgress/limitSanityChecks/likelihood_sigma_0.25_manyθx_θy.pdf]]

** How to compute marginal likelihood?

*** Likelihood with NPs is problematic
- $\mathcal{L'}$ a function of 5 parameters!
- $\text{EDF}(g_{ae}') \text{ @ } \SI{95}{\%}$ not well defined, infinite
  $g_{ae}'$
- need to remove NPs, but keep their effect on the likelihood  

*** Integration yields "marginal posterior likelihood"

[[~/org/Figs/statusAndProgress/limitCalculation/posterior_likelihood_annotated.pdf]]


** How to compute marginal likelihood?
# *** Calculating the marginal likelihood
# - marginal likelihood a 4-fold integral
# -   

*** Problems of computing the marginal likelihood
- marginal likelihood a 4-fold integral
- evaluation of single likelihood value non trivial
- $⇒$ regular numerical integration routines (simpson, adaptive
  Gauss-Kronrod quadrature etc.) way too slow
  $↦$ "curse of dimensionality"!
*** Solution: Monte Carlo!
In particular: Metropolis-Hastings (Markov Chain Monte Carlo) to
  evaluate integration space
1. let $\vec{x}$ be a random vector in the integration space and
  $f(\vec{x})$ the function to evaluate
2. pick new point $\vec{x}'$ in vicinity of $\vec{x}$
3. sample from random uniform in $[0, 1]$: $u$
4. accept $\vec{x}'$ if $u < \frac{f(\vec{x}')}{f(\vec{x})}$, add
  $\vec{x}'$ to chain and iterate (if $f(\vec{x}') > f(\vec{x})$ every
   new link accepted!)
5. long enough chain samples integration space well
6. throw away first N elements as "burn in"
7. generate multiple chains to be less dependent on starting position

$⇒$ $\mathcal{L}_m$ computed by histogram of sampled $g_{ae}²$ values

** Example MCMCs

MCMC will sample most in space of high likelihood.

*** $g_{ae}², θ_y, θ_x$                                          :B_column:
:PROPERTIES:
:BEAMER_env: block
:BEAMER_col: 0.5
:END:
#+ATTR_LATEX: :width 1\textwidth
[[~/org/Figs/statusAndProgress/limitCalculation/MCMC/mcmc_lines_long_0_likelihood_chain_burnin_20000.png]]

*** $θ_s, θ_b, g_{ae}²$                                          :B_column:
:PROPERTIES:
:BEAMER_env: block
:BEAMER_col: 0.5
:END:
#+ATTR_LATEX: :width 1\textwidth
[[~/org/Figs/statusAndProgress/limitCalculation/MCMC/mcmc_lines_long_0_likelihood_chain_burnin_20000_thetas_sb.png]]

** Fun examples!

... but with certain conditions it can get lost!

If MCMC enters region where $f(\vec{x}') \approx f(\vec{x})$ (e.g. no
contribution to $f$ anymore) *every* new link will be accepted,
because $\frac{f(\vec{x}')}{f(\vec{x})} \approx 1$!

*** $θ_s, θ_b, g_{ae}²$                                          :B_column:
:PROPERTIES:
:BEAMER_env: block
:BEAMER_col: 0.5
:END:
#+ATTR_LATEX: :width 1\textwidth
[[~/org/Figs/statusAndProgress/limitCalculation/MCMC/mcmc_lines_long_0_likelihood_chain_thetas_sb.png]]

*** $θ_x, θ_y, g_{ae}²$                                          :B_column:
:PROPERTIES:
:BEAMER_env: block
:BEAMER_col: 0.5
:END:
#+ATTR_LATEX: :width 1\textwidth
[[~/org/Figs/statusAndProgress/limitCalculation/MCMC/mcmc_lines_long_0_likelihood_chain_thetas_xy.png]]


* Expected limit
** Expected limit? Sampling toy candidates from background model
*** Example: Background model of energy bins $E_i$, then:
  
  \[
  B = \{ P_{\text{Pois}}(k; λ = b_i) \: | \: \text{for all energy bins } E_i \},
  \]

- background is the set of all energy bins $E_i$,
- each bin content a Poisson distribution with a mean and expectation value of $λ = b_i$ counts

- toy candidates: sample from each channel's Poisson distribution   

# *** In practice
# - sample from $(x, y, E)$ dependent background model by
#   generating a grid
# - in each grid volume distribute all drawn candidates uniformly in
#   position and energy

*** Expected limit:  
Median of sets of representative toy candidates. If $L_{t_i}$ is
the limit of the toy candidate set $t_i$, the expected limit
$\langle L \rangle$ is
defined as

\[
\langle L \rangle = \mathrm{median}( \{ L_{t_i} \} )
\]

If the number of toy candidate sets is large enough the expected
limit should prove accurate. The real limit will then be below or
above with $\SI{50}{\%}$ chance each.

** Candidate sampling

Build $(x, y, E)$ grid of $(10, 10, 20)$ cells. Each cell defines its
own expected counts as a Poisson distribution based on clusters in
that cell.

*** Slice (in energy) of sampling grid                           :B_column:
:PROPERTIES:
:BEAMER_env: block
:BEAMER_col: 0.5
:END:
#+ATTR_LATEX: :width 1\textwidth
[[~/org/Figs/statusAndProgress/limitSanityChecks/candidate_sampling_grid_index_5.pdf]]

*** Example toy candidates                                       :B_column:
:PROPERTIES:
:BEAMER_env: block
:BEAMER_col: 0.5
:END:
#+ATTR_LATEX: :width 1\textwidth
[[~/org/Figs/statusAndProgress/limitSanityChecks/example_candidates_1.pdf]]

** Example of expected limit

Computing many limits based on different toy candidate sets yields a
histogram whose median is the expected limit.

*** Histogram of $\num{30000}$ MC limits
#+ATTR_LATEX: :width 0.7\textwidth
[[~/org/Figs/statusAndProgress/mc_limit_lkMCMC_skInterpBackground_nmc_30000_uncertainty_ukUncertain_σs_0.0328_σb_0.0028_posUncertain_puUncertain_σp_0.0500nmc_30k_pretty.pdf]]

** Different expected limits
\vspace{-0.1cm}
*** \normalsize Many different parameters (plus a large selection of additional parameters)
\small
- $\ln \mathcal{L}$ or MLP
- software efficiency of method
- FADC veto software efficiency
- Septem veto: yes/no 
- Line veto: yes/no

Each may improve background rate, but limits sensitivity.

Compute expected limit for each setup: method with \green{best expected limit} $⇒$ *final method*
\normalsize

*** \normalsize Limit given as $g_{ae}·g_{aγ}$ with $g_{aγ} = \SI{1e-12}{GeV^{-1}}$ 

\footnotesize
#+ATTR_LATEX: :align lrllrrr :booktabs t
| Method |  $ε_S$ | Septem | Line | Total eff. | Limit no signal [$\si{GeV^{-1}}$] | Expected limit [$\si{GeV^{-1}}$] |
|--------+--------+--------+------+------------+-----------------------------------+----------------------------------|
| MLP    | 0.9107 | false  | true |     0.7677 | \num{5.96e-23}                    | \num{7.58e-23}                   |
| MLP    | 0.9718 | false  | true |     0.8192 | \num{5.84e-23}                    | \num{7.62e-23}                   |
| MLP    | 0.8473 | false  | true |     0.7142 | \num{6.14e-23}                    | \num{7.67e-23}                   |
| LnL    |    0.9 | false  | true |     0.7586 | \num{6.04e-23}                    | \num{7.74e-23}                   |
| MLP    | 0.7925 | false  | true |     0.6681 | \num{6.28e-23}                    | \num{7.82e-23}                   |
| MLP    | 0.7398 | false  | true |     0.6236 | \num{6.57e-23}                    | \num{7.99e-23}                   |
| LnL    |    0.8 | false  | true |     0.6743 | \num{6.31e-23}                    | \num{8.02e-23}                   |
| MLP    | 0.9718 | true   | true |     0.6976 | \num{6.24e-23 }                   | \num{8.06e-23}                   |
# | MLP    | 0.9107 | true   | true  |     0.6537 |      4.1370e-21 |                       8.0878e-23 |
# | MLP    | 0.9718 | true   | false |     0.7467 |      3.5802e-21 |                       8.1653e-23 |
# | MLP    | 0.9107 | true   | false |     0.6998 |      3.9193e-21 |                       8.2216e-23 |

\vspace{-0.15cm}
to compare: $g_{ae}·g_{aγ} = \SI{8.1e-23}{GeV^{-1}}$ CAST 2013

# OLd table
# | Method |  $ε_S$ | FADC  | $ε_{\text{FADC}}$ | Septem | Line | Total eff. | Limit no signal | Expected Limit |
# |--------+--------+-------+-------------------+--------+------+------------+-----------------+----------------|
# | MLP    | 0.9107 | true  |              0.98 | false  | true |     0.7677 |      6.0315e-23 |     7.7467e-23 |
# | MLP    | 0.9718 | true  |              0.98 | false  | true |     0.8192 |      5.7795e-23 |     7.8596e-23 |
# | MLP    | 0.8474 | true  |              0.98 | false  | true |     0.7143 |      6.1799e-23 |     7.8876e-23 |
# | LnL    |    0.9 | true  |              0.98 | false  | true |     0.7587 |      6.1524e-23 |     7.9443e-23 |
# | LnL    |    0.9 | false |              0.98 | false  | true |     0.7742 |      6.0733e-23 |     8.0335e-23 |
# | MLP    | 0.7926 | true  |              0.98 | false  | true |     0.6681 |      6.5733e-23 |     8.1569e-23 |
# | MLP    | 0.7398 | true  |              0.98 | false  | true |     0.6237 |      6.8165e-23 |     8.1907e-23 |
\normalsize

*** Expected limits :noexport:

The first row has 30k samples, the rest 15k. All other entries in the
table on the slide above only 1k samples.

|      ε | Type | Scinti | FADC | ε_FADC | Septem | Line | eccLineCut | ε_Septem | ε_Line | ε_SeptemLine | Total eff. | Limit no signal [GeV⁻¹] | Expected limit [GeV⁻¹] | Exp. limit variance [GeV⁻¹] | Exp. limit σ [GeV⁻¹] |
|--------+------+--------+------+--------+--------+------+------------+----------+--------+--------------+------------+-------------------------+------------------------+-----------------------------+----------------------|
| 0.9107 | MLP  | true   | true |   0.98 | false  | true |          1 |   0.7841 | 0.8602 |       0.7325 |     0.7677 |              5.9559e-23 |             7.5824e-23 |                  6.0632e-51 |           7.7866e-26 |
| 0.9718 | MLP  | true   | true |   0.98 | false  | true |          1 |   0.7841 | 0.8602 |       0.7325 |     0.8192 |              5.8374e-23 |             7.6252e-23 |                  1.6405e-50 |           1.2808e-25 |
| 0.8474 | MLP  | true   | true |   0.98 | false  | true |          1 |   0.7841 | 0.8602 |       0.7325 |     0.7143 |              6.1381e-23 |             7.6698e-23 |                  1.4081e-50 |           1.1866e-25 |
| 0.7926 | MLP  | true   | true |   0.98 | false  | true |          1 |   0.7841 | 0.8602 |       0.7325 |     0.6681 |              6.2843e-23 |             7.8222e-23 |                  1.3589e-50 |           1.1657e-25 |
| 0.7398 | MLP  | true   | true |   0.98 | false  | true |          1 |   0.7841 | 0.8602 |       0.7325 |     0.6237 |              6.5704e-23 |             7.9913e-23 |                  1.6073e-50 |           1.2678e-25 |


* Sneak preview :noexport:
** Sneak preview

*** Axion image
- turns out LLNL beamline designed to have focal point in center of
  detector chamber instead of at readout plane
- changes axion image, real image closer to focal point, mean
  conversion $\SI{1.2}{cm}$ behind detector window

*** Old axion image                                              :B_column:
:PROPERTIES:
:BEAMER_env: block
:BEAMER_col: 0.5
:END:
#+ATTR_LATEX: :width 0.8\textwidth
[[~/org/Figs/statusAndProgress/axionImages/axion_image_2018_1470_12.2mm.pdf]]
  
*** New axion image                                              :B_column:
:PROPERTIES:
:BEAMER_env: block
:BEAMER_col: 0.5
:END:
#+ATTR_LATEX: :width 0.8\textwidth
[[~/org/Figs/statusAndProgress/axionImages/axion_image_2018_1497.2mm.pdf]]
** Sneak preview

*** Axion image
- turns out LLNL beamline designed to have focal point in center of
  detector chamber instead of at readout plane
- changes axion image, real image closer to focal point, mean
  conversion $\SI{1.2}{cm}$ behind detector window

*** Expected limit for new axion image                           :B_column:
:PROPERTIES:
:BEAMER_env: block
:BEAMER_col: 0.5
:END:

Expected limit based on 1000 toy candidate sets for best case from
previous table:

\[
g_{ae} g_{aγ} = \SI{7.609e-23}{GeV^{-1}}
\]

compared to current best limit:

\[
g_{ae} g_{aγ} = \SI{8.1e-23}{GeV^{-1}}
\]

*** New axion image                                              :B_column:
:PROPERTIES:
:BEAMER_env: block
:BEAMER_col: 0.5
:END:
#+ATTR_LATEX: :width 0.8\textwidth
[[~/org/Figs/statusAndProgress/axionImages/axion_image_2018_1497.2mm.pdf]]


* Summary & conclusion

** Summary & conclusion

*** Summary
- Bayesian statistics based limit calculation method
- nuisance parameters encoding systematic uncertainties for signal (1),
  background (1) and position (2)
- limit computed by $\text{(E)CDF}(\mathcal{L}(g_{ae}²)) = 0.95$
- MCMC to evaluate likelihood space with nuisance parameters
  
*** Conclusion
- different setups evaluated by their expected limits
- best \orange{expected limit} for MLP ($ε_S = \num{0.91}$) + line veto:
  \[
  g_{ae} · g_{aγ} = \SI{7.58e-23}{GeV^{-1}}
  \]
  compared to the *real* limit (CAST 2013):
  \[
  g_{ae} · g_{aγ} = \SI{8.1e-23}{GeV^{-1}}
  \]

$⇒$ Let's see what our real data & limit looks like!  



* Backup     :B_appendix:
:PROPERTIES:
:BEAMER_env: appendix
:END:

** Sun $⇔$ Earth distance during CAST data taking

#+ATTR_LATEX: :width 0.7\textwidth
[[~/org/Figs/statusAndProgress/systematics/sun_earth_distance_cast_solar_tracking.pdf]]


** Background rate without vetoes

*** Background rate MLP ($ε = \SI{80}{\%}$) vs. LnL ($ε = \SI{80}{\%}$)
#+ATTR_LATEX: :width 0.7\textwidth
[[~/org/Figs/statusAndProgress/backgroundRates/limitMethodTalk/background_rate_run2_3_mlp_0.85_plus_vetoes.pdf]]

** Systematics. s/b for candidates

#+ATTR_LATEX: :width 0.7\textwidth
[[~/org/Figs/statusAndProgress/limitSanityChecks/candidates_signal_over_background_many_sens.pdf]]

